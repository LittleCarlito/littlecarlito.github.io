var hs=Object.defineProperty;var us=(o,e,t)=>e in o?hs(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var g=(o,e,t)=>us(o,typeof e!="symbol"?e+"":e,t);import{G as ae,R as J,v as pt,c as Re,d as ds,M as _s,j as fs}from"./rapier-BPrAnZxF.js";import{O as zt,M as k,B as jt,F as yt,T as ps,a as it,b as Kt,L as ms,c as Ae,d as Vt,C as W,e as te,S as Wt,P as gs,D as Ts,f as D,g as ce,h as q,V as P,i as le,j as S,I as ys,k as xs,l as V,m as Yt,n as Ss,o as We,p as bs,q as nt,r as Xt,R as ot,N as Qt,s as As,t as Ye,u as Es,v as ne,w as ye,x as ws,y as Is,z as vs,A as Os,E as Ns,G as Cs,H as Xe,J as qt,K as rt,Q as Ms,U as Rs,W as Ls,X as Zt,Y as at,Z as De,_ as Ps,$ as Gs,a0 as Fs,a1 as Ds,a2 as Hs,a3 as ks,a4 as Bs,a5 as $s,a6 as xt,a7 as St,a8 as bt,a9 as At,aa as Us,ab as zs,ac as js,ad as pe,ae as He,af as Le,ag as Pe,ah as Ks,ai as Jt,aj as Vs,ak as Ws,al as Ys,am as Xs,an as Qs,ao as qs,ap as Zs,aq as Js,ar as ei,as as ti,at as si,au as z,av as ii,aw as es,ax as ni,ay as oi,az as ri,aA as ts,aB as Et,aC as ai}from"./three-DqnnhEUs.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();var N=Object.freeze({Linear:Object.freeze({None:function(o){return o},In:function(o){return this.None(o)},Out:function(o){return this.None(o)},InOut:function(o){return this.None(o)}}),Quadratic:Object.freeze({In:function(o){return o*o},Out:function(o){return o*(2-o)},InOut:function(o){return(o*=2)<1?.5*o*o:-.5*(--o*(o-2)-1)}}),Cubic:Object.freeze({In:function(o){return o*o*o},Out:function(o){return--o*o*o+1},InOut:function(o){return(o*=2)<1?.5*o*o*o:.5*((o-=2)*o*o+2)}}),Quartic:Object.freeze({In:function(o){return o*o*o*o},Out:function(o){return 1- --o*o*o*o},InOut:function(o){return(o*=2)<1?.5*o*o*o*o:-.5*((o-=2)*o*o*o-2)}}),Quintic:Object.freeze({In:function(o){return o*o*o*o*o},Out:function(o){return--o*o*o*o*o+1},InOut:function(o){return(o*=2)<1?.5*o*o*o*o*o:.5*((o-=2)*o*o*o*o+2)}}),Sinusoidal:Object.freeze({In:function(o){return 1-Math.sin((1-o)*Math.PI/2)},Out:function(o){return Math.sin(o*Math.PI/2)},InOut:function(o){return .5*(1-Math.sin(Math.PI*(.5-o)))}}),Exponential:Object.freeze({In:function(o){return o===0?0:Math.pow(1024,o-1)},Out:function(o){return o===1?1:1-Math.pow(2,-10*o)},InOut:function(o){return o===0?0:o===1?1:(o*=2)<1?.5*Math.pow(1024,o-1):.5*(-Math.pow(2,-10*(o-1))+2)}}),Circular:Object.freeze({In:function(o){return 1-Math.sqrt(1-o*o)},Out:function(o){return Math.sqrt(1- --o*o)},InOut:function(o){return(o*=2)<1?-.5*(Math.sqrt(1-o*o)-1):.5*(Math.sqrt(1-(o-=2)*o)+1)}}),Elastic:Object.freeze({In:function(o){return o===0?0:o===1?1:-Math.pow(2,10*(o-1))*Math.sin((o-1.1)*5*Math.PI)},Out:function(o){return o===0?0:o===1?1:Math.pow(2,-10*o)*Math.sin((o-.1)*5*Math.PI)+1},InOut:function(o){return o===0?0:o===1?1:(o*=2,o<1?-.5*Math.pow(2,10*(o-1))*Math.sin((o-1.1)*5*Math.PI):.5*Math.pow(2,-10*(o-1))*Math.sin((o-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(o){var e=1.70158;return o===1?1:o*o*((e+1)*o-e)},Out:function(o){var e=1.70158;return o===0?0:--o*o*((e+1)*o+e)+1},InOut:function(o){var e=2.5949095;return(o*=2)<1?.5*(o*o*((e+1)*o-e)):.5*((o-=2)*o*((e+1)*o+e)+2)}}),Bounce:Object.freeze({In:function(o){return 1-N.Bounce.Out(1-o)},Out:function(o){return o<1/2.75?7.5625*o*o:o<2/2.75?7.5625*(o-=1.5/2.75)*o+.75:o<2.5/2.75?7.5625*(o-=2.25/2.75)*o+.9375:7.5625*(o-=2.625/2.75)*o+.984375},InOut:function(o){return o<.5?N.Bounce.In(o*2)*.5:N.Bounce.Out(o*2-1)*.5+.5}}),generatePow:function(o){return o===void 0&&(o=4),o=o<Number.EPSILON?Number.EPSILON:o,o=o>1e4?1e4:o,{In:function(e){return Math.pow(e,o)},Out:function(e){return 1-Math.pow(1-e,o)},InOut:function(e){return e<.5?Math.pow(e*2,o)/2:(1-Math.pow(2-e*2,o))/2+.5}}}}),be=function(){return performance.now()},ci=function(){function o(){this._tweens={},this._tweensAddedDuringUpdate={}}return o.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(t){return e._tweens[t]})},o.prototype.removeAll=function(){this._tweens={}},o.prototype.add=function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},o.prototype.remove=function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},o.prototype.update=function(e,t){e===void 0&&(e=be()),t===void 0&&(t=!1);var i=Object.keys(this._tweens);if(i.length===0)return!1;for(;i.length>0;){this._tweensAddedDuringUpdate={};for(var s=0;s<i.length;s++){var n=this._tweens[i[s]],r=!t;n&&n.update(e,r)===!1&&!t&&delete this._tweens[i[s]]}i=Object.keys(this._tweensAddedDuringUpdate)}return!0},o}(),me={Linear:function(o,e){var t=o.length-1,i=t*e,s=Math.floor(i),n=me.Utils.Linear;return e<0?n(o[0],o[1],i):e>1?n(o[t],o[t-1],t-i):n(o[s],o[s+1>t?t:s+1],i-s)},Bezier:function(o,e){for(var t=0,i=o.length-1,s=Math.pow,n=me.Utils.Bernstein,r=0;r<=i;r++)t+=s(1-e,i-r)*s(e,r)*o[r]*n(i,r);return t},CatmullRom:function(o,e){var t=o.length-1,i=t*e,s=Math.floor(i),n=me.Utils.CatmullRom;return o[0]===o[t]?(e<0&&(s=Math.floor(i=t*(1+e))),n(o[(s-1+t)%t],o[s],o[(s+1)%t],o[(s+2)%t],i-s)):e<0?o[0]-(n(o[0],o[0],o[1],o[1],-i)-o[0]):e>1?o[t]-(n(o[t],o[t],o[t-1],o[t-1],i-t)-o[t]):n(o[s?s-1:0],o[s],o[t<s+1?t:s+1],o[t<s+2?t:s+2],i-s)},Utils:{Linear:function(o,e,t){return(e-o)*t+o},Bernstein:function(o,e){var t=me.Utils.Factorial;return t(o)/t(e)/t(o-e)},Factorial:function(){var o=[1];return function(e){var t=1;if(o[e])return o[e];for(var i=e;i>1;i--)t*=i;return o[e]=t,t}}(),CatmullRom:function(o,e,t,i,s){var n=(t-o)*.5,r=(i-e)*.5,a=s*s,c=s*a;return(2*e-2*t+n+r)*c+(-3*e+3*t-2*n-r)*a+n*s+e}}},li=function(){function o(){}return o.nextId=function(){return o._nextId++},o._nextId=0,o}(),ct=new ci,C=function(){function o(e,t){t===void 0&&(t=ct),this._object=e,this._group=t,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=N.Linear.None,this._interpolationFunction=me.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=li.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1}return o.prototype.getId=function(){return this._id},o.prototype.isPlaying=function(){return this._isPlaying},o.prototype.isPaused=function(){return this._isPaused},o.prototype.getDuration=function(){return this._duration},o.prototype.to=function(e,t){if(t===void 0&&(t=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=t<0?0:t,this},o.prototype.duration=function(e){return e===void 0&&(e=1e3),this._duration=e<0?0:e,this},o.prototype.dynamic=function(e){return e===void 0&&(e=!1),this._isDynamic=e,this},o.prototype.start=function(e,t){if(e===void 0&&(e=be()),t===void 0&&(t=!1),this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var i in this._valuesStartRepeat)this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||t){if(this._propertiesAreSetUp=!0,!this._isDynamic){var s={};for(var n in this._valuesEnd)s[n]=this._valuesEnd[n];this._valuesEnd=s}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,t)}return this},o.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},o.prototype._setupProperties=function(e,t,i,s,n){for(var r in i){var a=e[r],c=Array.isArray(a),l=c?"array":typeof a,u=!c&&Array.isArray(i[r]);if(!(l==="undefined"||l==="function")){if(u){var h=i[r];if(h.length===0)continue;for(var d=[a],_=0,f=h.length;_<f;_+=1){var m=this._handleRelativeValue(a,h[_]);if(isNaN(m)){u=!1,console.warn("Found invalid interpolation list. Skipping.");break}d.push(m)}u&&(i[r]=d)}if((l==="object"||c)&&a&&!u){t[r]=c?[]:{};var T=a;for(var y in T)t[r][y]=T[y];s[r]=c?[]:{};var h=i[r];if(!this._isDynamic){var x={};for(var y in h)x[y]=h[y];i[r]=h=x}this._setupProperties(T,t[r],h,s[r],n)}else(typeof t[r]>"u"||n)&&(t[r]=a),c||(t[r]*=1),u?s[r]=i[r].slice().reverse():s[r]=t[r]||0}}},o.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},o.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},o.prototype.pause=function(e){return e===void 0&&(e=be()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this._group&&this._group.remove(this),this)},o.prototype.resume=function(e){return e===void 0&&(e=be()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},o.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},o.prototype.group=function(e){return e===void 0&&(e=ct),this._group=e,this},o.prototype.delay=function(e){return e===void 0&&(e=0),this._delayTime=e,this},o.prototype.repeat=function(e){return e===void 0&&(e=0),this._initialRepeat=e,this._repeat=e,this},o.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},o.prototype.yoyo=function(e){return e===void 0&&(e=!1),this._yoyo=e,this},o.prototype.easing=function(e){return e===void 0&&(e=N.Linear.None),this._easingFunction=e,this},o.prototype.interpolation=function(e){return e===void 0&&(e=me.Linear),this._interpolationFunction=e,this},o.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},o.prototype.onStart=function(e){return this._onStartCallback=e,this},o.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},o.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},o.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},o.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},o.prototype.onStop=function(e){return this._onStopCallback=e,this},o.prototype.update=function(e,t){var i=this,s;if(e===void 0&&(e=be()),t===void 0&&(t=!0),this._isPaused)return!0;var n,r=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(e>r)return!1;t&&this.start(e,!0)}if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var a=e-this._startTime,c=this._duration+((s=this._repeatDelayTime)!==null&&s!==void 0?s:this._delayTime),l=this._duration+this._repeat*c,u=function(){if(i._duration===0||a>l)return 1;var T=Math.trunc(a/c),y=a-T*c,x=Math.min(y/i._duration,1);return x===0&&a===i._duration?1:x},h=u(),d=this._easingFunction(h);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,d),this._onUpdateCallback&&this._onUpdateCallback(this._object,h),this._duration===0||a>=this._duration)if(this._repeat>0){var _=Math.min(Math.trunc((a-this._duration)/c)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=_);for(n in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[n]=="string"&&(this._valuesStartRepeat[n]=this._valuesStartRepeat[n]+parseFloat(this._valuesEnd[n])),this._yoyo&&this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=c*_,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var f=0,m=this._chainedTweens.length;f<m;f++)this._chainedTweens[f].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},o.prototype._updateProperties=function(e,t,i,s){for(var n in i)if(t[n]!==void 0){var r=t[n]||0,a=i[n],c=Array.isArray(e[n]),l=Array.isArray(a),u=!c&&l;u?e[n]=this._interpolationFunction(a,s):typeof a=="object"&&a?this._updateProperties(e[n],r,a,s):(a=this._handleRelativeValue(r,a),typeof a=="number"&&(e[n]=r+(a-r)*s))}},o.prototype._handleRelativeValue=function(e,t){return typeof t!="string"?t:t.charAt(0)==="+"||t.charAt(0)==="-"?e+parseFloat(t):parseFloat(t)},o.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],i=this._valuesEnd[e];typeof i=="string"?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(i):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=t},o}(),Q=ct;Q.getAll.bind(Q);Q.removeAll.bind(Q);Q.add.bind(Q);Q.remove.bind(Q);var hi=Q.update.bind(Q);const p={CONSTRUCTION_GREETING:!0,LAYER:!0,SELECT_LOGS:!1,TWEEN_LOGS:!1,HTML_LOGS:!1,PHYSICS_LOGS:!1,ASSET_LOGS:!1,ACTIVATE_LOGS:!0,EFFECT_LOGS:!1};Object.freeze(p);class xe{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const ui=new zt(-1,1,1,-1,0,1);class di extends jt{constructor(){super(),this.setAttribute("position",new yt([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new yt([0,2,0,0,2,0],2))}}const _i=new di;class mt{constructor(e){this._mesh=new k(_i,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,ui)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}function wt(o,e){if(e===ps)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),o;if(e===it||e===Kt){let t=o.getIndex();if(t===null){const r=[],a=o.getAttribute("position");if(a!==void 0){for(let c=0;c<a.count;c++)r.push(c);o.setIndex(r),t=o.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),o}const i=t.count-2,s=[];if(e===it)for(let r=1;r<=i;r++)s.push(t.getX(0)),s.push(t.getX(r)),s.push(t.getX(r+1));else for(let r=0;r<i;r++)r%2===0?(s.push(t.getX(r)),s.push(t.getX(r+1)),s.push(t.getX(r+2))):(s.push(t.getX(r+2)),s.push(t.getX(r+1)),s.push(t.getX(r)));s.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const n=o.clone();return n.setIndex(s),n.clearGroups(),n}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),o}class fi extends ms{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new yi(t)}),this.register(function(t){return new xi(t)}),this.register(function(t){return new Ni(t)}),this.register(function(t){return new Ci(t)}),this.register(function(t){return new Mi(t)}),this.register(function(t){return new bi(t)}),this.register(function(t){return new Ai(t)}),this.register(function(t){return new Ei(t)}),this.register(function(t){return new wi(t)}),this.register(function(t){return new Ti(t)}),this.register(function(t){return new Ii(t)}),this.register(function(t){return new Si(t)}),this.register(function(t){return new Oi(t)}),this.register(function(t){return new vi(t)}),this.register(function(t){return new mi(t)}),this.register(function(t){return new Ri(t)}),this.register(function(t){return new Li(t)})}load(e,t,i,s){const n=this;let r;if(this.resourcePath!=="")r=this.resourcePath;else if(this.path!==""){const l=Ae.extractUrlBase(e);r=Ae.resolveURL(l,this.path)}else r=Ae.extractUrlBase(e);this.manager.itemStart(e);const a=function(l){s?s(l):console.error(l),n.manager.itemError(e),n.manager.itemEnd(e)},c=new Vt(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(l){try{n.parse(l,r,function(u){t(u),n.manager.itemEnd(e)},a)}catch(u){a(u)}},i,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,s){let n;const r={},a={},c=new TextDecoder;if(typeof e=="string")n=JSON.parse(e);else if(e instanceof ArrayBuffer)if(c.decode(new Uint8Array(e,0,4))===ss){try{r[E.KHR_BINARY_GLTF]=new Pi(e)}catch(h){s&&s(h);return}n=JSON.parse(r[E.KHR_BINARY_GLTF].content)}else n=JSON.parse(c.decode(e));else n=e;if(n.asset===void 0||n.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new Wi(n,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const h=this.pluginCallbacks[u](l);h.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[h.name]=h,r[h.name]=!0}if(n.extensionsUsed)for(let u=0;u<n.extensionsUsed.length;++u){const h=n.extensionsUsed[u],d=n.extensionsRequired||[];switch(h){case E.KHR_MATERIALS_UNLIT:r[h]=new gi;break;case E.KHR_DRACO_MESH_COMPRESSION:r[h]=new Gi(n,this.dracoLoader);break;case E.KHR_TEXTURE_TRANSFORM:r[h]=new Fi;break;case E.KHR_MESH_QUANTIZATION:r[h]=new Di;break;default:d.indexOf(h)>=0&&a[h]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+h+'".')}}l.setExtensions(r),l.setPlugins(a),l.parse(i,s)}parseAsync(e,t){const i=this;return new Promise(function(s,n){i.parse(e,t,s,n)})}}function pi(){let o={};return{get:function(e){return o[e]},add:function(e,t){o[e]=t},remove:function(e){delete o[e]},removeAll:function(){o={}}}}const E={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class mi{constructor(e){this.parser=e,this.name=E.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,s=t.length;i<s;i++){const n=t[i];n.extensions&&n.extensions[this.name]&&n.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let s=t.cache.get(i);if(s)return s;const n=t.json,c=((n.extensions&&n.extensions[this.name]||{}).lights||[])[e];let l;const u=new W(16777215);c.color!==void 0&&u.setRGB(c.color[0],c.color[1],c.color[2],te);const h=c.range!==void 0?c.range:0;switch(c.type){case"directional":l=new Ts(u),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new gs(u),l.distance=h;break;case"spot":l=new Wt(u),l.distance=h,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,l.angle=c.spot.outerConeAngle,l.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return l.position.set(0,0,0),l.decay=2,Z(l,c),c.intensity!==void 0&&(l.intensity=c.intensity),l.name=t.createUniqueName(c.name||"light_"+e),s=Promise.resolve(l),t.cache.add(i,s),s}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,n=i.json.nodes[e],a=(n.extensions&&n.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(c){return i._getNodeRef(t.cache,a,c)})}}class gi{constructor(){this.name=E.KHR_MATERIALS_UNLIT}getMaterialType(){return D}extendParams(e,t,i){const s=[];e.color=new W(1,1,1),e.opacity=1;const n=t.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){const r=n.baseColorFactor;e.color.setRGB(r[0],r[1],r[2],te),e.opacity=r[3]}n.baseColorTexture!==void 0&&s.push(i.assignTexture(e,"map",n.baseColorTexture,ce))}return Promise.all(s)}}class Ti{constructor(e){this.parser=e,this.name=E.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=s.extensions[this.name].emissiveStrength;return n!==void 0&&(t.emissiveIntensity=n),Promise.resolve()}}class yi{constructor(e){this.parser=e,this.name=E.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:q}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],r=s.extensions[this.name];if(r.clearcoatFactor!==void 0&&(t.clearcoat=r.clearcoatFactor),r.clearcoatTexture!==void 0&&n.push(i.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),r.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),r.clearcoatRoughnessTexture!==void 0&&n.push(i.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),r.clearcoatNormalTexture!==void 0&&(n.push(i.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),r.clearcoatNormalTexture.scale!==void 0)){const a=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new P(a,a)}return Promise.all(n)}}class xi{constructor(e){this.parser=e,this.name=E.KHR_MATERIALS_DISPERSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:q}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=s.extensions[this.name];return t.dispersion=n.dispersion!==void 0?n.dispersion:0,Promise.resolve()}}class Si{constructor(e){this.parser=e,this.name=E.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:q}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],r=s.extensions[this.name];return r.iridescenceFactor!==void 0&&(t.iridescence=r.iridescenceFactor),r.iridescenceTexture!==void 0&&n.push(i.assignTexture(t,"iridescenceMap",r.iridescenceTexture)),r.iridescenceIor!==void 0&&(t.iridescenceIOR=r.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),r.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),r.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),r.iridescenceThicknessTexture!==void 0&&n.push(i.assignTexture(t,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(n)}}class bi{constructor(e){this.parser=e,this.name=E.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:q}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[];t.sheenColor=new W(0,0,0),t.sheenRoughness=0,t.sheen=1;const r=s.extensions[this.name];if(r.sheenColorFactor!==void 0){const a=r.sheenColorFactor;t.sheenColor.setRGB(a[0],a[1],a[2],te)}return r.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=r.sheenRoughnessFactor),r.sheenColorTexture!==void 0&&n.push(i.assignTexture(t,"sheenColorMap",r.sheenColorTexture,ce)),r.sheenRoughnessTexture!==void 0&&n.push(i.assignTexture(t,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(n)}}class Ai{constructor(e){this.parser=e,this.name=E.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:q}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],r=s.extensions[this.name];return r.transmissionFactor!==void 0&&(t.transmission=r.transmissionFactor),r.transmissionTexture!==void 0&&n.push(i.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(n)}}class Ei{constructor(e){this.parser=e,this.name=E.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:q}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],r=s.extensions[this.name];t.thickness=r.thicknessFactor!==void 0?r.thicknessFactor:0,r.thicknessTexture!==void 0&&n.push(i.assignTexture(t,"thicknessMap",r.thicknessTexture)),t.attenuationDistance=r.attenuationDistance||1/0;const a=r.attenuationColor||[1,1,1];return t.attenuationColor=new W().setRGB(a[0],a[1],a[2],te),Promise.all(n)}}class wi{constructor(e){this.parser=e,this.name=E.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:q}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=s.extensions[this.name];return t.ior=n.ior!==void 0?n.ior:1.5,Promise.resolve()}}class Ii{constructor(e){this.parser=e,this.name=E.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:q}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],r=s.extensions[this.name];t.specularIntensity=r.specularFactor!==void 0?r.specularFactor:1,r.specularTexture!==void 0&&n.push(i.assignTexture(t,"specularIntensityMap",r.specularTexture));const a=r.specularColorFactor||[1,1,1];return t.specularColor=new W().setRGB(a[0],a[1],a[2],te),r.specularColorTexture!==void 0&&n.push(i.assignTexture(t,"specularColorMap",r.specularColorTexture,ce)),Promise.all(n)}}class vi{constructor(e){this.parser=e,this.name=E.EXT_MATERIALS_BUMP}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:q}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],r=s.extensions[this.name];return t.bumpScale=r.bumpFactor!==void 0?r.bumpFactor:1,r.bumpTexture!==void 0&&n.push(i.assignTexture(t,"bumpMap",r.bumpTexture)),Promise.all(n)}}class Oi{constructor(e){this.parser=e,this.name=E.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:q}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],r=s.extensions[this.name];return r.anisotropyStrength!==void 0&&(t.anisotropy=r.anisotropyStrength),r.anisotropyRotation!==void 0&&(t.anisotropyRotation=r.anisotropyRotation),r.anisotropyTexture!==void 0&&n.push(i.assignTexture(t,"anisotropyMap",r.anisotropyTexture)),Promise.all(n)}}class Ni{constructor(e){this.parser=e,this.name=E.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,s=i.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const n=s.extensions[this.name],r=t.options.ktx2Loader;if(!r){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,n.source,r)}}class Ci{constructor(e){this.parser=e,this.name=E.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,n=s.textures[e];if(!n.extensions||!n.extensions[t])return null;const r=n.extensions[t],a=s.images[r.source];let c=i.textureLoader;if(a.uri){const l=i.options.manager.getHandler(a.uri);l!==null&&(c=l)}return this.detectSupport().then(function(l){if(l)return i.loadTextureImage(e,r.source,c);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Mi{constructor(e){this.parser=e,this.name=E.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,n=s.textures[e];if(!n.extensions||!n.extensions[t])return null;const r=n.extensions[t],a=s.images[r.source];let c=i.textureLoader;if(a.uri){const l=i.options.manager.getHandler(a.uri);l!==null&&(c=l)}return this.detectSupport().then(function(l){if(l)return i.loadTextureImage(e,r.source,c);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Ri{constructor(e){this.name=E.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const s=i.extensions[this.name],n=this.parser.getDependency("buffer",s.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return n.then(function(a){const c=s.byteOffset||0,l=s.byteLength||0,u=s.count,h=s.byteStride,d=new Uint8Array(a,c,l);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(u,h,d,s.mode,s.filter).then(function(_){return _.buffer}):r.ready.then(function(){const _=new ArrayBuffer(u*h);return r.decodeGltfBuffer(new Uint8Array(_),u,h,d,s.mode,s.filter),_})})}else return null}}class Li{constructor(e){this.name=E.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const s=t.meshes[i.mesh];for(const l of s.primitives)if(l.mode!==K.TRIANGLES&&l.mode!==K.TRIANGLE_STRIP&&l.mode!==K.TRIANGLE_FAN&&l.mode!==void 0)return null;const r=i.extensions[this.name].attributes,a=[],c={};for(const l in r)a.push(this.parser.getDependency("accessor",r[l]).then(u=>(c[l]=u,c[l])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(l=>{const u=l.pop(),h=u.isGroup?u.children:[u],d=l[0].count,_=[];for(const f of h){const m=new le,T=new S,y=new De,x=new S(1,1,1),I=new ys(f.geometry,f.material,d);for(let A=0;A<d;A++)c.TRANSLATION&&T.fromBufferAttribute(c.TRANSLATION,A),c.ROTATION&&y.fromBufferAttribute(c.ROTATION,A),c.SCALE&&x.fromBufferAttribute(c.SCALE,A),I.setMatrixAt(A,m.compose(T,y,x));for(const A in c)if(A==="_COLOR_0"){const M=c[A];I.instanceColor=new xs(M.array,M.itemSize,M.normalized)}else A!=="TRANSLATION"&&A!=="ROTATION"&&A!=="SCALE"&&f.geometry.setAttribute(A,c[A]);V.prototype.copy.call(I,f),this.parser.assignFinalMaterial(I),_.push(I)}return u.isGroup?(u.clear(),u.add(..._),u):_[0]}))}}const ss="glTF",Se=12,It={JSON:1313821514,BIN:5130562};class Pi{constructor(e){this.name=E.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,Se),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==ss)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-Se,n=new DataView(e,Se);let r=0;for(;r<s;){const a=n.getUint32(r,!0);r+=4;const c=n.getUint32(r,!0);if(r+=4,c===It.JSON){const l=new Uint8Array(e,Se+r,a);this.content=i.decode(l)}else if(c===It.BIN){const l=Se+r;this.body=e.slice(l,l+a)}r+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Gi{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=E.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,s=this.dracoLoader,n=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,a={},c={},l={};for(const u in r){const h=lt[u]||u.toLowerCase();a[h]=r[u]}for(const u in e.attributes){const h=lt[u]||u.toLowerCase();if(r[u]!==void 0){const d=i.accessors[e.attributes[u]],_=Te[d.componentType];l[h]=_.name,c[h]=d.normalized===!0}}return t.getDependency("bufferView",n).then(function(u){return new Promise(function(h,d){s.decodeDracoFile(u,function(_){for(const f in _.attributes){const m=_.attributes[f],T=c[f];T!==void 0&&(m.normalized=T)}h(_)},a,l,te,d)})})}}class Fi{constructor(){this.name=E.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Di{constructor(){this.name=E.KHR_MESH_QUANTIZATION}}class is extends js{constructor(e,t,i,s){super(e,t,i,s)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,n=e*s*3+s;for(let r=0;r!==s;r++)t[r]=i[n+r];return t}interpolate_(e,t,i,s){const n=this.resultBuffer,r=this.sampleValues,a=this.valueSize,c=a*2,l=a*3,u=s-t,h=(i-t)/u,d=h*h,_=d*h,f=e*l,m=f-l,T=-2*_+3*d,y=_-d,x=1-T,I=y-d+h;for(let A=0;A!==a;A++){const M=r[m+A+a],Y=r[m+A+c]*u,U=r[f+A+a],ue=r[f+A]*u;n[A]=x*M+I*Y+T*U+y*ue}return n}}const Hi=new De;class ki extends is{interpolate_(e,t,i,s){const n=super.interpolate_(e,t,i,s);return Hi.fromArray(n).normalize().toArray(n),n}}const K={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Te={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},vt={9728:Qt,9729:nt,9984:Ps,9985:Gs,9986:Fs,9987:Xt},Ot={33071:Ds,33648:Hs,10497:ot},Qe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},lt={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ie={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Bi={CUBICSPLINE:void 0,LINEAR:Zt,STEP:ks},qe={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function $i(o){return o.DefaultMaterial===void 0&&(o.DefaultMaterial=new ne({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Bs})),o.DefaultMaterial}function oe(o,e,t){for(const i in t.extensions)o[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function Z(o,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(o.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Ui(o,e,t){let i=!1,s=!1,n=!1;for(let l=0,u=e.length;l<u;l++){const h=e[l];if(h.POSITION!==void 0&&(i=!0),h.NORMAL!==void 0&&(s=!0),h.COLOR_0!==void 0&&(n=!0),i&&s&&n)break}if(!i&&!s&&!n)return Promise.resolve(o);const r=[],a=[],c=[];for(let l=0,u=e.length;l<u;l++){const h=e[l];if(i){const d=h.POSITION!==void 0?t.getDependency("accessor",h.POSITION):o.attributes.position;r.push(d)}if(s){const d=h.NORMAL!==void 0?t.getDependency("accessor",h.NORMAL):o.attributes.normal;a.push(d)}if(n){const d=h.COLOR_0!==void 0?t.getDependency("accessor",h.COLOR_0):o.attributes.color;c.push(d)}}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(c)]).then(function(l){const u=l[0],h=l[1],d=l[2];return i&&(o.morphAttributes.position=u),s&&(o.morphAttributes.normal=h),n&&(o.morphAttributes.color=d),o.morphTargetsRelative=!0,o})}function zi(o,e){if(o.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)o.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(o.morphTargetInfluences.length===t.length){o.morphTargetDictionary={};for(let i=0,s=t.length;i<s;i++)o.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ji(o){let e;const t=o.extensions&&o.extensions[E.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+Ze(t.attributes):e=o.indices+":"+Ze(o.attributes)+":"+o.mode,o.targets!==void 0)for(let i=0,s=o.targets.length;i<s;i++)e+=":"+Ze(o.targets[i]);return e}function Ze(o){let e="";const t=Object.keys(o).sort();for(let i=0,s=t.length;i<s;i++)e+=t[i]+":"+o[t[i]]+";";return e}function ht(o){switch(o){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Ki(o){return o.search(/\.jpe?g($|\?)/i)>0||o.search(/^data\:image\/jpeg/)===0?"image/jpeg":o.search(/\.webp($|\?)/i)>0||o.search(/^data\:image\/webp/)===0?"image/webp":o.search(/\.ktx2($|\?)/i)>0||o.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const Vi=new le;class Wi{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new pi,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,s=-1,n=!1,r=-1;if(typeof navigator<"u"){const a=navigator.userAgent;i=/^((?!chrome|android).)*safari/i.test(a)===!0;const c=a.match(/Version\/(\d+)/);s=i&&c?parseInt(c[1],10):-1,n=a.indexOf("Firefox")>-1,r=n?a.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||i&&s<17||n&&r<98?this.textureLoader=new Yt(this.options.manager):this.textureLoader=new Ss(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Vt(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,s=this.json,n=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(r){return r._markDefs&&r._markDefs()}),Promise.all(this._invokeAll(function(r){return r.beforeRoot&&r.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(r){const a={scene:r[0][s.scene||0],scenes:r[0],animations:r[1],cameras:r[2],asset:s.asset,parser:i,userData:{}};return oe(n,a,s),Z(a,s),Promise.all(i._invokeAll(function(c){return c.afterRoot&&c.afterRoot(a)})).then(function(){for(const c of a.scenes)c.updateMatrixWorld();e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let s=0,n=t.length;s<n;s++){const r=t[s].joints;for(let a=0,c=r.length;a<c;a++)e[r[a]].isBone=!0}for(let s=0,n=e.length;s<n;s++){const r=e[s];r.mesh!==void 0&&(this._addNodeRef(this.meshCache,r.mesh),r.skin!==void 0&&(i[r.mesh].isSkinnedMesh=!0)),r.camera!==void 0&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const s=i.clone(),n=(r,a)=>{const c=this.associations.get(r);c!=null&&this.associations.set(a,c);for(const[l,u]of r.children.entries())n(u,a.children[l])};return n(i,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const s=e(t[i]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let s=0;s<t.length;s++){const n=e(t[s]);n&&i.push(n)}return i}getDependency(e,t){const i=e+":"+t;let s=this.cache.get(i);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne(function(n){return n.loadNode&&n.loadNode(t)});break;case"mesh":s=this._invokeOne(function(n){return n.loadMesh&&n.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(n){return n.loadBufferView&&n.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(n){return n.loadMaterial&&n.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(n){return n.loadTexture&&n.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(n){return n.loadAnimation&&n.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne(function(n){return n!=this&&n.getDependency&&n.getDependency(e,t)}),!s)throw new Error("Unknown type: "+e);break}this.cache.add(i,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(n,r){return i.getDependency(e,r)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[E.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(n,r){i.load(Ae.resolveURL(t.uri,s.path),n,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const s=t.byteLength||0,n=t.byteOffset||0;return i.slice(n,n+s)})}loadAccessor(e){const t=this,i=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const r=Qe[s.type],a=Te[s.componentType],c=s.normalized===!0,l=new a(s.count*r);return Promise.resolve(new We(l,r,c))}const n=[];return s.bufferView!==void 0?n.push(this.getDependency("bufferView",s.bufferView)):n.push(null),s.sparse!==void 0&&(n.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(n).then(function(r){const a=r[0],c=Qe[s.type],l=Te[s.componentType],u=l.BYTES_PER_ELEMENT,h=u*c,d=s.byteOffset||0,_=s.bufferView!==void 0?i.bufferViews[s.bufferView].byteStride:void 0,f=s.normalized===!0;let m,T;if(_&&_!==h){const y=Math.floor(d/_),x="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+y+":"+s.count;let I=t.cache.get(x);I||(m=new l(a,y*_,s.count*_/u),I=new bs(m,_/u),t.cache.add(x,I)),T=new $s(I,c,d%_/u,f)}else a===null?m=new l(s.count*c):m=new l(a,d,s.count*c),T=new We(m,c,f);if(s.sparse!==void 0){const y=Qe.SCALAR,x=Te[s.sparse.indices.componentType],I=s.sparse.indices.byteOffset||0,A=s.sparse.values.byteOffset||0,M=new x(r[1],I,s.sparse.count*y),Y=new l(r[2],A,s.sparse.count*c);a!==null&&(T=new We(T.array.slice(),T.itemSize,T.normalized)),T.normalized=!1;for(let U=0,ue=M.length;U<ue;U++){const se=M[U];if(T.setX(se,Y[U*c]),c>=2&&T.setY(se,Y[U*c+1]),c>=3&&T.setZ(se,Y[U*c+2]),c>=4&&T.setW(se,Y[U*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}T.normalized=f}return T})}loadTexture(e){const t=this.json,i=this.options,n=t.textures[e].source,r=t.images[n];let a=this.textureLoader;if(r.uri){const c=i.manager.getHandler(r.uri);c!==null&&(a=c)}return this.loadTextureImage(e,n,a)}loadTextureImage(e,t,i){const s=this,n=this.json,r=n.textures[e],a=n.images[t],c=(a.uri||a.bufferView)+":"+r.sampler;if(this.textureCache[c])return this.textureCache[c];const l=this.loadImageSource(t,i).then(function(u){u.flipY=!1,u.name=r.name||a.name||"",u.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(u.name=a.uri);const d=(n.samplers||{})[r.sampler]||{};return u.magFilter=vt[d.magFilter]||nt,u.minFilter=vt[d.minFilter]||Xt,u.wrapS=Ot[d.wrapS]||ot,u.wrapT=Ot[d.wrapT]||ot,u.generateMipmaps=!u.isCompressedTexture&&u.minFilter!==Qt&&u.minFilter!==nt,s.associations.set(u,{textures:e}),u}).catch(function(){return null});return this.textureCache[c]=l,l}loadImageSource(e,t){const i=this,s=this.json,n=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(h=>h.clone());const r=s.images[e],a=self.URL||self.webkitURL;let c=r.uri||"",l=!1;if(r.bufferView!==void 0)c=i.getDependency("bufferView",r.bufferView).then(function(h){l=!0;const d=new Blob([h],{type:r.mimeType});return c=a.createObjectURL(d),c});else if(r.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(c).then(function(h){return new Promise(function(d,_){let f=d;t.isImageBitmapLoader===!0&&(f=function(m){const T=new xt(m);T.needsUpdate=!0,d(T)}),t.load(Ae.resolveURL(h,n.path),f,void 0,_)})}).then(function(h){return l===!0&&a.revokeObjectURL(c),Z(h,r),h.userData.mimeType=r.mimeType||Ki(r.uri),h}).catch(function(h){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),h});return this.sourceCache[e]=u,u}assignTexture(e,t,i,s){const n=this;return this.getDependency("texture",i.index).then(function(r){if(!r)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(r=r.clone(),r.channel=i.texCoord),n.extensions[E.KHR_TEXTURE_TRANSFORM]){const a=i.extensions!==void 0?i.extensions[E.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const c=n.associations.get(r);r=n.extensions[E.KHR_TEXTURE_TRANSFORM].extendTexture(r,a),n.associations.set(r,c)}}return s!==void 0&&(r.colorSpace=s),e[t]=r,r})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const s=t.attributes.tangent===void 0,n=t.attributes.color!==void 0,r=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+i.uuid;let c=this.cache.get(a);c||(c=new As,Ye.prototype.copy.call(c,i),c.color.copy(i.color),c.map=i.map,c.sizeAttenuation=!1,this.cache.add(a,c)),i=c}else if(e.isLine){const a="LineBasicMaterial:"+i.uuid;let c=this.cache.get(a);c||(c=new Es,Ye.prototype.copy.call(c,i),c.color.copy(i.color),c.map=i.map,this.cache.add(a,c)),i=c}if(s||n||r){let a="ClonedMaterial:"+i.uuid+":";s&&(a+="derivative-tangents:"),n&&(a+="vertex-colors:"),r&&(a+="flat-shading:");let c=this.cache.get(a);c||(c=i.clone(),n&&(c.vertexColors=!0),r&&(c.flatShading=!0),s&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(a,c),this.associations.set(c,this.associations.get(i))),i=c}e.material=i}getMaterialType(){return ne}loadMaterial(e){const t=this,i=this.json,s=this.extensions,n=i.materials[e];let r;const a={},c=n.extensions||{},l=[];if(c[E.KHR_MATERIALS_UNLIT]){const h=s[E.KHR_MATERIALS_UNLIT];r=h.getMaterialType(),l.push(h.extendParams(a,n,t))}else{const h=n.pbrMetallicRoughness||{};if(a.color=new W(1,1,1),a.opacity=1,Array.isArray(h.baseColorFactor)){const d=h.baseColorFactor;a.color.setRGB(d[0],d[1],d[2],te),a.opacity=d[3]}h.baseColorTexture!==void 0&&l.push(t.assignTexture(a,"map",h.baseColorTexture,ce)),a.metalness=h.metallicFactor!==void 0?h.metallicFactor:1,a.roughness=h.roughnessFactor!==void 0?h.roughnessFactor:1,h.metallicRoughnessTexture!==void 0&&(l.push(t.assignTexture(a,"metalnessMap",h.metallicRoughnessTexture)),l.push(t.assignTexture(a,"roughnessMap",h.metallicRoughnessTexture))),r=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(e,a)})))}n.doubleSided===!0&&(a.side=ye);const u=n.alphaMode||qe.OPAQUE;if(u===qe.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,u===qe.MASK&&(a.alphaTest=n.alphaCutoff!==void 0?n.alphaCutoff:.5)),n.normalTexture!==void 0&&r!==D&&(l.push(t.assignTexture(a,"normalMap",n.normalTexture)),a.normalScale=new P(1,1),n.normalTexture.scale!==void 0)){const h=n.normalTexture.scale;a.normalScale.set(h,h)}if(n.occlusionTexture!==void 0&&r!==D&&(l.push(t.assignTexture(a,"aoMap",n.occlusionTexture)),n.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=n.occlusionTexture.strength)),n.emissiveFactor!==void 0&&r!==D){const h=n.emissiveFactor;a.emissive=new W().setRGB(h[0],h[1],h[2],te)}return n.emissiveTexture!==void 0&&r!==D&&l.push(t.assignTexture(a,"emissiveMap",n.emissiveTexture,ce)),Promise.all(l).then(function(){const h=new r(a);return n.name&&(h.name=n.name),Z(h,n),t.associations.set(h,{materials:e}),n.extensions&&oe(s,h,n),h})}createUniqueName(e){const t=ws.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,s=this.primitiveCache;function n(a){return i[E.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(c){return Nt(c,a,t)})}const r=[];for(let a=0,c=e.length;a<c;a++){const l=e[a],u=ji(l),h=s[u];if(h)r.push(h.promise);else{let d;l.extensions&&l.extensions[E.KHR_DRACO_MESH_COMPRESSION]?d=n(l):d=Nt(new jt,l,t),s[u]={primitive:l,promise:d},r.push(d)}}return Promise.all(r)}loadMesh(e){const t=this,i=this.json,s=this.extensions,n=i.meshes[e],r=n.primitives,a=[];for(let c=0,l=r.length;c<l;c++){const u=r[c].material===void 0?$i(this.cache):this.getDependency("material",r[c].material);a.push(u)}return a.push(t.loadGeometries(r)),Promise.all(a).then(function(c){const l=c.slice(0,c.length-1),u=c[c.length-1],h=[];for(let _=0,f=u.length;_<f;_++){const m=u[_],T=r[_];let y;const x=l[_];if(T.mode===K.TRIANGLES||T.mode===K.TRIANGLE_STRIP||T.mode===K.TRIANGLE_FAN||T.mode===void 0)y=n.isSkinnedMesh===!0?new Is(m,x):new k(m,x),y.isSkinnedMesh===!0&&y.normalizeSkinWeights(),T.mode===K.TRIANGLE_STRIP?y.geometry=wt(y.geometry,Kt):T.mode===K.TRIANGLE_FAN&&(y.geometry=wt(y.geometry,it));else if(T.mode===K.LINES)y=new vs(m,x);else if(T.mode===K.LINE_STRIP)y=new Os(m,x);else if(T.mode===K.LINE_LOOP)y=new Ns(m,x);else if(T.mode===K.POINTS)y=new Cs(m,x);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+T.mode);Object.keys(y.geometry.morphAttributes).length>0&&zi(y,n),y.name=t.createUniqueName(n.name||"mesh_"+e),Z(y,n),T.extensions&&oe(s,y,T),t.assignFinalMaterial(y),h.push(y)}for(let _=0,f=h.length;_<f;_++)t.associations.set(h[_],{meshes:e,primitives:_});if(h.length===1)return n.extensions&&oe(s,h[0],n),h[0];const d=new Xe;n.extensions&&oe(s,d,n),t.associations.set(d,{meshes:e});for(let _=0,f=h.length;_<f;_++)d.add(h[_]);return d})}loadCamera(e){let t;const i=this.json.cameras[e],s=i[i.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new qt(rt.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):i.type==="orthographic"&&(t=new zt(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),Z(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i=[];for(let s=0,n=t.joints.length;s<n;s++)i.push(this._loadNodeShallow(t.joints[s]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(s){const n=s.pop(),r=s,a=[],c=[];for(let l=0,u=r.length;l<u;l++){const h=r[l];if(h){a.push(h);const d=new le;n!==null&&d.fromArray(n.array,l*16),c.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[l])}return new Ms(a,c)})}loadAnimation(e){const t=this.json,i=this,s=t.animations[e],n=s.name?s.name:"animation_"+e,r=[],a=[],c=[],l=[],u=[];for(let h=0,d=s.channels.length;h<d;h++){const _=s.channels[h],f=s.samplers[_.sampler],m=_.target,T=m.node,y=s.parameters!==void 0?s.parameters[f.input]:f.input,x=s.parameters!==void 0?s.parameters[f.output]:f.output;m.node!==void 0&&(r.push(this.getDependency("node",T)),a.push(this.getDependency("accessor",y)),c.push(this.getDependency("accessor",x)),l.push(f),u.push(m))}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(c),Promise.all(l),Promise.all(u)]).then(function(h){const d=h[0],_=h[1],f=h[2],m=h[3],T=h[4],y=[];for(let x=0,I=d.length;x<I;x++){const A=d[x],M=_[x],Y=f[x],U=m[x],ue=T[x];if(A===void 0)continue;A.updateMatrix&&A.updateMatrix();const se=i._createAnimationTracks(A,M,Y,U,ue);if(se)for(let Ve=0;Ve<se.length;Ve++)y.push(se[Ve])}return new Rs(n,void 0,y)})}createNodeMesh(e){const t=this.json,i=this,s=t.nodes[e];return s.mesh===void 0?null:i.getDependency("mesh",s.mesh).then(function(n){const r=i._getNodeRef(i.meshCache,s.mesh,n);return s.weights!==void 0&&r.traverse(function(a){if(a.isMesh)for(let c=0,l=s.weights.length;c<l;c++)a.morphTargetInfluences[c]=s.weights[c]}),r})}loadNode(e){const t=this.json,i=this,s=t.nodes[e],n=i._loadNodeShallow(e),r=[],a=s.children||[];for(let l=0,u=a.length;l<u;l++)r.push(i.getDependency("node",a[l]));const c=s.skin===void 0?Promise.resolve(null):i.getDependency("skin",s.skin);return Promise.all([n,Promise.all(r),c]).then(function(l){const u=l[0],h=l[1],d=l[2];d!==null&&u.traverse(function(_){_.isSkinnedMesh&&_.bind(d,Vi)});for(let _=0,f=h.length;_<f;_++)u.add(h[_]);return u})}_loadNodeShallow(e){const t=this.json,i=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const n=t.nodes[e],r=n.name?s.createUniqueName(n.name):"",a=[],c=s._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(e)});return c&&a.push(c),n.camera!==void 0&&a.push(s.getDependency("camera",n.camera).then(function(l){return s._getNodeRef(s.cameraCache,n.camera,l)})),s._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(e)}).forEach(function(l){a.push(l)}),this.nodeCache[e]=Promise.all(a).then(function(l){let u;if(n.isBone===!0?u=new Ls:l.length>1?u=new Xe:l.length===1?u=l[0]:u=new V,u!==l[0])for(let h=0,d=l.length;h<d;h++)u.add(l[h]);if(n.name&&(u.userData.name=n.name,u.name=r),Z(u,n),n.extensions&&oe(i,u,n),n.matrix!==void 0){const h=new le;h.fromArray(n.matrix),u.applyMatrix4(h)}else n.translation!==void 0&&u.position.fromArray(n.translation),n.rotation!==void 0&&u.quaternion.fromArray(n.rotation),n.scale!==void 0&&u.scale.fromArray(n.scale);return s.associations.has(u)||s.associations.set(u,{}),s.associations.get(u).nodes=e,u}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],s=this,n=new Xe;i.name&&(n.name=s.createUniqueName(i.name)),Z(n,i),i.extensions&&oe(t,n,i);const r=i.nodes||[],a=[];for(let c=0,l=r.length;c<l;c++)a.push(s.getDependency("node",r[c]));return Promise.all(a).then(function(c){for(let u=0,h=c.length;u<h;u++)n.add(c[u]);const l=u=>{const h=new Map;for(const[d,_]of s.associations)(d instanceof Ye||d instanceof xt)&&h.set(d,_);return u.traverse(d=>{const _=s.associations.get(d);_!=null&&h.set(d,_)}),h};return s.associations=l(n),n})}_createAnimationTracks(e,t,i,s,n){const r=[],a=e.name?e.name:e.uuid,c=[];ie[n.path]===ie.weights?e.traverse(function(d){d.morphTargetInfluences&&c.push(d.name?d.name:d.uuid)}):c.push(a);let l;switch(ie[n.path]){case ie.weights:l=bt;break;case ie.rotation:l=At;break;case ie.position:case ie.scale:l=St;break;default:switch(i.itemSize){case 1:l=bt;break;case 2:case 3:default:l=St;break}break}const u=s.interpolation!==void 0?Bi[s.interpolation]:Zt,h=this._getArrayFromAccessor(i);for(let d=0,_=c.length;d<_;d++){const f=new l(c[d]+"."+ie[n.path],t.array,h,u);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(f),r.push(f)}return r}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const i=ht(t.constructor),s=new Float32Array(t.length);for(let n=0,r=t.length;n<r;n++)s[n]=t[n]*i;t=s}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(i){const s=this instanceof At?ki:is;return new s(this.times,this.values,this.getValueSize()/3,i)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Yi(o,e,t){const i=e.attributes,s=new Us;if(i.POSITION!==void 0){const a=t.json.accessors[i.POSITION],c=a.min,l=a.max;if(c!==void 0&&l!==void 0){if(s.set(new S(c[0],c[1],c[2]),new S(l[0],l[1],l[2])),a.normalized){const u=ht(Te[a.componentType]);s.min.multiplyScalar(u),s.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const n=e.targets;if(n!==void 0){const a=new S,c=new S;for(let l=0,u=n.length;l<u;l++){const h=n[l];if(h.POSITION!==void 0){const d=t.json.accessors[h.POSITION],_=d.min,f=d.max;if(_!==void 0&&f!==void 0){if(c.setX(Math.max(Math.abs(_[0]),Math.abs(f[0]))),c.setY(Math.max(Math.abs(_[1]),Math.abs(f[1]))),c.setZ(Math.max(Math.abs(_[2]),Math.abs(f[2]))),d.normalized){const m=ht(Te[d.componentType]);c.multiplyScalar(m)}a.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(a)}o.boundingBox=s;const r=new zs;s.getCenter(r.center),r.radius=s.min.distanceTo(s.max)/2,o.boundingSphere=r}function Nt(o,e,t){const i=e.attributes,s=[];function n(r,a){return t.getDependency("accessor",r).then(function(c){o.setAttribute(a,c)})}for(const r in i){const a=lt[r]||r.toLowerCase();a in o.attributes||s.push(n(i[r],a))}if(e.indices!==void 0&&!o.index){const r=t.getDependency("accessor",e.indices).then(function(a){o.setIndex(a)});s.push(r)}return at.workingColorSpace!==te&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${at.workingColorSpace}" not supported.`),Z(o,e),Yi(o,e,t),Promise.all(s).then(function(){return e.targets!==void 0?Ui(o,e.targets,t):o})}const ns={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class Xi extends xe{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof pe?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=He.clone(e.uniforms),this.material=new pe({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new mt(this.material)}render(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class Ct extends xe{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){const s=e.getContext(),n=e.state;n.buffers.color.setMask(!1),n.buffers.depth.setMask(!1),n.buffers.color.setLocked(!0),n.buffers.depth.setLocked(!0);let r,a;this.inverse?(r=0,a=1):(r=1,a=0),n.buffers.stencil.setTest(!0),n.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),n.buffers.stencil.setFunc(s.ALWAYS,r,4294967295),n.buffers.stencil.setClear(a),n.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),n.buffers.color.setLocked(!1),n.buffers.depth.setLocked(!1),n.buffers.color.setMask(!0),n.buffers.depth.setMask(!0),n.buffers.stencil.setLocked(!1),n.buffers.stencil.setFunc(s.EQUAL,1,4294967295),n.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),n.buffers.stencil.setLocked(!0)}}class Qi extends xe{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class qi{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const i=e.getSize(new P);this._width=i.width,this._height=i.height,t=new Le(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Pe}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new Xi(ns),this.copyPass.material.blending=Ks,this.clock=new Jt}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let i=!1;for(let s=0,n=this.passes.length;s<n;s++){const r=this.passes[s];if(r.enabled!==!1){if(r.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),r.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),r.needsSwap){if(i){const a=this.renderer.getContext(),c=this.renderer.state.buffers.stencil;c.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),c.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}Ct!==void 0&&(r instanceof Ct?i=!0:r instanceof Qi&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new P);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget1.setSize(i,s),this.renderTarget2.setSize(i,s);for(let n=0;n<this.passes.length;n++)this.passes[n].setSize(i,s)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}const Zi={name:"OutputShader",uniforms:{tDiffuse:{value:null},toneMappingExposure:{value:1}},vertexShader:`
		precision highp float;

		uniform mat4 modelViewMatrix;
		uniform mat4 projectionMatrix;

		attribute vec3 position;
		attribute vec2 uv;

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`
	
		precision highp float;

		uniform sampler2D tDiffuse;

		#include <tonemapping_pars_fragment>
		#include <colorspace_pars_fragment>

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );

			// tone mapping

			#ifdef LINEAR_TONE_MAPPING

				gl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );

			#elif defined( REINHARD_TONE_MAPPING )

				gl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );

			#elif defined( CINEON_TONE_MAPPING )

				gl_FragColor.rgb = CineonToneMapping( gl_FragColor.rgb );

			#elif defined( ACES_FILMIC_TONE_MAPPING )

				gl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );

			#elif defined( AGX_TONE_MAPPING )

				gl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );

			#elif defined( NEUTRAL_TONE_MAPPING )

				gl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );

			#endif

			// color space

			#ifdef SRGB_TRANSFER

				gl_FragColor = sRGBTransferOETF( gl_FragColor );

			#endif

		}`};class Ji extends xe{constructor(){super();const e=Zi;this.uniforms=He.clone(e.uniforms),this.material=new Vs({name:e.name,uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.fsQuad=new mt(this.material),this._outputColorSpace=null,this._toneMapping=null}render(e,t,i){this.uniforms.tDiffuse.value=i.texture,this.uniforms.toneMappingExposure.value=e.toneMappingExposure,(this._outputColorSpace!==e.outputColorSpace||this._toneMapping!==e.toneMapping)&&(this._outputColorSpace=e.outputColorSpace,this._toneMapping=e.toneMapping,this.material.defines={},at.getTransfer(this._outputColorSpace)===Ws&&(this.material.defines.SRGB_TRANSFER=""),this._toneMapping===Ys?this.material.defines.LINEAR_TONE_MAPPING="":this._toneMapping===Xs?this.material.defines.REINHARD_TONE_MAPPING="":this._toneMapping===Qs?this.material.defines.CINEON_TONE_MAPPING="":this._toneMapping===qs?this.material.defines.ACES_FILMIC_TONE_MAPPING="":this._toneMapping===Zs?this.material.defines.AGX_TONE_MAPPING="":this._toneMapping===Js&&(this.material.defines.NEUTRAL_TONE_MAPPING=""),this.material.needsUpdate=!0),this.renderToScreen===!0?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class en extends xe{constructor(e,t,i=null,s=null,n=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=s,this.clearAlpha=n,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new W}render(e,t,i){const s=e.autoClear;e.autoClear=!1;let n,r;this.overrideMaterial!==null&&(r=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),this.clearAlpha!==null&&(n=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(n),this.overrideMaterial!==null&&(this.scene.overrideMaterial=r),e.autoClear=s}}const tn={name:"LuminosityHighPassShader",shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new W(0)},defaultOpacity:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform vec3 defaultColor;
		uniform float defaultOpacity;
		uniform float luminosityThreshold;
		uniform float smoothWidth;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );

			float v = luminance( texel.xyz );

			vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );

			float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );

			gl_FragColor = mix( outputColor, texel, alpha );

		}`};class he extends xe{constructor(e,t,i,s){super(),this.strength=t!==void 0?t:1,this.radius=i,this.threshold=s,this.resolution=e!==void 0?new P(e.x,e.y):new P(256,256),this.clearColor=new W(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let n=Math.round(this.resolution.x/2),r=Math.round(this.resolution.y/2);this.renderTargetBright=new Le(n,r,{type:Pe}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let h=0;h<this.nMips;h++){const d=new Le(n,r,{type:Pe});d.texture.name="UnrealBloomPass.h"+h,d.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(d);const _=new Le(n,r,{type:Pe});_.texture.name="UnrealBloomPass.v"+h,_.texture.generateMipmaps=!1,this.renderTargetsVertical.push(_),n=Math.round(n/2),r=Math.round(r/2)}const a=tn;this.highPassUniforms=He.clone(a.uniforms),this.highPassUniforms.luminosityThreshold.value=s,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new pe({uniforms:this.highPassUniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}),this.separableBlurMaterials=[];const c=[3,5,7,9,11];n=Math.round(this.resolution.x/2),r=Math.round(this.resolution.y/2);for(let h=0;h<this.nMips;h++)this.separableBlurMaterials.push(this.getSeparableBlurMaterial(c[h])),this.separableBlurMaterials[h].uniforms.invSize.value=new P(1/n,1/r),n=Math.round(n/2),r=Math.round(r/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1;const l=[1,.8,.6,.4,.2];this.compositeMaterial.uniforms.bloomFactors.value=l,this.bloomTintColors=[new S(1,1,1),new S(1,1,1),new S(1,1,1),new S(1,1,1),new S(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;const u=ns;this.copyUniforms=He.clone(u.uniforms),this.blendMaterial=new pe({uniforms:this.copyUniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,blending:ei,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new W,this.oldClearAlpha=1,this.basic=new D,this.fsQuad=new mt(null)}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose();for(let e=0;e<this.separableBlurMaterials.length;e++)this.separableBlurMaterials[e].dispose();this.compositeMaterial.dispose(),this.blendMaterial.dispose(),this.basic.dispose(),this.fsQuad.dispose()}setSize(e,t){let i=Math.round(e/2),s=Math.round(t/2);this.renderTargetBright.setSize(i,s);for(let n=0;n<this.nMips;n++)this.renderTargetsHorizontal[n].setSize(i,s),this.renderTargetsVertical[n].setSize(i,s),this.separableBlurMaterials[n].uniforms.invSize.value=new P(1/i,1/s),i=Math.round(i/2),s=Math.round(s/2)}render(e,t,i,s,n){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const r=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),n&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=i.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=i.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let a=this.renderTargetBright;for(let c=0;c<this.nMips;c++)this.fsQuad.material=this.separableBlurMaterials[c],this.separableBlurMaterials[c].uniforms.colorTexture.value=a.texture,this.separableBlurMaterials[c].uniforms.direction.value=he.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[c]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[c].uniforms.colorTexture.value=this.renderTargetsHorizontal[c].texture,this.separableBlurMaterials[c].uniforms.direction.value=he.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[c]),e.clear(),this.fsQuad.render(e),a=this.renderTargetsVertical[c];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.blendMaterial,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,n&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(i),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=r}getSeparableBlurMaterial(e){const t=[];for(let i=0;i<e;i++)t.push(.39894*Math.exp(-.5*i*i/(e*e))/e);return new pe({defines:{KERNEL_RADIUS:e},uniforms:{colorTexture:{value:null},invSize:{value:new P(.5,.5)},direction:{value:new P(.5,.5)},gaussianCoefficients:{value:t}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 invSize;
				uniform vec2 direction;
				uniform float gaussianCoefficients[KERNEL_RADIUS];

				void main() {
					float weightSum = gaussianCoefficients[0];
					vec3 diffuseSum = texture2D( colorTexture, vUv ).rgb * weightSum;
					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {
						float x = float(i);
						float w = gaussianCoefficients[i];
						vec2 uvOffset = direction * invSize * x;
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset ).rgb;
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset ).rgb;
						diffuseSum += (sample1 + sample2) * w;
						weightSum += 2.0 * w;
					}
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);
				}`})}getCompositeMaterial(e){return new pe({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;
				uniform sampler2D blurTexture1;
				uniform sampler2D blurTexture2;
				uniform sampler2D blurTexture3;
				uniform sampler2D blurTexture4;
				uniform sampler2D blurTexture5;
				uniform float bloomStrength;
				uniform float bloomRadius;
				uniform float bloomFactors[NUM_MIPS];
				uniform vec3 bloomTintColors[NUM_MIPS];

				float lerpBloomFactor(const in float factor) {
					float mirrorFactor = 1.2 - factor;
					return mix(factor, mirrorFactor, bloomRadius);
				}

				void main() {
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +
						lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +
						lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +
						lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +
						lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );
				}`})}}he.BlurDirectionX=new P(1,0);he.BlurDirectionY=new P(0,1);class sn extends V{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new P(.5,.5),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof t.element.ownerDocument.defaultView.Element&&t.element.parentNode!==null&&t.element.remove()})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const de=new S,Mt=new le,Rt=new le,Lt=new S,Pt=new S;class nn{constructor(e={}){const t=this;let i,s,n,r;const a={objects:new WeakMap},c=e.element!==void 0?e.element:document.createElement("div");c.style.overflow="hidden",this.domElement=c,this.getSize=function(){return{width:i,height:s}},this.render=function(f,m){f.matrixWorldAutoUpdate===!0&&f.updateMatrixWorld(),m.parent===null&&m.matrixWorldAutoUpdate===!0&&m.updateMatrixWorld(),Mt.copy(m.matrixWorldInverse),Rt.multiplyMatrices(m.projectionMatrix,Mt),u(f,f,m),_(f)},this.setSize=function(f,m){i=f,s=m,n=i/2,r=s/2,c.style.width=f+"px",c.style.height=m+"px"};function l(f){f.isCSS2DObject&&(f.element.style.display="none");for(let m=0,T=f.children.length;m<T;m++)l(f.children[m])}function u(f,m,T){if(f.visible===!1){l(f);return}if(f.isCSS2DObject){de.setFromMatrixPosition(f.matrixWorld),de.applyMatrix4(Rt);const y=de.z>=-1&&de.z<=1&&f.layers.test(T.layers)===!0,x=f.element;x.style.display=y===!0?"":"none",y===!0&&(f.onBeforeRender(t,m,T),x.style.transform="translate("+-100*f.center.x+"%,"+-100*f.center.y+"%)translate("+(de.x*n+n)+"px,"+(-de.y*r+r)+"px)",x.parentNode!==c&&c.appendChild(x),f.onAfterRender(t,m,T));const I={distanceToCameraSquared:h(T,f)};a.objects.set(f,I)}for(let y=0,x=f.children.length;y<x;y++)u(f.children[y],m,T)}function h(f,m){return Lt.setFromMatrixPosition(f.matrixWorld),Pt.setFromMatrixPosition(m.matrixWorld),Lt.distanceToSquared(Pt)}function d(f){const m=[];return f.traverseVisible(function(T){T.isCSS2DObject&&m.push(T)}),m}function _(f){const m=d(f).sort(function(y,x){if(y.renderOrder!==x.renderOrder)return x.renderOrder-y.renderOrder;const I=a.objects.get(y).distanceToCameraSquared,A=a.objects.get(x).distanceToCameraSquared;return I-A}),T=m.length;for(let y=0,x=m.length;y<x;y++)m[y].element.style.zIndex=T-y}}}class on{constructor(e,t){g(this,"webgl_renderer");g(this,"css_renderer");g(this,"composer");this.parent=e,this.camera=t,this.css_renderer=new nn,this.css_renderer.setSize(window.innerWidth,window.innerHeight),this.css_renderer.domElement.style.position="absolute",this.css_renderer.domElement.style.top="0",this.css_renderer.domElement.style.zIndex="1",document.body.appendChild(this.css_renderer.domElement),this.webgl_renderer=new ti({antialias:!0}),this.webgl_renderer.setSize(window.innerWidth,window.innerHeight),this.webgl_renderer.shadowMap.enabled=!0,this.webgl_renderer.shadowMap.type=si,this.webgl_renderer.domElement.style.position="absolute",this.webgl_renderer.domElement.style.top="0",this.webgl_renderer.domElement.style.zIndex="0",document.body.appendChild(this.webgl_renderer.domElement),this.composer=new qi(this.webgl_renderer);const i=new Ji,s=new en(this.parent,this.camera),n=new he(new P(window.innerWidth,window.innerHeight),1.5,.4,1);this.composer.addPass(s),this.composer.addPass(n),this.composer.addPass(i)}add_event_listener(e,t){this.webgl_renderer.domElement.addEventListener(e,t),this.css_renderer.domElement.addEventListener(e,t)}render(){this.composer.render(),this.css_renderer.render(this.parent,this.camera)}resize(){this.webgl_renderer.setSize(window.innerWidth,window.innerHeight),this.css_renderer.setSize(window.innerWidth,window.innerHeight);const e=this.composer.passes.find(t=>t instanceof he);e&&e.resolution.set(window.innerWidth,window.innerHeight)}set_animation_loop(e){this.webgl_renderer.setAnimationLoop(e)}}const b=Object.freeze({ANY:"any_",CONATINER:"container_",LABEL:"label_",TEXT:"text_",TEXT_BLOCK:"textblock_",BACKGROUND:"background_",GLTF_MESH:"gltf_",LINK:"link_",HIDE:"hide_",FLOOR:"floor_",BALL:"ball_",INTERACTABLE:"interactable_",SIGN:"sign_"}),re=Object.freeze({PRIMARY:"primary",SECONDARY:"secondary",UNIQUE:"unique",AXE:"axe",DIPLOMA:"diploma",DESK:"desk"}),O={AXE:"AXE",DIPLOMA:"education",DESK:"DESK",CHAIR:"CHAIR",BOOK:"BOOK",ROOM:"ROOM",TABLET:"TABLET",DESKPHOTO:"DESK_PHOTO",CUBE:"CUBE"};Object.freeze(O);const Ge={[O.AXE]:{PATH:"assets/Axe.glb",name:"axe",scale:20,mass:5,restitution:.1},[O.DIPLOMA]:{PATH:"assets/diploma_bot.glb",name:"education",scale:10,mass:1,restitution:.2},[O.DESK]:{PATH:"assets/desk.glb",name:"desk",scale:2,mass:1,restitution:.5},[O.ROOM]:{PATH:"assets/room.glb",name:"room",scale:5,mass:1,restituation:.2},[O.BOOK]:{PATH:"assets/book.glb",name:"book",scale:5,mass:1,restituation:1},[O.CHAIR]:{PATH:"assets/chair.glb",name:"chair",scale:5,mass:1.2,restituation:1},[O.TABLET]:{PATH:"assets/tablet.glb",name:"tablet",scale:5,mass:1,restituation:1},[O.DESKPHOTO]:{PATH:"assets/deskphoto.glb",name:"desk_photo",scale:5,mass:1,restituation:1},[O.CUBE]:{name:"cube",scale:1,mass:1,restitution:1.1,geometry:new z(1,1,1),create_material:o=>new ne({color:o})}},j=class j{constructor(){g(this,"currently_activated_name","");g(this,"emission_states",new Map);g(this,"name","[AssetManager]");if(j.instance)return j.instance;this.loader=new fi,this.loaded_assets=new Map,this.dynamic_bodies=new Map,this.static_meshes=new Map,this.loading_promises=new Map,j.instance=this}static get_instance(){return j.instance||(j.instance=new j),j.instance}async load_asset_type(e){const t=Ge[e];if(!t)throw new Error(`Unknown asset type: ${e}`);if(this.loaded_assets.has(e))return this.loaded_assets.get(e);if(this.loading_promises.has(e))return this.loading_promises.get(e);const i=new Promise((s,n)=>{this.loader.load(t.PATH,r=>{this.loaded_assets.set(e,r),this.loading_promises.delete(e),s(r)},void 0,n)});return this.loading_promises.set(e,i),i}get_new_instance_id(){return j.instance_counter++}async spawn_asset(e,t,i,s={},n=new S(0,0,0)){if(!Object.values(O).includes(e))throw new Error(`Invalid asset type: ${e}`);const r=Ge[e];let a;const c=i.createRigidBody(ae.dynamic().setTranslation(n.x,n.y,n.z).setCanSleep(!1));if(p.ASSET_LOGS&&console.log(`Created rigid body for ${e}:`,c),e===O.CUBE){a=new k(r.geometry,r.create_material(s.color||16777215)),a.position.copy(n),a.castShadow=!0,a.name=`${b.INTERACTABLE}${r.name}`;const h=J.cuboid(.5,.5,.5).setMass(r.mass).setRestitution(r.restitution),d=i.createCollider(h,c);p.ASSET_LOGS&&console.log("Created cube collider:",d)}else{this.loaded_assets.has(e)||await this.load_asset_type(e),a=this.loaded_assets.get(e).scene.clone(),a.position.copy(n),a.scale.set(r.scale,r.scale,r.scale);let d=[];if(a.traverse(_=>{_.isMesh&&(_.name.startsWith("col_")?(d.push(_),_.visible=!1,p.ASSET_LOGS&&console.log(`Found collision mesh for ${e}:`,{name:_.name,vertices:_.geometry.attributes.position.count,hasIndices:!!_.geometry.index,position:_.position,scale:r.scale})):(_.material=_.material.clone(),_.material.depthTest=!0,_.material.transparent=!1,_.name=`${b.INTERACTABLE}${r.name}`,_.castShadow=!0))}),d.length>0)p.ASSET_LOGS&&console.log(`Creating compound collider for ${e} with ${d.length} collision meshes`),d.forEach(_=>{const f=_.geometry,m=f.attributes.position.array,T=new Float32Array(m.length);for(let M=0;M<m.length;M++)T[M]=m[M]*r.scale;const y=f.index?f.index.array:void 0;p.ASSET_LOGS&&console.log(`Creating collider component for ${_.name}:`,{vertexCount:T.length/3,indexCount:y?y.length:"none",scale:r.scale,position:_.position});let x;y?x=J.trimesh(T,y).setMass(r.mass).setRestitution(r.restitution):x=J.convexHull(T).setMass(r.mass).setRestitution(r.restitution);const I=new S;_.getWorldPosition(I);const A=I.sub(a.position);x.setTranslation(A.x*r.scale,A.y*r.scale,A.z*r.scale),i.createCollider(x,c)});else{p.ASSET_LOGS&&console.warn(`No collision mesh found for ${e}, falling back to bounding box`);let _;if(a.traverse(f=>{f.isMesh&&!f.name.startsWith("col_")&&(_=f.geometry)}),_){_.computeBoundingBox();const f=_.boundingBox,m=new S;f.getSize(m);const T=m.x*r.scale/2,y=m.y*r.scale/2,x=m.z*r.scale/2,I=J.cuboid(T,y,x).setMass(r.mass).setRestitution(r.restitution),A=i.createCollider(I,c);p.ASSET_LOGS&&console.log("Created bounding box collider:",A),p.ASSET_LOGS&&console.log("Collider dimensions:",{width:T,height:y,depth:x,mass:r.mass,restitution:r.restitution})}}}t.add(a);const l=`${e}_${this.get_new_instance_id()}`,u=[a,c];return this.dynamic_bodies.set(l,u),a.userData.instance_id=l,u}add_object(e,t){if(!e){console.error("Cannot add object: incoming_mesh is undefined");return}if(e.name){const s=`${e.name}_${this.get_new_instance_id()}`,n=[e,t];this.dynamic_bodies.set(s,n),e.userData.instance_id=s}else console.error(`${e} ${t} mesh body combo could not be added because the mesh didn't have a name`)}async create_static_mesh(e,t,i=new S(0,0,0),s=null){var c,l,u;if(!Object.values(O).includes(e))throw new Error(`Invalid asset type: ${e}`);const n=Ge[e];let r;e===O.CUBE?(r=new k(n.geometry,n.create_material(16777215)),r.castShadow=!0):(this.loaded_assets.has(e)||await this.load_asset_type(e),r=this.loaded_assets.get(e).scene.clone(),r.scale.set(n.scale,n.scale,n.scale),p.ASSET_LOGS&&console.log("Creating static mesh for UI:",{assetType:e,parentType:t.type,parentName:t.name,isOverlay:(u=(l=(c=t.parent)==null?void 0:c.parent)==null?void 0:l.name)==null?void 0:u.includes("overlay")}),r.traverse(d=>{d.isMesh&&(p.ASSET_LOGS&&console.log("Original material properties:",{hasMap:!!d.material.map,color:d.material.color,type:d.material.type}),d.material=new D({map:d.material.map,color:d.material.color,transparent:!0,depthTest:!1,side:ye,opacity:1}),d.renderOrder=999,p.ASSET_LOGS&&console.log("New material properties:",{hasMap:!!d.material.map,color:d.material.color,type:d.material.type,transparent:d.material.transparent,depthTest:d.material.depthTest,renderOrder:d.renderOrder}))})),r.position.copy(i),s&&r.rotation.copy(s),r.renderOrder=999,t.add(r);const a=`${e}_static_${Date.now()}`;return this.static_meshes.set(a,r),r}update(){this.get_all_dynamic_bodies().forEach(([e,t])=>{if(t){const i=t.translation();e.position.set(i.x,i.y,i.z);const s=t.rotation();e.quaternion.set(s.x,s.y,s.z,s.w)}})}get_all_dynamic_bodies(){return Array.from(this.dynamic_bodies.values())}get_all_static_meshes(){return Array.from(this.static_meshes.values())}get_body_pair_by_mesh(e){let t=e.userData.instance_id,i=e;for(;!t&&i.parent;)i=i.parent,t=i.userData.instance_id;return t?this.dynamic_bodies.get(t):null}is_mesh_emissive(e){if(!e)return!1;let t=!1;const i=s=>s&&s.emissive&&s.emissiveIntensity>0&&s.emissiveIntensity===9;return e.isGroup||e.isObject3D?e.traverse(s=>{s.isMesh&&!s.name.startsWith("col_")&&i(s.material)&&(t=!0)}):e.isMesh&&(t=i(e.material)),t}activate_object(e){if(e===this.currently_activated_name&&this.emission_states.get(e)==="active"){let s=!1;for(const[n,[r,a]]of this.dynamic_bodies)if(r.name.split("_")[1]===e.split("_")[1])if(this.is_mesh_emissive(r)){s=!0;return}else{p.ACTIVATE_LOGS&&console.log(`${this.name} Object ${e} claims to be active but isn't emissive - reapplying`),this.emission_states.delete(e);break}s||(p.ACTIVATE_LOGS&&console.log(`${this.name} Object ${e} not found for verification - resetting state`),this.emission_states.delete(e))}this.currently_activated_name!==e&&(p.ACTIVATE_LOGS&&console.log(`${this.name} Deactivating previous: ${this.currently_activated_name}`),this.deactivate_object(this.currently_activated_name)),this.currently_activated_name=e;const t=e.split("_")[1];p.ACTIVATE_LOGS&&console.log(`${this.name} Looking for category: ${t}`);let i=!1;for(const[s,[n,r]]of this.dynamic_bodies){const a=n.name.split("_")[1];if(a===t){i=!0,p.ACTIVATE_LOGS&&console.log(`${this.name} Found matching mesh by category: ${a}`);const c=Object.values(G).find(l=>typeof l!="function"&&l.value===t);if(c){p.ACTIVATE_LOGS&&console.log(`${this.name} Applying emission material with color: ${c.color}`),this.emission_states.set(e,"applying");const l=d=>new ne({color:c.color,emissive:c.color,emissiveIntensity:9,map:(d==null?void 0:d.map)||null,transparent:(d==null?void 0:d.transparent)||!1,opacity:(d==null?void 0:d.opacity)||1});let u=0,h=0;n.isGroup||n.isObject3D?n.traverse(d=>{d.isMesh&&!d.name.startsWith("col_")&&h++}):n.isMesh&&(h=1),n.isGroup||n.isObject3D?n.traverse(d=>{d.isMesh&&!d.name.startsWith("col_")&&(d.userData.originalMaterial||(d.userData.originalMaterial=d.material.clone()),d.material&&d.material.dispose(),d.material=l(d.userData.originalMaterial),u++,u===h&&(this.is_mesh_emissive(n)?(this.emission_states.set(e,"active"),p.ACTIVATE_LOGS&&console.log(`${this.name} Object ${e} is now fully activated and verified`)):(p.ACTIVATE_LOGS&&console.warn(`[${this.name} Failed to apply emission to ${e}`),this.emission_states.delete(e))))}):n.isMesh&&(n.userData.originalMaterial||(n.userData.originalMaterial=n.material.clone()),n.material&&n.material.dispose(),n.material=l(n.userData.originalMaterial),this.is_mesh_emissive(n)?(this.emission_states.set(e,"active"),p.ACTIVATE_LOGS&&console.log(`${this.name} Object ${e} is now fully activated and verified`)):(p.ACTIVATE_LOGS&&console.warn(`${this.name} Failed to apply emission to ${e}`),this.emission_states.delete(e)))}break}}!i&&p.ACTIVATE_LOGS&&(console.warn(`${this.name} No mesh found for category: ${t}`),this.emission_states.delete(e))}deactivate_object(e){if(!e)return;const t=e.split("_")[1];let i=!1;for(const[s,[n,r]]of this.dynamic_bodies)if(n.name.split("_")[1]===t){i=!0,p.ACTIVATE_LOGS&&console.log(`${this.name} Found mesh to deactivate: ${n.name}`),this.emission_states.set(e,"deactivating");let c=0,l=0;n.isGroup||n.isObject3D?n.traverse(h=>{h.isMesh&&!h.name.startsWith("col_")&&l++}):n.isMesh&&(l=1);const u=h=>{if(h.userData.originalMaterial){if(h.material&&h.material.emissiveIntensity>0){const d=h.material.clone();h.material=d,new C(d).to({emissiveIntensity:0},500).easing(N.Quadratic.Out).onComplete(()=>{d&&d.dispose();const _=h.userData.originalMaterial.clone();h.material=_,c++,c===l&&(this.emission_states.delete(e),p.ACTIVATE_LOGS&&console.log(`${this.name} Object ${e} is now fully deactivated`)),p.ACTIVATE_LOGS&&console.log(`${this.name} Restored original material for: ${h.name}`)}).start()}}else p.ACTIVATE_LOGS&&(console.warn(`${this.name} No original material found for: ${h.name}`),c++,c===l&&this.emission_states.delete(e))};n.isGroup||n.isObject3D?n.traverse(h=>{h.isMesh&&!h.name.startsWith("col_")&&u(h)}):n.isMesh&&u(n);break}!i&&p.ACTIVATE_LOGS&&(console.warn(`${this.name} No active mesh found for category: ${t}`),this.emission_states.delete(e))}deactivate_all_objects(e=null){if(!this.currently_activated_name)return;p.ACTIVATE_LOGS&&console.log(`${this.name} Deactivating all objects${e?` with prefix: ${e}`:""}`);let t=0;const i=s=>{if(s.material&&s.material.emissive&&s.material.emissiveIntensity>0){p.ACTIVATE_LOGS&&console.log(`${this.name} Deactivating emissive mesh: ${s.name}`);const n=s.material.clone();s.material=n,new C(n).to({emissiveIntensity:0},500).easing(N.Quadratic.Out).onComplete(()=>{if(n&&n.dispose(),s.userData.originalMaterial){const r=s.userData.originalMaterial.clone();s.material=r}}).start(),t++}};for(const[s,[n,r]]of this.dynamic_bodies)e&&!n.name.startsWith(e)||(n.isGroup||n.isObject3D?n.traverse(a=>{a.isMesh&&!a.name.startsWith("col_")&&i(a)}):n.isMesh&&i(n));t>0&&p.ACTIVATE_LOGS&&console.log(`[AssetManager] Deactivated ${t} objects`),this.currently_activated_name=""}contains_object(e){for(const[t,[i,s]]of this.dynamic_bodies)if(i.name===e)return!0;return!1}};g(j,"instance",null),g(j,"instance_counter",0);let H=j;const gt=new Yt,os=800,rn=300,an=.7,cn=1,ln=1;function Ee(o){return!o||!o.name?"":o.name.split("_")[0]+"_"}const Gt=new ii,Je=new P;function hn(o){return{x:o.clientX/window.innerWidth*2-1,y:-(o.clientY/window.innerHeight)*2+1}}function Tt(o,e,t){const i=hn(o);return Je.x=i.x,Je.y=i.y,Gt.setFromCamera(Je,e),Gt.intersectObject(t,!0)}const Ne="north",ee="south",ze="east",B="west",rs=[Ne,ee,ze,B];function R(o){const e=new P;return o.getViewSize(15,e),e}function L(o,e){if(rs.includes(o)){const t=R(e);switch(o){case Ne:return t.y;case ee:return-t.y;case ze:return t.x;case B:return-t.x}}}const G={CONTACT:{value:"contact",icon:"categories/contact_raised.svg",color:15060536,html:"pages/contact.html"},PROJECTS:{value:"projects",icon:"categories/projects_raised.svg",color:8605364,html:"pages/projects.html"},WORK:{value:"work",icon:"categories/work_raised.svg",color:11813956,html:"pages/work.html"},EDUCATION:{value:"education",icon:"categories/education_raised.svg",color:2463546,html:"pages/education.html"},ABOUT:{value:"about",icon:"categories/about_raised.svg",color:3690981,html:"pages/about.html"}};Object.defineProperty(G,"getValues",{value:function(){return Object.values(this).map(o=>o.value)},enumerable:!1});Object.defineProperty(G,"getIcons",{value:function(){return Object.values(this).map(o=>o.icon)},enumerable:!1});Object.defineProperty(G,"getColors",{value:function(){return Object.values(this).map(o=>o.color)},enumerable:!1});Object.defineProperty(G,"getHtmlPaths",{value:function(){return Object.values(this).map(o=>o.html)},enumerable:!1});Object.freeze(G);const we={GITHUB:{value:"github",url:"https://github.com/blooooork",icon_path:"links/github_link.svg"},TWITCH:{value:"twitch",url:"https://www.twitch.tv/blooooork",icon_path:"links/twitch_link.svg"},LINKEDIN:{value:"linkedin",url:"https://www.linkedin.com/in/meiersteven",icon_path:"links/linkedin_link.svg"},TIKTOK:{value:"tiktok",url:"https://www.tiktok.com/@blooooork",icon_path:"links/tiktok_link.svg"}};Object.defineProperty(we,"get_link",{value:function(o){for(const e in this)if(this[e]&&typeof this[e]=="object"&&this[e].value===o)return this[e].url;return null},enumerable:!1});Object.freeze(we);class un{constructor(e,t,i){this.world=e,this.parent=t,this.camera=i;const s=new z(100,1,100),n=new ne({color:8421504});this.floor_mesh=new k(s,n),this.floor_mesh.receiveShadow=!0,this.floor_mesh.position.y=-10.2,this.floor_mesh.name=`${b.FLOOR}${re.UNIQUE}`,this.floor_mesh.raycast=()=>null,this.parent.add(this.floor_mesh);const r=this.world.createRigidBody(ae.fixed().setTranslation(0,this.floor_mesh.position.y,0)),a=J.cuboid(50,.5,50);this.world.createCollider(a,r)}}function je(o,e,t){return Math.max(e,Math.min(t,o))}const dn="title_",Ft=2.75,et=9,_n=-4,Dt=.2;class fn{constructor(e,t){this.parent=e,this.camera=t,this.title_width=this.get_title_width(),this.title_height=Ft;const i=new z(this.title_width,this.title_height,Dt),s=new D({color:16777215,wireframe:!0});this.title_box=new k(i,s),this.title_box.name=`${dn}`,this.title_box.position.y=et,this.title_box.position.x=_n,this.parent.add(this.title_box)}get_title_width(){return je(R(this.camera).x*.5,12,18)}trigger_overlay(e,t){const i=this.title_box.position.clone(),s=e?L(Ne,this.camera):et;p.TWEEN_LOGS&&console.log(`Title Block - Starting overlay animation:
                Hidden: ${e}
                Current Position: (${i.x.toFixed(2)}, ${i.y.toFixed(2)}, ${i.z.toFixed(2)})
                Target Y: ${s.toFixed(2)}
                Map Size: ${t.size}`),!e&&p.LAYER&&this.title_box.layers.set(0);const n=new C(this.title_box.position).to({y:s}).easing(N.Elastic.InOut).start().onComplete(()=>{const r=this.title_box.position.clone();p.TWEEN_LOGS&&console.log(`Title Block - Completed overlay animation:
                        Hidden: ${e}
                        Final Position: (${r.x.toFixed(2)}, ${r.y.toFixed(2)}, ${r.z.toFixed(2)})`),e&&p.LAYER&&this.title_box.layers.set(1),t.delete(this.title_box.name)});t.set(this.title_box.name,n)}resize(){this.title_box.geometry.dispose(),this.title_box.geometry=new z(this.get_title_width(this.camera),Ft,Dt)}reposition(){new C(this.title_box.position).to({y:et}).easing(N.Elastic.Out).start()}offscreen_reposition(){this.title_box.position.y=L(Ne,this.camera)}}const pn=.5,mn=.5,gn="/pages/placeholder.html",ut="iframe_",Tn="div_";class yn{constructor(e,t,i,s){g(this,"camera");g(this,"parent");g(this,"frame_width");g(this,"pixel_width");g(this,"frame_height");g(this,"pixel_height");g(this,"div");g(this,"iframe");g(this,"css_div");g(this,"particles",[]);this.parent=e,this.camera=t,this.div=document.createElement("div"),this.div.name=`${Tn}${e.simple_name}`,this.iframe=document.createElement("iframe"),this.iframe.name=`${ut}${e.simple_name}`;const n=Object.values(G).find(r=>r.value===e.simple_name);this.iframe.src=n?n.html:gn,this.div.appendChild(this.iframe),this.css_div=new sn(this.div),this.css_div.simple_name=`${e.simple_name}`,this.css_div.name=`${ut}${this.css_div.simple_name}`,this.parent.add(this.css_div),this.update_size(i,s)}update_size(e,t){this.frame_width=e-pn,this.frame_height=t-mn;const i=this.camera.fov*Math.PI/180,s=2*Math.tan(i/2)*15,n=window.innerHeight/s;this.pixel_width=Math.round(this.frame_width*n),this.pixel_height=Math.round(this.frame_height*n),this.div.style.width=`${this.pixel_width}px`,this.div.style.height=`${this.pixel_height}px`,this.iframe.style.width=`${this.pixel_width}px`,this.iframe.style.height=`${this.pixel_height}px`,this.iframe.style.border="0px"}}class xn{constructor(e,t){g(this,"container_width");g(this,"container_height");g(this,"text_frames",new Map);g(this,"focused_text_name","");g(this,"particles",[]);g(this,"asset_manager");this.parent=e,this.camera=t,this.text_box_container=new V,this.asset_manager=H.get_instance(),this.parent.add(this.text_box_container);const i=(n,r)=>{this.container_width=this.get_text_box_width(),this.container_height=this.get_text_box_height();const a=new z(this.container_width,this.container_height,.01),c=new D({color:n.color,depthTest:!1,transparent:!0}),l=new k(a,c);l.name=`${b.BACKGROUND}${n.value}`,l.renderOrder=-1,r.add(l)},s=(n,r)=>{const a=new yn(r,this.camera,this.container_width,this.container_height);a.simple_name=n.value,a.name=`${b.TEXT_BLOCK}${n.value}`,this.text_frames.set(a.name,a)};Object.values(G).forEach((n,r)=>{if(typeof n=="function")return;const a=new V;switch(a.position.x=L(B,this.camera)*2,a.position.y=this.get_text_box_y(),a.simple_name=n.value,a.name=`${b.TEXT}${n.value}`,p.LAYER&&a.layers.set(1),this.text_box_container.add(a),n.value){case G.EDUCATION.value:const c=new es(-Math.PI/2,0,Math.PI,"XYZ"),l=new S(0,3,0),u=new S(0,-3,0);(async()=>{const h=Ge[O.DIPLOMA],d=await this.asset_manager.loader.loadAsync(h.PATH);[l,u].forEach(_=>{const f=d.scene.clone();f.scale.set(h.scale,h.scale,h.scale),f.position.copy(_),f.rotation.copy(c),f.traverse(m=>{var T,y,x,I;if(m.isMesh){if(m.name.startsWith("col_")){m.visible=!1;return}const A=m.material;p.ASSET_LOGS&&console.log("Original material:",{name:m.name,map:(y=(T=A.map)==null?void 0:T.image)==null?void 0:y.src,color:A.color.getHexString()}),m.material=new D,m.material.copy(A),m.material.needsUpdate=!0,m.material.transparent=!0,m.material.depthTest=!1,m.material.side=ye,m.renderOrder=999,p.ASSET_LOGS&&console.log("New material:",{name:m.name,map:(I=(x=m.material.map)==null?void 0:x.image)==null?void 0:I.src,color:m.material.color.getHexString()})}}),a.add(f)})})(),i(n,a);break;case G.ABOUT.value:s(n,a);break;default:i(n,a),s(n,a);break}})}focus_text_box(e,t){var i,s,n;if(t)this.lose_focus_text_box(B);else{const r=e.indexOf("_"),a=b.TEXT+e.substring(r+1);if(p.SELECT_LOGS&&console.log("Focusing text box:",{incoming_name:e,new_name:a,category:e.substring(r+1),available_frames:Array.from(this.text_frames.keys())}),a!=this.focused_text_name){if(this.focused_text_name!=""){const h=this.focused_text_name.replace(b.TEXT,""),d=this.text_frames.get(`${b.TEXT_BLOCK}${h}`);if(d&&d.iframe.contentWindow&&d.simple_name===G.EDUCATION.value){const _=new Event("visibilitychange");Object.defineProperty(d.iframe.contentDocument,"hidden",{value:!0,writable:!1}),d.iframe.contentDocument.dispatchEvent(_)}this.lose_focus_text_box(ee)}this.focused_text_name=a;const l=e.substring(r+1),u=this.text_frames.get(`${b.TEXT_BLOCK}${l}`);p.SELECT_LOGS&&console.log("Frame lookup:",{category:l,frameKey:`${b.TEXT_BLOCK}${l}`,frameFound:!!u,frameWindow:(i=u==null?void 0:u.iframe)!=null&&i.contentWindow?"exists":"missing",hasAnimation:(n=(s=u==null?void 0:u.iframe)==null?void 0:s.contentWindow)!=null&&n.trigger_frame_animation?"yes":"no"}),u&&u.iframe.contentWindow&&typeof u.iframe.contentWindow.trigger_frame_animation=="function"&&u.iframe.contentWindow.trigger_frame_animation()}const c=this.text_box_container.getObjectByName(this.focused_text_name);p.LAYER&&this.set_content_layer(this.focused_text_name,0),new C(c.position).to({x:this.get_focused_text_x()},285).easing(N.Sinusoidal.Out).start()}}lose_focus_text_box(e=""){if(this.focused_text_name!=""&&(e==""||rs.includes(e))){const t=this.text_box_container.getObjectByName(this.focused_text_name);if(e=="")t.position.x=L(B,this.camera);else{const i=L(e,this.camera),s=os*.2;switch(e){case Ne:new C(t.position).to({y:i},s).easing(N.Sinusoidal.Out).start().onComplete(()=>{p.LAYER&&this.set_content_layer(t.name,1),t.position.y=this.get_text_box_y(),t.position.x=L(B,this.camera)});break;case ee:new C(t.position).to({y:i},s).easing(N.Sinusoidal.Out).start().onComplete(()=>{p.LAYER&&this.set_content_layer(t.name,1),t.position.y=this.get_text_box_y(),t.position.x=2*L(B,this.camera)});break;case ze:new C(t.position).to({x:i},s).easing(N.Sinusoidal.Out).start().onComplete(()=>{p.LAYER&&this.set_content_layer(t.name,1),t.position.x=L(B,this.camera)});break;case B:new C(t.position).to({x:i},s).easing(N.Sinusoidal.Out).start().onComplete(()=>{p.LAYER&&this.set_content_layer(t.name,1)});break}}this.focused_text_name=""}}resize(){this.container_width=this.get_text_box_width(this.camera),this.container_height=this.get_text_box_height(this.camera);const e=new z(this.container_width,this.container_height,0);this.text_box_container.children.forEach(t=>{t.children.forEach(i=>{if(!i||!i.name)return;switch(Ee(i)){case b.BACKGROUND:i.geometry.dispose(),i.geometry=e;break;case ut:i.simple_name&&this.update_iframe_size(i.simple_name,this.container_width,this.container_height);break}})})}update_iframe_size(e,t,i){const s=Array.from(this.text_frames.values()).find(n=>n.simple_name==e);s&&s.update_size(t,i)}reposition(e){this.focused_text_name!=""&&this.focus_text_box(this.focused_text_name,e),this.text_box_container.children.forEach(t=>{t.name!=this.focused_text_name&&(t.position.x=L(B,this.camera)*2,t.position.y=this.get_text_box_y(this.camera))})}offscreen_reposition(){this.text_box_container.children.forEach(e=>{e.position.x=-(this.container_width*3),e.position.y=this.get_text_box_y(this.camera)})}set_content_layer(e,t){this.text_box_container.getObjectByName(e).children.forEach(s=>{s.layers.set(t)})}get_focused_text_x(){return-(R(this.camera).x/2*.36)}get_text_box_y(){return-(R(this.camera).y*.05)}get_text_box_height(){return R(this.camera).y*.6}get_text_box_width(){return je(R(this.camera).x*.5,12,18)}is_text_box_active(){return this.focused_text_name!=""}get_active_text_box(){return this.text_box_container.getObjectByName(this.focused_text_name)}trigger_overlay(e,t){const i=this.text_box_container.position.clone(),s=e?L(ee,this.camera):this.get_text_box_y();p.TWEEN_LOGS&&console.log(`Text Container - Starting overlay animation:
                Hidden: ${e}
                Current Position: (${i.x.toFixed(2)}, ${i.y.toFixed(2)}, ${i.z.toFixed(2)})
                Target Y: ${s.toFixed(2)}
                Map Size: ${t.size}`),!e&&p.LAYER&&this.set_content_layer(0);const n=new C(this.text_box_container.position).to({y:s},680).easing(N.Elastic.InOut).start().onComplete(()=>{const r=this.text_box_container.position.clone();p.TWEEN_LOGS&&console.log(`Text Container - Completed overlay animation:
                        Hidden: ${e}
                        Final Position: (${r.x.toFixed(2)}, ${r.y.toFixed(2)}, ${r.z.toFixed(2)})`),this.current_tween=null,e&&p.LAYER&&this.set_content_layer(1),t.delete(this.text_box_container.name)});t.set(this.text_box_container.name,n)}}class Sn{constructor(e,t){g(this,"in_tween_map",new Map);g(this,"swapping_column_sides",!1);g(this,"is_column_left",!0);g(this,"current_intersected",null);this.parent=e,this.camera=t,this.container_column=new V,this.container_column.name=`${b.CONATINER}column`,this.parent.add(this.container_column),Object.values(G).forEach((i,s)=>{if(typeof i=="function")return;const n=new V;n.simple_name=i.value,n.name=`${b.CONATINER}${i.value}`,this.container_column.add(n);const r=gt.load(i.icon);r.colorSpace=ce;const a=new k(new z(5,3,0),new D({map:r,transparent:!0,depthTest:!1}));a.simple_name=i.value,a.name=`${b.LABEL}${i.value}`,a.position.y=s*3,n.add(a)}),this.container_column.position.x=this.get_column_x_position(!0),this.container_column.position.y=this.get_column_y_position(!0),this.container_column.rotation.y=this.get_column_y_rotation(!0)}trigger_overlay(e,t){!e&&p.LAYER&&this.set_content_layer(0);const i=e?L(B,this.camera):this.get_column_x_position(!0),s=new C(this.container_column.position).to({x:i}).easing(N.Elastic.InOut).start().onComplete(()=>{e&&p.LAYER&&this.set_content_layer(1),t.delete(this.container_column.name)});t.set(this.container_column.name,s)}swap_sides(){this.is_column_left=!this.is_column_left;const e=this.get_column_x_position(this.is_column_left),t=this.get_column_y_position(this.is_column_left),i=this.get_column_y_rotation(this.is_column_left);this.swapping_column_sides=!0,new C(this.container_column.position).to({x:e,y:t},os).easing(N.Elastic.Out).start().onComplete(()=>{this.swapping_column_sides=!1}),new C(this.container_column.rotation).to({y:i},rn).easing(N.Exponential.Out).start()}reposition(){let e=this.get_column_x_position(this.is_column_left);new C(this.container_column.position).to({x:e}).easing(N.Elastic.Out).start()}offscreen_reposition(){this.container_column.position.x=L(B,this.camera)}handle_hover(e){if(!e||!e.rotation){p.ROTATION_TWEEN_LOGS&&console.log("[RotationTween] Invalid hover object received");return}if(p.ROTATION_TWEEN_LOGS&&(console.log(`[RotationTween] Hover detected on object: ${e.name}`),console.log(`[RotationTween] Current rotation: ${JSON.stringify(e.rotation)}`),console.log(`[RotationTween] Swapping sides status: ${this.swapping_column_sides}`)),this.swapping_column_sides){p.ROTATION_TWEEN_LOGS&&console.log("[RotationTween] Ignoring hover while swapping sides");return}const t=e.name;let i=this.in_tween_map.get(t);if(p.ROTATION_TWEEN_LOGS&&(console.log(`[RotationTween] Existing tween for ${t}:`,i?"yes":"no"),i&&console.log("[RotationTween] Current tween progress:",i._elapsed/i._duration)),i==null&&this.current_intersected!==e){p.ROTATION_TWEEN_LOGS&&console.log("[RotationTween] New intersection detected. Previous:",this.current_intersected?this.current_intersected.name:"none"),this.reset_previous_intersected(),this.current_intersected=e;let s=this.is_column_left?-.7:an;p.ROTATION_TWEEN_LOGS&&console.log(`[RotationTween] Starting rotation tween to ${s} (is_column_left: ${this.is_column_left})`),i=new C(this.current_intersected.rotation).to({y:s},400).easing(N.Sinusoidal.In).start().onComplete(()=>{p.ROTATION_TWEEN_LOGS&&console.log(`[RotationTween] Tween complete for ${t}. Final rotation:`,e.rotation.y),e.rotation.y=s,this.in_tween_map.delete(t)}),this.in_tween_map.set(t,i)}}reset_previous_intersected(){if(this.current_intersected){p.ROTATION_TWEEN_LOGS&&console.log(`[RotationTween] Resetting rotation for ${this.current_intersected.name}. Current rotation:`,this.current_intersected.rotation.y);const e=this.current_intersected,t=this.in_tween_map.get(e.name);t&&(p.ROTATION_TWEEN_LOGS&&console.log(`[RotationTween] Stopping existing tween for ${e.name} at progress:`,t._elapsed/t._duration),t.stop(),this.in_tween_map.delete(e.name)),new C(e.rotation).to({y:0},400).easing(N.Elastic.Out).start().onComplete(()=>{p.ROTATION_TWEEN_LOGS&&console.log(`[RotationTween] Reset complete for ${e.name}. Final rotation:`,e.rotation.y),e.rotation.y=0}),this.current_intersected=null}}set_content_layer(e){this.container_column.layers.set(0),Object.values(G).forEach(t=>{if(typeof t=="function")return;const i=`${b.CONATINER}${t.value}`,s=`${b.LABEL}${t.value}`;this.container_column.getObjectByName(i).getObjectByName(s).layers.set(e)})}get_column_x_position(e){return(e?-1:1)*(R(this.camera).x/2)*.6}get_column_y_position(e){return(e?-1:-.6)*(R(this.camera).y/2)*.6}get_column_y_rotation(e){return e?1:-1}}const _e={DIMENSIONS:{RADIUS:.44,SPACING:3.5},POSITION:{X_OFFSET:7,Y_SCALE:.45,Z:0}};class bn{constructor(e,t){this.parent=e,this.camera=t,this.link_container=new V,this.link_container.position.x=this.get_link_container_x(),this.link_container.position.y=this.get_link_container_y(),this.parent.add(this.link_container),Object.values(we).forEach((i,s)=>{const n=new ni(_e.DIMENSIONS.RADIUS),r=gt.load(i.icon_path);r.colorSpace=ce;const a=new k(n,new D({map:r,transparent:!0,depthTest:!1}));a.name=`${b.LINK}${i.value}`,a.position.x+=_e.DIMENSIONS.RADIUS*(_e.DIMENSIONS.SPACING*s),this.link_container.add(a)})}open_link(e){const t=we.get_link(e);t?window.open(t,"_blank"):console.log(`Given label "${e}" does not have a stored path`)}trigger_overlay(e,t){const i=this.link_container.position.clone(),s=e?L(ee,this.camera):this.get_link_container_y();p.TWEEN_LOGS&&console.log(`Link Container - Starting overlay animation:
                Hidden: ${e}
                Current Position: (${i.x.toFixed(2)}, ${i.y.toFixed(2)}, ${i.z.toFixed(2)})
                Target Y: ${s.toFixed(2)}
                Map Size: ${t.size}`),!e&&p.LAYER&&this.set_content_layers(0);const n=new C(this.link_container.position).to({y:s},680).easing(N.Elastic.InOut).start().onComplete(()=>{const r=this.link_container.position.clone();p.TWEEN_LOGS&&console.log(`Link Container - Completed overlay animation:
                        Hidden: ${e}
                        Final Position: (${r.x.toFixed(2)}, ${r.y.toFixed(2)}, ${r.z.toFixed(2)})`),this.current_tween=null,e&&p.LAYER&&this.set_content_layers(1),t.delete(this.link_container.name)});t.set(this.link_container.name,n)}reposition(){new C(this.link_container.position).to({x:this.get_link_container_x(),y:this.get_link_container_y()}).easing(N.Elastic.Out).start()}offscreen_reposition(){this.link_container.position.y=L(ee,this.camera),this.link_container.position.x=this.get_link_container_x()}set_content_layers(e){this.link_container.layers.set(e),Object.values(we).forEach(t=>{const i=`${b.LINK}${t.value}`;this.link_container.getObjectByName(i).layers.set(e)})}get_link_container_x(){return R(this.camera).x/2-_e.POSITION.X_OFFSET}get_link_container_y(){return-(_e.POSITION.Y_SCALE*R(this.camera).y)}get_link_radius(){return je(R(this.camera).x*.02,Number.MIN_SAFE_INTEGER,_e.DIMENSIONS.RADIUS)}}class An{constructor(e,t){g(this,"is_overlay_hidden",!1);this.parent=e,this.camera=t;const i=cn,s=ln,n=new z(i,s,0),r=this.get_hide_button_material();this.hide_button=new k(n,r),this.hide_button.position.y=this.get_hide_button_y(this.camera),this.hide_button.position.x=this.get_hide_button_x(!0,this.camera),this.hide_button.name=`${b.HIDE}${re.UNIQUE}`,this.parent.add(this.hide_button)}get_hide_button_material(){return new D({color:this.is_overlay_hidden?6856504:7829889,toneMapped:!1})}get_hide_button_x(e){return e?R(this.camera).x/2-2.5:L(ze,this.camera)}get_hide_button_y(){return R(this.camera).y/2-2.5}update_material(){this.hide_button.material&&this.hide_button.material.dispose(),this.hide_button.material=this.get_hide_button_material()}swap_sides(e){e&&this.hide_button.layers.set(0);const t=this.get_hide_button_x(e,this.camera);new C(this.hide_button.position).to({x:t},250).easing(N.Sinusoidal.Out).start().onComplete(()=>{e||this.hide_button.layers.set(1)})}reposition(e){new C(this.hide_button.position).to({x:this.get_hide_button_x(e),y:this.get_hide_button_y()}).easing(N.Elastic.Out).start()}offscreen_reposition(){this.hide_button.position.y=this.get_hide_button_y(),this.hide_button.position.x=this.get_hide_button_x(!1)}swap_hide_status(){this.is_overlay_hidden=!this.is_overlay_hidden,this.update_material()}}const F={DIMENSIONS:{MIN_WIDTH:6,MAX_WIDTH:8,WIDTH_SCALE:.2,HEIGHT:1,DEPTH:.2},POSITION:{X_OFFSET:1,Y_SCALE:.45,Z:0,MIN_PADDING:3}};class En{constructor(e,t){this.parent=e,this.camera=t;const i=new z(this.get_artist_width(),F.DIMENSIONS.HEIGHT,F.DIMENSIONS.DEPTH),s=new D({color:16777215,wireframe:!0});this.artist_box=new k(i,s);const n=R(this.camera),r=this.get_artist_width();this.artist_box.position.set(-(n.x/2)+F.POSITION.X_OFFSET+r/2,-(F.POSITION.Y_SCALE*n.y),F.POSITION.Z),this.artist_box.renderOrder=999,this.artist_box.material.depthTest=!1,this.parent.add(this.artist_box),this.reposition()}get_artist_width(){return je(R(this.camera).x*F.DIMENSIONS.WIDTH_SCALE,F.DIMENSIONS.MIN_WIDTH,F.DIMENSIONS.MAX_WIDTH)}resize(){this.artist_box.geometry.dispose(),this.artist_box.geometry=new z(this.get_artist_width(),F.DIMENSIONS.HEIGHT,F.DIMENSIONS.DEPTH)}trigger_overlay(e,t){const i=e?L(ee,this.camera):-(F.POSITION.Y_SCALE*R(this.camera).y);!e&&p.LAYER&&this.artist_box.layers.set(0);const s=new C(this.artist_box.position).to({y:i},680).easing(N.Elastic.InOut).start().onComplete(()=>{e&&p.LAYER&&this.artist_box.layers.set(1),t.delete(this.artist_box.name)});t.set(this.artist_box.name,s)}reposition(){const e=R(this.camera),t=this.get_artist_width(),s=e.x/2-7-F.POSITION.MIN_PADDING-t/2,n=Math.min(s,-(e.x/2)+F.POSITION.X_OFFSET+t/2);new C(this.artist_box.position).to({x:n,y:-(F.POSITION.Y_SCALE*e.y)}).easing(N.Elastic.Out).start()}offscreen_reposition(){const e=R(this.camera),t=this.get_artist_width();this.artist_box.position.y=L(ee,this.camera),this.artist_box.position.x=-(e.x/2)+F.POSITION.X_OFFSET+t/2}}const wn=200,Ht=[16711680,65280,255,16776960,16711935,65535],kt=.05,In=.004,vn=.995,On=-80,Nn=-100,Cn=45;class Mn{constructor(e,t){g(this,"overlay_container");g(this,"title_block");g(this,"text_box_container");g(this,"label_container");g(this,"link_container");g(this,"hide_button");g(this,"hide_transition_map",new Map);g(this,"party_popped",!1);g(this,"particles",[]);g(this,"primary_control_trigger",!1);g(this,"secondary_control_trigger",!1);g(this,"artist_block");this.parent=e,this.camera=t,this.overlay_container=new V,this.overlay_container.renderOrder=999,this.overlay_container.traverse(i=>{i.renderOrder=999}),this.title_block=new fn(this.overlay_container,this.camera),this.text_box_container=new xn(this.overlay_container,this.camera),this.label_container=new Sn(this.overlay_container,this.camera),this.link_container=new bn(this.overlay_container,this.camera),this.artist_block=new En(this.overlay_container,this.camera),this.hide_button=new An(this.overlay_container,this.camera),this.overlay_container.position.z=this.camera.position.z-15,this.parent.add(this.overlay_container)}create_confetti_burst(){if(p.PHYSICS_LOGS){const s=this.camera.position,n=this.overlay_container.position;console.log(`Camera Position: (${s.x.toFixed(2)}, ${s.y.toFixed(2)}, ${s.z.toFixed(2)})`),console.log(`Overlay Position: (${n.x.toFixed(2)}, ${n.y.toFixed(2)}, ${n.z.toFixed(2)})`)}const e=new S(0,0,-3);e.applyQuaternion(this.camera.quaternion);const t=this.camera.position.clone().add(e);p.PHYSICS_LOGS&&console.log(`Burst Position: (${t.x.toFixed(2)}, ${t.y.toFixed(2)}, ${t.z.toFixed(2)})`),[On*Math.PI/180,Nn*Math.PI/180].forEach((s,n)=>{const r=n===0?-1:1;for(let a=0;a<wn/2;a++){const c=new oi(kt,kt),l=new D({color:Ht[Math.floor(Math.random()*Ht.length)],side:ye,depthTest:!1,transparent:!0,opacity:1}),u=new k(c,l),h=t.clone().add(new S((Math.random()-.5)*.2-r*.5,(Math.random()-.5)*.2,(Math.random()-.5)*.2));u.position.copy(h),this.parent.add(u),u.renderOrder=999;const d=(Math.random()-.5)*Cn*Math.PI/180,_=s+d,f=new S,m=new S(1,0,0).applyQuaternion(this.camera.quaternion),T=new S(0,1,0).applyQuaternion(this.camera.quaternion);f.addScaledVector(m,Math.cos(_)),f.addScaledVector(T,Math.sin(_));const y=.08+Math.random()*.12,x=.15+Math.random()*.1;u.velocity=new S(f.x*y,f.y*y+x,f.z*y),u.lookAt(this.camera.position),u.rotation.z=Math.random()*Math.PI*2,u.rotationSpeed=(Math.random()-.5)*.2,this.particles.push(u),new C(u.material).to({opacity:0},2e3).easing(N.Quadratic.Out).start().onComplete(()=>{this.parent.remove(u),u.geometry.dispose(),u.material.dispose();const I=this.particles.indexOf(u);I>-1&&this.particles.splice(I,1)})}})}update_confetti(){if(this.particles.length>0&&p.PHYSICS_LOGS&&Math.random()<.1){const e=this.particles[0];console.log(`First Particle - Position: (${e.position.x.toFixed(2)}, ${e.position.y.toFixed(2)}, ${e.position.z.toFixed(2)}), Velocity: (${e.velocity.x.toFixed(3)}, ${e.velocity.y.toFixed(3)}, ${e.velocity.z.toFixed(3)})`)}for(const e of this.particles){const t=e.velocity.clone();t.applyQuaternion(this.overlay_container.quaternion.clone().invert()),t.y-=In,t.multiplyScalar(vn),e.velocity.copy(t),e.velocity.applyQuaternion(this.overlay_container.quaternion),e.position.add(e.velocity),e.rotation.z+=e.rotationSpeed}}trigger_overlay(){p.TWEEN_LOGS&&console.log(`OverlayContainer - Triggering overlay animation:
                Current Map Size: ${this.hide_transition_map.size}
                Current Position: (${this.overlay_container.position.x.toFixed(2)}, ${this.overlay_container.position.y.toFixed(2)}, ${this.overlay_container.position.z.toFixed(2)})`),this.hide_transition_map.size==0?(this.hide_button.swap_hide_status(),p.TWEEN_LOGS&&console.log(`OverlayContainer - Starting animations:
                    Is overlay hidden: ${this.hide_button.is_overlay_hidden}
                    Active tweens before: ${this.hide_transition_map.size}`),this.title_block.trigger_overlay(this.hide_button.is_overlay_hidden,this.hide_transition_map),this.label_container.trigger_overlay(this.hide_button.is_overlay_hidden,this.hide_transition_map),this.link_container.trigger_overlay(this.hide_button.is_overlay_hidden,this.hide_transition_map),this.artist_block.trigger_overlay(this.hide_button.is_overlay_hidden,this.hide_transition_map),this.primary_control_trigger&&!this.secondary_control_trigger&&this.hide_button.is_overlay_hidden&&(this.secondary_control_trigger=!0),this.primary_control_trigger=!0,p.TWEEN_LOGS&&console.log(`OverlayContainer - Animations started:
                    Active tweens after: ${this.hide_transition_map.size}`)):p.TWEEN_LOGS&&console.log(`OverlayContainer - Animation skipped:
                    Current active tweens: ${this.hide_transition_map.size}
                    Active tween names: ${Array.from(this.hide_transition_map.keys()).join(", ")}`)}swap_column_sides(){this.label_container.swap_sides(),this.hide_button.swap_sides(this.label_container.is_column_left)}resize_reposition(){this.text_box_container.resize(),this.text_box_container.reposition(this.label_container.is_column_left),this.label_container.reposition(),this.link_container.reposition(),this.title_block.resize(),this.title_block.reposition(),this.hide_button.reposition(this.label_container.is_column_left),this.artist_block.resize(),this.artist_block.reposition()}resize_reposition_offscreen(){this.text_box_container.resize(),this.text_box_container.offscreen_reposition(),this.label_container.offscreen_reposition(),this.link_container.offscreen_reposition(),this.title_block.resize(),this.title_block.offscreen_reposition(),this.artist_block.resize()}handle_hover(e){this.label_container.handle_hover(e)}reset_hover(){this.label_container.reset_previous_intersected()}focus_text_box(e){const t=e.split("_")[1];if(t==G.EDUCATION.value&&!this.party_popped){const i={value:0};new C(i).to({value:1},200).easing(N.Sinusoidal.Out).start().onComplete(()=>{this.create_confetti_burst()}),this.party_popped=!0}this.text_box_container.focus_text_box(t,this.label_container.is_column_left)}lose_focus_text_box(e){this.text_box_container.lose_focus_text_box(e)}open_link(e){this.link_container.open_link(e)}is_label_container_left_side(){return this.label_container.is_column_left}is_intersected(){return this.label_container.current_intersected}intersected_name(){return this.label_container.current_intersected.name}is_swapping_sides(){return this.label_container.swapping_column_sides}is_text_active(){return this.text_box_container.is_text_box_active()}get_active_box(){if(this.is_text_active())return this.text_box_container.get_active_text_box()}}class Rn{constructor(e,t=15){this.camera=e,this.distance=t,this.target=new S(0,0,0),this.phi=0,this.theta=0,this.min_phi=-60,this.max_phi=60,this.min_dist=5,this.max_dist=30,this.on_update_callbacks=new Set,this.overlay_container=null,this.update_camera()}add_update_callback(e){this.on_update_callbacks.add(e)}remove_update_callback(e){this.on_update_callbacks.delete(e)}rotate(e,t){this.theta-=e,this.phi=Math.max(this.min_phi,Math.min(this.max_phi,this.phi+t)),this.update_camera()}zoom(e){this.distance=Math.max(this.min_dist,Math.min(this.max_dist,this.distance+e)),this.update_camera()}set_overlay_container(e){this.overlay_container=e}update_camera(){const e=rt.degToRad(this.phi),t=rt.degToRad(this.theta);if(this.camera.position.x=this.distance*Math.cos(e)*Math.sin(t),this.camera.position.y=this.distance*Math.sin(e),this.camera.position.z=this.distance*Math.cos(e)*Math.cos(t),p.PHYSICS_LOGS&&(console.log("Camera Update:"),console.log(`Position: (${this.camera.position.x.toFixed(2)}, ${this.camera.position.y.toFixed(2)}, ${this.camera.position.z.toFixed(2)})`),console.log(`Angles: phi=${this.phi.toFixed(2)}, theta=${this.theta.toFixed(2)}`)),this.camera.lookAt(this.target),this.camera.updateMatrix(),this.overlay_container){const i=new S(0,0,-15);i.applyQuaternion(this.camera.quaternion),this.overlay_container.overlay_container.position.copy(this.camera.position),this.overlay_container.overlay_container.position.add(i),this.overlay_container.overlay_container.lookAt(this.camera.position)}this.on_update_callbacks.forEach(i=>i())}}const Ln=25;class Pn{constructor(e,t){g(this,"detect_rotation",!1);g(this,"overlay_container");g(this,"leftMouseDown",!1);g(this,"rightMouseDown",!1);g(this,"camera_manager");this.viewable_container_container=new V,this.parent=e,this.world=t,this.camera=new qt(75,window.innerWidth/window.innerHeight,.1,1e3),this.camera_manager=new Rn(this.camera,Ln),this.overlay_container=new Mn(this.viewable_container_container,this.get_camera()),this.camera_manager.set_overlay_container(this.overlay_container),this.camera_manager.add_update_callback(()=>{this.overlay_container&&this.overlay_container.resize_reposition_offscreen()}),this.viewable_container_container.add(this.camera),this.parent.add(this.viewable_container_container)}swap_sides(){this.get_overlay().swap_column_sides()}reset_hover(){this.get_overlay().reset_hover()}focus_text_box(e){this.get_overlay().focus_text_box(e)}open_link(e){this.get_overlay().open_link(e)}lose_focus_text_box(e=null){this.get_overlay().lose_focus_text_box(e)}reset_camera(){this.get_camera().aspect=window.innerWidth/window.innerHeight,this.get_camera().updateProjectionMatrix()}resize_reposition(){this.is_overlay_hidden()?this.get_overlay().resize_reposition_offscreen():this.get_overlay().resize_reposition()}trigger_overlay(){this.get_overlay().trigger_overlay()}handle_mouse_up(e){if(this.is_column_left_side()){if(e.length>0){const t=e[0].object,i=t.name;switch(Ee(t)){case b.LABEL:p.SELECT_LOGS&&console.log(i,"clicked up"),this.reset_hover(),this.swap_sides(),this.focus_text_box(i);break;case b.HIDE:this.trigger_overlay();break;case b.LINK:this.open_link(i.split("_")[1].trim());break}}}else if(e.length>0){const t=e[0].object,i=t.name;switch(Ee(t)){case b.LABEL:p.SELECT_LOGS&&console.log(i,"clicked up"),this.focus_text_box(i);break;case b.LINK:this.open_link(i.split("_")[1].trim());break;default:this.swap_sides(),this.lose_focus_text_box(B)}}else this.swap_sides(),this.lose_focus_text_box(B)}handle_mouse_down(e){if(e.length>0){const t=e[0].object,i=t.name;switch(Ee(t)){case b.LABEL:p.SELECT_LOGS&&console.log(i,"clicked down");break}}}is_primary_triggered(){return this.get_overlay().primary_control_trigger}is_secondary_triggered(){return this.get_overlay().secondary_control_trigger}is_column_left_side(){return this.get_overlay().is_label_container_left_side()}is_text_active(){return this.overlay_container.is_text_active()}is_overlay_hidden(){return this.get_overlay().hide_button.is_overlay_hidden}get_hide_transition_map(){return this.get_overlay().hide_transition_map}get_camera(){return this.camera}get_camera_manager(){return this.camera_manager}get_overlay(){return this.overlay_container}get_active_name(){return this.overlay_container.get_active_box().name}get_viewable_container(){return this.viewable_container_container}get_intersected_name(){return this.get_overlay().intersected_name()}}const Bt=7,Gn=16775640,Fn=16777215,Dn=6700063;class Hn{constructor(e){this.parent=e,this.lighting_container=new V,this.parent.add(this.lighting_container);const t=new Wt(Gn,150);t.position.set(2.5,Bt,-5),t.angle=-Math.PI/2,t.penumbra=.5,t.castShadow=!0,t.shadow.blurSamples=10,t.shadow.radius=5,this.lighting_container.add(t);const i=t.clone();i.position.set(-2.5,Bt,-1),this.lighting_container.add(i);const s=new ri(Fn,Dn,2);s.position.z=50,s.position.y=500,this.lighting_container.add(s)}}const tt=.1,st=4,as=2;let ke=new P,Ke=15,dt=new S,Ie=new S,_t=0;function kn(o,e){const i=H.get_instance().get_body_pair_by_mesh(o);if(i){const[s,n]=i,r=new S;e.getWorldPosition(r);const a=new S;o.getWorldPosition(a);const c=new S().subVectors(a,r).normalize();n.applyImpulse({x:c.x*st,y:c.y*st,z:c.z*st},!0)}}function Bn(o){ke.x=o.clientX/window.innerWidth*2-1,ke.y=-(o.clientY/window.innerHeight)*2+1}function $n(o,e){const i=H.get_instance().get_body_pair_by_mesh(o);if(!i)return;const[s,n]=i,r=new S,a=new S,c=new S;r.setFromMatrixPosition(e.matrixWorld),a.set(ke.x,ke.y,1).unproject(e),c.subVectors(a,r).normalize();const l=r.clone().add(c.multiplyScalar(Ke)),u=performance.now(),h=(u-_t)/1e3;Ie.subVectors(l,dt).divideScalar(h),dt.copy(l),_t=u;const d=n.rotation();n.setTranslation(l),n.setRotation(d)}function Un(o){H.get_instance().get_body_pair_by_mesh(o)&&(Ke+=as)}function zn(o){H.get_instance().get_body_pair_by_mesh(o)&&(Ke-=as)}function jn(o,e){const t=H.get_instance();p.ACTIVATE_LOGS&&console.log(`Grabbing ${o.name}`);const i=t.get_body_pair_by_mesh(o);if(!i)return;const[s,n]=i,r=new S;e.getWorldPosition(r);const a=new S;a.copy(n.translation()),Ke=r.distanceTo(a),dt.copy(a),_t=performance.now(),Ie.set(0,0,0),n.setBodyType(pt.KinematicPositionBased)}function cs(o){const t=H.get_instance().get_body_pair_by_mesh(o);if(!t)return;const[i,s]=t;s.setBodyType(pt.Dynamic),s.applyImpulse({x:Ie.x*tt,y:Ie.y*tt,z:Ie.z*tt},!0)}const Kn="images/MouseControlMenu.svg",v={BEAM:{DIMENSIONS:{WIDTH:10,HEIGHT:.5,DEPTH:.2},PHYSICS:{MASS:0,RESTITUTION:1.1}},SIGN:{DIMENSIONS:{WIDTH:10,HEIGHT:10,DEPTH:.01},PHYSICS:{LINEAR_DAMPING:.9,ANGULAR_DAMPING:.9,MASS:5,RESTITUTION:.2,USE_CCD:!0}},SPACING:1.5,JOINT:{SPREAD:5,LENGTH:1,LIMITS:{MIN:-Math.PI/6,MAX:Math.PI/6}},POSITION:{OFFSET:{X:0,Y:8,Z:400},Z_TARGET:7},MOVEMENT:{DEFAULT_SPEED:80,GRAVITY_DELAY:266}},Me={BEAM:{LEFT:{x:-5,y:0,z:0},RIGHT:{x:v.JOINT.SPREAD,y:0,z:0},BOTTOM:{x:0,y:-.5/2,z:0}},SIGN:{LEFT:{x:-5,y:v.SIGN.DIMENSIONS.HEIGHT/2,z:0},RIGHT:{x:v.JOINT.SPREAD,y:v.SIGN.DIMENSIONS.HEIGHT/2,z:0},BOTTOM:{x:0,y:-10/2,z:0},TOP:{x:0,y:v.SIGN.DIMENSIONS.HEIGHT/2,z:0}}},Vn=250;class Wn{constructor(e,t,i,s,n=Vn){g(this,"parent");g(this,"camera");g(this,"world");g(this,"top_beam_geometry");g(this,"top_beam_material");g(this,"top_beam_mesh");g(this,"top_beam_body");g(this,"top_beam_shape");g(this,"sign_image");g(this,"sign_canvas");g(this,"sign_context");g(this,"sign_texture");g(this,"sign_material");g(this,"sign_geometry");g(this,"sign_mesh");g(this,"sign_body");g(this,"sign_shape");g(this,"assembly_position");g(this,"sign_joint");g(this,"chains_broken",!1);g(this,"reached_target",!1);g(this,"last_log_time",0);g(this,"log_interval",500);this.parent=e,this.camera=t,this.world=i,this.assembly_position={x:this.camera.position.x+v.POSITION.OFFSET.X,y:this.camera.position.y+v.POSITION.OFFSET.Y,z:this.camera.position.z-v.POSITION.OFFSET.Z},this.top_beam_geometry=new z(v.BEAM.DIMENSIONS.WIDTH,v.BEAM.DIMENSIONS.HEIGHT,v.BEAM.DIMENSIONS.DEPTH),this.top_beam_material=new ne({color:16777215,transparent:!0,opacity:0}),this.top_beam_mesh=new k(this.top_beam_geometry,this.top_beam_material),this.parent.add(this.top_beam_mesh),this.top_beam_body=this.world.createRigidBody(ae.dynamic().setTranslation(this.assembly_position.x,this.assembly_position.y,this.assembly_position.z).setLinvel(0,0,n).setGravityScale(0).setCanSleep(!1)),this.top_beam_shape=J.cuboid(v.BEAM.DIMENSIONS.WIDTH/2,v.BEAM.DIMENSIONS.HEIGHT/2,v.BEAM.DIMENSIONS.DEPTH/2).setMass(v.BEAM.PHYSICS.MASS).setRestitution(v.BEAM.PHYSICS.RESTITUTION),this.world.createCollider(this.top_beam_shape,this.top_beam_body),s.dynamic_bodies.push([this.top_beam_mesh,this.top_beam_body]),this.sign_image=new Image,this.sign_image.onload=()=>{this.sign_canvas=document.createElement("canvas"),this.sign_canvas.width=this.sign_image.width,this.sign_canvas.height=this.sign_image.height,this.sign_context=this.sign_canvas.getContext("2d"),this.sign_context.drawImage(this.sign_image,0,0),this.sign_texture=new ts(this.sign_canvas),this.sign_material=new ne({map:this.sign_texture,side:ye}),this.sign_geometry=new z(v.SIGN.DIMENSIONS.WIDTH,v.SIGN.DIMENSIONS.HEIGHT,v.SIGN.DIMENSIONS.DEPTH),this.sign_mesh=new k(this.sign_geometry,this.sign_material),this.sign_mesh.castShadow=!0,this.sign_mesh.name=`${b.INTERACTABLE}${re.PRIMARY}`,this.parent.add(this.sign_mesh);const r=new De().setFromAxisAngle(new S(1,0,0),-Math.PI/2);this.sign_body=this.world.createRigidBody(ae.dynamic().setTranslation(this.assembly_position.x,this.top_beam_mesh.position.y-(v.SPACING+v.SIGN.DIMENSIONS.HEIGHT/2),this.top_beam_mesh.position.z).setRotation(r).setAngvel({x:0,y:0,z:0}).setLinearDamping(v.SIGN.PHYSICS.LINEAR_DAMPING).setAngularDamping(2).setCcdEnabled(v.SIGN.PHYSICS.USE_CCD).setCanSleep(!1)),this.sign_shape=J.cuboid(v.SIGN.DIMENSIONS.WIDTH/2,v.SIGN.DIMENSIONS.HEIGHT/2,v.SIGN.DIMENSIONS.DEPTH/2).setMass(v.SIGN.PHYSICS.MASS).setRestitution(v.SIGN.PHYSICS.RESTITUTION),this.world.createCollider(this.sign_shape,this.sign_body);const a=Re.revolute(Me.BEAM.BOTTOM,{x:Me.SIGN.TOP.x,y:Me.SIGN.TOP.y+v.SPACING,z:Me.SIGN.TOP.z},{x:1,y:0,z:0});a.limits=[0,0],this.sign_joint=this.world.createImpulseJoint(a,this.top_beam_body,this.sign_body),this.sign_joint&&this.sign_joint.configureMotorPosition(0,1e4,1e3),p.PHYSICS_LOGS&&console.log("Joint created with motor configuration"),s.dynamic_bodies.push([this.sign_mesh,this.sign_body])},this.sign_image.src=Kn,this.reached_target=!1,this.last_log_time=0,this.log_interval=5e3}break_chains(){this.chains_broken||(this.sign_body.setGravityScale(1),this.world.removeImpulseJoint(this.sign_joint),this.sign_joint=null,this.chains_broken=!0)}update(){if(!this.sign_joint||this.chains_broken)return;const e=performance.now();if(e-this.last_log_time>this.log_interval){const t=this.top_beam_mesh.position,i=this.top_beam_body.linvel();if(p.PHYSICS_LOGS&&(console.log("=== Position Update ==="),console.log(`Top Beam - Position: (${t.x.toFixed(2)}, ${t.y.toFixed(2)}, ${t.z.toFixed(2)})`),console.log(`Top Beam - Velocity: (${i.x.toFixed(2)}, ${i.y.toFixed(2)}, ${i.z.toFixed(2)})`),this.sign_mesh&&this.sign_body)){const s=this.sign_mesh.position,n=this.sign_body.linvel(),r=this.sign_body.rotation(),a=new es().setFromQuaternion(new De(r.x,r.y,r.z,r.w));console.log(`Sign - Position: (${s.x.toFixed(2)}, ${s.y.toFixed(2)}, ${s.z.toFixed(2)})`),console.log(`Sign - Velocity: (${n.x.toFixed(2)}, ${n.y.toFixed(2)}, ${n.z.toFixed(2)})`),console.log(`Sign - Rotation (rad): x:${a.x.toFixed(2)}, y:${a.y.toFixed(2)}, z:${a.z.toFixed(2)}`),console.log(`Sign - Rotation (deg): x:${(a.x*180/Math.PI).toFixed(2)}, y:${(a.y*180/Math.PI).toFixed(2)}, z:${(a.z*180/Math.PI).toFixed(2)}`)}this.last_log_time=e}if(!this.reached_target&&this.top_beam_mesh.position.z>=v.POSITION.Z_TARGET){p.PHYSICS_LOGS&&console.log("=== Attempting to Stop Beam ==="),this.reached_target=!0;const t=this.top_beam_body.translation();p.PHYSICS_LOGS&&console.log(`Current Position before stop: (${t.x.toFixed(2)}, ${t.y.toFixed(2)}, ${t.z.toFixed(2)})`),this.top_beam_body.setLinvel(0,0,0),this.sign_body.setAngularDamping(.9),this.sign_joint&&!this.chains_broken&&(this.sign_joint.configureMotorPosition(0,1e3,200),setTimeout(()=>{this.sign_joint&&!this.chains_broken&&(this.sign_joint.configureMotorPosition(0,500,100),setTimeout(()=>{this.sign_joint&&!this.chains_broken&&(this.sign_joint.configureMotorPosition(0,100,20),setTimeout(()=>{this.sign_joint&&!this.chains_broken&&this.sign_joint.configureMotorPosition(0,10,2)},100))},100))},100)),setTimeout(()=>{this.sign_body.setGravityScale(1)},v.MOVEMENT.GRAVITY_DELAY),this.top_beam_body.setBodyType(pt.Fixed),p.PHYSICS_LOGS&&(console.log("Changed body type to Fixed"),console.log(`Final Position: (${t.x.toFixed(2)}, ${t.y.toFixed(2)}, ${t.z.toFixed(2)})`))}}}class Yn{constructor(e,t,i,s,n){g(this,"parent");g(this,"camera");g(this,"world");g(this,"dynamic_bodies");g(this,"CHAIN_CONFIG",{POSITION:{X:0,Y:10,Z:0},SEGMENTS:{COUNT:6,LENGTH:.5,RADIUS:.1,DAMPING:.2,MASS:.05,RESTITUTION:.1,FRICTION:.8,ANGULAR_DAMPING:1.5,GRAVITY_SCALE:5},SIGN:{LOCAL_OFFSET:{X:0,Y:2,Z:0},DIMENSIONS:{WIDTH:2,HEIGHT:2,DEPTH:.01},DAMPING:.8,MASS:1,RESTITUTION:.1,FRICTION:.8,ANGULAR_DAMPING:.8,GRAVITY_SCALE:1.5,IMAGE_PATH:"images/ScrollControlMenu.svg"}});g(this,"chain_joints",[]);g(this,"chains_broken",!1);g(this,"last_log_time",0);g(this,"log_interval",500);this.parent=e,this.camera=t,this.world=i,this.dynamic_bodies=s.dynamic_bodies,this.CHAIN_CONFIG.POSITION.X=n.x,this.CHAIN_CONFIG.POSITION.Y=n.y,this.CHAIN_CONFIG.POSITION.Z=n.z;const a=Math.atan2(this.camera.position.x,this.camera.position.z)/2,c={x:0,y:Math.sin(a),z:0,w:Math.cos(a)},l=this.world.createRigidBody(ae.fixed().setTranslation(this.CHAIN_CONFIG.POSITION.X,this.CHAIN_CONFIG.POSITION.Y,this.CHAIN_CONFIG.POSITION.Z).setRotation(c));let u=l;for(let d=0;d<this.CHAIN_CONFIG.SEGMENTS.COUNT;d++){const _=this.world.createRigidBody(ae.dynamic().setTranslation(this.CHAIN_CONFIG.POSITION.X,this.CHAIN_CONFIG.POSITION.Y-(d+1)*this.CHAIN_CONFIG.SEGMENTS.LENGTH,this.CHAIN_CONFIG.POSITION.Z).setRotation(c).setLinearDamping(this.CHAIN_CONFIG.SEGMENTS.DAMPING).setAngularDamping(this.CHAIN_CONFIG.SEGMENTS.ANGULAR_DAMPING).setAdditionalMass(this.CHAIN_CONFIG.SEGMENTS.MASS).setGravityScale(this.CHAIN_CONFIG.SEGMENTS.GRAVITY_SCALE).setCanSleep(!1)),f=J.ball(this.CHAIN_CONFIG.SEGMENTS.RADIUS).setRestitution(this.CHAIN_CONFIG.SEGMENTS.RESTITUTION).setFriction(this.CHAIN_CONFIG.SEGMENTS.FRICTION);this.world.createCollider(f,_),this.dynamic_bodies.push([_]);let m;if(d>0){const T=Re.spherical({x:0,y:-this.CHAIN_CONFIG.SEGMENTS.LENGTH/2,z:0},{x:0,y:this.CHAIN_CONFIG.SEGMENTS.LENGTH/2,z:0});m=this.world.createImpulseJoint(T,u,_,!0)}else{const T=Re.spherical({x:0,y:0,z:0},{x:0,y:this.CHAIN_CONFIG.SEGMENTS.LENGTH/2,z:0});m=this.world.createImpulseJoint(T,l,_,!0)}this.chain_joints.push(m),u=_}const h=new Image;h.onload=()=>{const d=document.createElement("canvas");d.width=h.width,d.height=h.height,d.getContext("2d").drawImage(h,0,0);const f=new ts(d),m=new ne({map:f,side:ye}),T=new z(this.CHAIN_CONFIG.SIGN.DIMENSIONS.WIDTH,this.CHAIN_CONFIG.SIGN.DIMENSIONS.HEIGHT,this.CHAIN_CONFIG.SIGN.DIMENSIONS.DEPTH),y=new k(T,m);y.castShadow=!0,y.name=`${b.INTERACTABLE}${re.SECONDARY}`,y.rotation.x=Math.PI/2,this.parent.add(y);const x=this.CHAIN_CONFIG.POSITION.Y-this.CHAIN_CONFIG.SEGMENTS.COUNT*this.CHAIN_CONFIG.SEGMENTS.LENGTH,A=Math.atan2(this.camera.position.x,this.camera.position.z)/2,M=this.world.createRigidBody(ae.dynamic().setTranslation(this.CHAIN_CONFIG.POSITION.X+this.CHAIN_CONFIG.SIGN.LOCAL_OFFSET.X,x+this.CHAIN_CONFIG.SIGN.LOCAL_OFFSET.Y,this.CHAIN_CONFIG.POSITION.Z+this.CHAIN_CONFIG.SIGN.LOCAL_OFFSET.Z).setRotation({x:0,y:Math.sin(A),z:0,w:Math.cos(A)}).setLinearDamping(this.CHAIN_CONFIG.SIGN.DAMPING).setAngularDamping(this.CHAIN_CONFIG.SIGN.ANGULAR_DAMPING).setAdditionalMass(this.CHAIN_CONFIG.SIGN.MASS).setGravityScale(this.CHAIN_CONFIG.SIGN.GRAVITY_SCALE).setCanSleep(!1)),Y=J.cuboid(this.CHAIN_CONFIG.SIGN.DIMENSIONS.WIDTH/2,this.CHAIN_CONFIG.SIGN.DIMENSIONS.HEIGHT/2,this.CHAIN_CONFIG.SIGN.DIMENSIONS.DEPTH/2).setRestitution(this.CHAIN_CONFIG.SIGN.RESTITUTION).setFriction(this.CHAIN_CONFIG.SIGN.FRICTION);this.world.createCollider(Y,M);const U=Re.spherical({x:0,y:-this.CHAIN_CONFIG.SEGMENTS.LENGTH/2,z:0},{x:0,y:this.CHAIN_CONFIG.SIGN.DIMENSIONS.HEIGHT/2,z:0});this.world.createImpulseJoint(U,u,M,!0),H.get_instance().add_object(y,M)},h.src=this.CHAIN_CONFIG.SIGN.IMAGE_PATH,this.last_log_time=0,this.log_interval=500}break_chains(){if(!this.chains_broken){if(this.chain_joints.forEach(e=>{this.world.removeImpulseJoint(e)}),this.chain_joints=[],this.parent.children){this.parent.children.filter(i=>i.geometry instanceof Et).forEach((i,s)=>{const n=this.dynamic_bodies.find(([r])=>r===i);if(n){const[r,a]=n;a.setGravityScale(this.CHAIN_CONFIG.SEGMENTS.GRAVITY_SCALE)}});const t=this.parent.children.find(i=>i.name===`${b.INTERACTABLE}${re.SECONDARY}`);if(t){const i=this.dynamic_bodies.find(([s])=>s===t);if(i){const[s,n]=i;n.setGravityScale(this.CHAIN_CONFIG.SIGN.GRAVITY_SCALE)}}}this.chains_broken=!0}}update(){const e=performance.now();if(this.parent.children){const t=this.parent.children.find(i=>i.name===`${b.INTERACTABLE}${re.SECONDARY}`);if(t){const i=new S;i.subVectors(this.camera.position,new S(0,0,0)),i.normalize(),t.position.normalize();const s=new le;s.lookAt(t.position,new S(0,0,0),new S(0,1,0)),t.quaternion.setFromRotationMatrix(s),t.rotateY(Math.PI)}}if(e-this.last_log_time>this.log_interval){if(p.PHYSICS_LOGS){console.log("=== Position Update (Scroll Menu) ==="),this.parent.children&&this.parent.children.filter(s=>s.geometry instanceof Et).forEach((s,n)=>{const r=s.position;console.log(`Chain Link ${n} - Position: (${r.x.toFixed(2)}, ${r.y.toFixed(2)}, ${r.z.toFixed(2)})`)});const t=this.parent.children.find(i=>i.name===`${b.INTERACTABLE}${re.SECONDARY}`);if(t){const i=t.position;console.log(`Sign - Position: (${i.x.toFixed(2)}, ${i.y.toFixed(2)}, ${i.z.toFixed(2)})`)}}this.last_log_time=e}}}class Xn{constructor(e,t,i){g(this,"name","[BackgroundContainer]");g(this,"parent");g(this,"camera");g(this,"world");g(this,"object_container");g(this,"primary_instruction_sign",null);g(this,"secondary_instruction_sign",null);g(this,"dynamic_bodies",[]);this.parent=e,this.camera=t,this.world=i,this.object_container=new V,this.parent.add(this.object_container);const s=H.get_instance();(async()=>{let[a,c]=await s.spawn_asset(O.DESKPHOTO,this.object_container,this.world,{},new S(-5,5,5));a.name=`${b.INTERACTABLE}${O.DESKPHOTO}`,p.ASSET_LOGS&&console.log(`${this.name} Creating Desk photo with name: ${a.name}`),[a,c]=await s.spawn_asset(O.TABLET,this.object_container,this.world,{},new S(-10,5,5)),a.name=`${b.INTERACTABLE}${O.TABLET}`,p.ASSET_LOGS&&console.log(`${this.name} Creating Tablet with name: ${a.name}`),[a,c]=await s.spawn_asset(O.DIPLOMA,this.object_container,this.world,{},new S(-10,5,0)),a.name=`${b.INTERACTABLE}${O.DIPLOMA}`,p.ASSET_LOGS&&console.log(`${this.name} Creating Diploma with name: ${a.name}`),[a,c]=await s.spawn_asset(O.DESK,this.object_container,this.world,{},new S(-5,5,0)),a.name=`${b.INTERACTABLE}${O.DESK}`,p.ASSET_LOGS&&console.log(`${this.name} Creating Desk with name: ${a.name}`),[a,c]=await s.spawn_asset(O.CHAIR,this.object_container,this.world,{},new S(-0,5,0)),a.name=`${b.INTERACTABLE}${O.CHAIR}`,p.ASSET_LOGS&&console.log(`${this.name} Creating Chair with name: ${a.name}`),[a,c]=await s.spawn_asset(O.ROOM,this.object_container,this.world,{},new S(5,5,0)),a.name=`${b.INTERACTABLE}${O.ROOM}`,p.ASSET_LOGS&&console.log(`${this.name} Creating Room with name: ${a.name}`),[a,c]=await s.spawn_asset(O.BOOK,this.object_container,this.world,{},new S(10,5,0)),a.name=`${b.INTERACTABLE}${O.BOOK}`,p.ASSET_LOGS&&console.log(`${this.name} Creating Book with name: ${a.name}`)})();const n=H.get_instance(),r=Object.values(G).map(async(a,c)=>{if(typeof a=="function"||a==G.EDUCATION)return;const l=new S(c*2-3,-2,-5),[u,h]=await n.spawn_asset(O.CUBE,this.object_container,this.world,{color:a.color},l);u.name=`${b.INTERACTABLE}${a.value}`,p.ASSET_LOGS&&console.log(`${this.name} Creating cube with name: ${u.name}`)});Promise.all(r).then(()=>{p.PHYSICS_LOGS&&console.log("All cubes initialized")})}update(e,t){let i=!1;(e!=null||t.is_secondary_triggered())&&!i&&(i=!0),t.is_primary_triggered()&&!this.is_primary_spawned()?this.spawn_primary_instructions().catch(s=>{console.error("Error spawning primary instructions:",s)}):!t.is_overlay_hidden()&&this.is_primary_instructions_intact()?this.break_primary_chains():i&&!this.is_secondary_spawned()?(this.break_primary_chains(),this.spawn_secondary_instructions()):this.is_secondary_spawned()&&!t.is_overlay_hidden()&&this.break_secondary_chains(),this.primary_instruction_sign&&this.primary_instruction_sign.update(),this.secondary_instruction_sign&&this.secondary_instruction_sign.update(),this.dynamic_bodies.forEach(([s,n])=>{if(n!=null){const r=n.translation();s.position.set(r.x,r.y,r.z);const a=n.rotation();s.quaternion.set(a.x,a.y,a.z,a.w)}})}contains_object(e){this.getNodeChildren().forEach(t=>{if(t.name==e)return!0})}async spawn_primary_instructions(){(async()=>{this.primary_instruction_sign=new Wn(this.object_container,this.camera,this.world,this),await new Promise(t=>{const i=()=>{this.primary_instruction_sign.sign_mesh&&this.primary_instruction_sign.sign_body?t():setTimeout(i,100)};i()});const e=H.get_instance();this.primary_instruction_sign.sign_mesh.name=`${b.INTERACTABLE}primary`,this.primary_instruction_sign.sign_mesh.traverse(t=>{t.isMesh&&(t.name=`${b.INTERACTABLE}primary`)}),e.add_object(this.primary_instruction_sign.sign_mesh,this.primary_instruction_sign.sign_body),p.PHYSICS_LOGS&&console.log("Primary sign added to asset manager:",{meshName:this.primary_instruction_sign.sign_mesh.name,hasBody:!!this.primary_instruction_sign.sign_body,bodyType:this.primary_instruction_sign.sign_body.bodyType()})})().catch(e=>{console.error("Error spawning primary instructions:",e)})}async spawn_secondary_instructions(){p.PHYSICS_LOGS&&(console.log("Spawning Scroll Menu:"),console.log(`Camera Position: (${this.camera.position.x.toFixed(2)}, ${this.camera.position.y.toFixed(2)}, ${this.camera.position.z.toFixed(2)})`));const e=new S(0,0,-5);e.applyQuaternion(this.camera.quaternion);const t={x:this.camera.position.x+e.x,y:this.camera.position.y+e.y+4,z:this.camera.position.z+e.z};(async()=>{this.secondary_instruction_sign=new Yn(this.object_container,this.camera,this.world,this,t),await new Promise(s=>{const n=()=>{this.secondary_instruction_sign.sign_mesh&&this.secondary_instruction_sign.sign_body?s():setTimeout(n,100)};n()});const i=H.get_instance();this.secondary_instruction_sign.sign_mesh.name=`${b.INTERACTABLE}secondary`,this.secondary_instruction_sign.sign_mesh.traverse(s=>{s.isMesh&&(s.name=`${b.INTERACTABLE}secondary`)}),i.add_object(this.secondary_instruction_sign.sign_mesh,this.secondary_instruction_sign.sign_body),p.PHYSICS_LOGS&&console.log("Secondary sign added to asset manager:",{meshName:this.secondary_instruction_sign.sign_mesh.name,hasBody:!!this.secondary_instruction_sign.sign_body,bodyType:this.secondary_instruction_sign.sign_body.bodyType()})})().catch(i=>{console.error("Error spawning secondary instructions:",i)})}break_primary_chains(){this.is_primary_spawned?this.primary_instruction_sign.chains_broken?console.log("Primary instruction chains are already broken"):this.primary_instruction_sign.break_chains():console.warn("Primary instruction chains cannot be broken as it has not spawned...")}break_secondary_chains(){this.is_secondary_spawned?this.secondary_instruction_sign.chains_broken||this.secondary_instruction_sign.break_chains():console.warn("Secondary instruction chains cannot be broken as it has not spawned...")}is_primary_spawned(){return this.primary_instruction_sign!=null}is_primary_chains_broken(){return this.is_primary_spawned()?this.primary_instruction_sign.chains_broken:(console.warn("Primary instruction chains don't exist yet to be broken; Returning false"),!1)}is_primary_instructions_intact(){return this.is_primary_spawned()?!this.is_primary_chains_broken():!1}is_secondary_spawned(){return this.secondary_instruction_sign!=null}is_secondary_chains_broken(){return this.is_secondary_spawned?this.secondary_instruction_sign.chains_broken:(console.warn("Secondary instruction chains don't exist yet to be broken; Returning false"),!1)}is_secondary_instructions_intact(){return this.is_secondary_spawned?!this.is_secondary_chains_broken():!1}}const Qn="images/gradient.jpg";let Be=!1,$e=!1,$t=window.devicePixelRatio,X,Ut,ge,ls,w,ve,Ue,Oe="",$=null,Fe=!1,ft=!1,Ce=!1,fe;async function qn(){await ds(),fe=H.get_instance(),p.CONSTRUCTION_GREETING&&fetch("pages/under_construction.html").then(o=>o.text()).then(o=>{document.body.insertAdjacentHTML("beforeend",o);const e=document.getElementById("construction-modal"),t=document.getElementById("acknowledge-btn");e.style.display="block",t.addEventListener("click",()=>{e.style.display="none",Ce=!0})}),X=new ai,X.background=gt.load(Qn),window.addEventListener("resize",Jn),window.addEventListener("mousemove",eo),window.addEventListener("mousedown",so),window.addEventListener("mouseup",to),window.addEventListener("contextmenu",io),window.addEventListener("wheel",no),Ut=new fs(0,-9.81,0),ge=new _s(Ut),ls=new Jt,w=new Pn(X,ge),ve=new on(X,w.get_camera()),new Hn(X),Ue=new Xn(X,w.get_camera(),ge),new un(ge,X,w.get_camera()),ve.set_animation_loop(Zn),ve.add_event_listener("mouseout",()=>{w.is_column_left_side()&&w.reset_hover()})}function Zn(){const o=ls.getDelta();hi(),Be&&($e?$e=!1:w.resize_reposition(),Be=!1),w.get_overlay().is_intersected()!=null?fe.activate_object(w.get_intersected_name()):$?$n($,w.get_camera()):Oe!=""?fe.activate_object(Oe):w.is_text_active()?fe.activate_object(w.get_active_name()):fe.deactivate_all_objects(),ge.timestep=Math.min(o,.1),ge.step(),Ue.update($,w),fe.update(),w.get_overlay().update_confetti(),ve.render()}function Jn(){Be=!0;const o=window.devicePixelRatio;$t!=o&&($t=o,$e=!0),w.reset_camera(),ve.resize()}function eo(o){if(Bn(o),w.detect_rotation&&w.get_camera_manager().rotate(o.movementX*.02,o.movementY*.02),Ce){const e=Tt(o,w.get_camera(),X);if(e.length>0&&!w.get_overlay().is_swapping_sides()){const t=e[0].object,i=t.name;switch(i.split("_")[0]+"_"){case b.LABEL:w.get_overlay().handle_hover(t);break;case b.FLOOR:w.get_overlay().reset_hover();break;case b.INTERACTABLE:w.is_overlay_hidden()?Oe=i:Oe=""}}else w.get_overlay().reset_hover(),Oe=""}}function to(o){Ce&&($&&(cs($),$=null),w.handle_mouse_up(Tt(o,w.get_camera(),X)),o.button===0&&(w.detect_rotation=!1,Fe=!1),o.button===2&&(w.detect_rotation=!1,ft=!1))}function so(o){Ce&&(o.button===0&&(Fe=!0),o.button===2&&(ft=!0,$&&(cs($),$=null)),Fe&&ft&&w.is_overlay_hidden()?w.detect_rotation=!0:w.is_overlay_hidden()&&Tt(o,w.get_camera(),X).forEach(t=>{switch(Ee(t.object)){case b.INTERACTABLE:Fe?($=t.object,jn($,w.get_camera())):kn(t.object,w.get_camera());break}}))}function io(o){o.preventDefault()}function no(o){Ce&&$&&(o.deltaY<0?(Ue.break_secondary_chains(),Un($)):(Ue.break_secondary_chains(),zn($)),$e=!0,Be=!0)}qn().catch(console.error);
//# sourceMappingURL=index-BsMT1xiX.js.map
