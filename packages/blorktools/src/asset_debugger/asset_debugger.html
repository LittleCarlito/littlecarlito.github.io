<!DOCTYPE html>
<html lang="en" class="dark-mode">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asset Debugger - Blorktools</title>
    <style>
        :root {
            /* Blorkboard-inspired theme */
            --primary-color: #4CAF50; /* Terminal green */
            --tool-color: #F1C40F; /* Blorkboard tool color (yellow) for borders */
            --button-color: #1E88E5; /* Blorkboard button color (blue) */
            --secondary-color: #1a1a1a; /* Dark background but not pure black */
            --bg-color: #121212; /* Dark background */
            --panel-bg: #1e1e1e; /* Panel background */
            --panel-bg-lighter: #252525; /* Lighter panel background */
            --panel-border: #333; /* Panel border */
            --text-color: #b8b8b8; /* Light gray for regular text */
            --card-border: #333; /* Card border color */
            --input-bg: #252525; /* Input background */
            --input-text: #dadada; /* Input text */
            --label-text: #959595; /* Label text */
            --hover-glow: 0 0 5px rgba(241, 196, 15, 0.7); /* Yellow glow for hover */
            --success-glow: 0 0 5px rgba(76, 175, 80, 0.7); /* Green glow for success */
        }
        
        /* Legacy dark theme variables - we'll override these */
        .dark-mode {
            --primary-color: #4CAF50;
            --tool-color: #F1C40F;
            --button-color: #1E88E5;
            --secondary-color: #1a1a1a;
            --bg-color: #121212;
            --panel-bg: #1e1e1e;
            --panel-bg-lighter: #252525;
            --panel-border: #333;
            --text-color: #b8b8b8;
            --card-border: #333;
            --input-bg: #252525;
            --input-text: #dadada;
            --label-text: #959595;
            --hover-glow: 0 0 5px rgba(241, 196, 15, 0.7);
            --success-glow: 0 0 5px rgba(76, 175, 80, 0.7);
        }
        
        body {
            font-family: monospace;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background-color: var(--secondary-color);
            color: var(--primary-color);
            border-bottom: 1px solid var(--panel-border);
        }
        
        h1 {
            margin: 0;
            font-size: 24px;
            color: var(--primary-color);
        }
        
        h2, h3 {
            color: var(--primary-color);
        }
        
        /* Blorkboard-style small button */
        .theme-toggle {
            background-color: transparent;
            border: 1px solid var(--button-color);
            color: var(--button-color);
            cursor: pointer;
            font-size: 14px;
            padding: 8px 12px;
            font-family: monospace;
            transition: all 0.3s ease;
        }
        
        .theme-toggle:hover {
            background-color: rgba(30, 136, 229, 0.2);
        }
        
        /* Blorkboard-style card panel */
        .tool-panel {
            background-color: var(--panel-bg);
            border: 1px solid var(--tool-color);
            padding: 20px;
            margin-bottom: 20px;
            transition: background-color 0.3s ease;
        }
        
        .dropzone-container {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        /* Dropzone styling as requested */
        .dropzone {
            flex: 1;
            border: 1px dashed #555; /* Boring gray dashed border initially */
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            min-height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: var(--panel-bg-lighter);
        }
        
        .dropzone.active {
            border: 2px dashed var(--tool-color); /* Yellow when hovering */
            box-shadow: var(--hover-glow);
        }
        
        .dropzone.has-file {
            border: 2px solid var(--primary-color); /* Green when file dropped */
            box-shadow: var(--success-glow);
        }
        
        .dropzone h3 {
            margin-top: 0;
            margin-bottom: 10px;
        }
        
        .dropzone p {
            margin: 5px 0;
            font-size: 14px;
        }
        
        .file-info {
            font-size: 12px;
            margin-top: 10px;
            color: var(--label-text);
        }
        
        .preview-container {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .preview {
            flex: 1;
            max-height: 150px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            border: 1px solid var(--panel-border);
            background-color: rgba(0,0,0,0.2);
        }
        
        .preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        /* Blorkboard-style blue button */
        .start-button, .button-base {
            background-color: var(--button-color);
            color: white;
            border: none;
            padding: 10px 20px;
            font-family: monospace;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .start-button {
            display: block;
            width: 100%;
        }
        
        .start-button:hover, .button-base:hover {
            background-color: #0d74c7;
        }
        
        .start-button:disabled {
            background-color: #555;
            color: #888;
            cursor: not-allowed;
        }
        
        .button-base {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            height: 40px;
            margin: 10px 0;
        }
        
        .restart-button {
            padding: 10px 20px;
            font-size: 14px;
        }
        
        .settings-button {
            width: 40px;
            height: 40px;
            background-color: var(--secondary-color);
            padding: 0;
            margin-left: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--button-color);
        }
        
        .settings-button svg path {
            fill: var(--button-color);
        }
        
        .settings-button:hover {
            background-color: rgba(30, 136, 229, 0.2);
        }
        
        /* Modal styling */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .modal-container {
            background-color: var(--panel-bg);
            width: 400px;
            max-width: 90%;
            border: 1px solid var(--panel-border);
            overflow: hidden;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid var(--panel-border);
        }
        
        .modal-title {
            font-weight: bold;
            font-size: 18px;
            margin: 0;
            color: var(--primary-color);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-color);
        }
        
        .modal-body {
            padding: 20px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--panel-border);
            display: flex;
            justify-content: flex-end;
        }
        
        .modal-btn {
            padding: 8px 16px;
            border: none;
            cursor: pointer;
            margin-left: 10px;
            font-family: monospace;
            transition: all 0.3s ease;
        }
        
        .modal-btn-primary {
            background-color: var(--button-color);
            color: white;
        }
        
        .modal-btn-secondary {
            background-color: #555;
            color: white;
        }
        
        .modal-btn:hover {
            opacity: 0.9;
        }
        
        /* Settings styles */
        .settings-group {
            margin-bottom: 20px;
            border: 1px solid var(--panel-border);
            padding: 15px;
            background-color: rgba(0,0,0,0.1);
        }
        
        .settings-title {
            font-weight: bold;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--panel-border);
            color: var(--primary-color);
        }
        
        .settings-option {
            margin-bottom: 10px;
        }
        
        .settings-option label {
            display: block;
            margin-bottom: 5px;
            color: var(--label-text);
        }
        
        .settings-select {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--panel-border);
            background-color: var(--input-bg);
            color: var(--input-text);
            font-family: monospace;
        }
        
        #viewport {
            width: 100%;
            height: 600px;
            background-color: #000;
            display: none;
            border: 1px solid var(--panel-border);
            overflow: hidden;
        }
        
        /* View layout with panel */
        .view-container {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .view-panel {
            flex: 1;
            position: relative;
        }
        
        .mesh-panel {
            flex: 0 0 300px;
            background-color: var(--panel-bg);
            border: 1px solid var(--panel-border);
            padding: 15px;
            max-height: 600px;
            overflow-y: auto;
            display: none;
            transition: background-color 0.3s ease;
        }
        
        .mesh-panel h3 {
            margin-top: 0;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--panel-border);
        }
        
        .mesh-group {
            margin-bottom: 15px;
        }
        
        .mesh-group-header {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
            cursor: pointer;
            padding: 5px;
            background-color: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--panel-border);
        }
        
        .mesh-group-header:hover {
            background-color: rgba(0, 0, 0, 0.3);
        }
        
        .mesh-group-toggle {
            margin-right: 5px;
            color: var(--primary-color);
        }
        
        .mesh-group-name {
            font-weight: bold;
            flex-grow: 1;
        }
        
        .mesh-group-count {
            color: var(--label-text);
            font-size: 12px;
        }
        
        .mesh-items {
            margin-left: 20px;
            border-left: 1px solid var(--panel-border);
            padding-left: 5px;
        }
        
        .mesh-item {
            display: flex;
            align-items: center;
            margin-bottom: 3px;
            padding: 3px;
        }
        
        .mesh-item:hover {
            background-color: rgba(0, 0, 0, 0.2);
        }
        
        .mesh-toggle {
            margin-right: 5px;
            color: var(--primary-color);
        }
        
        .mesh-name {
            font-size: 13px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* Tabs styling */
        .tab-container {
            flex: 0 0 300px;
            background-color: var(--panel-bg);
            border: 1px solid var(--panel-border);
            max-height: 600px;
            height: 600px;
            display: none;
            transition: background-color 0.3s ease;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .tab-navigation {
            display: flex;
            border-bottom: 1px solid var(--panel-border);
            flex-shrink: 0;
        }
        
        .tab-button {
            flex: 1;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            padding: 10px;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-color);
            transition: all 0.3s ease;
            font-family: monospace;
        }
        
        .tab-button:hover {
            background-color: rgba(0, 0, 0, 0.2);
        }
        
        .tab-button.active {
            border-bottom-color: var(--button-color);
            font-weight: bold;
            background-color: rgba(30, 136, 229, 0.1);
            color: var(--button-color);
        }
        
        .tab-content {
            display: none;
            padding: 15px;
            overflow-y: auto;
            flex-grow: 1;
            max-height: calc(600px - 45px);
        }
        
        .tab-content.active {
            display: block;
        }
        
        .tab-content h3 {
            margin-top: 0;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--panel-border);
        }
        
        /* Atlas Visualization */
        .texture-type-selector {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            gap: 5px;
        }
        
        .texture-type-button {
            flex: 1;
            padding: 5px;
            background: var(--secondary-color);
            border: 1px solid var(--panel-border);
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            color: var(--text-color);
            font-family: monospace;
        }
        
        .texture-type-button:hover {
            background-color: rgba(0, 0, 0, 0.2);
        }
        
        .texture-type-button.active {
            background-color: var(--button-color);
            color: white;
            border-color: var(--button-color);
        }
        
        .atlas-canvas {
            width: 100%;
            height: auto;
            border: 1px solid var(--panel-border);
            margin-bottom: 10px;
            background-color: #000;
        }
        
        .coords-text {
            font-size: 12px;
            margin-bottom: 10px;
            font-family: monospace;
            padding: 5px;
            background-color: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--panel-border);
            color: var(--text-color);
        }
        
        .segment-info {
            font-size: 12px;
            padding: 5px;
            background-color: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--panel-border);
            margin-bottom: 10px;
            color: var(--text-color);
        }
        
        /* UV Controls */
        .uv-info-container {
            margin-bottom: 15px;
            font-size: 13px;
            color: var(--text-color);
        }
        
        .uv-control-group {
            margin-bottom: 15px;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--panel-border);
        }
        
        .uv-control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--label-text);
        }
        
        .uv-control-row {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .uv-control-row span {
            width: 20px;
            text-align: center;
            color: var(--text-color);
            font-weight: bold;
        }
        
        .uv-control-row input {
            flex: 1;
            padding: 5px;
            border: 1px solid var(--panel-border);
            background-color: var(--input-bg);
            color: var(--input-text);
            font-family: monospace;
        }
        
        .uv-note {
            font-size: 11px;
            color: var(--label-text);
            margin-top: 5px;
            font-style: italic;
        }
        
        /* Rig Visualization */
        .rig-button {
            display: block;
            width: 100%;
            padding: 8px;
            background-color: var(--button-color);
            color: white;
            border: none;
            font-size: 14px;
            cursor: pointer;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            font-family: monospace;
        }
        
        .rig-button:hover {
            background-color: #0d74c7;
        }
        
        .bone-hierarchy {
            margin-top: 10px;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--panel-border);
            padding: 5px;
            background-color: rgba(0,0,0,0.2);
        }
        
        .bone-item {
            padding: 2px 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .bone-children {
            margin-left: 15px;
            border-left: 1px dotted var(--panel-border);
            padding-left: 5px;
        }
        
        .bone-toggle {
            display: inline-block;
            width: 15px;
            text-align: center;
            color: var(--primary-color);
        }
        
        /* Hide entire upload section when debugging starts */
        .hidden-on-debug {
            display: none;
        }
        
        /* Settings styles */
        .settings-slider {
            width: 80%;
            margin-right: 10px;
            background-color: var(--secondary-color);
            border: 1px solid var(--panel-border);
            height: 5px;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            margin-top: 5px;
        }
        
        #axis-intensity-value {
            min-width: 30px;
            text-align: center;
            color: var(--text-color);
        }
        
        /* Settings Tab Styles */
        .settings-tabs {
            display: flex;
            border-bottom: 1px solid var(--panel-border);
            margin-bottom: 15px;
        }
        
        .settings-tab-button {
            background: transparent;
            border: none;
            color: var(--text-color);
            padding: 10px 15px;
            cursor: pointer;
            font-size: 14px;
            border-bottom: 2px solid transparent;
            outline: none;
            transition: all 0.2s ease;
            font-family: monospace;
        }
        
        .settings-tab-button.active {
            color: var(--button-color);
            border-bottom: 2px solid var(--button-color);
            background-color: rgba(30, 136, 229, 0.1);
        }
        
        .settings-tab-content {
            display: none;
        }
        
        .settings-tab-content.active {
            display: block;
        }
        
        .settings-row {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 15px;
            justify-content: space-between;
        }
        
        .settings-option {
            flex: 0 0 48%;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .settings-option label {
            margin-right: 10px;
            color: var(--label-text);
        }
        
        .settings-checkbox {
            margin-left: 10px;
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--button-color);
        }
        
        .settings-color-picker {
            margin-left: 10px;
            width: 40px;
            height: 25px;
            padding: 0;
            border: 1px solid var(--panel-border);
            cursor: pointer;
            background-color: transparent;
        }
        
        .reset-button {
            background-color: var(--button-color);
            color: white;
            border: none;
            padding: 6px 12px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
            font-family: monospace;
        }
        
        .reset-button:hover {
            background-color: #0d74c7;
        }
        
        .settings-option.full-width {
            flex: 0 0 100%;
            justify-content: space-between;
        }
        
        .text-center {
            text-align: center;
            justify-content: center;
        }
        
        .text-center button {
            width: 50%;
        }
        
        .settings-subheading {
            font-size: 14px;
            margin: 0 0 10px 0;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--panel-border);
            width: 100%;
            color: var(--primary-color);
        }
        
        .collapsible-header {
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .collapsible-header .settings-subheading {
            margin-bottom: 0;
            flex: 1;
        }
        
        .collapse-indicator {
            font-size: 12px;
            transition: none;
            color: var(--primary-color);
        }
        
        .collapsible-header.expanded .collapse-indicator {
            transform: none;
        }
        
        /* Example Modal Styles */
        #load-example-modal .modal-container {
            background-color: var(--panel-bg);
            border: 1px solid var(--panel-border);
            color: var(--text-color);
            font-family: monospace;
        }
        
        #load-example-modal .modal-header {
            border-bottom: 1px solid var(--panel-border);
        }
        
        #load-example-modal .modal-title {
            color: var(--primary-color);
        }
        
        #load-example-modal .modal-close {
            color: var(--text-color);
        }
        
        #rig-example-button {
            background-color: var(--button-color);
            color: white;
            border: none;
            padding: 10px 20px;
            font-family: monospace;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 80%;
            margin: 0 auto;
            display: block;
        }
        
        #rig-example-button:hover {
            background-color: #0d74c7;
        }
        
        #rig-example-button:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body>
    <header>
        <h1>Asset Debugger</h1>
        <div style="display: flex; gap: 10px;">
            <button id="return-to-toolbox" class="theme-toggle">Exit to Toolbox</button>
            <button id="theme-toggle" class="theme-toggle">System Status</button>
        </div>
    </header>
    
    <div class="container">
        <div id="upload-section" class="tool-panel">
            <h2>Upload Files (Optional)</h2>
            <div class="dropzone-container">
                <div class="dropzone" id="basecolor-dropzone">
                    <h3>Base Color Atlas</h3>
                    <p>Drag & drop your base color texture atlas here</p>
                    <p class="file-info" id="basecolor-info"></p>
                </div>
                
                <div class="dropzone" id="orm-dropzone">
                    <h3>ORM Atlas</h3>
                    <p>Drag & drop your ORM (Occlusion, Roughness, Metalness) texture atlas here</p>
                    <p class="file-info" id="orm-info"></p>
                </div>
                
                <div class="dropzone" id="normal-dropzone">
                    <h3>Normal Atlas</h3>
                    <p>Drag & drop your normal map texture atlas here</p>
                    <p class="file-info" id="normal-info"></p>
                </div>
                
                <div class="dropzone" id="model-dropzone">
                    <h3>3D Model</h3>
                    <p>Drag & drop a GLB model file here</p>
                    <p>If not provided, a cube will be used</p>
                    <p class="file-info" id="model-info"></p>
                </div>
            </div>
            
            <div class="preview-container">
                <div class="preview" id="basecolor-preview"></div>
                <div class="preview" id="orm-preview"></div>
                <div class="preview" id="normal-preview"></div>
            </div>
            
            <button id="start-debug" class="start-button">Start Debugging</button>
        </div>
        
        <div id="debug-button-container" style="display: none;">
            <button id="restart-debug" class="button-base restart-button">Restart</button>
            <button id="settings-button" class="button-base settings-button" aria-label="Settings">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M17.4039 10.9839C17.4373 10.6618 17.4373 10.3382 17.4039 10.0161L19.0039 8.7661C19.1706 8.63275 19.2239 8.41608 19.1373 8.23275L17.3039 5.10775C17.2173 4.92441 17.0039 4.84108 16.8206 4.92441L14.9373 5.69108C14.5039 5.35775 14.0373 5.09108 13.5373 4.89108L13.2706 2.89108C13.2373 2.69108 13.0706 2.55774 12.8706 2.55774H9.20394C9.00394 2.55774 8.83727 2.69108 8.80394 2.89108L8.53727 4.89108C8.03727 5.09108 7.57061 5.35775 7.13727 5.69108L5.25394 4.92441C5.07061 4.84108 4.85727 4.92441 4.77061 5.10775L2.93727 8.23275C2.85061 8.41608 2.90394 8.63275 3.07061 8.7661L4.67061 10.0161C4.63727 10.3382 4.63727 10.6618 4.67061 10.9839L3.07061 12.2339C2.90394 12.3672 2.85061 12.5839 2.93727 12.7672L4.77061 15.8922C4.85727 16.0755 5.07061 16.1589 5.25394 16.0755L7.13727 15.3089C7.57061 15.6422 8.03727 15.9089 8.53727 16.1089L8.80394 18.1089C8.83727 18.3089 9.00394 18.4422 9.20394 18.4422H12.8706C13.0706 18.4422 13.2373 18.3089 13.2706 18.1089L13.5373 16.1089C14.0373 15.9089 14.5039 15.6422 14.9373 15.3089L16.8206 16.0755C17.0039 16.1589 17.2173 16.0755 17.3039 15.8922L19.1373 12.7672C19.2239 12.5839 19.1706 12.3672 19.0039 12.2339L17.4039 10.9839ZM11.0373 13.8089C9.17061 13.8089 7.65394 12.2922 7.65394 10.4255C7.65394 8.55889 9.17061 7.04222 11.0373 7.04222C12.9039 7.04222 14.4206 8.55889 14.4206 10.4255C14.4206 12.2922 12.9039 13.8089 11.0373 13.8089Z" fill="white"/>
                </svg>
            </button>
        </div>
        
        <div class="view-container">
            <div class="view-panel">
                <div id="viewport"></div>
                <div id="loading-indicator" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.7); color: white; padding: 15px; border-radius: 5px; z-index: 100; justify-content: center; align-items: center;">
                    <div>Loading model...</div>
                </div>
            </div>
            <div id="tab-container" class="tab-container" style="display: none;">
                <div class="tab-navigation">
                    <button id="mesh-tab-button" class="tab-button active">Mesh</button>
                    <button id="atlas-tab-button" class="tab-button">Atlas</button>
                    <button id="uv-tab-button" class="tab-button">UV</button>
                    <button id="rig-tab-button" class="tab-button">Rig</button>
                </div>
                <div id="mesh-tab" class="tab-content active">
                    <h3>Mesh Visibility</h3>
                    <div id="mesh-groups"></div>
                </div>
                <div id="atlas-tab" class="tab-content">
                    <h3>Atlas Visualization</h3>
                    <div id="texture-type-selector" class="texture-type-selector">
                        <button data-texture-type="baseColor" class="texture-type-button active">ðŸŽ¨ Base Color</button>
                        <button data-texture-type="orm" class="texture-type-button">âœ¨ ORM</button>
                        <button data-texture-type="normal" class="texture-type-button">ðŸ§© Normal</button>
                    </div>
                    <canvas id="atlas-canvas" class="atlas-canvas" width="260" height="260"></canvas>
                    <div id="coords-text" class="coords-text">UV coordinates: Full texture is shown</div>
                    <div id="segment-info" class="segment-info" style="display: none;"></div>
                </div>
                <div id="uv-tab" class="tab-content">
                    <h3>UV Channel Controls</h3>
                    <div id="uv-content">
                        <div id="uv-info-container" class="uv-info-container">
                            <p>No model loaded or no UV data available.</p>
                            <p>Load a model to view UV information.</p>
                        </div>
                        <div id="uv-manual-controls" style="display: none;">
                            <h4>Manual UV Mapping Controls</h4>
                            <div class="uv-control-group">
                                <label>UV Offset (0-1):</label>
                                <div class="uv-control-row">
                                    <span>X:</span>
                                    <input type="number" id="uv-offset-x" min="0" max="1" step="0.01" value="0">
                                </div>
                                <div class="uv-control-row">
                                    <span>Y:</span>
                                    <input type="number" id="uv-offset-y" min="0" max="1" step="0.01" value="0">
                                </div>
                            </div>
                            <div class="uv-control-group">
                                <label>UV Scale (0-1):</label>
                                <div class="uv-control-row">
                                    <span>W:</span>
                                    <input type="number" id="uv-scale-w" min="0.01" max="1" step="0.01" value="1">
                                </div>
                                <div class="uv-control-row">
                                    <span>H:</span>
                                    <input type="number" id="uv-scale-h" min="0.01" max="1" step="0.01" value="1">
                                </div>
                            </div>
                            <div class="uv-control-group">
                                <label>Predefined Segments:</label>
                                <select id="uv-predefined-segments">
                                    <option value="0">Full texture (1Ã—1)</option>
                                    <option value="1">Top-left quarter (1/2Ã—1/2)</option>
                                    <option value="2">Top-right quarter (1/2Ã—1/2)</option>
                                    <option value="3">Bottom-left quarter (1/2Ã—1/2)</option>
                                    <option value="4">Bottom-right quarter (1/2Ã—1/2)</option>
                                    <option value="5">Top-left ninth (1/3Ã—1/3)</option>
                                    <option value="6">Top-center ninth (1/3Ã—1/3)</option>
                                    <option value="7">Top-right ninth (1/3Ã—1/3)</option>
                                    <option value="8">Middle-left ninth (1/3Ã—1/3)</option>
                                </select>
                            </div>
                            <div class="uv-note">Changes auto-apply immediately</div>
                        </div>
                    </div>
                </div>
                <div id="rig-tab" class="tab-content">
                    <div id="rig-content" class="rig-info-container">
                        <p>No rig data found.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Settings Modal -->
    <div id="settings-modal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3 class="modal-title">Settings</h3>
                <button class="modal-close" id="close-settings-modal">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Settings Tab Navigation -->
                <div class="settings-tabs">
                    <button class="settings-tab-button active" data-tab="axis-settings">Axis Indicator</button>
                    <button class="settings-tab-button" data-tab="rig-settings">Rig Options</button>
                </div>
                
                <!-- Axis Indicator Settings Tab -->
                <div id="axis-settings" class="settings-tab-content active">
                    <div class="settings-group">
                        <div class="settings-option">
                            <label for="axis-indicator-type">Display Mode</label>
                            <select id="axis-indicator-type" class="settings-select">
                                <option value="disabled" selected>Disabled</option>
                                <option value="windowed">Windowed</option>
                                <option value="embedded">Embedded</option>
                            </select>
                        </div>
                        <div id="embedded-axis-settings" class="settings-option" style="display: none;">
                            <label for="axis-intensity">Background Intensity</label>
                            <div class="slider-container">
                                <input type="range" id="axis-intensity" min="0.1" max="1.0" step="0.1" value="0.7" class="settings-slider">
                                <span id="axis-intensity-value">0.7</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Rig Options Settings Tab -->
                <div id="rig-settings" class="settings-tab-content">
                    <div class="settings-group">
                        <!-- First row - Toggle controls -->
                        <div class="settings-row">
                            <div class="settings-option">
                                <label for="display-rig">Display Rig</label>
                                <input type="checkbox" id="display-rig" class="settings-checkbox">
                            </div>
                            <div class="settings-option">
                                <label for="force-z">Force Z-index</label>
                                <input type="checkbox" id="force-z" class="settings-checkbox">
                            </div>
                        </div>
                        
                        <!-- Second row - Toggle controls -->
                        <div class="settings-row">
                            <div class="settings-option">
                                <label for="fill-wireframe">Fill Wireframe</label>
                                <input type="checkbox" id="fill-wireframe" class="settings-checkbox">
                            </div>
                            <div class="settings-option">
                                <label for="show-joint-labels">Show Joint Labels</label>
                                <input type="checkbox" id="show-joint-labels" class="settings-checkbox">
                            </div>
                        </div>
                        
                        <!-- Rig Colors Section -->
                        <div class="settings-row" style="margin-top: 15px;">
                            <div class="settings-option full-width collapsible-header">
                                <h4 class="settings-subheading">Rig Colors</h4>
                                <span class="collapse-indicator">â–¶</span>
                            </div>
                        </div>
                        
                        <div class="collapsible-content" style="display: none;">
                            <div class="settings-row">
                                <div class="settings-option full-width">
                                    <label for="primary-color">Primary Color</label>
                                    <input type="color" id="primary-color" class="settings-color-picker">
                                </div>
                            </div>
                            
                            <div class="settings-row" id="secondary-color-option" style="display: none;">
                                <div class="settings-option full-width">
                                    <label for="secondary-color">Secondary Color</label>
                                    <input type="color" id="secondary-color" class="settings-color-picker">
                                </div>
                            </div>
                            
                            <div class="settings-row">
                                <div class="settings-option full-width">
                                    <label for="joint-color">Joint Color</label>
                                    <input type="color" id="joint-color" class="settings-color-picker">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Control Handle Colors Section -->
                        <div class="settings-row" style="margin-top: 15px;">
                            <div class="settings-option full-width collapsible-header">
                                <h4 class="settings-subheading">Control Handle Colors</h4>
                                <span class="collapse-indicator">â–¶</span>
                            </div>
                        </div>
                        
                        <div class="collapsible-content" style="display: none;">
                            <div class="settings-row">
                                <div class="settings-option full-width">
                                    <label for="normal-color">Normal State</label>
                                    <input type="color" id="normal-color" class="settings-color-picker" value="#FF0000">
                                </div>
                            </div>
                            
                            <div class="settings-row">
                                <div class="settings-option full-width">
                                    <label for="hover-color">Hover State</label>
                                    <input type="color" id="hover-color" class="settings-color-picker" value="#00FF00">
                                </div>
                            </div>
                            
                            <div class="settings-row">
                                <div class="settings-option full-width">
                                    <label for="active-color">Active State</label>
                                    <input type="color" id="active-color" class="settings-color-picker" value="#0000FF">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Reset Rig button on its own line at the bottom -->
                        <div class="settings-row" style="margin-top: 20px;">
                            <div class="settings-option full-width text-center">
                                <button id="reset-rig" class="reset-button">Reset Rig</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" id="cancel-settings">Cancel</button>
                <button class="modal-btn modal-btn-primary" id="save-settings">Save Changes</button>
            </div>
        </div>
    </div>
    
    <!-- Load Example Modal -->
    <div id="load-example-modal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3 class="modal-title">LOAD EXAMPLE</h3>
                <button class="modal-close" id="close-example-modal">&times;</button>
            </div>
            <div class="modal-body" style="padding: 25px 20px;">
                <div style="text-align: center; margin-bottom: 20px;">
                    <p style="margin-bottom: 20px; font-size: 16px;">SELECT AN EXAMPLE TO LOAD:</p>
                    <button id="rig-example-button">RIG EXAMPLE</button>
                </div>
                <div style="font-size: 12px; margin-top: 30px; color: #999; text-align: center;">
                    <p>EXAMPLES WILL LOAD WITHOUT REQUIRING ANY FILE UPLOADS</p>
                </div>
            </div>
        </div>
    </div>
    
    <script type="module" src="asset_debugger.js"></script>
    <script>
        // Theme toggle functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Always use terminal theme (dark mode)
            document.documentElement.classList.add('dark-mode');
            document.documentElement.classList.remove('light-mode');
            
            const themeToggle = document.getElementById('theme-toggle');
            themeToggle.textContent = 'System Status';
            
            themeToggle.addEventListener('click', function() {
                alert('System Status: Online\nAsset Debugger: Ready\nRig Visualizer: Ready');
            });
            
            // Set up restart button functionality
            const startDebugBtn = document.getElementById('start-debug');
            const uploadSection = document.getElementById('upload-section');
            const restartContainer = document.getElementById('debug-button-container');
            const restartDebugBtn = document.getElementById('restart-debug');
            
            // Note: The start debug button functionality is now handled by the asset_debugger.js script
            // This is just making sure the UI elements are updated correctly
            startDebugBtn.addEventListener('click', function() {
                // Hide upload section and show restart button
                uploadSection.style.display = 'none';
                restartContainer.style.display = 'flex';
                // The actual debugging initialization happens in the JavaScript module
            });
            
            // Settings modal functionality
            const settingsBtn = document.getElementById('settings-button');
            const settingsModal = document.getElementById('settings-modal');
            const closeSettingsBtn = document.getElementById('close-settings-modal');
            const cancelSettingsBtn = document.getElementById('cancel-settings');
            const saveSettingsBtn = document.getElementById('save-settings');
            
            // Open settings modal
            settingsBtn.addEventListener('click', function() {
                settingsModal.style.display = 'flex';
            });
            
            // Close modal functions
            function closeSettingsModal() {
                settingsModal.style.display = 'none';
            }
            
            closeSettingsBtn.addEventListener('click', closeSettingsModal);
            cancelSettingsBtn.addEventListener('click', closeSettingsModal);
            
            // Load example modal functionality
            const loadExampleModal = document.getElementById('load-example-modal');
            const closeExampleBtn = document.getElementById('close-example-modal');
            
            // Close modal function
            function closeExampleModal() {
                loadExampleModal.style.display = 'none';
            }
            
            // Add event listener for close button
            if (closeExampleBtn) {
                closeExampleBtn.addEventListener('click', closeExampleModal);
            }
            
            // When clicking outside the modal, close it
            loadExampleModal.addEventListener('click', function(event) {
                if (event.target === loadExampleModal) {
                    closeExampleModal();
                }
            });
            
            // Save settings
            saveSettingsBtn.addEventListener('click', function() {
                // Get values from axis indicator settings
                const axisIndicatorType = document.getElementById('axis-indicator-type').value;
                const axisIntensity = parseFloat(document.getElementById('axis-intensity').value);
                
                // Get values from rig options settings
                const displayRig = document.getElementById('display-rig').checked;
                const forceZ = document.getElementById('force-z').checked;
                const fillWireframe = document.getElementById('fill-wireframe').checked;
                const primaryColor = document.getElementById('primary-color').value;
                const secondaryColor = document.getElementById('secondary-color').value;
                const jointColor = document.getElementById('joint-color').value;
                const showJointLabels = document.getElementById('show-joint-labels').checked;
                
                // Get control handle colors
                const normalColor = document.getElementById('normal-color').value;
                const hoverColor = document.getElementById('hover-color').value;
                const activeColor = document.getElementById('active-color').value;
                
                // Store settings
                const settings = {
                    axisIndicator: {
                        type: axisIndicatorType,
                        intensity: axisIntensity
                    },
                    rigOptions: {
                        displayRig: displayRig,
                        forceZ: forceZ,
                        wireframe: !fillWireframe, // Invert logic - wireframe is opposite of fill
                        primaryColor: parseInt(primaryColor.replace('#', '0x'), 16),
                        secondaryColor: parseInt(secondaryColor.replace('#', '0x'), 16),
                        jointColor: parseInt(jointColor.replace('#', '0x'), 16),
                        showJointLabels: showJointLabels,
                        normalColor: parseInt(normalColor.replace('#', '0x'), 16),
                        hoverColor: parseInt(hoverColor.replace('#', '0x'), 16),
                        activeColor: parseInt(activeColor.replace('#', '0x'), 16)
                    }
                };
                
                // Store settings in localStorage
                localStorage.setItem('assetDebuggerSettings', JSON.stringify(settings));
                
                // Apply settings immediately
                applyAxisIndicatorSetting(axisIndicatorType, axisIntensity);
                applyRigOptionsSetting(settings.rigOptions);
                
                // Close the modal
                closeSettingsModal();
                
                // Notify that settings were saved
                console.log('Settings saved:', settings);
            });
            
            // Function to apply axis indicator settings
            function applyAxisIndicatorSetting(type, intensity = 0.7) {
                // Trigger event to notify application of setting change
                const event = new CustomEvent('axisIndicatorModeChange', {
                    detail: { 
                        mode: type,
                        intensity: intensity
                    }
                });
                document.dispatchEvent(event);
            }
            
            // Function to apply rig options settings
            function applyRigOptionsSetting(options) {
                // Trigger event to notify application of setting change
                const event = new CustomEvent('rigOptionsChange', {
                    detail: options
                });
                document.dispatchEvent(event);
            }
            
            // Load saved settings on startup
            function loadSavedSettings() {
                const savedSettings = localStorage.getItem('assetDebuggerSettings');
                
                if (savedSettings) {
                    try {
                        const settings = JSON.parse(savedSettings);
                        
                        // Apply axis indicator settings if available
                        if (settings.axisIndicator && settings.axisIndicator.type) {
                            // Update the dropdown to match saved setting
                            const axisIndicatorSelect = document.getElementById('axis-indicator-type');
                            if (axisIndicatorSelect) {
                                axisIndicatorSelect.value = settings.axisIndicator.type;
                            }
                            
                            // Update intensity slider if available
                            if (settings.axisIndicator.intensity !== undefined) {
                                const intensitySlider = document.getElementById('axis-intensity');
                                const intensityValue = document.getElementById('axis-intensity-value');
                                if (intensitySlider && intensityValue) {
                                    intensitySlider.value = settings.axisIndicator.intensity;
                                    intensityValue.textContent = settings.axisIndicator.intensity;
                                }
                            }
                            
                            // Apply the setting
                            applyAxisIndicatorSetting(
                                settings.axisIndicator.type, 
                                settings.axisIndicator.intensity || 0.7
                            );
                            
                            // Show/hide embedded settings based on selection
                            toggleEmbeddedSettings(settings.axisIndicator.type);
                        }
                        
                        // Apply rig options settings if available
                        if (settings.rigOptions) {
                            // Update the form values
                            const displayRig = document.getElementById('display-rig');
                            const forceZ = document.getElementById('force-z');
                            const fillWireframe = document.getElementById('fill-wireframe');
                            const primaryColor = document.getElementById('primary-color');
                            const secondaryColor = document.getElementById('secondary-color');
                            const jointColor = document.getElementById('joint-color');
                            const showJointLabels = document.getElementById('show-joint-labels');
                            const normalColor = document.getElementById('normal-color'); 
                            const hoverColor = document.getElementById('hover-color');
                            const activeColor = document.getElementById('active-color');
                            
                            if (displayRig && settings.rigOptions.displayRig !== undefined) {
                                displayRig.checked = settings.rigOptions.displayRig;
                            }
                            
                            if (forceZ && settings.rigOptions.forceZ !== undefined) {
                                forceZ.checked = settings.rigOptions.forceZ;
                            }
                            
                            if (fillWireframe && settings.rigOptions.wireframe !== undefined) {
                                fillWireframe.checked = !settings.rigOptions.wireframe; // Invert logic
                                toggleSecondaryColorVisibility(!settings.rigOptions.wireframe);
                            }
                            
                            if (primaryColor && settings.rigOptions.primaryColor !== undefined) {
                                primaryColor.value = '#' + settings.rigOptions.primaryColor.toString(16).padStart(6, '0');
                            }
                            
                            if (secondaryColor && settings.rigOptions.secondaryColor !== undefined) {
                                secondaryColor.value = '#' + settings.rigOptions.secondaryColor.toString(16).padStart(6, '0');
                            }
                            
                            if (jointColor && settings.rigOptions.jointColor !== undefined) {
                                jointColor.value = '#' + settings.rigOptions.jointColor.toString(16).padStart(6, '0');
                            }
                            
                            if (showJointLabels && settings.rigOptions.showJointLabels !== undefined) {
                                showJointLabels.checked = settings.rigOptions.showJointLabels;
                            }
                            
                            // Set control handle colors if available
                            if (normalColor && settings.rigOptions.normalColor !== undefined) {
                                normalColor.value = '#' + settings.rigOptions.normalColor.toString(16).padStart(6, '0');
                            }
                            
                            if (hoverColor && settings.rigOptions.hoverColor !== undefined) {
                                hoverColor.value = '#' + settings.rigOptions.hoverColor.toString(16).padStart(6, '0');
                            }
                            
                            if (activeColor && settings.rigOptions.activeColor !== undefined) {
                                activeColor.value = '#' + settings.rigOptions.activeColor.toString(16).padStart(6, '0');
                            }
                            
                            // Apply the settings
                            applyRigOptionsSetting(settings.rigOptions);
                        } else {
                            // Set default values for rig options
                            initializeRigOptions();
                        }
                    } catch (e) {
                        console.error('Error loading saved settings:', e);
                        initializeRigOptions();
                    }
                } else {
                    // No saved settings - apply defaults
                    applyAxisIndicatorSetting('disabled');
                    initializeRigOptions();
                }
            }
            
            // Initialize default rig options
            function initializeRigOptions() {
                const displayRig = document.getElementById('display-rig');
                const forceZ = document.getElementById('force-z');
                const fillWireframe = document.getElementById('fill-wireframe');
                const primaryColor = document.getElementById('primary-color');
                const secondaryColor = document.getElementById('secondary-color');
                const jointColor = document.getElementById('joint-color');
                const showJointLabels = document.getElementById('show-joint-labels');
                const normalColor = document.getElementById('normal-color');
                const hoverColor = document.getElementById('hover-color');
                const activeColor = document.getElementById('active-color');
                
                // Set default values
                if (displayRig) displayRig.checked = false;
                if (forceZ) forceZ.checked = false;
                if (fillWireframe) fillWireframe.checked = false;
                if (primaryColor) primaryColor.value = '#FF00FF'; // Magenta
                if (secondaryColor) secondaryColor.value = '#FFFF00'; // Yellow
                if (jointColor) jointColor.value = '#00FFFF'; // Cyan
                if (showJointLabels) showJointLabels.checked = false;
                if (normalColor) normalColor.value = '#FF0000'; // Red
                if (hoverColor) hoverColor.value = '#00FF00'; // Green
                if (activeColor) activeColor.value = '#0000FF'; // Blue
                
                // Hide secondary color option initially
                toggleSecondaryColorVisibility(false);
            }
            
            // Toggle secondary color visibility based on fill wireframe option
            function toggleSecondaryColorVisibility(show) {
                const secondaryColorOption = document.getElementById('secondary-color-option');
                if (secondaryColorOption) {
                    // Make sure we're showing it with the right display mode
                    // even if it's in a collapsed section
                    secondaryColorOption.style.display = show ? 'flex' : 'none';
                }
            }
            
            // Toggle embedded settings visibility
            function toggleEmbeddedSettings(type) {
                const embeddedSettings = document.getElementById('embedded-axis-settings');
                if (embeddedSettings) {
                    embeddedSettings.style.display = type === 'embedded' ? 'block' : 'none';
                }
            }
            
            // Add event listeners for settings form controls
            
            // Add intensity slider change event
            const intensitySlider = document.getElementById('axis-intensity');
            const intensityValue = document.getElementById('axis-intensity-value');
            if (intensitySlider && intensityValue) {
                intensitySlider.addEventListener('input', function() {
                    intensityValue.textContent = this.value;
                });
            }
            
            // Add axis indicator type change event
            const axisTypeSelect = document.getElementById('axis-indicator-type');
            if (axisTypeSelect) {
                axisTypeSelect.addEventListener('change', function() {
                    toggleEmbeddedSettings(this.value);
                });
            }
            
            // Add fill wireframe change event
            const fillWireframe = document.getElementById('fill-wireframe');
            if (fillWireframe) {
                fillWireframe.addEventListener('change', function() {
                    toggleSecondaryColorVisibility(this.checked);
                });
            }
            
            // Setup tabs in settings modal
            const settingsTabs = document.querySelectorAll('.settings-tab-button');
            settingsTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs
                    settingsTabs.forEach(t => t.classList.remove('active'));
                    
                    // Add active class to clicked tab
                    this.classList.add('active');
                    
                    // Hide all tab content
                    document.querySelectorAll('.settings-tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Show the selected tab content
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            // Call on page load
            loadSavedSettings();
            
            // Setup collapsible sections
            const collapsibleHeaders = document.querySelectorAll('.collapsible-header');
            collapsibleHeaders.forEach(header => {
                header.addEventListener('click', function() {
                    // Toggle expanded class (but only for styling)
                    this.classList.toggle('expanded');
                    
                    // Update the collapse indicator with proper symbol
                    const indicator = this.querySelector('.collapse-indicator');
                    if (this.classList.contains('expanded')) {
                        indicator.textContent = 'â–¼'; // Down arrow when expanded
                    } else {
                        indicator.textContent = 'â–¶'; // Right arrow when collapsed
                    }
                    
                    // Toggle the visibility of the next sibling (collapsible content)
                    const content = this.closest('.settings-row').nextElementSibling;
                    if (content && content.classList.contains('collapsible-content')) {
                        content.style.display = this.classList.contains('expanded') ? 'block' : 'none';
                    }
                });
            });
            
            // Return to Toolbox functionality
            const returnToToolboxBtn = document.getElementById('return-to-toolbox');
            returnToToolboxBtn.addEventListener('click', function() {
                window.location.href = '../../';
            });
            
            // Add reset rig button event
            const resetRigBtn = document.getElementById('reset-rig');
            if (resetRigBtn) {
                resetRigBtn.addEventListener('click', function() {
                    const event = new CustomEvent('resetRig');
                    document.dispatchEvent(event);
                });
            }
        });
    </script>
</body>
</html> 