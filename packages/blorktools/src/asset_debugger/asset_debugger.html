<!DOCTYPE html>
<html lang="en" class="dark-mode">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asset Debugger - Blorktools</title>
    <style>
        :root {
            /* Light theme variables */
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --bg-color: #f5f5f5;
            --panel-bg: #ffffff;
            --text-color: #333333;
            --border-color: #dddddd;
            --input-bg: #ffffff;
            --input-text: #333333;
            --label-text: #555555;
        }
        
        /* Dark theme variables */
        .dark-mode {
            --primary-color: #2980b9;
            --secondary-color: #1a252f;
            --accent-color: #c0392b;
            --bg-color: #121212;
            --panel-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --border-color: #444444;
            --input-bg: #2a2a2a;
            --input-text: #e0e0e0;
            --label-text: #cccccc;
        }
        
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background-color: var(--secondary-color);
            color: white;
        }
        
        h1 {
            margin: 0;
            font-size: 24px;
        }
        
        .theme-toggle {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 16px;
            padding: 5px 10px;
            border-radius: 4px;
            background-color: rgba(255, 255, 255, 0.2);
            transition: background-color 0.3s ease;
        }
        
        .theme-toggle:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        .tool-panel {
            background-color: var(--panel-bg);
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
            transition: background-color 0.3s ease;
        }
        
        .dropzone-container {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .dropzone {
            flex: 1;
            border: 2px dashed var(--border-color);
            border-radius: 4px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            min-height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .dropzone.active {
            border-color: var(--primary-color);
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        .dropzone.has-file {
            border-color: var(--accent-color);
            background-color: rgba(231, 76, 60, 0.1);
        }
        
        .dropzone h3 {
            margin-top: 0;
            margin-bottom: 10px;
        }
        
        .dropzone p {
            margin: 5px 0;
            font-size: 14px;
        }
        
        .file-info {
            font-size: 12px;
            margin-top: 10px;
        }
        
        .preview-container {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .preview {
            flex: 1;
            max-height: 150px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        
        .preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .start-button {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .start-button:hover {
            background-color: #2980b9;
        }
        
        .start-button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }

        .button-base {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            height: 40px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin: 10px 0;
        }
        
        .restart-button {
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            font-size: 16px;
        }
        
        .settings-button {
            width: 40px;
            height: 40px;
            background-color: #777;
            color: white;
            padding: 0;
            margin-left: 10px;
        }
        
        .restart-button:hover {
            background-color: #2980b9;
        }
        
        .settings-button:hover {
            background-color: #555;
        }
        
        #debug-button-container {
            display: flex;
            align-items: center;
            flex-direction: row;
        }
        
        /* Modal styling */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .modal-container {
            background-color: var(--panel-bg);
            width: 400px;
            max-width: 90%;
            border-radius: 6px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .modal-title {
            font-weight: bold;
            font-size: 18px;
            margin: 0;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--text-color);
        }
        
        .modal-body {
            padding: 20px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
        }
        
        .modal-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }
        
        .modal-btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .modal-btn-secondary {
            background-color: #777;
            color: white;
        }
        
        /* Settings styles */
        .settings-group {
            margin-bottom: 20px;
        }
        
        .settings-title {
            font-weight: bold;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .settings-option {
            margin-bottom: 10px;
        }
        
        .settings-option label {
            display: block;
            margin-bottom: 5px;
        }
        
        .settings-select {
            width: 100%;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            background-color: var(--input-bg);
            color: var(--input-text);
        }
        
        #viewport {
            width: 100%;
            height: 600px;
            background-color: #000;
            display: none;
            border-radius: 4px;
            overflow: hidden;
        }
        
        /* View layout with panel */
        .view-container {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .view-panel {
            flex: 1;
            position: relative;
        }
        
        .mesh-panel {
            flex: 0 0 300px;
            background-color: var(--panel-bg);
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 15px;
            max-height: 600px;
            overflow-y: auto;
            display: none;
            transition: background-color 0.3s ease;
        }
        
        .mesh-panel h3 {
            margin-top: 0;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .mesh-group {
            margin-bottom: 15px;
        }
        
        .mesh-group-header {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
            cursor: pointer;
            padding: 5px;
            background-color: rgba(0,0,0,0.03);
            border-radius: 3px;
        }
        
        .dark-mode .mesh-group-header {
            background-color: rgba(255,255,255,0.05);
        }
        
        .mesh-group-header:hover {
            background-color: rgba(0,0,0,0.06);
        }
        
        .dark-mode .mesh-group-header:hover {
            background-color: rgba(255,255,255,0.08);
        }
        
        .mesh-group-toggle {
            margin-right: 5px;
        }
        
        .mesh-group-name {
            font-weight: bold;
            flex-grow: 1;
        }
        
        .mesh-group-count {
            color: #888;
            font-size: 12px;
        }
        
        .dark-mode .mesh-group-count {
            color: #aaa;
        }
        
        .mesh-items {
            margin-left: 20px;
        }
        
        .mesh-item {
            display: flex;
            align-items: center;
            margin-bottom: 3px;
            padding: 3px;
            border-radius: 3px;
        }
        
        .mesh-item:hover {
            background-color: rgba(0,0,0,0.03);
        }
        
        .dark-mode .mesh-item:hover {
            background-color: rgba(255,255,255,0.05);
        }
        
        .mesh-toggle {
            margin-right: 5px;
        }
        
        .mesh-name {
            font-size: 13px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* Tabs styling */
        .tab-container {
            flex: 0 0 300px;
            background-color: var(--panel-bg);
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            max-height: 600px;
            height: 600px;
            display: none;
            transition: background-color 0.3s ease;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .tab-navigation {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }
        
        .tab-button {
            flex: 1;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            padding: 10px;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-color);
            transition: all 0.3s ease;
        }
        
        .tab-button:hover {
            background-color: rgba(0,0,0,0.03);
        }
        
        .dark-mode .tab-button:hover {
            background-color: rgba(255,255,255,0.05);
        }
        
        .tab-button.active {
            border-bottom-color: var(--primary-color);
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
            padding: 15px;
            overflow-y: auto;
            flex-grow: 1;
            max-height: calc(600px - 45px);
        }
        
        .tab-content.active {
            display: block;
        }
        
        .tab-content h3 {
            margin-top: 0;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        /* Atlas Visualization */
        .texture-type-selector {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            gap: 5px;
        }
        
        .texture-type-button {
            flex: 1;
            padding: 5px;
            background: none;
            border: 1px solid var(--border-color);
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            color: var(--text-color);
        }
        
        .texture-type-button:hover {
            background-color: rgba(0,0,0,0.03);
        }
        
        .dark-mode .texture-type-button:hover {
            background-color: rgba(255,255,255,0.05);
        }
        
        .texture-type-button.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .atlas-canvas {
            width: 100%;
            height: auto;
            border: 1px solid var(--border-color);
            margin-bottom: 10px;
        }
        
        .coords-text {
            font-size: 12px;
            margin-bottom: 10px;
            font-family: monospace;
            padding: 5px;
            background-color: rgba(0,0,0,0.03);
            border-radius: 3px;
            color: var(--text-color);
        }
        
        .dark-mode .coords-text {
            background-color: rgba(255,255,255,0.05);
        }
        
        .segment-info {
            font-size: 12px;
            padding: 5px;
            background-color: rgba(0,0,0,0.03);
            border-radius: 3px;
            margin-bottom: 10px;
            color: var(--text-color);
        }
        
        .dark-mode .segment-info {
            background-color: rgba(255,255,255,0.05);
        }
        
        /* UV Controls */
        .uv-info-container {
            margin-bottom: 15px;
            font-size: 13px;
            color: var(--text-color);
        }
        
        .uv-control-group {
            margin-bottom: 15px;
            padding: 10px;
            background-color: rgba(0,0,0,0.02);
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }
        
        .dark-mode .uv-control-group {
            background-color: rgba(255,255,255,0.03);
        }
        
        .uv-control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--label-text);
        }
        
        .uv-control-row {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .uv-control-row span {
            width: 20px;
            text-align: center;
            color: var(--text-color);
            font-weight: bold;
        }
        
        .uv-control-row input {
            flex: 1;
            padding: 5px;
            border: 1px solid var(--border-color);
            border-radius: 3px;
            background-color: var(--input-bg);
            color: var(--input-text);
        }
        
        .uv-note {
            font-size: 11px;
            color: #888;
            margin-top: 5px;
            font-style: italic;
        }
        
        .dark-mode .uv-note {
            color: #aaa;
        }
        
        /* Rig Visualization */
        .rig-button {
            display: block;
            width: 100%;
            padding: 8px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 3px;
            font-size: 14px;
            cursor: pointer;
            margin-bottom: 10px;
            transition: background-color 0.3s ease;
        }
        
        .rig-button:hover {
            background-color: #2980b9;
        }
        
        .bone-hierarchy {
            margin-top: 10px;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 3px;
            padding: 5px;
        }
        
        .bone-item {
            padding: 2px 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .bone-children {
            margin-left: 15px;
            border-left: 1px dotted var(--border-color);
            padding-left: 5px;
        }
        
        .bone-toggle {
            display: inline-block;
            width: 15px;
            text-align: center;
        }
        
        /* Hide entire upload section when debugging starts */
        .hidden-on-debug {
            display: none;
        }
        
        /* Settings styles */
        .settings-slider {
            width: 80%;
            margin-right: 10px;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            margin-top: 5px;
        }
        
        #axis-intensity-value {
            min-width: 30px;
            text-align: center;
        }
    </style>
</head>
<body>
    <header>
        <h1>Asset Debugger</h1>
        <div style="display: flex; gap: 10px;">
            <button id="return-to-toolbox" class="theme-toggle">Return to Toolbox</button>
            <button id="theme-toggle" class="theme-toggle">Switch to Light Mode</button>
        </div>
    </header>
    
    <div class="container">
        <div id="upload-section" class="tool-panel">
            <h2>Upload Files (Optional)</h2>
            <div class="dropzone-container">
                <div class="dropzone" id="basecolor-dropzone">
                    <h3>Base Color Atlas</h3>
                    <p>Drag & drop your base color texture atlas here</p>
                    <p class="file-info" id="basecolor-info"></p>
                </div>
                
                <div class="dropzone" id="orm-dropzone">
                    <h3>ORM Atlas</h3>
                    <p>Drag & drop your ORM (Occlusion, Roughness, Metalness) texture atlas here</p>
                    <p class="file-info" id="orm-info"></p>
                </div>
                
                <div class="dropzone" id="normal-dropzone">
                    <h3>Normal Atlas</h3>
                    <p>Drag & drop your normal map texture atlas here</p>
                    <p class="file-info" id="normal-info"></p>
                </div>
                
                <div class="dropzone" id="model-dropzone">
                    <h3>3D Model</h3>
                    <p>Drag & drop a GLB model file here</p>
                    <p>If not provided, a cube will be used</p>
                    <p class="file-info" id="model-info"></p>
                </div>
            </div>
            
            <div class="preview-container">
                <div class="preview" id="basecolor-preview"></div>
                <div class="preview" id="orm-preview"></div>
                <div class="preview" id="normal-preview"></div>
            </div>
            
            <button id="start-debug" class="start-button" disabled>Start Debugging</button>
        </div>
        
        <div id="debug-button-container" style="display: none;">
            <button id="restart-debug" class="button-base restart-button">Restart</button>
            <button id="settings-button" class="button-base settings-button" aria-label="Settings">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M17.4039 10.9839C17.4373 10.6618 17.4373 10.3382 17.4039 10.0161L19.0039 8.7661C19.1706 8.63275 19.2239 8.41608 19.1373 8.23275L17.3039 5.10775C17.2173 4.92441 17.0039 4.84108 16.8206 4.92441L14.9373 5.69108C14.5039 5.35775 14.0373 5.09108 13.5373 4.89108L13.2706 2.89108C13.2373 2.69108 13.0706 2.55774 12.8706 2.55774H9.20394C9.00394 2.55774 8.83727 2.69108 8.80394 2.89108L8.53727 4.89108C8.03727 5.09108 7.57061 5.35775 7.13727 5.69108L5.25394 4.92441C5.07061 4.84108 4.85727 4.92441 4.77061 5.10775L2.93727 8.23275C2.85061 8.41608 2.90394 8.63275 3.07061 8.7661L4.67061 10.0161C4.63727 10.3382 4.63727 10.6618 4.67061 10.9839L3.07061 12.2339C2.90394 12.3672 2.85061 12.5839 2.93727 12.7672L4.77061 15.8922C4.85727 16.0755 5.07061 16.1589 5.25394 16.0755L7.13727 15.3089C7.57061 15.6422 8.03727 15.9089 8.53727 16.1089L8.80394 18.1089C8.83727 18.3089 9.00394 18.4422 9.20394 18.4422H12.8706C13.0706 18.4422 13.2373 18.3089 13.2706 18.1089L13.5373 16.1089C14.0373 15.9089 14.5039 15.6422 14.9373 15.3089L16.8206 16.0755C17.0039 16.1589 17.2173 16.0755 17.3039 15.8922L19.1373 12.7672C19.2239 12.5839 19.1706 12.3672 19.0039 12.2339L17.4039 10.9839ZM11.0373 13.8089C9.17061 13.8089 7.65394 12.2922 7.65394 10.4255C7.65394 8.55889 9.17061 7.04222 11.0373 7.04222C12.9039 7.04222 14.4206 8.55889 14.4206 10.4255C14.4206 12.2922 12.9039 13.8089 11.0373 13.8089Z" fill="white"/>
                </svg>
            </button>
        </div>
        
        <div class="view-container">
            <div class="view-panel">
                <div id="viewport"></div>
                <div id="loading-indicator" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.7); color: white; padding: 15px; border-radius: 5px; z-index: 100; justify-content: center; align-items: center;">
                    <div>Loading model...</div>
                </div>
            </div>
            <div id="tab-container" class="tab-container" style="display: none;">
                <div class="tab-navigation">
                    <button id="mesh-tab-button" class="tab-button active">Mesh</button>
                    <button id="atlas-tab-button" class="tab-button">Atlas</button>
                    <button id="uv-tab-button" class="tab-button">UV</button>
                    <button id="rig-tab-button" class="tab-button">Rig</button>
                </div>
                <div id="mesh-tab" class="tab-content active">
                    <h3>Mesh Visibility</h3>
                    <div id="mesh-groups"></div>
                </div>
                <div id="atlas-tab" class="tab-content">
                    <h3>Atlas Visualization</h3>
                    <div id="texture-type-selector" class="texture-type-selector">
                        <button data-texture-type="baseColor" class="texture-type-button active">ðŸŽ¨ Base Color</button>
                        <button data-texture-type="orm" class="texture-type-button">âœ¨ ORM</button>
                        <button data-texture-type="normal" class="texture-type-button">ðŸ§© Normal</button>
                    </div>
                    <canvas id="atlas-canvas" class="atlas-canvas" width="260" height="260"></canvas>
                    <div id="coords-text" class="coords-text">UV coordinates: Full texture is shown</div>
                    <div id="segment-info" class="segment-info" style="display: none;"></div>
                </div>
                <div id="uv-tab" class="tab-content">
                    <h3>UV Channel Controls</h3>
                    <div id="uv-content">
                        <div id="uv-info-container" class="uv-info-container">
                            <p>No model loaded or no UV data available.</p>
                            <p>Load a model to view UV information.</p>
                        </div>
                        <div id="uv-manual-controls" style="display: none;">
                            <h4>Manual UV Mapping Controls</h4>
                            <div class="uv-control-group">
                                <label>UV Offset (0-1):</label>
                                <div class="uv-control-row">
                                    <span>X:</span>
                                    <input type="number" id="uv-offset-x" min="0" max="1" step="0.01" value="0">
                                </div>
                                <div class="uv-control-row">
                                    <span>Y:</span>
                                    <input type="number" id="uv-offset-y" min="0" max="1" step="0.01" value="0">
                                </div>
                            </div>
                            <div class="uv-control-group">
                                <label>UV Scale (0-1):</label>
                                <div class="uv-control-row">
                                    <span>W:</span>
                                    <input type="number" id="uv-scale-w" min="0.01" max="1" step="0.01" value="1">
                                </div>
                                <div class="uv-control-row">
                                    <span>H:</span>
                                    <input type="number" id="uv-scale-h" min="0.01" max="1" step="0.01" value="1">
                                </div>
                            </div>
                            <div class="uv-control-group">
                                <label>Predefined Segments:</label>
                                <select id="uv-predefined-segments">
                                    <option value="0">Full texture (1Ã—1)</option>
                                    <option value="1">Top-left quarter (1/2Ã—1/2)</option>
                                    <option value="2">Top-right quarter (1/2Ã—1/2)</option>
                                    <option value="3">Bottom-left quarter (1/2Ã—1/2)</option>
                                    <option value="4">Bottom-right quarter (1/2Ã—1/2)</option>
                                    <option value="5">Top-left ninth (1/3Ã—1/3)</option>
                                    <option value="6">Top-center ninth (1/3Ã—1/3)</option>
                                    <option value="7">Top-right ninth (1/3Ã—1/3)</option>
                                    <option value="8">Middle-left ninth (1/3Ã—1/3)</option>
                                </select>
                            </div>
                            <div class="uv-note">Changes auto-apply immediately</div>
                        </div>
                    </div>
                </div>
                <div id="rig-tab" class="tab-content">
                    <div id="rig-content" class="rig-info-container">
                        <p>No rig data found.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Settings Modal -->
    <div id="settings-modal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3 class="modal-title">Settings</h3>
                <button class="modal-close" id="close-settings-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-group">
                    <div class="settings-title">Axis Indicator</div>
                    <div class="settings-option">
                        <label for="axis-indicator-type">Display Mode</label>
                        <select id="axis-indicator-type" class="settings-select">
                            <option value="disabled" selected>Disabled</option>
                            <option value="windowed">Windowed</option>
                            <option value="embedded">Embedded</option>
                        </select>
                    </div>
                    <div id="embedded-axis-settings" class="settings-option" style="display: none;">
                        <label for="axis-intensity">Axis Intensity</label>
                        <div class="slider-container">
                            <input type="range" id="axis-intensity" min="0.1" max="1.0" step="0.1" value="0.7" class="settings-slider">
                            <span id="axis-intensity-value">0.7</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" id="cancel-settings">Cancel</button>
                <button class="modal-btn modal-btn-primary" id="save-settings">Save Changes</button>
            </div>
        </div>
    </div>
    
    <script type="module" src="asset_debugger.js"></script>
    <script>
        // Theme toggle functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Set default to dark mode
            document.documentElement.classList.add('dark-mode');
            document.documentElement.classList.remove('light-mode');
            
            const themeToggle = document.getElementById('theme-toggle');
            themeToggle.textContent = 'Switch to Light Mode';
            
            themeToggle.addEventListener('click', function() {
                if (document.documentElement.classList.contains('dark-mode')) {
                    document.documentElement.classList.remove('dark-mode');
                    document.documentElement.classList.add('light-mode');
                    themeToggle.textContent = 'Switch to Dark Mode';
                } else {
                    document.documentElement.classList.add('dark-mode');
                    document.documentElement.classList.remove('light-mode');
                    themeToggle.textContent = 'Switch to Light Mode';
                }
            });
            
            // Set up restart button functionality
            const startDebugBtn = document.getElementById('start-debug');
            const uploadSection = document.getElementById('upload-section');
            const restartContainer = document.getElementById('debug-button-container');
            const restartDebugBtn = document.getElementById('restart-debug');
            
            // Note: The start debug button functionality is now handled by the asset_debugger.js script
            // This is just making sure the UI elements are updated correctly
            startDebugBtn.addEventListener('click', function() {
                // Hide upload section and show restart button
                uploadSection.style.display = 'none';
                restartContainer.style.display = 'flex';
                // The actual debugging initialization happens in the JavaScript module
            });
            
            // Settings modal functionality
            const settingsBtn = document.getElementById('settings-button');
            const settingsModal = document.getElementById('settings-modal');
            const closeSettingsBtn = document.getElementById('close-settings-modal');
            const cancelSettingsBtn = document.getElementById('cancel-settings');
            const saveSettingsBtn = document.getElementById('save-settings');
            
            // Open settings modal
            settingsBtn.addEventListener('click', function() {
                settingsModal.style.display = 'flex';
            });
            
            // Close modal functions
            function closeSettingsModal() {
                settingsModal.style.display = 'none';
            }
            
            closeSettingsBtn.addEventListener('click', closeSettingsModal);
            cancelSettingsBtn.addEventListener('click', closeSettingsModal);
            
            // Save settings
            saveSettingsBtn.addEventListener('click', function() {
                // Get values from settings form
                const axisIndicatorType = document.getElementById('axis-indicator-type').value;
                const axisIntensity = parseFloat(document.getElementById('axis-intensity').value);
                
                // For future implementation - store settings
                const settings = {
                    axisIndicator: {
                        type: axisIndicatorType,
                        intensity: axisIntensity
                    }
                };
                
                // Store settings in localStorage
                localStorage.setItem('assetDebuggerSettings', JSON.stringify(settings));
                
                // Apply settings immediately
                applyAxisIndicatorSetting(axisIndicatorType, axisIntensity);
                
                // Close the modal
                closeSettingsModal();
                
                // Notify that settings were saved
                console.log('Settings saved:', settings);
            });
            
            // Function to apply axis indicator settings
            function applyAxisIndicatorSetting(type, intensity = 0.7) {
                // Trigger event to notify application of setting change
                const event = new CustomEvent('axisIndicatorModeChange', {
                    detail: { 
                        mode: type,
                        intensity: intensity
                    }
                });
                document.dispatchEvent(event);
            }
            
            // Load saved settings on startup
            function loadSavedSettings() {
                const savedSettings = localStorage.getItem('assetDebuggerSettings');
                
                if (savedSettings) {
                    try {
                        const settings = JSON.parse(savedSettings);
                        
                        // Apply axis indicator settings if available
                        if (settings.axisIndicator && settings.axisIndicator.type) {
                            // Update the dropdown to match saved setting
                            const axisIndicatorSelect = document.getElementById('axis-indicator-type');
                            if (axisIndicatorSelect) {
                                axisIndicatorSelect.value = settings.axisIndicator.type;
                            }
                            
                            // Update intensity slider if available
                            if (settings.axisIndicator.intensity !== undefined) {
                                const intensitySlider = document.getElementById('axis-intensity');
                                const intensityValue = document.getElementById('axis-intensity-value');
                                if (intensitySlider && intensityValue) {
                                    intensitySlider.value = settings.axisIndicator.intensity;
                                    intensityValue.textContent = settings.axisIndicator.intensity;
                                }
                            }
                            
                            // Apply the setting
                            applyAxisIndicatorSetting(
                                settings.axisIndicator.type, 
                                settings.axisIndicator.intensity || 0.7
                            );
                            
                            // Show/hide embedded settings based on selection
                            toggleEmbeddedSettings(settings.axisIndicator.type);
                        }
                    } catch (e) {
                        console.error('Error loading saved settings:', e);
                    }
                } else {
                    // No saved settings - apply defaults
                    applyAxisIndicatorSetting('disabled');
                }
            }
            
            // Toggle embedded settings visibility
            function toggleEmbeddedSettings(type) {
                const embeddedSettings = document.getElementById('embedded-axis-settings');
                if (embeddedSettings) {
                    embeddedSettings.style.display = type === 'embedded' ? 'block' : 'none';
                }
            }
            
            // Add intensity slider change event
            const intensitySlider = document.getElementById('axis-intensity');
            const intensityValue = document.getElementById('axis-intensity-value');
            if (intensitySlider && intensityValue) {
                intensitySlider.addEventListener('input', function() {
                    intensityValue.textContent = this.value;
                });
            }
            
            // Add axis indicator type change event
            const axisTypeSelect = document.getElementById('axis-indicator-type');
            if (axisTypeSelect) {
                axisTypeSelect.addEventListener('change', function() {
                    toggleEmbeddedSettings(this.value);
                });
            }
            
            // Call on page load
            loadSavedSettings();
            
            // Return to Toolbox functionality
            const returnToToolboxBtn = document.getElementById('return-to-toolbox');
            returnToToolboxBtn.addEventListener('click', function() {
                window.location.href = '../../';
            });
        });
    </script>
</body>
</html> 