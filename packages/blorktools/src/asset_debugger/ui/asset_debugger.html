<!DOCTYPE html>
<html lang="en" class="dark-mode">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asset Debugger - Blorktools</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <header>
        <h1>Asset Debugger</h1>
        <div style="display: flex; gap: 10px;">
            <button id="return-to-toolbox" class="theme-toggle">Exit to Toolbox</button>
            <button id="theme-toggle" class="theme-toggle">System Status</button>
        </div>
    </header>
    
    <div class="container">
        <div id="upload-section" class="tool-panel">
            <h2>Upload Files (Optional)</h2>
            <div class="dropzone-container">
                <div class="dropzone" id="basecolor-dropzone">
                    <h3>Base Color Atlas</h3>
                    <p>Drag & drop your base color texture atlas here</p>
                    <p class="file-info" id="basecolor-info"></p>
                </div>
                
                <div class="dropzone" id="orm-dropzone">
                    <h3>ORM Atlas</h3>
                    <p>Drag & drop your ORM (Occlusion, Roughness, Metalness) texture atlas here</p>
                    <p class="file-info" id="orm-info"></p>
                </div>
                
                <div class="dropzone" id="normal-dropzone">
                    <h3>Normal Atlas</h3>
                    <p>Drag & drop your normal map texture atlas here</p>
                    <p class="file-info" id="normal-info"></p>
                </div>
                
                <div class="dropzone" id="model-dropzone">
                    <h3>3D Model</h3>
                    <p>Drag & drop a GLB model file here</p>
                    <p>If not provided, a cube will be used</p>
                    <p class="file-info" id="model-info"></p>
                </div>
            </div>
            
            <div class="preview-container">
                <div class="preview" id="basecolor-preview"></div>
                <div class="preview" id="orm-preview"></div>
                <div class="preview" id="normal-preview"></div>
            </div>
            
            <button id="start-debug" class="start-button">Start Debugging</button>
        </div>
        
        <div id="debug-button-container" style="display: none;">
            <button id="restart-debug" class="button-base restart-button">Restart</button>
            <button id="settings-button" class="button-base settings-button" aria-label="Settings">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M17.4039 10.9839C17.4373 10.6618 17.4373 10.3382 17.4039 10.0161L19.0039 8.7661C19.1706 8.63275 19.2239 8.41608 19.1373 8.23275L17.3039 5.10775C17.2173 4.92441 17.0039 4.84108 16.8206 4.92441L14.9373 5.69108C14.5039 5.35775 14.0373 5.09108 13.5373 4.89108L13.2706 2.89108C13.2373 2.69108 13.0706 2.55774 12.8706 2.55774H9.20394C9.00394 2.55774 8.83727 2.69108 8.80394 2.89108L8.53727 4.89108C8.03727 5.09108 7.57061 5.35775 7.13727 5.69108L5.25394 4.92441C5.07061 4.84108 4.85727 4.92441 4.77061 5.10775L2.93727 8.23275C2.85061 8.41608 2.90394 8.63275 3.07061 8.7661L4.67061 10.0161C4.63727 10.3382 4.63727 10.6618 4.67061 10.9839L3.07061 12.2339C2.90394 12.3672 2.85061 12.5839 2.93727 12.7672L4.77061 15.8922C4.85727 16.0755 5.07061 16.1589 5.25394 16.0755L7.13727 15.3089C7.57061 15.6422 8.03727 15.9089 8.53727 16.1089L8.80394 18.1089C8.83727 18.3089 9.00394 18.4422 9.20394 18.4422H12.8706C13.0706 18.4422 13.2373 18.3089 13.2706 18.1089L13.5373 16.1089C14.0373 15.9089 14.5039 15.6422 14.9373 15.3089L16.8206 16.0755C17.0039 16.1589 17.2173 16.0755 17.3039 15.8922L19.1373 12.7672C19.2239 12.5839 19.1706 12.3672 19.0039 12.2339L17.4039 10.9839ZM11.0373 13.8089C9.17061 13.8089 7.65394 12.2922 7.65394 10.4255C7.65394 8.55889 9.17061 7.04222 11.0373 7.04222C12.9039 7.04222 14.4206 8.55889 14.4206 10.4255C14.4206 12.2922 12.9039 13.8089 11.0373 13.8089Z" fill="white"/>
                </svg>
            </button>
        </div>
        
        <div class="view-container">
            <div class="view-panel">
                <div id="viewport"></div>
                <div id="loading-indicator" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.7); color: white; padding: 15px; border-radius: 5px; z-index: 100; justify-content: center; align-items: center;">
                    <div>Loading model...</div>
                </div>
            </div>
            <div id="tab-container" class="tab-container" style="display: none;">
                <div class="tab-navigation">
                    <button id="mesh-tab-button" class="tab-button active">Mesh</button>
                    <button id="atlas-tab-button" class="tab-button">Atlas</button>
                    <button id="uv-tab-button" class="tab-button">UV</button>
                    <button id="rig-tab-button" class="tab-button">Rig</button>
                </div>
                <div id="mesh-tab" class="tab-content active">
                    <h3>Mesh Visibility</h3>
                    <div id="mesh-groups"></div>
                </div>
                <div id="atlas-tab" class="tab-content">
                    <h3>Atlas Visualization</h3>
                    <div id="texture-type-selector" class="texture-type-selector">
                        <button data-texture-type="baseColor" class="texture-type-button active">ðŸŽ¨ Base Color</button>
                        <button data-texture-type="orm" class="texture-type-button">âœ¨ ORM</button>
                        <button data-texture-type="normal" class="texture-type-button">ðŸ§© Normal</button>
                    </div>
                    <canvas id="atlas-canvas" class="atlas-canvas" width="260" height="260"></canvas>
                    <div id="coords-text" class="coords-text">UV coordinates: Full texture is shown</div>
                    <div id="segment-info" class="segment-info" style="display: none;"></div>
                </div>
                <div id="uv-tab" class="tab-content">
                    <h3>UV Channel Controls</h3>
                    <div id="uv-content">
                        <div id="uv-info-container" class="uv-info-container">
                            <p>No model loaded or no UV data available.</p>
                            <p>Load a model to view UV information.</p>
                        </div>
                        <div id="uv-manual-controls" style="display: none;">
                            <h4>Manual UV Mapping Controls</h4>
                            <div class="uv-control-group">
                                <label>UV Offset (0-1):</label>
                                <div class="uv-control-row">
                                    <span>X:</span>
                                    <input type="number" id="uv-offset-x" min="0" max="1" step="0.01" value="0">
                                </div>
                                <div class="uv-control-row">
                                    <span>Y:</span>
                                    <input type="number" id="uv-offset-y" min="0" max="1" step="0.01" value="0">
                                </div>
                            </div>
                            <div class="uv-control-group">
                                <label>UV Scale (0-1):</label>
                                <div class="uv-control-row">
                                    <span>W:</span>
                                    <input type="number" id="uv-scale-w" min="0.01" max="1" step="0.01" value="1">
                                </div>
                                <div class="uv-control-row">
                                    <span>H:</span>
                                    <input type="number" id="uv-scale-h" min="0.01" max="1" step="0.01" value="1">
                                </div>
                            </div>
                            <div class="uv-control-group">
                                <label>Predefined Segments:</label>
                                <select id="uv-predefined-segments">
                                    <option value="0">Full texture (1Ã—1)</option>
                                    <option value="1">Top-left quarter (1/2Ã—1/2)</option>
                                    <option value="2">Top-right quarter (1/2Ã—1/2)</option>
                                    <option value="3">Bottom-left quarter (1/2Ã—1/2)</option>
                                    <option value="4">Bottom-right quarter (1/2Ã—1/2)</option>
                                    <option value="5">Top-left ninth (1/3Ã—1/3)</option>
                                    <option value="6">Top-center ninth (1/3Ã—1/3)</option>
                                    <option value="7">Top-right ninth (1/3Ã—1/3)</option>
                                    <option value="8">Middle-left ninth (1/3Ã—1/3)</option>
                                </select>
                            </div>
                            <div class="uv-note">Changes auto-apply immediately</div>
                        </div>
                    </div>
                </div>
                <div id="rig-tab" class="tab-content">
                    <div id="rig-content" class="rig-info-container">
                        <p>No rig data found.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Settings Modal -->
    <div id="settings-modal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3 class="modal-title">Settings</h3>
                <button class="modal-close" id="close-settings-modal">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Settings Tab Navigation -->
                <div class="settings-tabs">
                    <button class="settings-tab-button active" data-tab="axis-settings">Axis Indicator</button>
                    <button class="settings-tab-button" data-tab="rig-settings">Rig Options</button>
                </div>
                
                <!-- Axis Indicator Settings Tab -->
                <div id="axis-settings" class="settings-tab-content active">
                    <div class="settings-group">
                        <div class="settings-option">
                            <label for="axis-indicator-type">Display Mode</label>
                            <select id="axis-indicator-type" class="settings-select">
                                <option value="disabled" selected>Disabled</option>
                                <option value="windowed">Windowed</option>
                                <option value="embedded">Embedded</option>
                            </select>
                        </div>
                        <div id="embedded-axis-settings" class="settings-option" style="display: none;">
                            <label for="axis-intensity">Background Intensity</label>
                            <div class="slider-container">
                                <input type="range" id="axis-intensity" min="0.1" max="1.0" step="0.1" value="0.7" class="settings-slider">
                                <span id="axis-intensity-value">0.7</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Rig Options Settings Tab -->
                <div id="rig-settings" class="settings-tab-content">
                    <div class="settings-group">
                        <!-- First row - Toggle controls -->
                        <div class="settings-row">
                            <div class="settings-option">
                                <label for="display-rig">Display Rig</label>
                                <input type="checkbox" id="display-rig" class="settings-checkbox">
                            </div>
                            <div class="settings-option">
                                <label for="force-z">Force Z-index</label>
                                <input type="checkbox" id="force-z" class="settings-checkbox">
                            </div>
                        </div>
                        
                        <!-- Second row - Toggle controls -->
                        <div class="settings-row">
                            <div class="settings-option">
                                <label for="fill-wireframe">Fill Wireframe</label>
                                <input type="checkbox" id="fill-wireframe" class="settings-checkbox">
                            </div>
                            <div class="settings-option">
                                <label for="show-joint-labels">Show Joint Labels</label>
                                <input type="checkbox" id="show-joint-labels" class="settings-checkbox">
                            </div>
                        </div>
                        
                        <!-- Rig Colors Section -->
                        <div class="settings-row" style="margin-top: 15px;">
                            <div class="settings-option full-width collapsible-header">
                                <h4 class="settings-subheading">Rig Colors</h4>
                                <span class="collapse-indicator">â–¶</span>
                            </div>
                        </div>
                        
                        <div class="collapsible-content" style="display: none;">
                            <div class="settings-row">
                                <div class="settings-option full-width">
                                    <label for="primary-color">Primary Color</label>
                                    <input type="color" id="primary-color" class="settings-color-picker">
                                </div>
                            </div>
                            
                            <div class="settings-row" id="secondary-color-option" style="display: none;">
                                <div class="settings-option full-width">
                                    <label for="secondary-color">Secondary Color</label>
                                    <input type="color" id="secondary-color" class="settings-color-picker">
                                </div>
                            </div>
                            
                            <div class="settings-row">
                                <div class="settings-option full-width">
                                    <label for="joint-color">Joint Color</label>
                                    <input type="color" id="joint-color" class="settings-color-picker">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Control Handle Colors Section -->
                        <div class="settings-row" style="margin-top: 15px;">
                            <div class="settings-option full-width collapsible-header">
                                <h4 class="settings-subheading">Control Handle Colors</h4>
                                <span class="collapse-indicator">â–¶</span>
                            </div>
                        </div>
                        
                        <div class="collapsible-content" style="display: none;">
                            <div class="settings-row">
                                <div class="settings-option full-width">
                                    <label for="normal-color">Normal State</label>
                                    <input type="color" id="normal-color" class="settings-color-picker" value="#FF0000">
                                </div>
                            </div>
                            
                            <div class="settings-row">
                                <div class="settings-option full-width">
                                    <label for="hover-color">Hover State</label>
                                    <input type="color" id="hover-color" class="settings-color-picker" value="#00FF00">
                                </div>
                            </div>
                            
                            <div class="settings-row">
                                <div class="settings-option full-width">
                                    <label for="active-color">Active State</label>
                                    <input type="color" id="active-color" class="settings-color-picker" value="#0000FF">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Reset Rig button on its own line at the bottom -->
                        <div class="settings-row" style="margin-top: 20px;">
                            <div class="settings-option full-width text-center">
                                <button id="reset-rig" class="reset-button">Reset Rig</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" id="cancel-settings">Cancel</button>
                <button class="modal-btn modal-btn-primary" id="save-settings">Save Changes</button>
            </div>
        </div>
    </div>
    
    <!-- Load Example Modal -->
    <div id="load-example-modal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3 class="modal-title">LOAD EXAMPLE</h3>
                <button class="modal-close" id="close-example-modal">&times;</button>
            </div>
            <div class="modal-body" style="padding: 25px 20px;">
                <div style="text-align: center; margin-bottom: 20px;">
                    <p style="margin-bottom: 20px; font-size: 16px;">SELECT AN EXAMPLE TO LOAD:</p>
                    <button id="rig-example-button">RIG EXAMPLE</button>
                </div>
                <div style="font-size: 12px; margin-top: 30px; color: #999; text-align: center;">
                    <p>EXAMPLES WILL LOAD WITHOUT REQUIRING ANY FILE UPLOADS</p>
                </div>
            </div>
        </div>
    </div>
    
    <script type="module" src="asset_debugger.js"></script>
    <script type="module">
        // Import UI components
        import { SettingsModal } from './settings-modal.js';
        
        // Theme toggle functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Always use terminal theme (dark mode)
            document.documentElement.classList.add('dark-mode');
            document.documentElement.classList.remove('light-mode');
            
            const themeToggle = document.getElementById('theme-toggle');
            themeToggle.textContent = 'System Status';
            
            themeToggle.addEventListener('click', function() {
                alert('System Status: Online\nAsset Debugger: Ready\nRig Visualizer: Ready');
            });
            
            // Set up restart button functionality
            const startDebugBtn = document.getElementById('start-debug');
            const uploadSection = document.getElementById('upload-section');
            const restartContainer = document.getElementById('debug-button-container');
            const restartDebugBtn = document.getElementById('restart-debug');
            
            // Note: All start debug button functionality is now handled by the asset_debugger.js script
            // The inline listener has been moved to consolidate all logic in one place
            
            // Load example modal functionality is now handled by ExamplesModal class
            
            // Return to Toolbox functionality
            const returnToToolboxBtn = document.getElementById('return-to-toolbox');
            if (returnToToolboxBtn) {
                returnToToolboxBtn.addEventListener('click', function() {
                    window.location.href = '../../';
                });
            }
        });
    </script>
</body>
</html> 