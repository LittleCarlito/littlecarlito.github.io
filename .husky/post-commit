#!/bin/sh

echo "📊 POST-COMMIT REPORT"
echo "===================="

# Get current branch name
CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)

# Start collecting results to a variable for a clean report
OUTPUT=""

# Use git ls-files to respect .gitignore and only find js/html files over 1000 lines
OUTPUT="${OUTPUT}\n🔍 LARGE FILES (>1000 lines, JS/HTML only):\n"
git ls-files "*.js" "*.html" | xargs wc -l 2>/dev/null | awk '$1 > 1000 {print "📄 " $1 " lines: " substr($0, index($0, $2))}' | sort -nr | head -10 > /tmp/large_files.txt
LARGE_FILES=$(cat /tmp/large_files.txt)
LARGE_FILES_COUNT=$(wc -l < /tmp/large_files.txt | tr -d ' ')

if [ "$LARGE_FILES_COUNT" -gt 0 ]; then
  OUTPUT="${OUTPUT}${LARGE_FILES}"
  if [ "$LARGE_FILES_COUNT" -gt 10 ]; then
    OUTPUT="${OUTPUT}\n...and $(($LARGE_FILES_COUNT - 10)) more files over 1000 lines"
  fi
else
  OUTPUT="${OUTPUT}✅ No large JS or HTML files found"
fi

# Print the collected output
echo "$OUTPUT"
echo "\n====================" 