{"version":3,"file":"index.js","sources":["../../../node_modules/.pnpm/three@0.172.0/node_modules/three/examples/jsm/utils/SkeletonUtils.js","../../../node_modules/.pnpm/three@0.172.0/node_modules/three/examples/jsm/libs/tween.module.js","../src/loaders.js","../src/rapier_proxy.js","../src/three_proxy.js","../../../node_modules/.pnpm/three@0.172.0/node_modules/three/examples/jsm/utils/BufferGeometryUtils.js","../../../node_modules/.pnpm/three@0.172.0/node_modules/three/examples/jsm/loaders/GLTFLoader.js","../src/blorkpack_flags.js","../src/custom_type_manager.js","../src/asset_storage.js","../src/asset_activator.js","../src/asset_spawner/common/system_asset_types.js","../src/asset_spawner/common/id_generator.js","../src/asset_spawner/asset_factories/system_spawners/box_spawner.js","../src/asset_spawner/asset_factories/system_spawners/sphere_spawner.js","../src/asset_spawner/asset_factories/system_spawners/capsule_spawner.js","../src/asset_spawner/asset_factories/system_spawners/cylinder_spawner.js","../src/asset_spawner/asset_factories/system_spawners/spotlight_spawner.js","../src/asset_spawner/asset_factories/system_factory.js","../src/asset_spawner/asset_factories/custom_factory.js","../src/asset_spawner/asset_spawner.js","../resources/default_configs.js","../src/manifest_manager.js","../../../node_modules/.pnpm/three@0.172.0/node_modules/three/examples/jsm/postprocessing/Pass.js","../../../node_modules/.pnpm/three@0.172.0/node_modules/three/examples/jsm/shaders/CopyShader.js","../../../node_modules/.pnpm/three@0.172.0/node_modules/three/examples/jsm/postprocessing/ShaderPass.js","../../../node_modules/.pnpm/three@0.172.0/node_modules/three/examples/jsm/postprocessing/MaskPass.js","../../../node_modules/.pnpm/three@0.172.0/node_modules/three/examples/jsm/postprocessing/EffectComposer.js","../../../node_modules/.pnpm/three@0.172.0/node_modules/three/examples/jsm/shaders/OutputShader.js","../../../node_modules/.pnpm/three@0.172.0/node_modules/three/examples/jsm/postprocessing/OutputPass.js","../../../node_modules/.pnpm/three@0.172.0/node_modules/three/examples/jsm/postprocessing/RenderPass.js","../../../node_modules/.pnpm/three@0.172.0/node_modules/three/examples/jsm/shaders/LuminosityHighPassShader.js","../../../node_modules/.pnpm/three@0.172.0/node_modules/three/examples/jsm/postprocessing/UnrealBloomPass.js","../../../node_modules/.pnpm/three@0.172.0/node_modules/three/examples/jsm/renderers/CSS2DRenderer.js","../src/app_renderer.js","../src/physics/physics_util.js","../src/manifest_types.js","../src/index.js"],"sourcesContent":["import {\n\tAnimationClip,\n\tAnimationMixer,\n\tMatrix4,\n\tQuaternion,\n\tQuaternionKeyframeTrack,\n\tSkeletonHelper,\n\tVector3,\n\tVectorKeyframeTrack\n} from 'three';\n\nfunction getBoneName( bone, options ) {\n\n\tif ( options.getBoneName !== undefined ) {\n\n\t\treturn options.getBoneName( bone );\n\n\t}\n\n\treturn options.names[ bone.name ];\n\n}\n\nfunction retarget( target, source, options = {} ) {\n\n\tconst quat = new Quaternion(),\n\t\tscale = new Vector3(),\n\t\trelativeMatrix = new Matrix4(),\n\t\tglobalMatrix = new Matrix4();\n\n\toptions.preserveBoneMatrix = options.preserveBoneMatrix !== undefined ? options.preserveBoneMatrix : true;\n\toptions.preserveBonePositions = options.preserveBonePositions !== undefined ? options.preserveBonePositions : true;\n\toptions.useTargetMatrix = options.useTargetMatrix !== undefined ? options.useTargetMatrix : false;\n\toptions.hip = options.hip !== undefined ? options.hip : 'hip';\n\toptions.hipInfluence = options.hipInfluence !== undefined ? options.hipInfluence : new Vector3( 1, 1, 1 );\n\toptions.scale = options.scale !== undefined ? options.scale : 1;\n\toptions.names = options.names || {};\n\n\tconst sourceBones = source.isObject3D ? source.skeleton.bones : getBones( source ),\n\t\tbones = target.isObject3D ? target.skeleton.bones : getBones( target );\n\n\tlet bone, name, boneTo,\n\t\tbonesPosition;\n\n\t// reset bones\n\n\tif ( target.isObject3D ) {\n\n\t\ttarget.skeleton.pose();\n\n\t} else {\n\n\t\toptions.useTargetMatrix = true;\n\t\toptions.preserveBoneMatrix = false;\n\n\t}\n\n\tif ( options.preserveBonePositions ) {\n\n\t\tbonesPosition = [];\n\n\t\tfor ( let i = 0; i < bones.length; i ++ ) {\n\n\t\t\tbonesPosition.push( bones[ i ].position.clone() );\n\n\t\t}\n\n\t}\n\n\tif ( options.preserveBoneMatrix ) {\n\n\t\t// reset matrix\n\n\t\ttarget.updateMatrixWorld();\n\n\t\ttarget.matrixWorld.identity();\n\n\t\t// reset children matrix\n\n\t\tfor ( let i = 0; i < target.children.length; ++ i ) {\n\n\t\t\ttarget.children[ i ].updateMatrixWorld( true );\n\n\t\t}\n\n\t}\n\n\tfor ( let i = 0; i < bones.length; ++ i ) {\n\n\t\tbone = bones[ i ];\n\t\tname = getBoneName( bone, options );\n\n\t\tboneTo = getBoneByName( name, sourceBones );\n\n\t\tglobalMatrix.copy( bone.matrixWorld );\n\n\t\tif ( boneTo ) {\n\n\t\t\tboneTo.updateMatrixWorld();\n\n\t\t\tif ( options.useTargetMatrix ) {\n\n\t\t\t\trelativeMatrix.copy( boneTo.matrixWorld );\n\n\t\t\t} else {\n\n\t\t\t\trelativeMatrix.copy( target.matrixWorld ).invert();\n\t\t\t\trelativeMatrix.multiply( boneTo.matrixWorld );\n\n\t\t\t}\n\n\t\t\t// ignore scale to extract rotation\n\n\t\t\tscale.setFromMatrixScale( relativeMatrix );\n\t\t\trelativeMatrix.scale( scale.set( 1 / scale.x, 1 / scale.y, 1 / scale.z ) );\n\n\t\t\t// apply to global matrix\n\n\t\t\tglobalMatrix.makeRotationFromQuaternion( quat.setFromRotationMatrix( relativeMatrix ) );\n\n\t\t\tif ( target.isObject3D ) {\n\n\t\t\t\tif ( options.localOffsets ) {\n\n\t\t\t\t\tif ( options.localOffsets[ bone.name ] ) {\n\n\t\t\t\t\t\tglobalMatrix.multiply( options.localOffsets[ bone.name ] );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tglobalMatrix.copyPosition( relativeMatrix );\n\n\t\t}\n\n\t\tif ( name === options.hip ) {\n\n\t\t\tglobalMatrix.elements[ 12 ] *= options.scale * options.hipInfluence.x;\n\t\t\tglobalMatrix.elements[ 13 ] *= options.scale * options.hipInfluence.y;\n\t\t\tglobalMatrix.elements[ 14 ] *= options.scale * options.hipInfluence.z;\n\n\t\t\tif ( options.hipPosition !== undefined ) {\n\n\t\t\t\tglobalMatrix.elements[ 12 ] += options.hipPosition.x * options.scale;\n\t\t\t\tglobalMatrix.elements[ 13 ] += options.hipPosition.y * options.scale;\n\t\t\t\tglobalMatrix.elements[ 14 ] += options.hipPosition.z * options.scale;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( bone.parent ) {\n\n\t\t\tbone.matrix.copy( bone.parent.matrixWorld ).invert();\n\t\t\tbone.matrix.multiply( globalMatrix );\n\n\t\t} else {\n\n\t\t\tbone.matrix.copy( globalMatrix );\n\n\t\t}\n\n\t\tbone.matrix.decompose( bone.position, bone.quaternion, bone.scale );\n\n\t\tbone.updateMatrixWorld();\n\n\t}\n\n\tif ( options.preserveBonePositions ) {\n\n\t\tfor ( let i = 0; i < bones.length; ++ i ) {\n\n\t\t\tbone = bones[ i ];\n\t\t\tname = getBoneName( bone, options ) || bone.name;\n\n\t\t\tif ( name !== options.hip ) {\n\n\t\t\t\tbone.position.copy( bonesPosition[ i ] );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tif ( options.preserveBoneMatrix ) {\n\n\t\t// restore matrix\n\n\t\ttarget.updateMatrixWorld( true );\n\n\t}\n\n}\n\nfunction retargetClip( target, source, clip, options = {} ) {\n\n\toptions.useFirstFramePosition = options.useFirstFramePosition !== undefined ? options.useFirstFramePosition : false;\n\n\t// Calculate the fps from the source clip based on the track with the most frames, unless fps is already provided.\n\toptions.fps = options.fps !== undefined ? options.fps : ( Math.max( ...clip.tracks.map( track => track.times.length ) ) / clip.duration );\n\toptions.names = options.names || [];\n\n\tif ( ! source.isObject3D ) {\n\n\t\tsource = getHelperFromSkeleton( source );\n\n\t}\n\n\tconst numFrames = Math.round( clip.duration * ( options.fps / 1000 ) * 1000 ),\n\t\tdelta = clip.duration / ( numFrames - 1 ),\n\t\tconvertedTracks = [],\n\t\tmixer = new AnimationMixer( source ),\n\t\tbones = getBones( target.skeleton ),\n\t\tboneDatas = [];\n\n\tlet positionOffset,\n\t\tbone, boneTo, boneData,\n\t\tname;\n\n\tmixer.clipAction( clip ).play();\n\n\t// trim\n\n\tlet start = 0, end = numFrames;\n\n\tif ( options.trim !== undefined ) {\n\n\t\tstart = Math.round( options.trim[ 0 ] * options.fps );\n\t\tend = Math.min( Math.round( options.trim[ 1 ] * options.fps ), numFrames ) - start;\n\n\t\tmixer.update( options.trim[ 0 ] );\n\n\t} else {\n\n\t\tmixer.update( 0 );\n\n\t}\n\n\tsource.updateMatrixWorld();\n\n\t//\n\n\tfor ( let frame = 0; frame < end; ++ frame ) {\n\n\t\tconst time = frame * delta;\n\n\t\tretarget( target, source, options );\n\n\t\tfor ( let j = 0; j < bones.length; ++ j ) {\n\n\t\t\tbone = bones[ j ];\n\t\t\tname = getBoneName( bone, options ) || bone.name;\n\t\t\tboneTo = getBoneByName( name, source.skeleton );\n\n\t\t\tif ( boneTo ) {\n\n\t\t\t\tboneData = boneDatas[ j ] = boneDatas[ j ] || { bone: bone };\n\n\t\t\t\tif ( options.hip === name ) {\n\n\t\t\t\t\tif ( ! boneData.pos ) {\n\n\t\t\t\t\t\tboneData.pos = {\n\t\t\t\t\t\t\ttimes: new Float32Array( end ),\n\t\t\t\t\t\t\tvalues: new Float32Array( end * 3 )\n\t\t\t\t\t\t};\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( options.useFirstFramePosition ) {\n\n\t\t\t\t\t\tif ( frame === 0 ) {\n\n\t\t\t\t\t\t\tpositionOffset = bone.position.clone();\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbone.position.sub( positionOffset );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tboneData.pos.times[ frame ] = time;\n\n\t\t\t\t\tbone.position.toArray( boneData.pos.values, frame * 3 );\n\n\t\t\t\t}\n\n\t\t\t\tif ( ! boneData.quat ) {\n\n\t\t\t\t\tboneData.quat = {\n\t\t\t\t\t\ttimes: new Float32Array( end ),\n\t\t\t\t\t\tvalues: new Float32Array( end * 4 )\n\t\t\t\t\t};\n\n\t\t\t\t}\n\n\t\t\t\tboneData.quat.times[ frame ] = time;\n\n\t\t\t\tbone.quaternion.toArray( boneData.quat.values, frame * 4 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( frame === end - 2 ) {\n\n\t\t\t// last mixer update before final loop iteration\n\t\t\t// make sure we do not go over or equal to clip duration\n\t\t\tmixer.update( delta - 0.0000001 );\n\n\t\t} else {\n\n\t\t\tmixer.update( delta );\n\n\t\t}\n\n\t\tsource.updateMatrixWorld();\n\n\t}\n\n\tfor ( let i = 0; i < boneDatas.length; ++ i ) {\n\n\t\tboneData = boneDatas[ i ];\n\n\t\tif ( boneData ) {\n\n\t\t\tif ( boneData.pos ) {\n\n\t\t\t\tconvertedTracks.push( new VectorKeyframeTrack(\n\t\t\t\t\t'.bones[' + boneData.bone.name + '].position',\n\t\t\t\t\tboneData.pos.times,\n\t\t\t\t\tboneData.pos.values\n\t\t\t\t) );\n\n\t\t\t}\n\n\t\t\tconvertedTracks.push( new QuaternionKeyframeTrack(\n\t\t\t\t'.bones[' + boneData.bone.name + '].quaternion',\n\t\t\t\tboneData.quat.times,\n\t\t\t\tboneData.quat.values\n\t\t\t) );\n\n\t\t}\n\n\t}\n\n\tmixer.uncacheAction( clip );\n\n\treturn new AnimationClip( clip.name, - 1, convertedTracks );\n\n}\n\nfunction clone( source ) {\n\n\tconst sourceLookup = new Map();\n\tconst cloneLookup = new Map();\n\n\tconst clone = source.clone();\n\n\tparallelTraverse( source, clone, function ( sourceNode, clonedNode ) {\n\n\t\tsourceLookup.set( clonedNode, sourceNode );\n\t\tcloneLookup.set( sourceNode, clonedNode );\n\n\t} );\n\n\tclone.traverse( function ( node ) {\n\n\t\tif ( ! node.isSkinnedMesh ) return;\n\n\t\tconst clonedMesh = node;\n\t\tconst sourceMesh = sourceLookup.get( node );\n\t\tconst sourceBones = sourceMesh.skeleton.bones;\n\n\t\tclonedMesh.skeleton = sourceMesh.skeleton.clone();\n\t\tclonedMesh.bindMatrix.copy( sourceMesh.bindMatrix );\n\n\t\tclonedMesh.skeleton.bones = sourceBones.map( function ( bone ) {\n\n\t\t\treturn cloneLookup.get( bone );\n\n\t\t} );\n\n\t\tclonedMesh.bind( clonedMesh.skeleton, clonedMesh.bindMatrix );\n\n\t} );\n\n\treturn clone;\n\n}\n\n// internal helper\n\nfunction getBoneByName( name, skeleton ) {\n\n\tfor ( let i = 0, bones = getBones( skeleton ); i < bones.length; i ++ ) {\n\n\t\tif ( name === bones[ i ].name )\n\n\t\t\treturn bones[ i ];\n\n\t}\n\n}\n\nfunction getBones( skeleton ) {\n\n\treturn Array.isArray( skeleton ) ? skeleton : skeleton.bones;\n\n}\n\n\nfunction getHelperFromSkeleton( skeleton ) {\n\n\tconst source = new SkeletonHelper( skeleton.bones[ 0 ] );\n\tsource.skeleton = skeleton;\n\n\treturn source;\n\n}\n\nfunction parallelTraverse( a, b, callback ) {\n\n\tcallback( a, b );\n\n\tfor ( let i = 0; i < a.children.length; i ++ ) {\n\n\t\tparallelTraverse( a.children[ i ], b.children[ i ], callback );\n\n\t}\n\n}\n\nexport {\n\tretarget,\n\tretargetClip,\n\tclone,\n};\n","/**\n * The Ease class provides a collection of easing functions for use with tween.js.\n */\nvar Easing = Object.freeze({\n    Linear: Object.freeze({\n        None: function (amount) {\n            return amount;\n        },\n        In: function (amount) {\n            return this.None(amount);\n        },\n        Out: function (amount) {\n            return this.None(amount);\n        },\n        InOut: function (amount) {\n            return this.None(amount);\n        },\n    }),\n    Quadratic: Object.freeze({\n        In: function (amount) {\n            return amount * amount;\n        },\n        Out: function (amount) {\n            return amount * (2 - amount);\n        },\n        InOut: function (amount) {\n            if ((amount *= 2) < 1) {\n                return 0.5 * amount * amount;\n            }\n            return -0.5 * (--amount * (amount - 2) - 1);\n        },\n    }),\n    Cubic: Object.freeze({\n        In: function (amount) {\n            return amount * amount * amount;\n        },\n        Out: function (amount) {\n            return --amount * amount * amount + 1;\n        },\n        InOut: function (amount) {\n            if ((amount *= 2) < 1) {\n                return 0.5 * amount * amount * amount;\n            }\n            return 0.5 * ((amount -= 2) * amount * amount + 2);\n        },\n    }),\n    Quartic: Object.freeze({\n        In: function (amount) {\n            return amount * amount * amount * amount;\n        },\n        Out: function (amount) {\n            return 1 - --amount * amount * amount * amount;\n        },\n        InOut: function (amount) {\n            if ((amount *= 2) < 1) {\n                return 0.5 * amount * amount * amount * amount;\n            }\n            return -0.5 * ((amount -= 2) * amount * amount * amount - 2);\n        },\n    }),\n    Quintic: Object.freeze({\n        In: function (amount) {\n            return amount * amount * amount * amount * amount;\n        },\n        Out: function (amount) {\n            return --amount * amount * amount * amount * amount + 1;\n        },\n        InOut: function (amount) {\n            if ((amount *= 2) < 1) {\n                return 0.5 * amount * amount * amount * amount * amount;\n            }\n            return 0.5 * ((amount -= 2) * amount * amount * amount * amount + 2);\n        },\n    }),\n    Sinusoidal: Object.freeze({\n        In: function (amount) {\n            return 1 - Math.sin(((1.0 - amount) * Math.PI) / 2);\n        },\n        Out: function (amount) {\n            return Math.sin((amount * Math.PI) / 2);\n        },\n        InOut: function (amount) {\n            return 0.5 * (1 - Math.sin(Math.PI * (0.5 - amount)));\n        },\n    }),\n    Exponential: Object.freeze({\n        In: function (amount) {\n            return amount === 0 ? 0 : Math.pow(1024, amount - 1);\n        },\n        Out: function (amount) {\n            return amount === 1 ? 1 : 1 - Math.pow(2, -10 * amount);\n        },\n        InOut: function (amount) {\n            if (amount === 0) {\n                return 0;\n            }\n            if (amount === 1) {\n                return 1;\n            }\n            if ((amount *= 2) < 1) {\n                return 0.5 * Math.pow(1024, amount - 1);\n            }\n            return 0.5 * (-Math.pow(2, -10 * (amount - 1)) + 2);\n        },\n    }),\n    Circular: Object.freeze({\n        In: function (amount) {\n            return 1 - Math.sqrt(1 - amount * amount);\n        },\n        Out: function (amount) {\n            return Math.sqrt(1 - --amount * amount);\n        },\n        InOut: function (amount) {\n            if ((amount *= 2) < 1) {\n                return -0.5 * (Math.sqrt(1 - amount * amount) - 1);\n            }\n            return 0.5 * (Math.sqrt(1 - (amount -= 2) * amount) + 1);\n        },\n    }),\n    Elastic: Object.freeze({\n        In: function (amount) {\n            if (amount === 0) {\n                return 0;\n            }\n            if (amount === 1) {\n                return 1;\n            }\n            return -Math.pow(2, 10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI);\n        },\n        Out: function (amount) {\n            if (amount === 0) {\n                return 0;\n            }\n            if (amount === 1) {\n                return 1;\n            }\n            return Math.pow(2, -10 * amount) * Math.sin((amount - 0.1) * 5 * Math.PI) + 1;\n        },\n        InOut: function (amount) {\n            if (amount === 0) {\n                return 0;\n            }\n            if (amount === 1) {\n                return 1;\n            }\n            amount *= 2;\n            if (amount < 1) {\n                return -0.5 * Math.pow(2, 10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI);\n            }\n            return 0.5 * Math.pow(2, -10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI) + 1;\n        },\n    }),\n    Back: Object.freeze({\n        In: function (amount) {\n            var s = 1.70158;\n            return amount === 1 ? 1 : amount * amount * ((s + 1) * amount - s);\n        },\n        Out: function (amount) {\n            var s = 1.70158;\n            return amount === 0 ? 0 : --amount * amount * ((s + 1) * amount + s) + 1;\n        },\n        InOut: function (amount) {\n            var s = 1.70158 * 1.525;\n            if ((amount *= 2) < 1) {\n                return 0.5 * (amount * amount * ((s + 1) * amount - s));\n            }\n            return 0.5 * ((amount -= 2) * amount * ((s + 1) * amount + s) + 2);\n        },\n    }),\n    Bounce: Object.freeze({\n        In: function (amount) {\n            return 1 - Easing.Bounce.Out(1 - amount);\n        },\n        Out: function (amount) {\n            if (amount < 1 / 2.75) {\n                return 7.5625 * amount * amount;\n            }\n            else if (amount < 2 / 2.75) {\n                return 7.5625 * (amount -= 1.5 / 2.75) * amount + 0.75;\n            }\n            else if (amount < 2.5 / 2.75) {\n                return 7.5625 * (amount -= 2.25 / 2.75) * amount + 0.9375;\n            }\n            else {\n                return 7.5625 * (amount -= 2.625 / 2.75) * amount + 0.984375;\n            }\n        },\n        InOut: function (amount) {\n            if (amount < 0.5) {\n                return Easing.Bounce.In(amount * 2) * 0.5;\n            }\n            return Easing.Bounce.Out(amount * 2 - 1) * 0.5 + 0.5;\n        },\n    }),\n    generatePow: function (power) {\n        if (power === void 0) { power = 4; }\n        power = power < Number.EPSILON ? Number.EPSILON : power;\n        power = power > 10000 ? 10000 : power;\n        return {\n            In: function (amount) {\n                return Math.pow(amount, power);\n            },\n            Out: function (amount) {\n                return 1 - Math.pow((1 - amount), power);\n            },\n            InOut: function (amount) {\n                if (amount < 0.5) {\n                    return Math.pow((amount * 2), power) / 2;\n                }\n                return (1 - Math.pow((2 - amount * 2), power)) / 2 + 0.5;\n            },\n        };\n    },\n});\n\nvar now = function () { return performance.now(); };\n\n/**\n * Controlling groups of tweens\n *\n * Using the TWEEN singleton to manage your tweens can cause issues in large apps with many components.\n * In these cases, you may want to create your own smaller groups of tween\n */\nvar Group = /** @class */ (function () {\n    function Group() {\n        this._tweens = {};\n        this._tweensAddedDuringUpdate = {};\n    }\n    Group.prototype.getAll = function () {\n        var _this = this;\n        return Object.keys(this._tweens).map(function (tweenId) {\n            return _this._tweens[tweenId];\n        });\n    };\n    Group.prototype.removeAll = function () {\n        this._tweens = {};\n    };\n    Group.prototype.add = function (tween) {\n        this._tweens[tween.getId()] = tween;\n        this._tweensAddedDuringUpdate[tween.getId()] = tween;\n    };\n    Group.prototype.remove = function (tween) {\n        delete this._tweens[tween.getId()];\n        delete this._tweensAddedDuringUpdate[tween.getId()];\n    };\n    Group.prototype.update = function (time, preserve) {\n        if (time === void 0) { time = now(); }\n        if (preserve === void 0) { preserve = false; }\n        var tweenIds = Object.keys(this._tweens);\n        if (tweenIds.length === 0) {\n            return false;\n        }\n        // Tweens are updated in \"batches\". If you add a new tween during an\n        // update, then the new tween will be updated in the next batch.\n        // If you remove a tween during an update, it may or may not be updated.\n        // However, if the removed tween was added during the current batch,\n        // then it will not be updated.\n        while (tweenIds.length > 0) {\n            this._tweensAddedDuringUpdate = {};\n            for (var i = 0; i < tweenIds.length; i++) {\n                var tween = this._tweens[tweenIds[i]];\n                var autoStart = !preserve;\n                if (tween && tween.update(time, autoStart) === false && !preserve) {\n                    delete this._tweens[tweenIds[i]];\n                }\n            }\n            tweenIds = Object.keys(this._tweensAddedDuringUpdate);\n        }\n        return true;\n    };\n    return Group;\n}());\n\n/**\n *\n */\nvar Interpolation = {\n    Linear: function (v, k) {\n        var m = v.length - 1;\n        var f = m * k;\n        var i = Math.floor(f);\n        var fn = Interpolation.Utils.Linear;\n        if (k < 0) {\n            return fn(v[0], v[1], f);\n        }\n        if (k > 1) {\n            return fn(v[m], v[m - 1], m - f);\n        }\n        return fn(v[i], v[i + 1 > m ? m : i + 1], f - i);\n    },\n    Bezier: function (v, k) {\n        var b = 0;\n        var n = v.length - 1;\n        var pw = Math.pow;\n        var bn = Interpolation.Utils.Bernstein;\n        for (var i = 0; i <= n; i++) {\n            b += pw(1 - k, n - i) * pw(k, i) * v[i] * bn(n, i);\n        }\n        return b;\n    },\n    CatmullRom: function (v, k) {\n        var m = v.length - 1;\n        var f = m * k;\n        var i = Math.floor(f);\n        var fn = Interpolation.Utils.CatmullRom;\n        if (v[0] === v[m]) {\n            if (k < 0) {\n                i = Math.floor((f = m * (1 + k)));\n            }\n            return fn(v[(i - 1 + m) % m], v[i], v[(i + 1) % m], v[(i + 2) % m], f - i);\n        }\n        else {\n            if (k < 0) {\n                return v[0] - (fn(v[0], v[0], v[1], v[1], -f) - v[0]);\n            }\n            if (k > 1) {\n                return v[m] - (fn(v[m], v[m], v[m - 1], v[m - 1], f - m) - v[m]);\n            }\n            return fn(v[i ? i - 1 : 0], v[i], v[m < i + 1 ? m : i + 1], v[m < i + 2 ? m : i + 2], f - i);\n        }\n    },\n    Utils: {\n        Linear: function (p0, p1, t) {\n            return (p1 - p0) * t + p0;\n        },\n        Bernstein: function (n, i) {\n            var fc = Interpolation.Utils.Factorial;\n            return fc(n) / fc(i) / fc(n - i);\n        },\n        Factorial: (function () {\n            var a = [1];\n            return function (n) {\n                var s = 1;\n                if (a[n]) {\n                    return a[n];\n                }\n                for (var i = n; i > 1; i--) {\n                    s *= i;\n                }\n                a[n] = s;\n                return s;\n            };\n        })(),\n        CatmullRom: function (p0, p1, p2, p3, t) {\n            var v0 = (p2 - p0) * 0.5;\n            var v1 = (p3 - p1) * 0.5;\n            var t2 = t * t;\n            var t3 = t * t2;\n            return (2 * p1 - 2 * p2 + v0 + v1) * t3 + (-3 * p1 + 3 * p2 - 2 * v0 - v1) * t2 + v0 * t + p1;\n        },\n    },\n};\n\n/**\n * Utils\n */\nvar Sequence = /** @class */ (function () {\n    function Sequence() {\n    }\n    Sequence.nextId = function () {\n        return Sequence._nextId++;\n    };\n    Sequence._nextId = 0;\n    return Sequence;\n}());\n\nvar mainGroup = new Group();\n\n/**\n * Tween.js - Licensed under the MIT license\n * https://github.com/tweenjs/tween.js\n * ----------------------------------------------\n *\n * See https://github.com/tweenjs/tween.js/graphs/contributors for the full list of contributors.\n * Thank you all, you're awesome!\n */\nvar Tween = /** @class */ (function () {\n    function Tween(_object, _group) {\n        if (_group === void 0) { _group = mainGroup; }\n        this._object = _object;\n        this._group = _group;\n        this._isPaused = false;\n        this._pauseStart = 0;\n        this._valuesStart = {};\n        this._valuesEnd = {};\n        this._valuesStartRepeat = {};\n        this._duration = 1000;\n        this._isDynamic = false;\n        this._initialRepeat = 0;\n        this._repeat = 0;\n        this._yoyo = false;\n        this._isPlaying = false;\n        this._reversed = false;\n        this._delayTime = 0;\n        this._startTime = 0;\n        this._easingFunction = Easing.Linear.None;\n        this._interpolationFunction = Interpolation.Linear;\n        // eslint-disable-next-line\n        this._chainedTweens = [];\n        this._onStartCallbackFired = false;\n        this._onEveryStartCallbackFired = false;\n        this._id = Sequence.nextId();\n        this._isChainStopped = false;\n        this._propertiesAreSetUp = false;\n        this._goToEnd = false;\n    }\n    Tween.prototype.getId = function () {\n        return this._id;\n    };\n    Tween.prototype.isPlaying = function () {\n        return this._isPlaying;\n    };\n    Tween.prototype.isPaused = function () {\n        return this._isPaused;\n    };\n    Tween.prototype.getDuration = function () {\n        return this._duration;\n    };\n    Tween.prototype.to = function (target, duration) {\n        if (duration === void 0) { duration = 1000; }\n        if (this._isPlaying)\n            throw new Error('Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.');\n        this._valuesEnd = target;\n        this._propertiesAreSetUp = false;\n        this._duration = duration < 0 ? 0 : duration;\n        return this;\n    };\n    Tween.prototype.duration = function (duration) {\n        if (duration === void 0) { duration = 1000; }\n        this._duration = duration < 0 ? 0 : duration;\n        return this;\n    };\n    Tween.prototype.dynamic = function (dynamic) {\n        if (dynamic === void 0) { dynamic = false; }\n        this._isDynamic = dynamic;\n        return this;\n    };\n    Tween.prototype.start = function (time, overrideStartingValues) {\n        if (time === void 0) { time = now(); }\n        if (overrideStartingValues === void 0) { overrideStartingValues = false; }\n        if (this._isPlaying) {\n            return this;\n        }\n        // eslint-disable-next-line\n        this._group && this._group.add(this);\n        this._repeat = this._initialRepeat;\n        if (this._reversed) {\n            // If we were reversed (f.e. using the yoyo feature) then we need to\n            // flip the tween direction back to forward.\n            this._reversed = false;\n            for (var property in this._valuesStartRepeat) {\n                this._swapEndStartRepeatValues(property);\n                this._valuesStart[property] = this._valuesStartRepeat[property];\n            }\n        }\n        this._isPlaying = true;\n        this._isPaused = false;\n        this._onStartCallbackFired = false;\n        this._onEveryStartCallbackFired = false;\n        this._isChainStopped = false;\n        this._startTime = time;\n        this._startTime += this._delayTime;\n        if (!this._propertiesAreSetUp || overrideStartingValues) {\n            this._propertiesAreSetUp = true;\n            // If dynamic is not enabled, clone the end values instead of using the passed-in end values.\n            if (!this._isDynamic) {\n                var tmp = {};\n                for (var prop in this._valuesEnd)\n                    tmp[prop] = this._valuesEnd[prop];\n                this._valuesEnd = tmp;\n            }\n            this._setupProperties(this._object, this._valuesStart, this._valuesEnd, this._valuesStartRepeat, overrideStartingValues);\n        }\n        return this;\n    };\n    Tween.prototype.startFromCurrentValues = function (time) {\n        return this.start(time, true);\n    };\n    Tween.prototype._setupProperties = function (_object, _valuesStart, _valuesEnd, _valuesStartRepeat, overrideStartingValues) {\n        for (var property in _valuesEnd) {\n            var startValue = _object[property];\n            var startValueIsArray = Array.isArray(startValue);\n            var propType = startValueIsArray ? 'array' : typeof startValue;\n            var isInterpolationList = !startValueIsArray && Array.isArray(_valuesEnd[property]);\n            // If `to()` specifies a property that doesn't exist in the source object,\n            // we should not set that property in the object\n            if (propType === 'undefined' || propType === 'function') {\n                continue;\n            }\n            // Check if an Array was provided as property value\n            if (isInterpolationList) {\n                var endValues = _valuesEnd[property];\n                if (endValues.length === 0) {\n                    continue;\n                }\n                // Handle an array of relative values.\n                // Creates a local copy of the Array with the start value at the front\n                var temp = [startValue];\n                for (var i = 0, l = endValues.length; i < l; i += 1) {\n                    var value = this._handleRelativeValue(startValue, endValues[i]);\n                    if (isNaN(value)) {\n                        isInterpolationList = false;\n                        console.warn('Found invalid interpolation list. Skipping.');\n                        break;\n                    }\n                    temp.push(value);\n                }\n                if (isInterpolationList) {\n                    // if (_valuesStart[property] === undefined) { // handle end values only the first time. NOT NEEDED? setupProperties is now guarded by _propertiesAreSetUp.\n                    _valuesEnd[property] = temp;\n                    // }\n                }\n            }\n            // handle the deepness of the values\n            if ((propType === 'object' || startValueIsArray) && startValue && !isInterpolationList) {\n                _valuesStart[property] = startValueIsArray ? [] : {};\n                var nestedObject = startValue;\n                for (var prop in nestedObject) {\n                    _valuesStart[property][prop] = nestedObject[prop];\n                }\n                // TODO? repeat nested values? And yoyo? And array values?\n                _valuesStartRepeat[property] = startValueIsArray ? [] : {};\n                var endValues = _valuesEnd[property];\n                // If dynamic is not enabled, clone the end values instead of using the passed-in end values.\n                if (!this._isDynamic) {\n                    var tmp = {};\n                    for (var prop in endValues)\n                        tmp[prop] = endValues[prop];\n                    _valuesEnd[property] = endValues = tmp;\n                }\n                this._setupProperties(nestedObject, _valuesStart[property], endValues, _valuesStartRepeat[property], overrideStartingValues);\n            }\n            else {\n                // Save the starting value, but only once unless override is requested.\n                if (typeof _valuesStart[property] === 'undefined' || overrideStartingValues) {\n                    _valuesStart[property] = startValue;\n                }\n                if (!startValueIsArray) {\n                    // eslint-disable-next-line\n                    // @ts-ignore FIXME?\n                    _valuesStart[property] *= 1.0; // Ensures we're using numbers, not strings\n                }\n                if (isInterpolationList) {\n                    // eslint-disable-next-line\n                    // @ts-ignore FIXME?\n                    _valuesStartRepeat[property] = _valuesEnd[property].slice().reverse();\n                }\n                else {\n                    _valuesStartRepeat[property] = _valuesStart[property] || 0;\n                }\n            }\n        }\n    };\n    Tween.prototype.stop = function () {\n        if (!this._isChainStopped) {\n            this._isChainStopped = true;\n            this.stopChainedTweens();\n        }\n        if (!this._isPlaying) {\n            return this;\n        }\n        // eslint-disable-next-line\n        this._group && this._group.remove(this);\n        this._isPlaying = false;\n        this._isPaused = false;\n        if (this._onStopCallback) {\n            this._onStopCallback(this._object);\n        }\n        return this;\n    };\n    Tween.prototype.end = function () {\n        this._goToEnd = true;\n        this.update(Infinity);\n        return this;\n    };\n    Tween.prototype.pause = function (time) {\n        if (time === void 0) { time = now(); }\n        if (this._isPaused || !this._isPlaying) {\n            return this;\n        }\n        this._isPaused = true;\n        this._pauseStart = time;\n        // eslint-disable-next-line\n        this._group && this._group.remove(this);\n        return this;\n    };\n    Tween.prototype.resume = function (time) {\n        if (time === void 0) { time = now(); }\n        if (!this._isPaused || !this._isPlaying) {\n            return this;\n        }\n        this._isPaused = false;\n        this._startTime += time - this._pauseStart;\n        this._pauseStart = 0;\n        // eslint-disable-next-line\n        this._group && this._group.add(this);\n        return this;\n    };\n    Tween.prototype.stopChainedTweens = function () {\n        for (var i = 0, numChainedTweens = this._chainedTweens.length; i < numChainedTweens; i++) {\n            this._chainedTweens[i].stop();\n        }\n        return this;\n    };\n    Tween.prototype.group = function (group) {\n        if (group === void 0) { group = mainGroup; }\n        this._group = group;\n        return this;\n    };\n    Tween.prototype.delay = function (amount) {\n        if (amount === void 0) { amount = 0; }\n        this._delayTime = amount;\n        return this;\n    };\n    Tween.prototype.repeat = function (times) {\n        if (times === void 0) { times = 0; }\n        this._initialRepeat = times;\n        this._repeat = times;\n        return this;\n    };\n    Tween.prototype.repeatDelay = function (amount) {\n        this._repeatDelayTime = amount;\n        return this;\n    };\n    Tween.prototype.yoyo = function (yoyo) {\n        if (yoyo === void 0) { yoyo = false; }\n        this._yoyo = yoyo;\n        return this;\n    };\n    Tween.prototype.easing = function (easingFunction) {\n        if (easingFunction === void 0) { easingFunction = Easing.Linear.None; }\n        this._easingFunction = easingFunction;\n        return this;\n    };\n    Tween.prototype.interpolation = function (interpolationFunction) {\n        if (interpolationFunction === void 0) { interpolationFunction = Interpolation.Linear; }\n        this._interpolationFunction = interpolationFunction;\n        return this;\n    };\n    // eslint-disable-next-line\n    Tween.prototype.chain = function () {\n        var tweens = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            tweens[_i] = arguments[_i];\n        }\n        this._chainedTweens = tweens;\n        return this;\n    };\n    Tween.prototype.onStart = function (callback) {\n        this._onStartCallback = callback;\n        return this;\n    };\n    Tween.prototype.onEveryStart = function (callback) {\n        this._onEveryStartCallback = callback;\n        return this;\n    };\n    Tween.prototype.onUpdate = function (callback) {\n        this._onUpdateCallback = callback;\n        return this;\n    };\n    Tween.prototype.onRepeat = function (callback) {\n        this._onRepeatCallback = callback;\n        return this;\n    };\n    Tween.prototype.onComplete = function (callback) {\n        this._onCompleteCallback = callback;\n        return this;\n    };\n    Tween.prototype.onStop = function (callback) {\n        this._onStopCallback = callback;\n        return this;\n    };\n    /**\n     * @returns true if the tween is still playing after the update, false\n     * otherwise (calling update on a paused tween still returns true because\n     * it is still playing, just paused).\n     */\n    Tween.prototype.update = function (time, autoStart) {\n        var _this = this;\n        var _a;\n        if (time === void 0) { time = now(); }\n        if (autoStart === void 0) { autoStart = true; }\n        if (this._isPaused)\n            return true;\n        var property;\n        var endTime = this._startTime + this._duration;\n        if (!this._goToEnd && !this._isPlaying) {\n            if (time > endTime)\n                return false;\n            if (autoStart)\n                this.start(time, true);\n        }\n        this._goToEnd = false;\n        if (time < this._startTime) {\n            return true;\n        }\n        if (this._onStartCallbackFired === false) {\n            if (this._onStartCallback) {\n                this._onStartCallback(this._object);\n            }\n            this._onStartCallbackFired = true;\n        }\n        if (this._onEveryStartCallbackFired === false) {\n            if (this._onEveryStartCallback) {\n                this._onEveryStartCallback(this._object);\n            }\n            this._onEveryStartCallbackFired = true;\n        }\n        var elapsedTime = time - this._startTime;\n        var durationAndDelay = this._duration + ((_a = this._repeatDelayTime) !== null && _a !== void 0 ? _a : this._delayTime);\n        var totalTime = this._duration + this._repeat * durationAndDelay;\n        var calculateElapsedPortion = function () {\n            if (_this._duration === 0)\n                return 1;\n            if (elapsedTime > totalTime) {\n                return 1;\n            }\n            var timesRepeated = Math.trunc(elapsedTime / durationAndDelay);\n            var timeIntoCurrentRepeat = elapsedTime - timesRepeated * durationAndDelay;\n            // TODO use %?\n            // const timeIntoCurrentRepeat = elapsedTime % durationAndDelay\n            var portion = Math.min(timeIntoCurrentRepeat / _this._duration, 1);\n            if (portion === 0 && elapsedTime === _this._duration) {\n                return 1;\n            }\n            return portion;\n        };\n        var elapsed = calculateElapsedPortion();\n        var value = this._easingFunction(elapsed);\n        // properties transformations\n        this._updateProperties(this._object, this._valuesStart, this._valuesEnd, value);\n        if (this._onUpdateCallback) {\n            this._onUpdateCallback(this._object, elapsed);\n        }\n        if (this._duration === 0 || elapsedTime >= this._duration) {\n            if (this._repeat > 0) {\n                var completeCount = Math.min(Math.trunc((elapsedTime - this._duration) / durationAndDelay) + 1, this._repeat);\n                if (isFinite(this._repeat)) {\n                    this._repeat -= completeCount;\n                }\n                // Reassign starting values, restart by making startTime = now\n                for (property in this._valuesStartRepeat) {\n                    if (!this._yoyo && typeof this._valuesEnd[property] === 'string') {\n                        this._valuesStartRepeat[property] =\n                            // eslint-disable-next-line\n                            // @ts-ignore FIXME?\n                            this._valuesStartRepeat[property] + parseFloat(this._valuesEnd[property]);\n                    }\n                    if (this._yoyo) {\n                        this._swapEndStartRepeatValues(property);\n                    }\n                    this._valuesStart[property] = this._valuesStartRepeat[property];\n                }\n                if (this._yoyo) {\n                    this._reversed = !this._reversed;\n                }\n                this._startTime += durationAndDelay * completeCount;\n                if (this._onRepeatCallback) {\n                    this._onRepeatCallback(this._object);\n                }\n                this._onEveryStartCallbackFired = false;\n                return true;\n            }\n            else {\n                if (this._onCompleteCallback) {\n                    this._onCompleteCallback(this._object);\n                }\n                for (var i = 0, numChainedTweens = this._chainedTweens.length; i < numChainedTweens; i++) {\n                    // Make the chained tweens start exactly at the time they should,\n                    // even if the `update()` method was called way past the duration of the tween\n                    this._chainedTweens[i].start(this._startTime + this._duration, false);\n                }\n                this._isPlaying = false;\n                return false;\n            }\n        }\n        return true;\n    };\n    Tween.prototype._updateProperties = function (_object, _valuesStart, _valuesEnd, value) {\n        for (var property in _valuesEnd) {\n            // Don't update properties that do not exist in the source object\n            if (_valuesStart[property] === undefined) {\n                continue;\n            }\n            var start = _valuesStart[property] || 0;\n            var end = _valuesEnd[property];\n            var startIsArray = Array.isArray(_object[property]);\n            var endIsArray = Array.isArray(end);\n            var isInterpolationList = !startIsArray && endIsArray;\n            if (isInterpolationList) {\n                _object[property] = this._interpolationFunction(end, value);\n            }\n            else if (typeof end === 'object' && end) {\n                // eslint-disable-next-line\n                // @ts-ignore FIXME?\n                this._updateProperties(_object[property], start, end, value);\n            }\n            else {\n                // Parses relative end values with start as base (e.g.: +10, -3)\n                end = this._handleRelativeValue(start, end);\n                // Protect against non numeric properties.\n                if (typeof end === 'number') {\n                    // eslint-disable-next-line\n                    // @ts-ignore FIXME?\n                    _object[property] = start + (end - start) * value;\n                }\n            }\n        }\n    };\n    Tween.prototype._handleRelativeValue = function (start, end) {\n        if (typeof end !== 'string') {\n            return end;\n        }\n        if (end.charAt(0) === '+' || end.charAt(0) === '-') {\n            return start + parseFloat(end);\n        }\n        return parseFloat(end);\n    };\n    Tween.prototype._swapEndStartRepeatValues = function (property) {\n        var tmp = this._valuesStartRepeat[property];\n        var endValue = this._valuesEnd[property];\n        if (typeof endValue === 'string') {\n            this._valuesStartRepeat[property] = this._valuesStartRepeat[property] + parseFloat(endValue);\n        }\n        else {\n            this._valuesStartRepeat[property] = this._valuesEnd[property];\n        }\n        this._valuesEnd[property] = tmp;\n    };\n    return Tween;\n}());\n\nvar VERSION = '23.1.1';\n\n/**\n * Tween.js - Licensed under the MIT license\n * https://github.com/tweenjs/tween.js\n * ----------------------------------------------\n *\n * See https://github.com/tweenjs/tween.js/graphs/contributors for the full list of contributors.\n * Thank you all, you're awesome!\n */\nvar nextId = Sequence.nextId;\n/**\n * Controlling groups of tweens\n *\n * Using the TWEEN singleton to manage your tweens can cause issues in large apps with many components.\n * In these cases, you may want to create your own smaller groups of tweens.\n */\nvar TWEEN = mainGroup;\n// This is the best way to export things in a way that's compatible with both ES\n// Modules and CommonJS, without build hacks, and so as not to break the\n// existing API.\n// https://github.com/rollup/rollup/issues/1961#issuecomment-423037881\nvar getAll = TWEEN.getAll.bind(TWEEN);\nvar removeAll = TWEEN.removeAll.bind(TWEEN);\nvar add = TWEEN.add.bind(TWEEN);\nvar remove = TWEEN.remove.bind(TWEEN);\nvar update = TWEEN.update.bind(TWEEN);\nvar exports = {\n    Easing: Easing,\n    Group: Group,\n    Interpolation: Interpolation,\n    now: now,\n    Sequence: Sequence,\n    nextId: nextId,\n    Tween: Tween,\n    VERSION: VERSION,\n    getAll: getAll,\n    removeAll: removeAll,\n    add: add,\n    remove: remove,\n    update: update,\n};\n\nexport { Easing, Group, Interpolation, Sequence, Tween, VERSION, add, exports as default, getAll, nextId, now, remove, removeAll, update };\n","// Async loaders for Three.js and Rapier\nimport { update as updateTween, Easing, Tween } from 'three/examples/jsm/libs/tween.module.js';\n// Export for direct use\nexport { updateTween, Easing, Tween };\nlet loadedTHREE = null;\nlet loadedRAPER = null;\nlet rapierInitialized = false;\n/**\n * Asynchronously loads Three.js \n * @returns {Promise<Object>} The THREE module\n */\nexport async function load_three() {\n\tif (!loadedTHREE) {\n\t\tconst threeModule = await import('three');\n\t\tloadedTHREE = { \n\t\t\tTHREE: threeModule\n\t\t};\n\t}\n\treturn loadedTHREE;\n}\n/**\n * Asynchronously loads RAPIER physics engine\n * @returns {Promise<Object>} The RAPIER module\n */\nexport async function load_rapier() {\n\tif (!loadedRAPER) {\n\t\tconst RAPIER = await import('@dimforge/rapier3d-compat');\n\t\tloadedRAPER = RAPIER;\n\t}\n\treturn loadedRAPER;\n}\n/**\n * Ensures RAPIER is loaded and initialized\n * @returns {Promise<Object>} The initialized RAPIER module\n */\nexport async function ensure_rapier_initialized() {\n\tconst RAPIER = await load_rapier();\n\tif (!rapierInitialized) {\n\t\tawait RAPIER.init();\n\t\trapierInitialized = true;\n\t}\n\treturn RAPIER;\n} ","// Proxy implementation for lazy-loading RAPIER\nimport { load_rapier, ensure_rapier_initialized } from './loaders.js';\n// Track module state\nlet rapierModule = null;\nlet isInitialized = false;\nlet initPromise = null;\n/**\n * Creates a proxy for the RAPIER module that lazily loads the actual module\n */\nexport function createRapierProxy() {\n\t// Create a handler proxy that forwards all property access to the real module\n\treturn new Proxy({\n\t\t// Special method to initialize the module\n\t\tinit: async function() {\n\t\t\tif (initPromise) return initPromise;\n\t\t\tinitPromise = (async () => {\n\t\t\t\tconst module = await ensure_rapier_initialized();\n\t\t\t\trapierModule = module;\n\t\t\t\tisInitialized = true;\n\t\t\t\treturn module;\n\t\t\t})();\n\t\t\treturn initPromise;\n\t\t}\n\t}, {\n\t\t// Handle property access\n\t\tget(target, prop) {\n\t\t\t// Special case for init method\n\t\t\tif (prop === 'init') {\n\t\t\t\treturn target.init;\n\t\t\t}\n\t\t\t// Block access until initialized\n\t\t\tif (!isInitialized) {\n\t\t\t\tif (typeof prop === 'symbol' || prop === 'then' || prop === 'catch') {\n\t\t\t\t\t// Handle special JS properties to avoid errors\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\tthrow new Error(`RAPIER.${String(prop)} cannot be accessed before initialization. Call initRapier() first.`);\n\t\t\t}\n\t\t\t// Forward to the real module\n\t\t\treturn rapierModule[prop];\n\t\t}\n\t});\n} ","// Proxy implementation for lazy-loading THREE\nimport { load_three } from './loaders.js';\n// Track module state\nlet threeModule = null;\nlet isInitialized = false;\nlet initPromise = null;\n/**\n * Creates a proxy for the THREE module that lazily loads the actual module\n */\nexport function createThreeProxy() {\n\t// Create a handler proxy that forwards all property access to the real module\n\treturn new Proxy({\n\t\t// Special method to initialize the module\n\t\tinit: async function() {\n\t\t\tif (initPromise) return initPromise;\n\t\t\tinitPromise = (async () => {\n\t\t\t\tconst module = await load_three();\n\t\t\t\tthreeModule = module.THREE;\n\t\t\t\tisInitialized = true;\n\t\t\t\treturn threeModule;\n\t\t\t})();\n\t\t\treturn initPromise;\n\t\t}\n\t}, {\n\t\t// Handle property access\n\t\tget(target, prop) {\n\t\t\t// Special case for init method\n\t\t\tif (prop === 'init') {\n\t\t\t\treturn target.init;\n\t\t\t}\n\t\t\t// Block access until initialized\n\t\t\tif (!isInitialized) {\n\t\t\t\tif (typeof prop === 'symbol' || prop === 'then' || prop === 'catch') {\n\t\t\t\t\t// Handle special JS properties to avoid errors\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\tthrow new Error(`THREE.${String(prop)} cannot be accessed before initialization. Call initThree() first.`);\n\t\t\t}\n\t\t\t// Forward to the real module\n\t\t\treturn threeModule[prop];\n\t\t}\n\t});\n} ","import {\n\tBufferAttribute,\n\tBufferGeometry,\n\tFloat32BufferAttribute,\n\tInstancedBufferAttribute,\n\tInterleavedBuffer,\n\tInterleavedBufferAttribute,\n\tTriangleFanDrawMode,\n\tTriangleStripDrawMode,\n\tTrianglesDrawMode,\n\tVector3,\n} from 'three';\n\nfunction computeMikkTSpaceTangents( geometry, MikkTSpace, negateSign = true ) {\n\n\tif ( ! MikkTSpace || ! MikkTSpace.isReady ) {\n\n\t\tthrow new Error( 'BufferGeometryUtils: Initialized MikkTSpace library required.' );\n\n\t}\n\n\tif ( ! geometry.hasAttribute( 'position' ) || ! geometry.hasAttribute( 'normal' ) || ! geometry.hasAttribute( 'uv' ) ) {\n\n\t\tthrow new Error( 'BufferGeometryUtils: Tangents require \"position\", \"normal\", and \"uv\" attributes.' );\n\n\t}\n\n\tfunction getAttributeArray( attribute ) {\n\n\t\tif ( attribute.normalized || attribute.isInterleavedBufferAttribute ) {\n\n\t\t\tconst dstArray = new Float32Array( attribute.count * attribute.itemSize );\n\n\t\t\tfor ( let i = 0, j = 0; i < attribute.count; i ++ ) {\n\n\t\t\t\tdstArray[ j ++ ] = attribute.getX( i );\n\t\t\t\tdstArray[ j ++ ] = attribute.getY( i );\n\n\t\t\t\tif ( attribute.itemSize > 2 ) {\n\n\t\t\t\t\tdstArray[ j ++ ] = attribute.getZ( i );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn dstArray;\n\n\t\t}\n\n\t\tif ( attribute.array instanceof Float32Array ) {\n\n\t\t\treturn attribute.array;\n\n\t\t}\n\n\t\treturn new Float32Array( attribute.array );\n\n\t}\n\n\t// MikkTSpace algorithm requires non-indexed input.\n\n\tconst _geometry = geometry.index ? geometry.toNonIndexed() : geometry;\n\n\t// Compute vertex tangents.\n\n\tconst tangents = MikkTSpace.generateTangents(\n\n\t\tgetAttributeArray( _geometry.attributes.position ),\n\t\tgetAttributeArray( _geometry.attributes.normal ),\n\t\tgetAttributeArray( _geometry.attributes.uv )\n\n\t);\n\n\t// Texture coordinate convention of glTF differs from the apparent\n\t// default of the MikkTSpace library; .w component must be flipped.\n\n\tif ( negateSign ) {\n\n\t\tfor ( let i = 3; i < tangents.length; i += 4 ) {\n\n\t\t\ttangents[ i ] *= - 1;\n\n\t\t}\n\n\t}\n\n\t//\n\n\t_geometry.setAttribute( 'tangent', new BufferAttribute( tangents, 4 ) );\n\n\tif ( geometry !== _geometry ) {\n\n\t\tgeometry.copy( _geometry );\n\n\t}\n\n\treturn geometry;\n\n}\n\n/**\n * @param  {Array<BufferGeometry>} geometries\n * @param  {Boolean} useGroups\n * @return {BufferGeometry}\n */\nfunction mergeGeometries( geometries, useGroups = false ) {\n\n\tconst isIndexed = geometries[ 0 ].index !== null;\n\n\tconst attributesUsed = new Set( Object.keys( geometries[ 0 ].attributes ) );\n\tconst morphAttributesUsed = new Set( Object.keys( geometries[ 0 ].morphAttributes ) );\n\n\tconst attributes = {};\n\tconst morphAttributes = {};\n\n\tconst morphTargetsRelative = geometries[ 0 ].morphTargetsRelative;\n\n\tconst mergedGeometry = new BufferGeometry();\n\n\tlet offset = 0;\n\n\tfor ( let i = 0; i < geometries.length; ++ i ) {\n\n\t\tconst geometry = geometries[ i ];\n\t\tlet attributesCount = 0;\n\n\t\t// ensure that all geometries are indexed, or none\n\n\t\tif ( isIndexed !== ( geometry.index !== null ) ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\t// gather attributes, exit early if they're different\n\n\t\tfor ( const name in geometry.attributes ) {\n\n\t\t\tif ( ! attributesUsed.has( name ) ) {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. All geometries must have compatible attributes; make sure \"' + name + '\" attribute exists among all geometries, or in none of them.' );\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t\tif ( attributes[ name ] === undefined ) attributes[ name ] = [];\n\n\t\t\tattributes[ name ].push( geometry.attributes[ name ] );\n\n\t\t\tattributesCount ++;\n\n\t\t}\n\n\t\t// ensure geometries have the same number of attributes\n\n\t\tif ( attributesCount !== attributesUsed.size ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. Make sure all geometries have the same number of attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\t// gather morph attributes, exit early if they're different\n\n\t\tif ( morphTargetsRelative !== geometry.morphTargetsRelative ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. .morphTargetsRelative must be consistent throughout all geometries.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tfor ( const name in geometry.morphAttributes ) {\n\n\t\t\tif ( ! morphAttributesUsed.has( name ) ) {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '.  .morphAttributes must be consistent throughout all geometries.' );\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t\tif ( morphAttributes[ name ] === undefined ) morphAttributes[ name ] = [];\n\n\t\t\tmorphAttributes[ name ].push( geometry.morphAttributes[ name ] );\n\n\t\t}\n\n\t\tif ( useGroups ) {\n\n\t\t\tlet count;\n\n\t\t\tif ( isIndexed ) {\n\n\t\t\t\tcount = geometry.index.count;\n\n\t\t\t} else if ( geometry.attributes.position !== undefined ) {\n\n\t\t\t\tcount = geometry.attributes.position.count;\n\n\t\t\t} else {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. The geometry must have either an index or a position attribute' );\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t\tmergedGeometry.addGroup( offset, count, i );\n\n\t\t\toffset += count;\n\n\t\t}\n\n\t}\n\n\t// merge indices\n\n\tif ( isIndexed ) {\n\n\t\tlet indexOffset = 0;\n\t\tconst mergedIndex = [];\n\n\t\tfor ( let i = 0; i < geometries.length; ++ i ) {\n\n\t\t\tconst index = geometries[ i ].index;\n\n\t\t\tfor ( let j = 0; j < index.count; ++ j ) {\n\n\t\t\t\tmergedIndex.push( index.getX( j ) + indexOffset );\n\n\t\t\t}\n\n\t\t\tindexOffset += geometries[ i ].attributes.position.count;\n\n\t\t}\n\n\t\tmergedGeometry.setIndex( mergedIndex );\n\n\t}\n\n\t// merge attributes\n\n\tfor ( const name in attributes ) {\n\n\t\tconst mergedAttribute = mergeAttributes( attributes[ name ] );\n\n\t\tif ( ! mergedAttribute ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the ' + name + ' attribute.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tmergedGeometry.setAttribute( name, mergedAttribute );\n\n\t}\n\n\t// merge morph attributes\n\n\tfor ( const name in morphAttributes ) {\n\n\t\tconst numMorphTargets = morphAttributes[ name ][ 0 ].length;\n\n\t\tif ( numMorphTargets === 0 ) break;\n\n\t\tmergedGeometry.morphAttributes = mergedGeometry.morphAttributes || {};\n\t\tmergedGeometry.morphAttributes[ name ] = [];\n\n\t\tfor ( let i = 0; i < numMorphTargets; ++ i ) {\n\n\t\t\tconst morphAttributesToMerge = [];\n\n\t\t\tfor ( let j = 0; j < morphAttributes[ name ].length; ++ j ) {\n\n\t\t\t\tmorphAttributesToMerge.push( morphAttributes[ name ][ j ][ i ] );\n\n\t\t\t}\n\n\t\t\tconst mergedMorphAttribute = mergeAttributes( morphAttributesToMerge );\n\n\t\t\tif ( ! mergedMorphAttribute ) {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the ' + name + ' morphAttribute.' );\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t\tmergedGeometry.morphAttributes[ name ].push( mergedMorphAttribute );\n\n\t\t}\n\n\t}\n\n\treturn mergedGeometry;\n\n}\n\n/**\n * @param {Array<BufferAttribute>} attributes\n * @return {BufferAttribute}\n */\nfunction mergeAttributes( attributes ) {\n\n\tlet TypedArray;\n\tlet itemSize;\n\tlet normalized;\n\tlet gpuType = - 1;\n\tlet arrayLength = 0;\n\n\tfor ( let i = 0; i < attributes.length; ++ i ) {\n\n\t\tconst attribute = attributes[ i ];\n\n\t\tif ( TypedArray === undefined ) TypedArray = attribute.array.constructor;\n\t\tif ( TypedArray !== attribute.array.constructor ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tif ( itemSize === undefined ) itemSize = attribute.itemSize;\n\t\tif ( itemSize !== attribute.itemSize ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tif ( normalized === undefined ) normalized = attribute.normalized;\n\t\tif ( normalized !== attribute.normalized ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tif ( gpuType === - 1 ) gpuType = attribute.gpuType;\n\t\tif ( gpuType !== attribute.gpuType ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tarrayLength += attribute.count * itemSize;\n\n\t}\n\n\tconst array = new TypedArray( arrayLength );\n\tconst result = new BufferAttribute( array, itemSize, normalized );\n\tlet offset = 0;\n\n\tfor ( let i = 0; i < attributes.length; ++ i ) {\n\n\t\tconst attribute = attributes[ i ];\n\t\tif ( attribute.isInterleavedBufferAttribute ) {\n\n\t\t\tconst tupleOffset = offset / itemSize;\n\t\t\tfor ( let j = 0, l = attribute.count; j < l; j ++ ) {\n\n\t\t\t\tfor ( let c = 0; c < itemSize; c ++ ) {\n\n\t\t\t\t\tconst value = attribute.getComponent( j, c );\n\t\t\t\t\tresult.setComponent( j + tupleOffset, c, value );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tarray.set( attribute.array, offset );\n\n\t\t}\n\n\t\toffset += attribute.count * itemSize;\n\n\t}\n\n\tif ( gpuType !== undefined ) {\n\n\t\tresult.gpuType = gpuType;\n\n\t}\n\n\treturn result;\n\n}\n\n/**\n * @param {BufferAttribute} attribute\n * @return {BufferAttribute}\n */\nexport function deepCloneAttribute( attribute ) {\n\n\tif ( attribute.isInstancedInterleavedBufferAttribute || attribute.isInterleavedBufferAttribute ) {\n\n\t\treturn deinterleaveAttribute( attribute );\n\n\t}\n\n\tif ( attribute.isInstancedBufferAttribute ) {\n\n\t\treturn new InstancedBufferAttribute().copy( attribute );\n\n\t}\n\n\treturn new BufferAttribute().copy( attribute );\n\n}\n\n/**\n * @param {Array<BufferAttribute>} attributes\n * @return {Array<InterleavedBufferAttribute>}\n */\nfunction interleaveAttributes( attributes ) {\n\n\t// Interleaves the provided attributes into an InterleavedBuffer and returns\n\t// a set of InterleavedBufferAttributes for each attribute\n\tlet TypedArray;\n\tlet arrayLength = 0;\n\tlet stride = 0;\n\n\t// calculate the length and type of the interleavedBuffer\n\tfor ( let i = 0, l = attributes.length; i < l; ++ i ) {\n\n\t\tconst attribute = attributes[ i ];\n\n\t\tif ( TypedArray === undefined ) TypedArray = attribute.array.constructor;\n\t\tif ( TypedArray !== attribute.array.constructor ) {\n\n\t\t\tconsole.error( 'AttributeBuffers of different types cannot be interleaved' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tarrayLength += attribute.array.length;\n\t\tstride += attribute.itemSize;\n\n\t}\n\n\t// Create the set of buffer attributes\n\tconst interleavedBuffer = new InterleavedBuffer( new TypedArray( arrayLength ), stride );\n\tlet offset = 0;\n\tconst res = [];\n\tconst getters = [ 'getX', 'getY', 'getZ', 'getW' ];\n\tconst setters = [ 'setX', 'setY', 'setZ', 'setW' ];\n\n\tfor ( let j = 0, l = attributes.length; j < l; j ++ ) {\n\n\t\tconst attribute = attributes[ j ];\n\t\tconst itemSize = attribute.itemSize;\n\t\tconst count = attribute.count;\n\t\tconst iba = new InterleavedBufferAttribute( interleavedBuffer, itemSize, offset, attribute.normalized );\n\t\tres.push( iba );\n\n\t\toffset += itemSize;\n\n\t\t// Move the data for each attribute into the new interleavedBuffer\n\t\t// at the appropriate offset\n\t\tfor ( let c = 0; c < count; c ++ ) {\n\n\t\t\tfor ( let k = 0; k < itemSize; k ++ ) {\n\n\t\t\t\tiba[ setters[ k ] ]( c, attribute[ getters[ k ] ]( c ) );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\treturn res;\n\n}\n\n// returns a new, non-interleaved version of the provided attribute\nexport function deinterleaveAttribute( attribute ) {\n\n\tconst cons = attribute.data.array.constructor;\n\tconst count = attribute.count;\n\tconst itemSize = attribute.itemSize;\n\tconst normalized = attribute.normalized;\n\n\tconst array = new cons( count * itemSize );\n\tlet newAttribute;\n\tif ( attribute.isInstancedInterleavedBufferAttribute ) {\n\n\t\tnewAttribute = new InstancedBufferAttribute( array, itemSize, normalized, attribute.meshPerAttribute );\n\n\t} else {\n\n\t\tnewAttribute = new BufferAttribute( array, itemSize, normalized );\n\n\t}\n\n\tfor ( let i = 0; i < count; i ++ ) {\n\n\t\tnewAttribute.setX( i, attribute.getX( i ) );\n\n\t\tif ( itemSize >= 2 ) {\n\n\t\t\tnewAttribute.setY( i, attribute.getY( i ) );\n\n\t\t}\n\n\t\tif ( itemSize >= 3 ) {\n\n\t\t\tnewAttribute.setZ( i, attribute.getZ( i ) );\n\n\t\t}\n\n\t\tif ( itemSize >= 4 ) {\n\n\t\t\tnewAttribute.setW( i, attribute.getW( i ) );\n\n\t\t}\n\n\t}\n\n\treturn newAttribute;\n\n}\n\n// deinterleaves all attributes on the geometry\nexport function deinterleaveGeometry( geometry ) {\n\n\tconst attributes = geometry.attributes;\n\tconst morphTargets = geometry.morphTargets;\n\tconst attrMap = new Map();\n\n\tfor ( const key in attributes ) {\n\n\t\tconst attr = attributes[ key ];\n\t\tif ( attr.isInterleavedBufferAttribute ) {\n\n\t\t\tif ( ! attrMap.has( attr ) ) {\n\n\t\t\t\tattrMap.set( attr, deinterleaveAttribute( attr ) );\n\n\t\t\t}\n\n\t\t\tattributes[ key ] = attrMap.get( attr );\n\n\t\t}\n\n\t}\n\n\tfor ( const key in morphTargets ) {\n\n\t\tconst attr = morphTargets[ key ];\n\t\tif ( attr.isInterleavedBufferAttribute ) {\n\n\t\t\tif ( ! attrMap.has( attr ) ) {\n\n\t\t\t\tattrMap.set( attr, deinterleaveAttribute( attr ) );\n\n\t\t\t}\n\n\t\t\tmorphTargets[ key ] = attrMap.get( attr );\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * @param {BufferGeometry} geometry\n * @return {number}\n */\nfunction estimateBytesUsed( geometry ) {\n\n\t// Return the estimated memory used by this geometry in bytes\n\t// Calculate using itemSize, count, and BYTES_PER_ELEMENT to account\n\t// for InterleavedBufferAttributes.\n\tlet mem = 0;\n\tfor ( const name in geometry.attributes ) {\n\n\t\tconst attr = geometry.getAttribute( name );\n\t\tmem += attr.count * attr.itemSize * attr.array.BYTES_PER_ELEMENT;\n\n\t}\n\n\tconst indices = geometry.getIndex();\n\tmem += indices ? indices.count * indices.itemSize * indices.array.BYTES_PER_ELEMENT : 0;\n\treturn mem;\n\n}\n\n/**\n * @param {BufferGeometry} geometry\n * @param {number} tolerance\n * @return {BufferGeometry}\n */\nfunction mergeVertices( geometry, tolerance = 1e-4 ) {\n\n\ttolerance = Math.max( tolerance, Number.EPSILON );\n\n\t// Generate an index buffer if the geometry doesn't have one, or optimize it\n\t// if it's already available.\n\tconst hashToIndex = {};\n\tconst indices = geometry.getIndex();\n\tconst positions = geometry.getAttribute( 'position' );\n\tconst vertexCount = indices ? indices.count : positions.count;\n\n\t// next value for triangle indices\n\tlet nextIndex = 0;\n\n\t// attributes and new attribute arrays\n\tconst attributeNames = Object.keys( geometry.attributes );\n\tconst tmpAttributes = {};\n\tconst tmpMorphAttributes = {};\n\tconst newIndices = [];\n\tconst getters = [ 'getX', 'getY', 'getZ', 'getW' ];\n\tconst setters = [ 'setX', 'setY', 'setZ', 'setW' ];\n\n\t// Initialize the arrays, allocating space conservatively. Extra\n\t// space will be trimmed in the last step.\n\tfor ( let i = 0, l = attributeNames.length; i < l; i ++ ) {\n\n\t\tconst name = attributeNames[ i ];\n\t\tconst attr = geometry.attributes[ name ];\n\n\t\ttmpAttributes[ name ] = new attr.constructor(\n\t\t\tnew attr.array.constructor( attr.count * attr.itemSize ),\n\t\t\tattr.itemSize,\n\t\t\tattr.normalized\n\t\t);\n\n\t\tconst morphAttributes = geometry.morphAttributes[ name ];\n\t\tif ( morphAttributes ) {\n\n\t\t\tif ( ! tmpMorphAttributes[ name ] ) tmpMorphAttributes[ name ] = [];\n\t\t\tmorphAttributes.forEach( ( morphAttr, i ) => {\n\n\t\t\t\tconst array = new morphAttr.array.constructor( morphAttr.count * morphAttr.itemSize );\n\t\t\t\ttmpMorphAttributes[ name ][ i ] = new morphAttr.constructor( array, morphAttr.itemSize, morphAttr.normalized );\n\n\t\t\t} );\n\n\t\t}\n\n\t}\n\n\t// convert the error tolerance to an amount of decimal places to truncate to\n\tconst halfTolerance = tolerance * 0.5;\n\tconst exponent = Math.log10( 1 / tolerance );\n\tconst hashMultiplier = Math.pow( 10, exponent );\n\tconst hashAdditive = halfTolerance * hashMultiplier;\n\tfor ( let i = 0; i < vertexCount; i ++ ) {\n\n\t\tconst index = indices ? indices.getX( i ) : i;\n\n\t\t// Generate a hash for the vertex attributes at the current index 'i'\n\t\tlet hash = '';\n\t\tfor ( let j = 0, l = attributeNames.length; j < l; j ++ ) {\n\n\t\t\tconst name = attributeNames[ j ];\n\t\t\tconst attribute = geometry.getAttribute( name );\n\t\t\tconst itemSize = attribute.itemSize;\n\n\t\t\tfor ( let k = 0; k < itemSize; k ++ ) {\n\n\t\t\t\t// double tilde truncates the decimal value\n\t\t\t\thash += `${ ~ ~ ( attribute[ getters[ k ] ]( index ) * hashMultiplier + hashAdditive ) },`;\n\n\t\t\t}\n\n\t\t}\n\n\t\t// Add another reference to the vertex if it's already\n\t\t// used by another index\n\t\tif ( hash in hashToIndex ) {\n\n\t\t\tnewIndices.push( hashToIndex[ hash ] );\n\n\t\t} else {\n\n\t\t\t// copy data to the new index in the temporary attributes\n\t\t\tfor ( let j = 0, l = attributeNames.length; j < l; j ++ ) {\n\n\t\t\t\tconst name = attributeNames[ j ];\n\t\t\t\tconst attribute = geometry.getAttribute( name );\n\t\t\t\tconst morphAttributes = geometry.morphAttributes[ name ];\n\t\t\t\tconst itemSize = attribute.itemSize;\n\t\t\t\tconst newArray = tmpAttributes[ name ];\n\t\t\t\tconst newMorphArrays = tmpMorphAttributes[ name ];\n\n\t\t\t\tfor ( let k = 0; k < itemSize; k ++ ) {\n\n\t\t\t\t\tconst getterFunc = getters[ k ];\n\t\t\t\t\tconst setterFunc = setters[ k ];\n\t\t\t\t\tnewArray[ setterFunc ]( nextIndex, attribute[ getterFunc ]( index ) );\n\n\t\t\t\t\tif ( morphAttributes ) {\n\n\t\t\t\t\t\tfor ( let m = 0, ml = morphAttributes.length; m < ml; m ++ ) {\n\n\t\t\t\t\t\t\tnewMorphArrays[ m ][ setterFunc ]( nextIndex, morphAttributes[ m ][ getterFunc ]( index ) );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\thashToIndex[ hash ] = nextIndex;\n\t\t\tnewIndices.push( nextIndex );\n\t\t\tnextIndex ++;\n\n\t\t}\n\n\t}\n\n\t// generate result BufferGeometry\n\tconst result = geometry.clone();\n\tfor ( const name in geometry.attributes ) {\n\n\t\tconst tmpAttribute = tmpAttributes[ name ];\n\n\t\tresult.setAttribute( name, new tmpAttribute.constructor(\n\t\t\ttmpAttribute.array.slice( 0, nextIndex * tmpAttribute.itemSize ),\n\t\t\ttmpAttribute.itemSize,\n\t\t\ttmpAttribute.normalized,\n\t\t) );\n\n\t\tif ( ! ( name in tmpMorphAttributes ) ) continue;\n\n\t\tfor ( let j = 0; j < tmpMorphAttributes[ name ].length; j ++ ) {\n\n\t\t\tconst tmpMorphAttribute = tmpMorphAttributes[ name ][ j ];\n\n\t\t\tresult.morphAttributes[ name ][ j ] = new tmpMorphAttribute.constructor(\n\t\t\t\ttmpMorphAttribute.array.slice( 0, nextIndex * tmpMorphAttribute.itemSize ),\n\t\t\t\ttmpMorphAttribute.itemSize,\n\t\t\t\ttmpMorphAttribute.normalized,\n\t\t\t);\n\n\t\t}\n\n\t}\n\n\t// indices\n\n\tresult.setIndex( newIndices );\n\n\treturn result;\n\n}\n\n/**\n * @param {BufferGeometry} geometry\n * @param {number} drawMode\n * @return {BufferGeometry}\n */\nfunction toTrianglesDrawMode( geometry, drawMode ) {\n\n\tif ( drawMode === TrianglesDrawMode ) {\n\n\t\tconsole.warn( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles.' );\n\t\treturn geometry;\n\n\t}\n\n\tif ( drawMode === TriangleFanDrawMode || drawMode === TriangleStripDrawMode ) {\n\n\t\tlet index = geometry.getIndex();\n\n\t\t// generate index if not present\n\n\t\tif ( index === null ) {\n\n\t\t\tconst indices = [];\n\n\t\t\tconst position = geometry.getAttribute( 'position' );\n\n\t\t\tif ( position !== undefined ) {\n\n\t\t\t\tfor ( let i = 0; i < position.count; i ++ ) {\n\n\t\t\t\t\tindices.push( i );\n\n\t\t\t\t}\n\n\t\t\t\tgeometry.setIndex( indices );\n\t\t\t\tindex = geometry.getIndex();\n\n\t\t\t} else {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible.' );\n\t\t\t\treturn geometry;\n\n\t\t\t}\n\n\t\t}\n\n\t\t//\n\n\t\tconst numberOfTriangles = index.count - 2;\n\t\tconst newIndices = [];\n\n\t\tif ( drawMode === TriangleFanDrawMode ) {\n\n\t\t\t// gl.TRIANGLE_FAN\n\n\t\t\tfor ( let i = 1; i <= numberOfTriangles; i ++ ) {\n\n\t\t\t\tnewIndices.push( index.getX( 0 ) );\n\t\t\t\tnewIndices.push( index.getX( i ) );\n\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\t// gl.TRIANGLE_STRIP\n\n\t\t\tfor ( let i = 0; i < numberOfTriangles; i ++ ) {\n\n\t\t\t\tif ( i % 2 === 0 ) {\n\n\t\t\t\t\tnewIndices.push( index.getX( i ) );\n\t\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\n\t\t\t\t\tnewIndices.push( index.getX( i + 2 ) );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tnewIndices.push( index.getX( i + 2 ) );\n\t\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\n\t\t\t\t\tnewIndices.push( index.getX( i ) );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( ( newIndices.length / 3 ) !== numberOfTriangles ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.' );\n\n\t\t}\n\n\t\t// build final geometry\n\n\t\tconst newGeometry = geometry.clone();\n\t\tnewGeometry.setIndex( newIndices );\n\t\tnewGeometry.clearGroups();\n\n\t\treturn newGeometry;\n\n\t} else {\n\n\t\tconsole.error( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:', drawMode );\n\t\treturn geometry;\n\n\t}\n\n}\n\n/**\n * Calculates the morphed attributes of a morphed/skinned BufferGeometry.\n * Helpful for Raytracing or Decals.\n * @param {Mesh | Line | Points} object An instance of Mesh, Line or Points.\n * @return {Object} An Object with original position/normal attributes and morphed ones.\n */\nfunction computeMorphedAttributes( object ) {\n\n\tconst _vA = new Vector3();\n\tconst _vB = new Vector3();\n\tconst _vC = new Vector3();\n\n\tconst _tempA = new Vector3();\n\tconst _tempB = new Vector3();\n\tconst _tempC = new Vector3();\n\n\tconst _morphA = new Vector3();\n\tconst _morphB = new Vector3();\n\tconst _morphC = new Vector3();\n\n\tfunction _calculateMorphedAttributeData(\n\t\tobject,\n\t\tattribute,\n\t\tmorphAttribute,\n\t\tmorphTargetsRelative,\n\t\ta,\n\t\tb,\n\t\tc,\n\t\tmodifiedAttributeArray\n\t) {\n\n\t\t_vA.fromBufferAttribute( attribute, a );\n\t\t_vB.fromBufferAttribute( attribute, b );\n\t\t_vC.fromBufferAttribute( attribute, c );\n\n\t\tconst morphInfluences = object.morphTargetInfluences;\n\n\t\tif ( morphAttribute && morphInfluences ) {\n\n\t\t\t_morphA.set( 0, 0, 0 );\n\t\t\t_morphB.set( 0, 0, 0 );\n\t\t\t_morphC.set( 0, 0, 0 );\n\n\t\t\tfor ( let i = 0, il = morphAttribute.length; i < il; i ++ ) {\n\n\t\t\t\tconst influence = morphInfluences[ i ];\n\t\t\t\tconst morph = morphAttribute[ i ];\n\n\t\t\t\tif ( influence === 0 ) continue;\n\n\t\t\t\t_tempA.fromBufferAttribute( morph, a );\n\t\t\t\t_tempB.fromBufferAttribute( morph, b );\n\t\t\t\t_tempC.fromBufferAttribute( morph, c );\n\n\t\t\t\tif ( morphTargetsRelative ) {\n\n\t\t\t\t\t_morphA.addScaledVector( _tempA, influence );\n\t\t\t\t\t_morphB.addScaledVector( _tempB, influence );\n\t\t\t\t\t_morphC.addScaledVector( _tempC, influence );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t_morphA.addScaledVector( _tempA.sub( _vA ), influence );\n\t\t\t\t\t_morphB.addScaledVector( _tempB.sub( _vB ), influence );\n\t\t\t\t\t_morphC.addScaledVector( _tempC.sub( _vC ), influence );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t_vA.add( _morphA );\n\t\t\t_vB.add( _morphB );\n\t\t\t_vC.add( _morphC );\n\n\t\t}\n\n\t\tif ( object.isSkinnedMesh ) {\n\n\t\t\tobject.applyBoneTransform( a, _vA );\n\t\t\tobject.applyBoneTransform( b, _vB );\n\t\t\tobject.applyBoneTransform( c, _vC );\n\n\t\t}\n\n\t\tmodifiedAttributeArray[ a * 3 + 0 ] = _vA.x;\n\t\tmodifiedAttributeArray[ a * 3 + 1 ] = _vA.y;\n\t\tmodifiedAttributeArray[ a * 3 + 2 ] = _vA.z;\n\t\tmodifiedAttributeArray[ b * 3 + 0 ] = _vB.x;\n\t\tmodifiedAttributeArray[ b * 3 + 1 ] = _vB.y;\n\t\tmodifiedAttributeArray[ b * 3 + 2 ] = _vB.z;\n\t\tmodifiedAttributeArray[ c * 3 + 0 ] = _vC.x;\n\t\tmodifiedAttributeArray[ c * 3 + 1 ] = _vC.y;\n\t\tmodifiedAttributeArray[ c * 3 + 2 ] = _vC.z;\n\n\t}\n\n\tconst geometry = object.geometry;\n\tconst material = object.material;\n\n\tlet a, b, c;\n\tconst index = geometry.index;\n\tconst positionAttribute = geometry.attributes.position;\n\tconst morphPosition = geometry.morphAttributes.position;\n\tconst morphTargetsRelative = geometry.morphTargetsRelative;\n\tconst normalAttribute = geometry.attributes.normal;\n\tconst morphNormal = geometry.morphAttributes.position;\n\n\tconst groups = geometry.groups;\n\tconst drawRange = geometry.drawRange;\n\tlet i, j, il, jl;\n\tlet group;\n\tlet start, end;\n\n\tconst modifiedPosition = new Float32Array( positionAttribute.count * positionAttribute.itemSize );\n\tconst modifiedNormal = new Float32Array( normalAttribute.count * normalAttribute.itemSize );\n\n\tif ( index !== null ) {\n\n\t\t// indexed buffer geometry\n\n\t\tif ( Array.isArray( material ) ) {\n\n\t\t\tfor ( i = 0, il = groups.length; i < il; i ++ ) {\n\n\t\t\t\tgroup = groups[ i ];\n\n\t\t\t\tstart = Math.max( group.start, drawRange.start );\n\t\t\t\tend = Math.min( ( group.start + group.count ), ( drawRange.start + drawRange.count ) );\n\n\t\t\t\tfor ( j = start, jl = end; j < jl; j += 3 ) {\n\n\t\t\t\t\ta = index.getX( j );\n\t\t\t\t\tb = index.getX( j + 1 );\n\t\t\t\t\tc = index.getX( j + 2 );\n\n\t\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\t\tobject,\n\t\t\t\t\t\tpositionAttribute,\n\t\t\t\t\t\tmorphPosition,\n\t\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\t\ta, b, c,\n\t\t\t\t\t\tmodifiedPosition\n\t\t\t\t\t);\n\n\t\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\t\tobject,\n\t\t\t\t\t\tnormalAttribute,\n\t\t\t\t\t\tmorphNormal,\n\t\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\t\ta, b, c,\n\t\t\t\t\t\tmodifiedNormal\n\t\t\t\t\t);\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tstart = Math.max( 0, drawRange.start );\n\t\t\tend = Math.min( index.count, ( drawRange.start + drawRange.count ) );\n\n\t\t\tfor ( i = start, il = end; i < il; i += 3 ) {\n\n\t\t\t\ta = index.getX( i );\n\t\t\t\tb = index.getX( i + 1 );\n\t\t\t\tc = index.getX( i + 2 );\n\n\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\tobject,\n\t\t\t\t\tpositionAttribute,\n\t\t\t\t\tmorphPosition,\n\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\ta, b, c,\n\t\t\t\t\tmodifiedPosition\n\t\t\t\t);\n\n\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\tobject,\n\t\t\t\t\tnormalAttribute,\n\t\t\t\t\tmorphNormal,\n\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\ta, b, c,\n\t\t\t\t\tmodifiedNormal\n\t\t\t\t);\n\n\t\t\t}\n\n\t\t}\n\n\t} else {\n\n\t\t// non-indexed buffer geometry\n\n\t\tif ( Array.isArray( material ) ) {\n\n\t\t\tfor ( i = 0, il = groups.length; i < il; i ++ ) {\n\n\t\t\t\tgroup = groups[ i ];\n\n\t\t\t\tstart = Math.max( group.start, drawRange.start );\n\t\t\t\tend = Math.min( ( group.start + group.count ), ( drawRange.start + drawRange.count ) );\n\n\t\t\t\tfor ( j = start, jl = end; j < jl; j += 3 ) {\n\n\t\t\t\t\ta = j;\n\t\t\t\t\tb = j + 1;\n\t\t\t\t\tc = j + 2;\n\n\t\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\t\tobject,\n\t\t\t\t\t\tpositionAttribute,\n\t\t\t\t\t\tmorphPosition,\n\t\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\t\ta, b, c,\n\t\t\t\t\t\tmodifiedPosition\n\t\t\t\t\t);\n\n\t\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\t\tobject,\n\t\t\t\t\t\tnormalAttribute,\n\t\t\t\t\t\tmorphNormal,\n\t\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\t\ta, b, c,\n\t\t\t\t\t\tmodifiedNormal\n\t\t\t\t\t);\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tstart = Math.max( 0, drawRange.start );\n\t\t\tend = Math.min( positionAttribute.count, ( drawRange.start + drawRange.count ) );\n\n\t\t\tfor ( i = start, il = end; i < il; i += 3 ) {\n\n\t\t\t\ta = i;\n\t\t\t\tb = i + 1;\n\t\t\t\tc = i + 2;\n\n\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\tobject,\n\t\t\t\t\tpositionAttribute,\n\t\t\t\t\tmorphPosition,\n\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\ta, b, c,\n\t\t\t\t\tmodifiedPosition\n\t\t\t\t);\n\n\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\tobject,\n\t\t\t\t\tnormalAttribute,\n\t\t\t\t\tmorphNormal,\n\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\ta, b, c,\n\t\t\t\t\tmodifiedNormal\n\t\t\t\t);\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tconst morphedPositionAttribute = new Float32BufferAttribute( modifiedPosition, 3 );\n\tconst morphedNormalAttribute = new Float32BufferAttribute( modifiedNormal, 3 );\n\n\treturn {\n\n\t\tpositionAttribute: positionAttribute,\n\t\tnormalAttribute: normalAttribute,\n\t\tmorphedPositionAttribute: morphedPositionAttribute,\n\t\tmorphedNormalAttribute: morphedNormalAttribute\n\n\t};\n\n}\n\nfunction mergeGroups( geometry ) {\n\n\tif ( geometry.groups.length === 0 ) {\n\n\t\tconsole.warn( 'THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge.' );\n\t\treturn geometry;\n\n\t}\n\n\tlet groups = geometry.groups;\n\n\t// sort groups by material index\n\n\tgroups = groups.sort( ( a, b ) => {\n\n\t\tif ( a.materialIndex !== b.materialIndex ) return a.materialIndex - b.materialIndex;\n\n\t\treturn a.start - b.start;\n\n\t} );\n\n\t// create index for non-indexed geometries\n\n\tif ( geometry.getIndex() === null ) {\n\n\t\tconst positionAttribute = geometry.getAttribute( 'position' );\n\t\tconst indices = [];\n\n\t\tfor ( let i = 0; i < positionAttribute.count; i += 3 ) {\n\n\t\t\tindices.push( i, i + 1, i + 2 );\n\n\t\t}\n\n\t\tgeometry.setIndex( indices );\n\n\t}\n\n\t// sort index\n\n\tconst index = geometry.getIndex();\n\n\tconst newIndices = [];\n\n\tfor ( let i = 0; i < groups.length; i ++ ) {\n\n\t\tconst group = groups[ i ];\n\n\t\tconst groupStart = group.start;\n\t\tconst groupLength = groupStart + group.count;\n\n\t\tfor ( let j = groupStart; j < groupLength; j ++ ) {\n\n\t\t\tnewIndices.push( index.getX( j ) );\n\n\t\t}\n\n\t}\n\n\tgeometry.dispose(); // Required to force buffer recreation\n\tgeometry.setIndex( newIndices );\n\n\t// update groups indices\n\n\tlet start = 0;\n\n\tfor ( let i = 0; i < groups.length; i ++ ) {\n\n\t\tconst group = groups[ i ];\n\n\t\tgroup.start = start;\n\t\tstart += group.count;\n\n\t}\n\n\t// merge groups\n\n\tlet currentGroup = groups[ 0 ];\n\n\tgeometry.groups = [ currentGroup ];\n\n\tfor ( let i = 1; i < groups.length; i ++ ) {\n\n\t\tconst group = groups[ i ];\n\n\t\tif ( currentGroup.materialIndex === group.materialIndex ) {\n\n\t\t\tcurrentGroup.count += group.count;\n\n\t\t} else {\n\n\t\t\tcurrentGroup = group;\n\t\t\tgeometry.groups.push( currentGroup );\n\n\t\t}\n\n\t}\n\n\treturn geometry;\n\n}\n\n\n/**\n * Modifies the supplied geometry if it is non-indexed, otherwise creates a new,\n * non-indexed geometry. Returns the geometry with smooth normals everywhere except\n * faces that meet at an angle greater than the crease angle.\n *\n * @param {BufferGeometry} geometry\n * @param {number} [creaseAngle]\n * @return {BufferGeometry}\n */\nfunction toCreasedNormals( geometry, creaseAngle = Math.PI / 3 /* 60 degrees */ ) {\n\n\tconst creaseDot = Math.cos( creaseAngle );\n\tconst hashMultiplier = ( 1 + 1e-10 ) * 1e2;\n\n\t// reusable vectors\n\tconst verts = [ new Vector3(), new Vector3(), new Vector3() ];\n\tconst tempVec1 = new Vector3();\n\tconst tempVec2 = new Vector3();\n\tconst tempNorm = new Vector3();\n\tconst tempNorm2 = new Vector3();\n\n\t// hashes a vector\n\tfunction hashVertex( v ) {\n\n\t\tconst x = ~ ~ ( v.x * hashMultiplier );\n\t\tconst y = ~ ~ ( v.y * hashMultiplier );\n\t\tconst z = ~ ~ ( v.z * hashMultiplier );\n\t\treturn `${x},${y},${z}`;\n\n\t}\n\n\t// BufferGeometry.toNonIndexed() warns if the geometry is non-indexed\n\t// and returns the original geometry\n\tconst resultGeometry = geometry.index ? geometry.toNonIndexed() : geometry;\n\tconst posAttr = resultGeometry.attributes.position;\n\tconst vertexMap = {};\n\n\t// find all the normals shared by commonly located vertices\n\tfor ( let i = 0, l = posAttr.count / 3; i < l; i ++ ) {\n\n\t\tconst i3 = 3 * i;\n\t\tconst a = verts[ 0 ].fromBufferAttribute( posAttr, i3 + 0 );\n\t\tconst b = verts[ 1 ].fromBufferAttribute( posAttr, i3 + 1 );\n\t\tconst c = verts[ 2 ].fromBufferAttribute( posAttr, i3 + 2 );\n\n\t\ttempVec1.subVectors( c, b );\n\t\ttempVec2.subVectors( a, b );\n\n\t\t// add the normal to the map for all vertices\n\t\tconst normal = new Vector3().crossVectors( tempVec1, tempVec2 ).normalize();\n\t\tfor ( let n = 0; n < 3; n ++ ) {\n\n\t\t\tconst vert = verts[ n ];\n\t\t\tconst hash = hashVertex( vert );\n\t\t\tif ( ! ( hash in vertexMap ) ) {\n\n\t\t\t\tvertexMap[ hash ] = [];\n\n\t\t\t}\n\n\t\t\tvertexMap[ hash ].push( normal );\n\n\t\t}\n\n\t}\n\n\t// average normals from all vertices that share a common location if they are within the\n\t// provided crease threshold\n\tconst normalArray = new Float32Array( posAttr.count * 3 );\n\tconst normAttr = new BufferAttribute( normalArray, 3, false );\n\tfor ( let i = 0, l = posAttr.count / 3; i < l; i ++ ) {\n\n\t\t// get the face normal for this vertex\n\t\tconst i3 = 3 * i;\n\t\tconst a = verts[ 0 ].fromBufferAttribute( posAttr, i3 + 0 );\n\t\tconst b = verts[ 1 ].fromBufferAttribute( posAttr, i3 + 1 );\n\t\tconst c = verts[ 2 ].fromBufferAttribute( posAttr, i3 + 2 );\n\n\t\ttempVec1.subVectors( c, b );\n\t\ttempVec2.subVectors( a, b );\n\n\t\ttempNorm.crossVectors( tempVec1, tempVec2 ).normalize();\n\n\t\t// average all normals that meet the threshold and set the normal value\n\t\tfor ( let n = 0; n < 3; n ++ ) {\n\n\t\t\tconst vert = verts[ n ];\n\t\t\tconst hash = hashVertex( vert );\n\t\t\tconst otherNormals = vertexMap[ hash ];\n\t\t\ttempNorm2.set( 0, 0, 0 );\n\n\t\t\tfor ( let k = 0, lk = otherNormals.length; k < lk; k ++ ) {\n\n\t\t\t\tconst otherNorm = otherNormals[ k ];\n\t\t\t\tif ( tempNorm.dot( otherNorm ) > creaseDot ) {\n\n\t\t\t\t\ttempNorm2.add( otherNorm );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\ttempNorm2.normalize();\n\t\t\tnormAttr.setXYZ( i3 + n, tempNorm2.x, tempNorm2.y, tempNorm2.z );\n\n\t\t}\n\n\t}\n\n\tresultGeometry.setAttribute( 'normal', normAttr );\n\treturn resultGeometry;\n\n}\n\nexport {\n\tcomputeMikkTSpaceTangents,\n\tmergeGeometries,\n\tmergeAttributes,\n\tinterleaveAttributes,\n\testimateBytesUsed,\n\tmergeVertices,\n\ttoTrianglesDrawMode,\n\tcomputeMorphedAttributes,\n\tmergeGroups,\n\ttoCreasedNormals\n};\n","import {\n\tAnimationClip,\n\tBone,\n\tBox3,\n\tBufferAttribute,\n\tBufferGeometry,\n\tClampToEdgeWrapping,\n\tColor,\n\tColorManagement,\n\tDirectionalLight,\n\tDoubleSide,\n\tFileLoader,\n\tFrontSide,\n\tGroup,\n\tImageBitmapLoader,\n\tInstancedMesh,\n\tInterleavedBuffer,\n\tInterleavedBufferAttribute,\n\tInterpolant,\n\tInterpolateDiscrete,\n\tInterpolateLinear,\n\tLine,\n\tLineBasicMaterial,\n\tLineLoop,\n\tLineSegments,\n\tLinearFilter,\n\tLinearMipmapLinearFilter,\n\tLinearMipmapNearestFilter,\n\tLinearSRGBColorSpace,\n\tLoader,\n\tLoaderUtils,\n\tMaterial,\n\tMathUtils,\n\tMatrix4,\n\tMesh,\n\tMeshBasicMaterial,\n\tMeshPhysicalMaterial,\n\tMeshStandardMaterial,\n\tMirroredRepeatWrapping,\n\tNearestFilter,\n\tNearestMipmapLinearFilter,\n\tNearestMipmapNearestFilter,\n\tNumberKeyframeTrack,\n\tObject3D,\n\tOrthographicCamera,\n\tPerspectiveCamera,\n\tPointLight,\n\tPoints,\n\tPointsMaterial,\n\tPropertyBinding,\n\tQuaternion,\n\tQuaternionKeyframeTrack,\n\tRepeatWrapping,\n\tSkeleton,\n\tSkinnedMesh,\n\tSphere,\n\tSpotLight,\n\tTexture,\n\tTextureLoader,\n\tTriangleFanDrawMode,\n\tTriangleStripDrawMode,\n\tVector2,\n\tVector3,\n\tVectorKeyframeTrack,\n\tSRGBColorSpace,\n\tInstancedBufferAttribute\n} from 'three';\nimport { toTrianglesDrawMode } from '../utils/BufferGeometryUtils.js';\n\nclass GLTFLoader extends Loader {\n\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t\tthis.dracoLoader = null;\n\t\tthis.ktx2Loader = null;\n\t\tthis.meshoptDecoder = null;\n\n\t\tthis.pluginCallbacks = [];\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsClearcoatExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsDispersionExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFTextureBasisUExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFTextureWebPExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFTextureAVIFExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsSheenExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsTransmissionExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsVolumeExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsIorExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsEmissiveStrengthExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsSpecularExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsIridescenceExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsAnisotropyExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsBumpExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFLightsExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMeshoptCompression( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMeshGpuInstancing( parser );\n\n\t\t} );\n\n\t}\n\n\tload( url, onLoad, onProgress, onError ) {\n\n\t\tconst scope = this;\n\n\t\tlet resourcePath;\n\n\t\tif ( this.resourcePath !== '' ) {\n\n\t\t\tresourcePath = this.resourcePath;\n\n\t\t} else if ( this.path !== '' ) {\n\n\t\t\t// If a base path is set, resources will be relative paths from that plus the relative path of the gltf file\n\t\t\t// Example  path = 'https://my-cnd-server.com/', url = 'assets/models/model.gltf'\n\t\t\t// resourcePath = 'https://my-cnd-server.com/assets/models/'\n\t\t\t// referenced resource 'model.bin' will be loaded from 'https://my-cnd-server.com/assets/models/model.bin'\n\t\t\t// referenced resource '../textures/texture.png' will be loaded from 'https://my-cnd-server.com/assets/textures/texture.png'\n\t\t\tconst relativeUrl = LoaderUtils.extractUrlBase( url );\n\t\t\tresourcePath = LoaderUtils.resolveURL( relativeUrl, this.path );\n\n\t\t} else {\n\n\t\t\tresourcePath = LoaderUtils.extractUrlBase( url );\n\n\t\t}\n\n\t\t// Tells the LoadingManager to track an extra item, which resolves after\n\t\t// the model is fully loaded. This means the count of items loaded will\n\t\t// be incorrect, but ensures manager.onLoad() does not fire early.\n\t\tthis.manager.itemStart( url );\n\n\t\tconst _onError = function ( e ) {\n\n\t\t\tif ( onError ) {\n\n\t\t\t\tonError( e );\n\n\t\t\t} else {\n\n\t\t\t\tconsole.error( e );\n\n\t\t\t}\n\n\t\t\tscope.manager.itemError( url );\n\t\t\tscope.manager.itemEnd( url );\n\n\t\t};\n\n\t\tconst loader = new FileLoader( this.manager );\n\n\t\tloader.setPath( this.path );\n\t\tloader.setResponseType( 'arraybuffer' );\n\t\tloader.setRequestHeader( this.requestHeader );\n\t\tloader.setWithCredentials( this.withCredentials );\n\n\t\tloader.load( url, function ( data ) {\n\n\t\t\ttry {\n\n\t\t\t\tscope.parse( data, resourcePath, function ( gltf ) {\n\n\t\t\t\t\tonLoad( gltf );\n\n\t\t\t\t\tscope.manager.itemEnd( url );\n\n\t\t\t\t}, _onError );\n\n\t\t\t} catch ( e ) {\n\n\t\t\t\t_onError( e );\n\n\t\t\t}\n\n\t\t}, onProgress, _onError );\n\n\t}\n\n\tsetDRACOLoader( dracoLoader ) {\n\n\t\tthis.dracoLoader = dracoLoader;\n\t\treturn this;\n\n\t}\n\n\tsetKTX2Loader( ktx2Loader ) {\n\n\t\tthis.ktx2Loader = ktx2Loader;\n\t\treturn this;\n\n\t}\n\n\tsetMeshoptDecoder( meshoptDecoder ) {\n\n\t\tthis.meshoptDecoder = meshoptDecoder;\n\t\treturn this;\n\n\t}\n\n\tregister( callback ) {\n\n\t\tif ( this.pluginCallbacks.indexOf( callback ) === - 1 ) {\n\n\t\t\tthis.pluginCallbacks.push( callback );\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\tunregister( callback ) {\n\n\t\tif ( this.pluginCallbacks.indexOf( callback ) !== - 1 ) {\n\n\t\t\tthis.pluginCallbacks.splice( this.pluginCallbacks.indexOf( callback ), 1 );\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\tparse( data, path, onLoad, onError ) {\n\n\t\tlet json;\n\t\tconst extensions = {};\n\t\tconst plugins = {};\n\t\tconst textDecoder = new TextDecoder();\n\n\t\tif ( typeof data === 'string' ) {\n\n\t\t\tjson = JSON.parse( data );\n\n\t\t} else if ( data instanceof ArrayBuffer ) {\n\n\t\t\tconst magic = textDecoder.decode( new Uint8Array( data, 0, 4 ) );\n\n\t\t\tif ( magic === BINARY_EXTENSION_HEADER_MAGIC ) {\n\n\t\t\t\ttry {\n\n\t\t\t\t\textensions[ EXTENSIONS.KHR_BINARY_GLTF ] = new GLTFBinaryExtension( data );\n\n\t\t\t\t} catch ( error ) {\n\n\t\t\t\t\tif ( onError ) onError( error );\n\t\t\t\t\treturn;\n\n\t\t\t\t}\n\n\t\t\t\tjson = JSON.parse( extensions[ EXTENSIONS.KHR_BINARY_GLTF ].content );\n\n\t\t\t} else {\n\n\t\t\t\tjson = JSON.parse( textDecoder.decode( data ) );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tjson = data;\n\n\t\t}\n\n\t\tif ( json.asset === undefined || json.asset.version[ 0 ] < 2 ) {\n\n\t\t\tif ( onError ) onError( new Error( 'THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.' ) );\n\t\t\treturn;\n\n\t\t}\n\n\t\tconst parser = new GLTFParser( json, {\n\n\t\t\tpath: path || this.resourcePath || '',\n\t\t\tcrossOrigin: this.crossOrigin,\n\t\t\trequestHeader: this.requestHeader,\n\t\t\tmanager: this.manager,\n\t\t\tktx2Loader: this.ktx2Loader,\n\t\t\tmeshoptDecoder: this.meshoptDecoder\n\n\t\t} );\n\n\t\tparser.fileLoader.setRequestHeader( this.requestHeader );\n\n\t\tfor ( let i = 0; i < this.pluginCallbacks.length; i ++ ) {\n\n\t\t\tconst plugin = this.pluginCallbacks[ i ]( parser );\n\n\t\t\tif ( ! plugin.name ) console.error( 'THREE.GLTFLoader: Invalid plugin found: missing name' );\n\n\t\t\tplugins[ plugin.name ] = plugin;\n\n\t\t\t// Workaround to avoid determining as unknown extension\n\t\t\t// in addUnknownExtensionsToUserData().\n\t\t\t// Remove this workaround if we move all the existing\n\t\t\t// extension handlers to plugin system\n\t\t\textensions[ plugin.name ] = true;\n\n\t\t}\n\n\t\tif ( json.extensionsUsed ) {\n\n\t\t\tfor ( let i = 0; i < json.extensionsUsed.length; ++ i ) {\n\n\t\t\t\tconst extensionName = json.extensionsUsed[ i ];\n\t\t\t\tconst extensionsRequired = json.extensionsRequired || [];\n\n\t\t\t\tswitch ( extensionName ) {\n\n\t\t\t\t\tcase EXTENSIONS.KHR_MATERIALS_UNLIT:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFMaterialsUnlitExtension();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFDracoMeshCompressionExtension( json, this.dracoLoader );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase EXTENSIONS.KHR_TEXTURE_TRANSFORM:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFTextureTransformExtension();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase EXTENSIONS.KHR_MESH_QUANTIZATION:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFMeshQuantizationExtension();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tif ( extensionsRequired.indexOf( extensionName ) >= 0 && plugins[ extensionName ] === undefined ) {\n\n\t\t\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Unknown extension \"' + extensionName + '\".' );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tparser.setExtensions( extensions );\n\t\tparser.setPlugins( plugins );\n\t\tparser.parse( onLoad, onError );\n\n\t}\n\n\tparseAsync( data, path ) {\n\n\t\tconst scope = this;\n\n\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\tscope.parse( data, path, resolve, reject );\n\n\t\t} );\n\n\t}\n\n}\n\n/* GLTFREGISTRY */\n\nfunction GLTFRegistry() {\n\n\tlet objects = {};\n\n\treturn\t{\n\n\t\tget: function ( key ) {\n\n\t\t\treturn objects[ key ];\n\n\t\t},\n\n\t\tadd: function ( key, object ) {\n\n\t\t\tobjects[ key ] = object;\n\n\t\t},\n\n\t\tremove: function ( key ) {\n\n\t\t\tdelete objects[ key ];\n\n\t\t},\n\n\t\tremoveAll: function () {\n\n\t\t\tobjects = {};\n\n\t\t}\n\n\t};\n\n}\n\n/*********************************/\n/********** EXTENSIONS ***********/\n/*********************************/\n\nconst EXTENSIONS = {\n\tKHR_BINARY_GLTF: 'KHR_binary_glTF',\n\tKHR_DRACO_MESH_COMPRESSION: 'KHR_draco_mesh_compression',\n\tKHR_LIGHTS_PUNCTUAL: 'KHR_lights_punctual',\n\tKHR_MATERIALS_CLEARCOAT: 'KHR_materials_clearcoat',\n\tKHR_MATERIALS_DISPERSION: 'KHR_materials_dispersion',\n\tKHR_MATERIALS_IOR: 'KHR_materials_ior',\n\tKHR_MATERIALS_SHEEN: 'KHR_materials_sheen',\n\tKHR_MATERIALS_SPECULAR: 'KHR_materials_specular',\n\tKHR_MATERIALS_TRANSMISSION: 'KHR_materials_transmission',\n\tKHR_MATERIALS_IRIDESCENCE: 'KHR_materials_iridescence',\n\tKHR_MATERIALS_ANISOTROPY: 'KHR_materials_anisotropy',\n\tKHR_MATERIALS_UNLIT: 'KHR_materials_unlit',\n\tKHR_MATERIALS_VOLUME: 'KHR_materials_volume',\n\tKHR_TEXTURE_BASISU: 'KHR_texture_basisu',\n\tKHR_TEXTURE_TRANSFORM: 'KHR_texture_transform',\n\tKHR_MESH_QUANTIZATION: 'KHR_mesh_quantization',\n\tKHR_MATERIALS_EMISSIVE_STRENGTH: 'KHR_materials_emissive_strength',\n\tEXT_MATERIALS_BUMP: 'EXT_materials_bump',\n\tEXT_TEXTURE_WEBP: 'EXT_texture_webp',\n\tEXT_TEXTURE_AVIF: 'EXT_texture_avif',\n\tEXT_MESHOPT_COMPRESSION: 'EXT_meshopt_compression',\n\tEXT_MESH_GPU_INSTANCING: 'EXT_mesh_gpu_instancing'\n};\n\n/**\n * Punctual Lights Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_lights_punctual\n */\nclass GLTFLightsExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_LIGHTS_PUNCTUAL;\n\n\t\t// Object3D instance caches\n\t\tthis.cache = { refs: {}, uses: {} };\n\n\t}\n\n\t_markDefs() {\n\n\t\tconst parser = this.parser;\n\t\tconst nodeDefs = this.parser.json.nodes || [];\n\n\t\tfor ( let nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {\n\n\t\t\tconst nodeDef = nodeDefs[ nodeIndex ];\n\n\t\t\tif ( nodeDef.extensions\n\t\t\t\t\t&& nodeDef.extensions[ this.name ]\n\t\t\t\t\t&& nodeDef.extensions[ this.name ].light !== undefined ) {\n\n\t\t\t\tparser._addNodeRef( this.cache, nodeDef.extensions[ this.name ].light );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t_loadLight( lightIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst cacheKey = 'light:' + lightIndex;\n\t\tlet dependency = parser.cache.get( cacheKey );\n\n\t\tif ( dependency ) return dependency;\n\n\t\tconst json = parser.json;\n\t\tconst extensions = ( json.extensions && json.extensions[ this.name ] ) || {};\n\t\tconst lightDefs = extensions.lights || [];\n\t\tconst lightDef = lightDefs[ lightIndex ];\n\t\tlet lightNode;\n\n\t\tconst color = new Color( 0xffffff );\n\n\t\tif ( lightDef.color !== undefined ) color.setRGB( lightDef.color[ 0 ], lightDef.color[ 1 ], lightDef.color[ 2 ], LinearSRGBColorSpace );\n\n\t\tconst range = lightDef.range !== undefined ? lightDef.range : 0;\n\n\t\tswitch ( lightDef.type ) {\n\n\t\t\tcase 'directional':\n\t\t\t\tlightNode = new DirectionalLight( color );\n\t\t\t\tlightNode.target.position.set( 0, 0, - 1 );\n\t\t\t\tlightNode.add( lightNode.target );\n\t\t\t\tbreak;\n\n\t\t\tcase 'point':\n\t\t\t\tlightNode = new PointLight( color );\n\t\t\t\tlightNode.distance = range;\n\t\t\t\tbreak;\n\n\t\t\tcase 'spot':\n\t\t\t\tlightNode = new SpotLight( color );\n\t\t\t\tlightNode.distance = range;\n\t\t\t\t// Handle spotlight properties.\n\t\t\t\tlightDef.spot = lightDef.spot || {};\n\t\t\t\tlightDef.spot.innerConeAngle = lightDef.spot.innerConeAngle !== undefined ? lightDef.spot.innerConeAngle : 0;\n\t\t\t\tlightDef.spot.outerConeAngle = lightDef.spot.outerConeAngle !== undefined ? lightDef.spot.outerConeAngle : Math.PI / 4.0;\n\t\t\t\tlightNode.angle = lightDef.spot.outerConeAngle;\n\t\t\t\tlightNode.penumbra = 1.0 - lightDef.spot.innerConeAngle / lightDef.spot.outerConeAngle;\n\t\t\t\tlightNode.target.position.set( 0, 0, - 1 );\n\t\t\t\tlightNode.add( lightNode.target );\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Unexpected light type: ' + lightDef.type );\n\n\t\t}\n\n\t\t// Some lights (e.g. spot) default to a position other than the origin. Reset the position\n\t\t// here, because node-level parsing will only override position if explicitly specified.\n\t\tlightNode.position.set( 0, 0, 0 );\n\n\t\tlightNode.decay = 2;\n\n\t\tassignExtrasToUserData( lightNode, lightDef );\n\n\t\tif ( lightDef.intensity !== undefined ) lightNode.intensity = lightDef.intensity;\n\n\t\tlightNode.name = parser.createUniqueName( lightDef.name || ( 'light_' + lightIndex ) );\n\n\t\tdependency = Promise.resolve( lightNode );\n\n\t\tparser.cache.add( cacheKey, dependency );\n\n\t\treturn dependency;\n\n\t}\n\n\tgetDependency( type, index ) {\n\n\t\tif ( type !== 'light' ) return;\n\n\t\treturn this._loadLight( index );\n\n\t}\n\n\tcreateNodeAttachment( nodeIndex ) {\n\n\t\tconst self = this;\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\t\tconst lightDef = ( nodeDef.extensions && nodeDef.extensions[ this.name ] ) || {};\n\t\tconst lightIndex = lightDef.light;\n\n\t\tif ( lightIndex === undefined ) return null;\n\n\t\treturn this._loadLight( lightIndex ).then( function ( light ) {\n\n\t\t\treturn parser._getNodeRef( self.cache, lightIndex, light );\n\n\t\t} );\n\n\t}\n\n}\n\n/**\n * Unlit Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_unlit\n */\nclass GLTFMaterialsUnlitExtension {\n\n\tconstructor() {\n\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_UNLIT;\n\n\t}\n\n\tgetMaterialType() {\n\n\t\treturn MeshBasicMaterial;\n\n\t}\n\n\textendParams( materialParams, materialDef, parser ) {\n\n\t\tconst pending = [];\n\n\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\n\t\tmaterialParams.opacity = 1.0;\n\n\t\tconst metallicRoughness = materialDef.pbrMetallicRoughness;\n\n\t\tif ( metallicRoughness ) {\n\n\t\t\tif ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\n\n\t\t\t\tconst array = metallicRoughness.baseColorFactor;\n\n\t\t\t\tmaterialParams.color.setRGB( array[ 0 ], array[ 1 ], array[ 2 ], LinearSRGBColorSpace );\n\t\t\t\tmaterialParams.opacity = array[ 3 ];\n\n\t\t\t}\n\n\t\t\tif ( metallicRoughness.baseColorTexture !== undefined ) {\n\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture, SRGBColorSpace ) );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Materials Emissive Strength Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/blob/5768b3ce0ef32bc39cdf1bef10b948586635ead3/extensions/2.0/Khronos/KHR_materials_emissive_strength/README.md\n */\nclass GLTFMaterialsEmissiveStrengthExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_EMISSIVE_STRENGTH;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst emissiveStrength = materialDef.extensions[ this.name ].emissiveStrength;\n\n\t\tif ( emissiveStrength !== undefined ) {\n\n\t\t\tmaterialParams.emissiveIntensity = emissiveStrength;\n\n\t\t}\n\n\t\treturn Promise.resolve();\n\n\t}\n\n}\n\n/**\n * Clearcoat Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_clearcoat\n */\nclass GLTFMaterialsClearcoatExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_CLEARCOAT;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.clearcoatFactor !== undefined ) {\n\n\t\t\tmaterialParams.clearcoat = extension.clearcoatFactor;\n\n\t\t}\n\n\t\tif ( extension.clearcoatTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatMap', extension.clearcoatTexture ) );\n\n\t\t}\n\n\t\tif ( extension.clearcoatRoughnessFactor !== undefined ) {\n\n\t\t\tmaterialParams.clearcoatRoughness = extension.clearcoatRoughnessFactor;\n\n\t\t}\n\n\t\tif ( extension.clearcoatRoughnessTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatRoughnessMap', extension.clearcoatRoughnessTexture ) );\n\n\t\t}\n\n\t\tif ( extension.clearcoatNormalTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatNormalMap', extension.clearcoatNormalTexture ) );\n\n\t\t\tif ( extension.clearcoatNormalTexture.scale !== undefined ) {\n\n\t\t\t\tconst scale = extension.clearcoatNormalTexture.scale;\n\n\t\t\t\tmaterialParams.clearcoatNormalScale = new Vector2( scale, scale );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Materials dispersion Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Khronos/KHR_materials_dispersion\n */\nclass GLTFMaterialsDispersionExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_DISPERSION;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.dispersion = extension.dispersion !== undefined ? extension.dispersion : 0;\n\n\t\treturn Promise.resolve();\n\n\t}\n\n}\n\n/**\n * Iridescence Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_iridescence\n */\nclass GLTFMaterialsIridescenceExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_IRIDESCENCE;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.iridescenceFactor !== undefined ) {\n\n\t\t\tmaterialParams.iridescence = extension.iridescenceFactor;\n\n\t\t}\n\n\t\tif ( extension.iridescenceTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'iridescenceMap', extension.iridescenceTexture ) );\n\n\t\t}\n\n\t\tif ( extension.iridescenceIor !== undefined ) {\n\n\t\t\tmaterialParams.iridescenceIOR = extension.iridescenceIor;\n\n\t\t}\n\n\t\tif ( materialParams.iridescenceThicknessRange === undefined ) {\n\n\t\t\tmaterialParams.iridescenceThicknessRange = [ 100, 400 ];\n\n\t\t}\n\n\t\tif ( extension.iridescenceThicknessMinimum !== undefined ) {\n\n\t\t\tmaterialParams.iridescenceThicknessRange[ 0 ] = extension.iridescenceThicknessMinimum;\n\n\t\t}\n\n\t\tif ( extension.iridescenceThicknessMaximum !== undefined ) {\n\n\t\t\tmaterialParams.iridescenceThicknessRange[ 1 ] = extension.iridescenceThicknessMaximum;\n\n\t\t}\n\n\t\tif ( extension.iridescenceThicknessTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'iridescenceThicknessMap', extension.iridescenceThicknessTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Sheen Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Khronos/KHR_materials_sheen\n */\nclass GLTFMaterialsSheenExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_SHEEN;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tmaterialParams.sheenColor = new Color( 0, 0, 0 );\n\t\tmaterialParams.sheenRoughness = 0;\n\t\tmaterialParams.sheen = 1;\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.sheenColorFactor !== undefined ) {\n\n\t\t\tconst colorFactor = extension.sheenColorFactor;\n\t\t\tmaterialParams.sheenColor.setRGB( colorFactor[ 0 ], colorFactor[ 1 ], colorFactor[ 2 ], LinearSRGBColorSpace );\n\n\t\t}\n\n\t\tif ( extension.sheenRoughnessFactor !== undefined ) {\n\n\t\t\tmaterialParams.sheenRoughness = extension.sheenRoughnessFactor;\n\n\t\t}\n\n\t\tif ( extension.sheenColorTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'sheenColorMap', extension.sheenColorTexture, SRGBColorSpace ) );\n\n\t\t}\n\n\t\tif ( extension.sheenRoughnessTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'sheenRoughnessMap', extension.sheenRoughnessTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Transmission Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_transmission\n * Draft: https://github.com/KhronosGroup/glTF/pull/1698\n */\nclass GLTFMaterialsTransmissionExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_TRANSMISSION;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.transmissionFactor !== undefined ) {\n\n\t\t\tmaterialParams.transmission = extension.transmissionFactor;\n\n\t\t}\n\n\t\tif ( extension.transmissionTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'transmissionMap', extension.transmissionTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Materials Volume Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_volume\n */\nclass GLTFMaterialsVolumeExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_VOLUME;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.thickness = extension.thicknessFactor !== undefined ? extension.thicknessFactor : 0;\n\n\t\tif ( extension.thicknessTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'thicknessMap', extension.thicknessTexture ) );\n\n\t\t}\n\n\t\tmaterialParams.attenuationDistance = extension.attenuationDistance || Infinity;\n\n\t\tconst colorArray = extension.attenuationColor || [ 1, 1, 1 ];\n\t\tmaterialParams.attenuationColor = new Color().setRGB( colorArray[ 0 ], colorArray[ 1 ], colorArray[ 2 ], LinearSRGBColorSpace );\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Materials ior Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_ior\n */\nclass GLTFMaterialsIorExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_IOR;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.ior = extension.ior !== undefined ? extension.ior : 1.5;\n\n\t\treturn Promise.resolve();\n\n\t}\n\n}\n\n/**\n * Materials specular Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_specular\n */\nclass GLTFMaterialsSpecularExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_SPECULAR;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.specularIntensity = extension.specularFactor !== undefined ? extension.specularFactor : 1.0;\n\n\t\tif ( extension.specularTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'specularIntensityMap', extension.specularTexture ) );\n\n\t\t}\n\n\t\tconst colorArray = extension.specularColorFactor || [ 1, 1, 1 ];\n\t\tmaterialParams.specularColor = new Color().setRGB( colorArray[ 0 ], colorArray[ 1 ], colorArray[ 2 ], LinearSRGBColorSpace );\n\n\t\tif ( extension.specularColorTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'specularColorMap', extension.specularColorTexture, SRGBColorSpace ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n\n/**\n * Materials bump Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/EXT_materials_bump\n */\nclass GLTFMaterialsBumpExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.EXT_MATERIALS_BUMP;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.bumpScale = extension.bumpFactor !== undefined ? extension.bumpFactor : 1.0;\n\n\t\tif ( extension.bumpTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'bumpMap', extension.bumpTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Materials anisotropy Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_anisotropy\n */\nclass GLTFMaterialsAnisotropyExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_ANISOTROPY;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.anisotropyStrength !== undefined ) {\n\n\t\t\tmaterialParams.anisotropy = extension.anisotropyStrength;\n\n\t\t}\n\n\t\tif ( extension.anisotropyRotation !== undefined ) {\n\n\t\t\tmaterialParams.anisotropyRotation = extension.anisotropyRotation;\n\n\t\t}\n\n\t\tif ( extension.anisotropyTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'anisotropyMap', extension.anisotropyTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * BasisU Texture Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_basisu\n */\nclass GLTFTextureBasisUExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_TEXTURE_BASISU;\n\n\t}\n\n\tloadTexture( textureIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\n\t\tif ( ! textureDef.extensions || ! textureDef.extensions[ this.name ] ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst extension = textureDef.extensions[ this.name ];\n\t\tconst loader = parser.options.ktx2Loader;\n\n\t\tif ( ! loader ) {\n\n\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( this.name ) >= 0 ) {\n\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures' );\n\n\t\t\t} else {\n\n\t\t\t\t// Assumes that the extension is optional and that a fallback texture is present\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn parser.loadTextureImage( textureIndex, extension.source, loader );\n\n\t}\n\n}\n\n/**\n * WebP Texture Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_texture_webp\n */\nclass GLTFTextureWebPExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.EXT_TEXTURE_WEBP;\n\t\tthis.isSupported = null;\n\n\t}\n\n\tloadTexture( textureIndex ) {\n\n\t\tconst name = this.name;\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\n\t\tif ( ! textureDef.extensions || ! textureDef.extensions[ name ] ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst extension = textureDef.extensions[ name ];\n\t\tconst source = json.images[ extension.source ];\n\n\t\tlet loader = parser.textureLoader;\n\t\tif ( source.uri ) {\n\n\t\t\tconst handler = parser.options.manager.getHandler( source.uri );\n\t\t\tif ( handler !== null ) loader = handler;\n\n\t\t}\n\n\t\treturn this.detectSupport().then( function ( isSupported ) {\n\n\t\t\tif ( isSupported ) return parser.loadTextureImage( textureIndex, extension.source, loader );\n\n\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( name ) >= 0 ) {\n\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: WebP required by asset but unsupported.' );\n\n\t\t\t}\n\n\t\t\t// Fall back to PNG or JPEG.\n\t\t\treturn parser.loadTexture( textureIndex );\n\n\t\t} );\n\n\t}\n\n\tdetectSupport() {\n\n\t\tif ( ! this.isSupported ) {\n\n\t\t\tthis.isSupported = new Promise( function ( resolve ) {\n\n\t\t\t\tconst image = new Image();\n\n\t\t\t\t// Lossy test image. Support for lossy images doesn't guarantee support for all\n\t\t\t\t// WebP images, unfortunately.\n\t\t\t\timage.src = 'data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA';\n\n\t\t\t\timage.onload = image.onerror = function () {\n\n\t\t\t\t\tresolve( image.height === 1 );\n\n\t\t\t\t};\n\n\t\t\t} );\n\n\t\t}\n\n\t\treturn this.isSupported;\n\n\t}\n\n}\n\n/**\n * AVIF Texture Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_texture_avif\n */\nclass GLTFTextureAVIFExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.EXT_TEXTURE_AVIF;\n\t\tthis.isSupported = null;\n\n\t}\n\n\tloadTexture( textureIndex ) {\n\n\t\tconst name = this.name;\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\n\t\tif ( ! textureDef.extensions || ! textureDef.extensions[ name ] ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst extension = textureDef.extensions[ name ];\n\t\tconst source = json.images[ extension.source ];\n\n\t\tlet loader = parser.textureLoader;\n\t\tif ( source.uri ) {\n\n\t\t\tconst handler = parser.options.manager.getHandler( source.uri );\n\t\t\tif ( handler !== null ) loader = handler;\n\n\t\t}\n\n\t\treturn this.detectSupport().then( function ( isSupported ) {\n\n\t\t\tif ( isSupported ) return parser.loadTextureImage( textureIndex, extension.source, loader );\n\n\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( name ) >= 0 ) {\n\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: AVIF required by asset but unsupported.' );\n\n\t\t\t}\n\n\t\t\t// Fall back to PNG or JPEG.\n\t\t\treturn parser.loadTexture( textureIndex );\n\n\t\t} );\n\n\t}\n\n\tdetectSupport() {\n\n\t\tif ( ! this.isSupported ) {\n\n\t\t\tthis.isSupported = new Promise( function ( resolve ) {\n\n\t\t\t\tconst image = new Image();\n\n\t\t\t\t// Lossy test image.\n\t\t\t\timage.src = 'data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=';\n\t\t\t\timage.onload = image.onerror = function () {\n\n\t\t\t\t\tresolve( image.height === 1 );\n\n\t\t\t\t};\n\n\t\t\t} );\n\n\t\t}\n\n\t\treturn this.isSupported;\n\n\t}\n\n}\n\n/**\n * meshopt BufferView Compression Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_meshopt_compression\n */\nclass GLTFMeshoptCompression {\n\n\tconstructor( parser ) {\n\n\t\tthis.name = EXTENSIONS.EXT_MESHOPT_COMPRESSION;\n\t\tthis.parser = parser;\n\n\t}\n\n\tloadBufferView( index ) {\n\n\t\tconst json = this.parser.json;\n\t\tconst bufferView = json.bufferViews[ index ];\n\n\t\tif ( bufferView.extensions && bufferView.extensions[ this.name ] ) {\n\n\t\t\tconst extensionDef = bufferView.extensions[ this.name ];\n\n\t\t\tconst buffer = this.parser.getDependency( 'buffer', extensionDef.buffer );\n\t\t\tconst decoder = this.parser.options.meshoptDecoder;\n\n\t\t\tif ( ! decoder || ! decoder.supported ) {\n\n\t\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( this.name ) >= 0 ) {\n\n\t\t\t\t\tthrow new Error( 'THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files' );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// Assumes that the extension is optional and that fallback buffer data is present\n\t\t\t\t\treturn null;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn buffer.then( function ( res ) {\n\n\t\t\t\tconst byteOffset = extensionDef.byteOffset || 0;\n\t\t\t\tconst byteLength = extensionDef.byteLength || 0;\n\n\t\t\t\tconst count = extensionDef.count;\n\t\t\t\tconst stride = extensionDef.byteStride;\n\n\t\t\t\tconst source = new Uint8Array( res, byteOffset, byteLength );\n\n\t\t\t\tif ( decoder.decodeGltfBufferAsync ) {\n\n\t\t\t\t\treturn decoder.decodeGltfBufferAsync( count, stride, source, extensionDef.mode, extensionDef.filter ).then( function ( res ) {\n\n\t\t\t\t\t\treturn res.buffer;\n\n\t\t\t\t\t} );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// Support for MeshoptDecoder 0.18 or earlier, without decodeGltfBufferAsync\n\t\t\t\t\treturn decoder.ready.then( function () {\n\n\t\t\t\t\t\tconst result = new ArrayBuffer( count * stride );\n\t\t\t\t\t\tdecoder.decodeGltfBuffer( new Uint8Array( result ), count, stride, source, extensionDef.mode, extensionDef.filter );\n\t\t\t\t\t\treturn result;\n\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t} else {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * GPU Instancing Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_mesh_gpu_instancing\n *\n */\nclass GLTFMeshGpuInstancing {\n\n\tconstructor( parser ) {\n\n\t\tthis.name = EXTENSIONS.EXT_MESH_GPU_INSTANCING;\n\t\tthis.parser = parser;\n\n\t}\n\n\tcreateNodeMesh( nodeIndex ) {\n\n\t\tconst json = this.parser.json;\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\n\t\tif ( ! nodeDef.extensions || ! nodeDef.extensions[ this.name ] ||\n\t\t\tnodeDef.mesh === undefined ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst meshDef = json.meshes[ nodeDef.mesh ];\n\n\t\t// No Points or Lines + Instancing support yet\n\n\t\tfor ( const primitive of meshDef.primitives ) {\n\n\t\t\tif ( primitive.mode !== WEBGL_CONSTANTS.TRIANGLES &&\n\t\t\t\t primitive.mode !== WEBGL_CONSTANTS.TRIANGLE_STRIP &&\n\t\t\t\t primitive.mode !== WEBGL_CONSTANTS.TRIANGLE_FAN &&\n\t\t\t\t primitive.mode !== undefined ) {\n\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t}\n\n\t\tconst extensionDef = nodeDef.extensions[ this.name ];\n\t\tconst attributesDef = extensionDef.attributes;\n\n\t\t// @TODO: Can we support InstancedMesh + SkinnedMesh?\n\n\t\tconst pending = [];\n\t\tconst attributes = {};\n\n\t\tfor ( const key in attributesDef ) {\n\n\t\t\tpending.push( this.parser.getDependency( 'accessor', attributesDef[ key ] ).then( accessor => {\n\n\t\t\t\tattributes[ key ] = accessor;\n\t\t\t\treturn attributes[ key ];\n\n\t\t\t} ) );\n\n\t\t}\n\n\t\tif ( pending.length < 1 ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tpending.push( this.parser.createNodeMesh( nodeIndex ) );\n\n\t\treturn Promise.all( pending ).then( results => {\n\n\t\t\tconst nodeObject = results.pop();\n\t\t\tconst meshes = nodeObject.isGroup ? nodeObject.children : [ nodeObject ];\n\t\t\tconst count = results[ 0 ].count; // All attribute counts should be same\n\t\t\tconst instancedMeshes = [];\n\n\t\t\tfor ( const mesh of meshes ) {\n\n\t\t\t\t// Temporal variables\n\t\t\t\tconst m = new Matrix4();\n\t\t\t\tconst p = new Vector3();\n\t\t\t\tconst q = new Quaternion();\n\t\t\t\tconst s = new Vector3( 1, 1, 1 );\n\n\t\t\t\tconst instancedMesh = new InstancedMesh( mesh.geometry, mesh.material, count );\n\n\t\t\t\tfor ( let i = 0; i < count; i ++ ) {\n\n\t\t\t\t\tif ( attributes.TRANSLATION ) {\n\n\t\t\t\t\t\tp.fromBufferAttribute( attributes.TRANSLATION, i );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( attributes.ROTATION ) {\n\n\t\t\t\t\t\tq.fromBufferAttribute( attributes.ROTATION, i );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( attributes.SCALE ) {\n\n\t\t\t\t\t\ts.fromBufferAttribute( attributes.SCALE, i );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tinstancedMesh.setMatrixAt( i, m.compose( p, q, s ) );\n\n\t\t\t\t}\n\n\t\t\t\t// Add instance attributes to the geometry, excluding TRS.\n\t\t\t\tfor ( const attributeName in attributes ) {\n\n\t\t\t\t\tif ( attributeName === '_COLOR_0' ) {\n\n\t\t\t\t\t\tconst attr = attributes[ attributeName ];\n\t\t\t\t\t\tinstancedMesh.instanceColor = new InstancedBufferAttribute( attr.array, attr.itemSize, attr.normalized );\n\n\t\t\t\t\t} else if ( attributeName !== 'TRANSLATION' &&\n\t\t\t\t\t\t attributeName !== 'ROTATION' &&\n\t\t\t\t\t\t attributeName !== 'SCALE' ) {\n\n\t\t\t\t\t\tmesh.geometry.setAttribute( attributeName, attributes[ attributeName ] );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// Just in case\n\t\t\t\tObject3D.prototype.copy.call( instancedMesh, mesh );\n\n\t\t\t\tthis.parser.assignFinalMaterial( instancedMesh );\n\n\t\t\t\tinstancedMeshes.push( instancedMesh );\n\n\t\t\t}\n\n\t\t\tif ( nodeObject.isGroup ) {\n\n\t\t\t\tnodeObject.clear();\n\n\t\t\t\tnodeObject.add( ... instancedMeshes );\n\n\t\t\t\treturn nodeObject;\n\n\t\t\t}\n\n\t\t\treturn instancedMeshes[ 0 ];\n\n\t\t} );\n\n\t}\n\n}\n\n/* BINARY EXTENSION */\nconst BINARY_EXTENSION_HEADER_MAGIC = 'glTF';\nconst BINARY_EXTENSION_HEADER_LENGTH = 12;\nconst BINARY_EXTENSION_CHUNK_TYPES = { JSON: 0x4E4F534A, BIN: 0x004E4942 };\n\nclass GLTFBinaryExtension {\n\n\tconstructor( data ) {\n\n\t\tthis.name = EXTENSIONS.KHR_BINARY_GLTF;\n\t\tthis.content = null;\n\t\tthis.body = null;\n\n\t\tconst headerView = new DataView( data, 0, BINARY_EXTENSION_HEADER_LENGTH );\n\t\tconst textDecoder = new TextDecoder();\n\n\t\tthis.header = {\n\t\t\tmagic: textDecoder.decode( new Uint8Array( data.slice( 0, 4 ) ) ),\n\t\t\tversion: headerView.getUint32( 4, true ),\n\t\t\tlength: headerView.getUint32( 8, true )\n\t\t};\n\n\t\tif ( this.header.magic !== BINARY_EXTENSION_HEADER_MAGIC ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Unsupported glTF-Binary header.' );\n\n\t\t} else if ( this.header.version < 2.0 ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Legacy binary file detected.' );\n\n\t\t}\n\n\t\tconst chunkContentsLength = this.header.length - BINARY_EXTENSION_HEADER_LENGTH;\n\t\tconst chunkView = new DataView( data, BINARY_EXTENSION_HEADER_LENGTH );\n\t\tlet chunkIndex = 0;\n\n\t\twhile ( chunkIndex < chunkContentsLength ) {\n\n\t\t\tconst chunkLength = chunkView.getUint32( chunkIndex, true );\n\t\t\tchunkIndex += 4;\n\n\t\t\tconst chunkType = chunkView.getUint32( chunkIndex, true );\n\t\t\tchunkIndex += 4;\n\n\t\t\tif ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.JSON ) {\n\n\t\t\t\tconst contentArray = new Uint8Array( data, BINARY_EXTENSION_HEADER_LENGTH + chunkIndex, chunkLength );\n\t\t\t\tthis.content = textDecoder.decode( contentArray );\n\n\t\t\t} else if ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.BIN ) {\n\n\t\t\t\tconst byteOffset = BINARY_EXTENSION_HEADER_LENGTH + chunkIndex;\n\t\t\t\tthis.body = data.slice( byteOffset, byteOffset + chunkLength );\n\n\t\t\t}\n\n\t\t\t// Clients must ignore chunks with unknown types.\n\n\t\t\tchunkIndex += chunkLength;\n\n\t\t}\n\n\t\tif ( this.content === null ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: JSON content not found.' );\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * DRACO Mesh Compression Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_draco_mesh_compression\n */\nclass GLTFDracoMeshCompressionExtension {\n\n\tconstructor( json, dracoLoader ) {\n\n\t\tif ( ! dracoLoader ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: No DRACOLoader instance provided.' );\n\n\t\t}\n\n\t\tthis.name = EXTENSIONS.KHR_DRACO_MESH_COMPRESSION;\n\t\tthis.json = json;\n\t\tthis.dracoLoader = dracoLoader;\n\t\tthis.dracoLoader.preload();\n\n\t}\n\n\tdecodePrimitive( primitive, parser ) {\n\n\t\tconst json = this.json;\n\t\tconst dracoLoader = this.dracoLoader;\n\t\tconst bufferViewIndex = primitive.extensions[ this.name ].bufferView;\n\t\tconst gltfAttributeMap = primitive.extensions[ this.name ].attributes;\n\t\tconst threeAttributeMap = {};\n\t\tconst attributeNormalizedMap = {};\n\t\tconst attributeTypeMap = {};\n\n\t\tfor ( const attributeName in gltfAttributeMap ) {\n\n\t\t\tconst threeAttributeName = ATTRIBUTES[ attributeName ] || attributeName.toLowerCase();\n\n\t\t\tthreeAttributeMap[ threeAttributeName ] = gltfAttributeMap[ attributeName ];\n\n\t\t}\n\n\t\tfor ( const attributeName in primitive.attributes ) {\n\n\t\t\tconst threeAttributeName = ATTRIBUTES[ attributeName ] || attributeName.toLowerCase();\n\n\t\t\tif ( gltfAttributeMap[ attributeName ] !== undefined ) {\n\n\t\t\t\tconst accessorDef = json.accessors[ primitive.attributes[ attributeName ] ];\n\t\t\t\tconst componentType = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\n\n\t\t\t\tattributeTypeMap[ threeAttributeName ] = componentType.name;\n\t\t\t\tattributeNormalizedMap[ threeAttributeName ] = accessorDef.normalized === true;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn parser.getDependency( 'bufferView', bufferViewIndex ).then( function ( bufferView ) {\n\n\t\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\t\tdracoLoader.decodeDracoFile( bufferView, function ( geometry ) {\n\n\t\t\t\t\tfor ( const attributeName in geometry.attributes ) {\n\n\t\t\t\t\t\tconst attribute = geometry.attributes[ attributeName ];\n\t\t\t\t\t\tconst normalized = attributeNormalizedMap[ attributeName ];\n\n\t\t\t\t\t\tif ( normalized !== undefined ) attribute.normalized = normalized;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve( geometry );\n\n\t\t\t\t}, threeAttributeMap, attributeTypeMap, LinearSRGBColorSpace, reject );\n\n\t\t\t} );\n\n\t\t} );\n\n\t}\n\n}\n\n/**\n * Texture Transform Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_transform\n */\nclass GLTFTextureTransformExtension {\n\n\tconstructor() {\n\n\t\tthis.name = EXTENSIONS.KHR_TEXTURE_TRANSFORM;\n\n\t}\n\n\textendTexture( texture, transform ) {\n\n\t\tif ( ( transform.texCoord === undefined || transform.texCoord === texture.channel )\n\t\t\t&& transform.offset === undefined\n\t\t\t&& transform.rotation === undefined\n\t\t\t&& transform.scale === undefined ) {\n\n\t\t\t// See https://github.com/mrdoob/three.js/issues/21819.\n\t\t\treturn texture;\n\n\t\t}\n\n\t\ttexture = texture.clone();\n\n\t\tif ( transform.texCoord !== undefined ) {\n\n\t\t\ttexture.channel = transform.texCoord;\n\n\t\t}\n\n\t\tif ( transform.offset !== undefined ) {\n\n\t\t\ttexture.offset.fromArray( transform.offset );\n\n\t\t}\n\n\t\tif ( transform.rotation !== undefined ) {\n\n\t\t\ttexture.rotation = transform.rotation;\n\n\t\t}\n\n\t\tif ( transform.scale !== undefined ) {\n\n\t\t\ttexture.repeat.fromArray( transform.scale );\n\n\t\t}\n\n\t\ttexture.needsUpdate = true;\n\n\t\treturn texture;\n\n\t}\n\n}\n\n/**\n * Mesh Quantization Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_mesh_quantization\n */\nclass GLTFMeshQuantizationExtension {\n\n\tconstructor() {\n\n\t\tthis.name = EXTENSIONS.KHR_MESH_QUANTIZATION;\n\n\t}\n\n}\n\n/*********************************/\n/********** INTERPOLATION ********/\n/*********************************/\n\n// Spline Interpolation\n// Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#appendix-c-spline-interpolation\nclass GLTFCubicSplineInterpolant extends Interpolant {\n\n\tconstructor( parameterPositions, sampleValues, sampleSize, resultBuffer ) {\n\n\t\tsuper( parameterPositions, sampleValues, sampleSize, resultBuffer );\n\n\t}\n\n\tcopySampleValue_( index ) {\n\n\t\t// Copies a sample value to the result buffer. See description of glTF\n\t\t// CUBICSPLINE values layout in interpolate_() function below.\n\n\t\tconst result = this.resultBuffer,\n\t\t\tvalues = this.sampleValues,\n\t\t\tvalueSize = this.valueSize,\n\t\t\toffset = index * valueSize * 3 + valueSize;\n\n\t\tfor ( let i = 0; i !== valueSize; i ++ ) {\n\n\t\t\tresult[ i ] = values[ offset + i ];\n\n\t\t}\n\n\t\treturn result;\n\n\t}\n\n\tinterpolate_( i1, t0, t, t1 ) {\n\n\t\tconst result = this.resultBuffer;\n\t\tconst values = this.sampleValues;\n\t\tconst stride = this.valueSize;\n\n\t\tconst stride2 = stride * 2;\n\t\tconst stride3 = stride * 3;\n\n\t\tconst td = t1 - t0;\n\n\t\tconst p = ( t - t0 ) / td;\n\t\tconst pp = p * p;\n\t\tconst ppp = pp * p;\n\n\t\tconst offset1 = i1 * stride3;\n\t\tconst offset0 = offset1 - stride3;\n\n\t\tconst s2 = - 2 * ppp + 3 * pp;\n\t\tconst s3 = ppp - pp;\n\t\tconst s0 = 1 - s2;\n\t\tconst s1 = s3 - pp + p;\n\n\t\t// Layout of keyframe output values for CUBICSPLINE animations:\n\t\t//   [ inTangent_1, splineVertex_1, outTangent_1, inTangent_2, splineVertex_2, ... ]\n\t\tfor ( let i = 0; i !== stride; i ++ ) {\n\n\t\t\tconst p0 = values[ offset0 + i + stride ]; // splineVertex_k\n\t\t\tconst m0 = values[ offset0 + i + stride2 ] * td; // outTangent_k * (t_k+1 - t_k)\n\t\t\tconst p1 = values[ offset1 + i + stride ]; // splineVertex_k+1\n\t\t\tconst m1 = values[ offset1 + i ] * td; // inTangent_k+1 * (t_k+1 - t_k)\n\n\t\t\tresult[ i ] = s0 * p0 + s1 * m0 + s2 * p1 + s3 * m1;\n\n\t\t}\n\n\t\treturn result;\n\n\t}\n\n}\n\nconst _q = new Quaternion();\n\nclass GLTFCubicSplineQuaternionInterpolant extends GLTFCubicSplineInterpolant {\n\n\tinterpolate_( i1, t0, t, t1 ) {\n\n\t\tconst result = super.interpolate_( i1, t0, t, t1 );\n\n\t\t_q.fromArray( result ).normalize().toArray( result );\n\n\t\treturn result;\n\n\t}\n\n}\n\n\n/*********************************/\n/********** INTERNALS ************/\n/*********************************/\n\n/* CONSTANTS */\n\nconst WEBGL_CONSTANTS = {\n\tFLOAT: 5126,\n\t//FLOAT_MAT2: 35674,\n\tFLOAT_MAT3: 35675,\n\tFLOAT_MAT4: 35676,\n\tFLOAT_VEC2: 35664,\n\tFLOAT_VEC3: 35665,\n\tFLOAT_VEC4: 35666,\n\tLINEAR: 9729,\n\tREPEAT: 10497,\n\tSAMPLER_2D: 35678,\n\tPOINTS: 0,\n\tLINES: 1,\n\tLINE_LOOP: 2,\n\tLINE_STRIP: 3,\n\tTRIANGLES: 4,\n\tTRIANGLE_STRIP: 5,\n\tTRIANGLE_FAN: 6,\n\tUNSIGNED_BYTE: 5121,\n\tUNSIGNED_SHORT: 5123\n};\n\nconst WEBGL_COMPONENT_TYPES = {\n\t5120: Int8Array,\n\t5121: Uint8Array,\n\t5122: Int16Array,\n\t5123: Uint16Array,\n\t5125: Uint32Array,\n\t5126: Float32Array\n};\n\nconst WEBGL_FILTERS = {\n\t9728: NearestFilter,\n\t9729: LinearFilter,\n\t9984: NearestMipmapNearestFilter,\n\t9985: LinearMipmapNearestFilter,\n\t9986: NearestMipmapLinearFilter,\n\t9987: LinearMipmapLinearFilter\n};\n\nconst WEBGL_WRAPPINGS = {\n\t33071: ClampToEdgeWrapping,\n\t33648: MirroredRepeatWrapping,\n\t10497: RepeatWrapping\n};\n\nconst WEBGL_TYPE_SIZES = {\n\t'SCALAR': 1,\n\t'VEC2': 2,\n\t'VEC3': 3,\n\t'VEC4': 4,\n\t'MAT2': 4,\n\t'MAT3': 9,\n\t'MAT4': 16\n};\n\nconst ATTRIBUTES = {\n\tPOSITION: 'position',\n\tNORMAL: 'normal',\n\tTANGENT: 'tangent',\n\tTEXCOORD_0: 'uv',\n\tTEXCOORD_1: 'uv1',\n\tTEXCOORD_2: 'uv2',\n\tTEXCOORD_3: 'uv3',\n\tCOLOR_0: 'color',\n\tWEIGHTS_0: 'skinWeight',\n\tJOINTS_0: 'skinIndex',\n};\n\nconst PATH_PROPERTIES = {\n\tscale: 'scale',\n\ttranslation: 'position',\n\trotation: 'quaternion',\n\tweights: 'morphTargetInfluences'\n};\n\nconst INTERPOLATION = {\n\tCUBICSPLINE: undefined, // We use a custom interpolant (GLTFCubicSplineInterpolation) for CUBICSPLINE tracks. Each\n\t\t                        // keyframe track will be initialized with a default interpolation type, then modified.\n\tLINEAR: InterpolateLinear,\n\tSTEP: InterpolateDiscrete\n};\n\nconst ALPHA_MODES = {\n\tOPAQUE: 'OPAQUE',\n\tMASK: 'MASK',\n\tBLEND: 'BLEND'\n};\n\n/**\n * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#default-material\n *\n * @param {Object<String, Material>} cache\n * @return {Material}\n */\nfunction createDefaultMaterial( cache ) {\n\n\tif ( cache[ 'DefaultMaterial' ] === undefined ) {\n\n\t\tcache[ 'DefaultMaterial' ] = new MeshStandardMaterial( {\n\t\t\tcolor: 0xFFFFFF,\n\t\t\temissive: 0x000000,\n\t\t\tmetalness: 1,\n\t\t\troughness: 1,\n\t\t\ttransparent: false,\n\t\t\tdepthTest: true,\n\t\t\tside: FrontSide\n\t\t} );\n\n\t}\n\n\treturn cache[ 'DefaultMaterial' ];\n\n}\n\nfunction addUnknownExtensionsToUserData( knownExtensions, object, objectDef ) {\n\n\t// Add unknown glTF extensions to an object's userData.\n\n\tfor ( const name in objectDef.extensions ) {\n\n\t\tif ( knownExtensions[ name ] === undefined ) {\n\n\t\t\tobject.userData.gltfExtensions = object.userData.gltfExtensions || {};\n\t\t\tobject.userData.gltfExtensions[ name ] = objectDef.extensions[ name ];\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * @param {Object3D|Material|BufferGeometry} object\n * @param {GLTF.definition} gltfDef\n */\nfunction assignExtrasToUserData( object, gltfDef ) {\n\n\tif ( gltfDef.extras !== undefined ) {\n\n\t\tif ( typeof gltfDef.extras === 'object' ) {\n\n\t\t\tObject.assign( object.userData, gltfDef.extras );\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Ignoring primitive type .extras, ' + gltfDef.extras );\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#morph-targets\n *\n * @param {BufferGeometry} geometry\n * @param {Array<GLTF.Target>} targets\n * @param {GLTFParser} parser\n * @return {Promise<BufferGeometry>}\n */\nfunction addMorphTargets( geometry, targets, parser ) {\n\n\tlet hasMorphPosition = false;\n\tlet hasMorphNormal = false;\n\tlet hasMorphColor = false;\n\n\tfor ( let i = 0, il = targets.length; i < il; i ++ ) {\n\n\t\tconst target = targets[ i ];\n\n\t\tif ( target.POSITION !== undefined ) hasMorphPosition = true;\n\t\tif ( target.NORMAL !== undefined ) hasMorphNormal = true;\n\t\tif ( target.COLOR_0 !== undefined ) hasMorphColor = true;\n\n\t\tif ( hasMorphPosition && hasMorphNormal && hasMorphColor ) break;\n\n\t}\n\n\tif ( ! hasMorphPosition && ! hasMorphNormal && ! hasMorphColor ) return Promise.resolve( geometry );\n\n\tconst pendingPositionAccessors = [];\n\tconst pendingNormalAccessors = [];\n\tconst pendingColorAccessors = [];\n\n\tfor ( let i = 0, il = targets.length; i < il; i ++ ) {\n\n\t\tconst target = targets[ i ];\n\n\t\tif ( hasMorphPosition ) {\n\n\t\t\tconst pendingAccessor = target.POSITION !== undefined\n\t\t\t\t? parser.getDependency( 'accessor', target.POSITION )\n\t\t\t\t: geometry.attributes.position;\n\n\t\t\tpendingPositionAccessors.push( pendingAccessor );\n\n\t\t}\n\n\t\tif ( hasMorphNormal ) {\n\n\t\t\tconst pendingAccessor = target.NORMAL !== undefined\n\t\t\t\t? parser.getDependency( 'accessor', target.NORMAL )\n\t\t\t\t: geometry.attributes.normal;\n\n\t\t\tpendingNormalAccessors.push( pendingAccessor );\n\n\t\t}\n\n\t\tif ( hasMorphColor ) {\n\n\t\t\tconst pendingAccessor = target.COLOR_0 !== undefined\n\t\t\t\t? parser.getDependency( 'accessor', target.COLOR_0 )\n\t\t\t\t: geometry.attributes.color;\n\n\t\t\tpendingColorAccessors.push( pendingAccessor );\n\n\t\t}\n\n\t}\n\n\treturn Promise.all( [\n\t\tPromise.all( pendingPositionAccessors ),\n\t\tPromise.all( pendingNormalAccessors ),\n\t\tPromise.all( pendingColorAccessors )\n\t] ).then( function ( accessors ) {\n\n\t\tconst morphPositions = accessors[ 0 ];\n\t\tconst morphNormals = accessors[ 1 ];\n\t\tconst morphColors = accessors[ 2 ];\n\n\t\tif ( hasMorphPosition ) geometry.morphAttributes.position = morphPositions;\n\t\tif ( hasMorphNormal ) geometry.morphAttributes.normal = morphNormals;\n\t\tif ( hasMorphColor ) geometry.morphAttributes.color = morphColors;\n\t\tgeometry.morphTargetsRelative = true;\n\n\t\treturn geometry;\n\n\t} );\n\n}\n\n/**\n * @param {Mesh} mesh\n * @param {GLTF.Mesh} meshDef\n */\nfunction updateMorphTargets( mesh, meshDef ) {\n\n\tmesh.updateMorphTargets();\n\n\tif ( meshDef.weights !== undefined ) {\n\n\t\tfor ( let i = 0, il = meshDef.weights.length; i < il; i ++ ) {\n\n\t\t\tmesh.morphTargetInfluences[ i ] = meshDef.weights[ i ];\n\n\t\t}\n\n\t}\n\n\t// .extras has user-defined data, so check that .extras.targetNames is an array.\n\tif ( meshDef.extras && Array.isArray( meshDef.extras.targetNames ) ) {\n\n\t\tconst targetNames = meshDef.extras.targetNames;\n\n\t\tif ( mesh.morphTargetInfluences.length === targetNames.length ) {\n\n\t\t\tmesh.morphTargetDictionary = {};\n\n\t\t\tfor ( let i = 0, il = targetNames.length; i < il; i ++ ) {\n\n\t\t\t\tmesh.morphTargetDictionary[ targetNames[ i ] ] = i;\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.' );\n\n\t\t}\n\n\t}\n\n}\n\nfunction createPrimitiveKey( primitiveDef ) {\n\n\tlet geometryKey;\n\n\tconst dracoExtension = primitiveDef.extensions && primitiveDef.extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ];\n\n\tif ( dracoExtension ) {\n\n\t\tgeometryKey = 'draco:' + dracoExtension.bufferView\n\t\t\t\t+ ':' + dracoExtension.indices\n\t\t\t\t+ ':' + createAttributesKey( dracoExtension.attributes );\n\n\t} else {\n\n\t\tgeometryKey = primitiveDef.indices + ':' + createAttributesKey( primitiveDef.attributes ) + ':' + primitiveDef.mode;\n\n\t}\n\n\tif ( primitiveDef.targets !== undefined ) {\n\n\t\tfor ( let i = 0, il = primitiveDef.targets.length; i < il; i ++ ) {\n\n\t\t\tgeometryKey += ':' + createAttributesKey( primitiveDef.targets[ i ] );\n\n\t\t}\n\n\t}\n\n\treturn geometryKey;\n\n}\n\nfunction createAttributesKey( attributes ) {\n\n\tlet attributesKey = '';\n\n\tconst keys = Object.keys( attributes ).sort();\n\n\tfor ( let i = 0, il = keys.length; i < il; i ++ ) {\n\n\t\tattributesKey += keys[ i ] + ':' + attributes[ keys[ i ] ] + ';';\n\n\t}\n\n\treturn attributesKey;\n\n}\n\nfunction getNormalizedComponentScale( constructor ) {\n\n\t// Reference:\n\t// https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_mesh_quantization#encoding-quantized-data\n\n\tswitch ( constructor ) {\n\n\t\tcase Int8Array:\n\t\t\treturn 1 / 127;\n\n\t\tcase Uint8Array:\n\t\t\treturn 1 / 255;\n\n\t\tcase Int16Array:\n\t\t\treturn 1 / 32767;\n\n\t\tcase Uint16Array:\n\t\t\treturn 1 / 65535;\n\n\t\tdefault:\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Unsupported normalized accessor component type.' );\n\n\t}\n\n}\n\nfunction getImageURIMimeType( uri ) {\n\n\tif ( uri.search( /\\.jpe?g($|\\?)/i ) > 0 || uri.search( /^data\\:image\\/jpeg/ ) === 0 ) return 'image/jpeg';\n\tif ( uri.search( /\\.webp($|\\?)/i ) > 0 || uri.search( /^data\\:image\\/webp/ ) === 0 ) return 'image/webp';\n\tif ( uri.search( /\\.ktx2($|\\?)/i ) > 0 || uri.search( /^data\\:image\\/ktx2/ ) === 0 ) return 'image/ktx2';\n\n\treturn 'image/png';\n\n}\n\nconst _identityMatrix = new Matrix4();\n\n/* GLTF PARSER */\n\nclass GLTFParser {\n\n\tconstructor( json = {}, options = {} ) {\n\n\t\tthis.json = json;\n\t\tthis.extensions = {};\n\t\tthis.plugins = {};\n\t\tthis.options = options;\n\n\t\t// loader object cache\n\t\tthis.cache = new GLTFRegistry();\n\n\t\t// associations between Three.js objects and glTF elements\n\t\tthis.associations = new Map();\n\n\t\t// BufferGeometry caching\n\t\tthis.primitiveCache = {};\n\n\t\t// Node cache\n\t\tthis.nodeCache = {};\n\n\t\t// Object3D instance caches\n\t\tthis.meshCache = { refs: {}, uses: {} };\n\t\tthis.cameraCache = { refs: {}, uses: {} };\n\t\tthis.lightCache = { refs: {}, uses: {} };\n\n\t\tthis.sourceCache = {};\n\t\tthis.textureCache = {};\n\n\t\t// Track node names, to ensure no duplicates\n\t\tthis.nodeNamesUsed = {};\n\n\t\t// Use an ImageBitmapLoader if imageBitmaps are supported. Moves much of the\n\t\t// expensive work of uploading a texture to the GPU off the main thread.\n\n\t\tlet isSafari = false;\n\t\tlet safariVersion = - 1;\n\t\tlet isFirefox = false;\n\t\tlet firefoxVersion = - 1;\n\n\t\tif ( typeof navigator !== 'undefined' ) {\n\n\t\t\tconst userAgent = navigator.userAgent;\n\n\t\t\tisSafari = /^((?!chrome|android).)*safari/i.test( userAgent ) === true;\n\t\t\tconst safariMatch = userAgent.match( /Version\\/(\\d+)/ );\n\t\t\tsafariVersion = isSafari && safariMatch ? parseInt( safariMatch[ 1 ], 10 ) : - 1;\n\n\t\t\tisFirefox = userAgent.indexOf( 'Firefox' ) > - 1;\n\t\t\tfirefoxVersion = isFirefox ? userAgent.match( /Firefox\\/([0-9]+)\\./ )[ 1 ] : - 1;\n\n\t\t}\n\n\t\tif ( typeof createImageBitmap === 'undefined' || ( isSafari && safariVersion < 17 ) || ( isFirefox && firefoxVersion < 98 ) ) {\n\n\t\t\tthis.textureLoader = new TextureLoader( this.options.manager );\n\n\t\t} else {\n\n\t\t\tthis.textureLoader = new ImageBitmapLoader( this.options.manager );\n\n\t\t}\n\n\t\tthis.textureLoader.setCrossOrigin( this.options.crossOrigin );\n\t\tthis.textureLoader.setRequestHeader( this.options.requestHeader );\n\n\t\tthis.fileLoader = new FileLoader( this.options.manager );\n\t\tthis.fileLoader.setResponseType( 'arraybuffer' );\n\n\t\tif ( this.options.crossOrigin === 'use-credentials' ) {\n\n\t\t\tthis.fileLoader.setWithCredentials( true );\n\n\t\t}\n\n\t}\n\n\tsetExtensions( extensions ) {\n\n\t\tthis.extensions = extensions;\n\n\t}\n\n\tsetPlugins( plugins ) {\n\n\t\tthis.plugins = plugins;\n\n\t}\n\n\tparse( onLoad, onError ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\n\t\t// Clear the loader cache\n\t\tthis.cache.removeAll();\n\t\tthis.nodeCache = {};\n\n\t\t// Mark the special nodes/meshes in json for efficient parse\n\t\tthis._invokeAll( function ( ext ) {\n\n\t\t\treturn ext._markDefs && ext._markDefs();\n\n\t\t} );\n\n\t\tPromise.all( this._invokeAll( function ( ext ) {\n\n\t\t\treturn ext.beforeRoot && ext.beforeRoot();\n\n\t\t} ) ).then( function () {\n\n\t\t\treturn Promise.all( [\n\n\t\t\t\tparser.getDependencies( 'scene' ),\n\t\t\t\tparser.getDependencies( 'animation' ),\n\t\t\t\tparser.getDependencies( 'camera' ),\n\n\t\t\t] );\n\n\t\t} ).then( function ( dependencies ) {\n\n\t\t\tconst result = {\n\t\t\t\tscene: dependencies[ 0 ][ json.scene || 0 ],\n\t\t\t\tscenes: dependencies[ 0 ],\n\t\t\t\tanimations: dependencies[ 1 ],\n\t\t\t\tcameras: dependencies[ 2 ],\n\t\t\t\tasset: json.asset,\n\t\t\t\tparser: parser,\n\t\t\t\tuserData: {}\n\t\t\t};\n\n\t\t\taddUnknownExtensionsToUserData( extensions, result, json );\n\n\t\t\tassignExtrasToUserData( result, json );\n\n\t\t\treturn Promise.all( parser._invokeAll( function ( ext ) {\n\n\t\t\t\treturn ext.afterRoot && ext.afterRoot( result );\n\n\t\t\t} ) ).then( function () {\n\n\t\t\t\tfor ( const scene of result.scenes ) {\n\n\t\t\t\t\tscene.updateMatrixWorld();\n\n\t\t\t\t}\n\n\t\t\t\tonLoad( result );\n\n\t\t\t} );\n\n\t\t} ).catch( onError );\n\n\t}\n\n\t/**\n\t * Marks the special nodes/meshes in json for efficient parse.\n\t */\n\t_markDefs() {\n\n\t\tconst nodeDefs = this.json.nodes || [];\n\t\tconst skinDefs = this.json.skins || [];\n\t\tconst meshDefs = this.json.meshes || [];\n\n\t\t// Nothing in the node definition indicates whether it is a Bone or an\n\t\t// Object3D. Use the skins' joint references to mark bones.\n\t\tfor ( let skinIndex = 0, skinLength = skinDefs.length; skinIndex < skinLength; skinIndex ++ ) {\n\n\t\t\tconst joints = skinDefs[ skinIndex ].joints;\n\n\t\t\tfor ( let i = 0, il = joints.length; i < il; i ++ ) {\n\n\t\t\t\tnodeDefs[ joints[ i ] ].isBone = true;\n\n\t\t\t}\n\n\t\t}\n\n\t\t// Iterate over all nodes, marking references to shared resources,\n\t\t// as well as skeleton joints.\n\t\tfor ( let nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {\n\n\t\t\tconst nodeDef = nodeDefs[ nodeIndex ];\n\n\t\t\tif ( nodeDef.mesh !== undefined ) {\n\n\t\t\t\tthis._addNodeRef( this.meshCache, nodeDef.mesh );\n\n\t\t\t\t// Nothing in the mesh definition indicates whether it is\n\t\t\t\t// a SkinnedMesh or Mesh. Use the node's mesh reference\n\t\t\t\t// to mark SkinnedMesh if node has skin.\n\t\t\t\tif ( nodeDef.skin !== undefined ) {\n\n\t\t\t\t\tmeshDefs[ nodeDef.mesh ].isSkinnedMesh = true;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( nodeDef.camera !== undefined ) {\n\n\t\t\t\tthis._addNodeRef( this.cameraCache, nodeDef.camera );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Counts references to shared node / Object3D resources. These resources\n\t * can be reused, or \"instantiated\", at multiple nodes in the scene\n\t * hierarchy. Mesh, Camera, and Light instances are instantiated and must\n\t * be marked. Non-scenegraph resources (like Materials, Geometries, and\n\t * Textures) can be reused directly and are not marked here.\n\t *\n\t * Example: CesiumMilkTruck sample model reuses \"Wheel\" meshes.\n\t *\n\t * @param {Object} cache\n\t * @param {Object3D} index\n\t */\n\t_addNodeRef( cache, index ) {\n\n\t\tif ( index === undefined ) return;\n\n\t\tif ( cache.refs[ index ] === undefined ) {\n\n\t\t\tcache.refs[ index ] = cache.uses[ index ] = 0;\n\n\t\t}\n\n\t\tcache.refs[ index ] ++;\n\n\t}\n\n\t/**\n\t * Returns a reference to a shared resource, cloning it if necessary.\n\t *\n\t * @param {Object} cache\n\t * @param {Number} index\n\t * @param {Object} object\n\t * @return {Object}\n\t */\n\t_getNodeRef( cache, index, object ) {\n\n\t\tif ( cache.refs[ index ] <= 1 ) return object;\n\n\t\tconst ref = object.clone();\n\n\t\t// Propagates mappings to the cloned object, prevents mappings on the\n\t\t// original object from being lost.\n\t\tconst updateMappings = ( original, clone ) => {\n\n\t\t\tconst mappings = this.associations.get( original );\n\t\t\tif ( mappings != null ) {\n\n\t\t\t\tthis.associations.set( clone, mappings );\n\n\t\t\t}\n\n\t\t\tfor ( const [ i, child ] of original.children.entries() ) {\n\n\t\t\t\tupdateMappings( child, clone.children[ i ] );\n\n\t\t\t}\n\n\t\t};\n\n\t\tupdateMappings( object, ref );\n\n\t\tref.name += '_instance_' + ( cache.uses[ index ] ++ );\n\n\t\treturn ref;\n\n\t}\n\n\t_invokeOne( func ) {\n\n\t\tconst extensions = Object.values( this.plugins );\n\t\textensions.push( this );\n\n\t\tfor ( let i = 0; i < extensions.length; i ++ ) {\n\n\t\t\tconst result = func( extensions[ i ] );\n\n\t\t\tif ( result ) return result;\n\n\t\t}\n\n\t\treturn null;\n\n\t}\n\n\t_invokeAll( func ) {\n\n\t\tconst extensions = Object.values( this.plugins );\n\t\textensions.unshift( this );\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0; i < extensions.length; i ++ ) {\n\n\t\t\tconst result = func( extensions[ i ] );\n\n\t\t\tif ( result ) pending.push( result );\n\n\t\t}\n\n\t\treturn pending;\n\n\t}\n\n\t/**\n\t * Requests the specified dependency asynchronously, with caching.\n\t * @param {string} type\n\t * @param {number} index\n\t * @return {Promise<Object3D|Material|THREE.Texture|AnimationClip|ArrayBuffer|Object>}\n\t */\n\tgetDependency( type, index ) {\n\n\t\tconst cacheKey = type + ':' + index;\n\t\tlet dependency = this.cache.get( cacheKey );\n\n\t\tif ( ! dependency ) {\n\n\t\t\tswitch ( type ) {\n\n\t\t\t\tcase 'scene':\n\t\t\t\t\tdependency = this.loadScene( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'node':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadNode && ext.loadNode( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'mesh':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadMesh && ext.loadMesh( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'accessor':\n\t\t\t\t\tdependency = this.loadAccessor( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'bufferView':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadBufferView && ext.loadBufferView( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'buffer':\n\t\t\t\t\tdependency = this.loadBuffer( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'material':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadMaterial && ext.loadMaterial( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'texture':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadTexture && ext.loadTexture( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'skin':\n\t\t\t\t\tdependency = this.loadSkin( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'animation':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadAnimation && ext.loadAnimation( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'camera':\n\t\t\t\t\tdependency = this.loadCamera( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext != this && ext.getDependency && ext.getDependency( type, index );\n\n\t\t\t\t\t} );\n\n\t\t\t\t\tif ( ! dependency ) {\n\n\t\t\t\t\t\tthrow new Error( 'Unknown type: ' + type );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tthis.cache.add( cacheKey, dependency );\n\n\t\t}\n\n\t\treturn dependency;\n\n\t}\n\n\t/**\n\t * Requests all dependencies of the specified type asynchronously, with caching.\n\t * @param {string} type\n\t * @return {Promise<Array<Object>>}\n\t */\n\tgetDependencies( type ) {\n\n\t\tlet dependencies = this.cache.get( type );\n\n\t\tif ( ! dependencies ) {\n\n\t\t\tconst parser = this;\n\t\t\tconst defs = this.json[ type + ( type === 'mesh' ? 'es' : 's' ) ] || [];\n\n\t\t\tdependencies = Promise.all( defs.map( function ( def, index ) {\n\n\t\t\t\treturn parser.getDependency( type, index );\n\n\t\t\t} ) );\n\n\t\t\tthis.cache.add( type, dependencies );\n\n\t\t}\n\n\t\treturn dependencies;\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\n\t * @param {number} bufferIndex\n\t * @return {Promise<ArrayBuffer>}\n\t */\n\tloadBuffer( bufferIndex ) {\n\n\t\tconst bufferDef = this.json.buffers[ bufferIndex ];\n\t\tconst loader = this.fileLoader;\n\n\t\tif ( bufferDef.type && bufferDef.type !== 'arraybuffer' ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: ' + bufferDef.type + ' buffer type is not supported.' );\n\n\t\t}\n\n\t\t// If present, GLB container is required to be the first buffer.\n\t\tif ( bufferDef.uri === undefined && bufferIndex === 0 ) {\n\n\t\t\treturn Promise.resolve( this.extensions[ EXTENSIONS.KHR_BINARY_GLTF ].body );\n\n\t\t}\n\n\t\tconst options = this.options;\n\n\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\tloader.load( LoaderUtils.resolveURL( bufferDef.uri, options.path ), resolve, undefined, function () {\n\n\t\t\t\treject( new Error( 'THREE.GLTFLoader: Failed to load buffer \"' + bufferDef.uri + '\".' ) );\n\n\t\t\t} );\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\n\t * @param {number} bufferViewIndex\n\t * @return {Promise<ArrayBuffer>}\n\t */\n\tloadBufferView( bufferViewIndex ) {\n\n\t\tconst bufferViewDef = this.json.bufferViews[ bufferViewIndex ];\n\n\t\treturn this.getDependency( 'buffer', bufferViewDef.buffer ).then( function ( buffer ) {\n\n\t\t\tconst byteLength = bufferViewDef.byteLength || 0;\n\t\t\tconst byteOffset = bufferViewDef.byteOffset || 0;\n\t\t\treturn buffer.slice( byteOffset, byteOffset + byteLength );\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#accessors\n\t * @param {number} accessorIndex\n\t * @return {Promise<BufferAttribute|InterleavedBufferAttribute>}\n\t */\n\tloadAccessor( accessorIndex ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\n\t\tconst accessorDef = this.json.accessors[ accessorIndex ];\n\n\t\tif ( accessorDef.bufferView === undefined && accessorDef.sparse === undefined ) {\n\n\t\t\tconst itemSize = WEBGL_TYPE_SIZES[ accessorDef.type ];\n\t\t\tconst TypedArray = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\n\t\t\tconst normalized = accessorDef.normalized === true;\n\n\t\t\tconst array = new TypedArray( accessorDef.count * itemSize );\n\t\t\treturn Promise.resolve( new BufferAttribute( array, itemSize, normalized ) );\n\n\t\t}\n\n\t\tconst pendingBufferViews = [];\n\n\t\tif ( accessorDef.bufferView !== undefined ) {\n\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.bufferView ) );\n\n\t\t} else {\n\n\t\t\tpendingBufferViews.push( null );\n\n\t\t}\n\n\t\tif ( accessorDef.sparse !== undefined ) {\n\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.indices.bufferView ) );\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.values.bufferView ) );\n\n\t\t}\n\n\t\treturn Promise.all( pendingBufferViews ).then( function ( bufferViews ) {\n\n\t\t\tconst bufferView = bufferViews[ 0 ];\n\n\t\t\tconst itemSize = WEBGL_TYPE_SIZES[ accessorDef.type ];\n\t\t\tconst TypedArray = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\n\n\t\t\t// For VEC3: itemSize is 3, elementBytes is 4, itemBytes is 12.\n\t\t\tconst elementBytes = TypedArray.BYTES_PER_ELEMENT;\n\t\t\tconst itemBytes = elementBytes * itemSize;\n\t\t\tconst byteOffset = accessorDef.byteOffset || 0;\n\t\t\tconst byteStride = accessorDef.bufferView !== undefined ? json.bufferViews[ accessorDef.bufferView ].byteStride : undefined;\n\t\t\tconst normalized = accessorDef.normalized === true;\n\t\t\tlet array, bufferAttribute;\n\n\t\t\t// The buffer is not interleaved if the stride is the item size in bytes.\n\t\t\tif ( byteStride && byteStride !== itemBytes ) {\n\n\t\t\t\t// Each \"slice\" of the buffer, as defined by 'count' elements of 'byteStride' bytes, gets its own InterleavedBuffer\n\t\t\t\t// This makes sure that IBA.count reflects accessor.count properly\n\t\t\t\tconst ibSlice = Math.floor( byteOffset / byteStride );\n\t\t\t\tconst ibCacheKey = 'InterleavedBuffer:' + accessorDef.bufferView + ':' + accessorDef.componentType + ':' + ibSlice + ':' + accessorDef.count;\n\t\t\t\tlet ib = parser.cache.get( ibCacheKey );\n\n\t\t\t\tif ( ! ib ) {\n\n\t\t\t\t\tarray = new TypedArray( bufferView, ibSlice * byteStride, accessorDef.count * byteStride / elementBytes );\n\n\t\t\t\t\t// Integer parameters to IB/IBA are in array elements, not bytes.\n\t\t\t\t\tib = new InterleavedBuffer( array, byteStride / elementBytes );\n\n\t\t\t\t\tparser.cache.add( ibCacheKey, ib );\n\n\t\t\t\t}\n\n\t\t\t\tbufferAttribute = new InterleavedBufferAttribute( ib, itemSize, ( byteOffset % byteStride ) / elementBytes, normalized );\n\n\t\t\t} else {\n\n\t\t\t\tif ( bufferView === null ) {\n\n\t\t\t\t\tarray = new TypedArray( accessorDef.count * itemSize );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tarray = new TypedArray( bufferView, byteOffset, accessorDef.count * itemSize );\n\n\t\t\t\t}\n\n\t\t\t\tbufferAttribute = new BufferAttribute( array, itemSize, normalized );\n\n\t\t\t}\n\n\t\t\t// https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#sparse-accessors\n\t\t\tif ( accessorDef.sparse !== undefined ) {\n\n\t\t\t\tconst itemSizeIndices = WEBGL_TYPE_SIZES.SCALAR;\n\t\t\t\tconst TypedArrayIndices = WEBGL_COMPONENT_TYPES[ accessorDef.sparse.indices.componentType ];\n\n\t\t\t\tconst byteOffsetIndices = accessorDef.sparse.indices.byteOffset || 0;\n\t\t\t\tconst byteOffsetValues = accessorDef.sparse.values.byteOffset || 0;\n\n\t\t\t\tconst sparseIndices = new TypedArrayIndices( bufferViews[ 1 ], byteOffsetIndices, accessorDef.sparse.count * itemSizeIndices );\n\t\t\t\tconst sparseValues = new TypedArray( bufferViews[ 2 ], byteOffsetValues, accessorDef.sparse.count * itemSize );\n\n\t\t\t\tif ( bufferView !== null ) {\n\n\t\t\t\t\t// Avoid modifying the original ArrayBuffer, if the bufferView wasn't initialized with zeroes.\n\t\t\t\t\tbufferAttribute = new BufferAttribute( bufferAttribute.array.slice(), bufferAttribute.itemSize, bufferAttribute.normalized );\n\n\t\t\t\t}\n\n\t\t\t\t// Ignore normalized since we copy from sparse\n\t\t\t\tbufferAttribute.normalized = false;\n\n\t\t\t\tfor ( let i = 0, il = sparseIndices.length; i < il; i ++ ) {\n\n\t\t\t\t\tconst index = sparseIndices[ i ];\n\n\t\t\t\t\tbufferAttribute.setX( index, sparseValues[ i * itemSize ] );\n\t\t\t\t\tif ( itemSize >= 2 ) bufferAttribute.setY( index, sparseValues[ i * itemSize + 1 ] );\n\t\t\t\t\tif ( itemSize >= 3 ) bufferAttribute.setZ( index, sparseValues[ i * itemSize + 2 ] );\n\t\t\t\t\tif ( itemSize >= 4 ) bufferAttribute.setW( index, sparseValues[ i * itemSize + 3 ] );\n\t\t\t\t\tif ( itemSize >= 5 ) throw new Error( 'THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.' );\n\n\t\t\t\t}\n\n\t\t\t\tbufferAttribute.normalized = normalized;\n\n\t\t\t}\n\n\t\t\treturn bufferAttribute;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#textures\n\t * @param {number} textureIndex\n\t * @return {Promise<THREE.Texture|null>}\n\t */\n\tloadTexture( textureIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst options = this.options;\n\t\tconst textureDef = json.textures[ textureIndex ];\n\t\tconst sourceIndex = textureDef.source;\n\t\tconst sourceDef = json.images[ sourceIndex ];\n\n\t\tlet loader = this.textureLoader;\n\n\t\tif ( sourceDef.uri ) {\n\n\t\t\tconst handler = options.manager.getHandler( sourceDef.uri );\n\t\t\tif ( handler !== null ) loader = handler;\n\n\t\t}\n\n\t\treturn this.loadTextureImage( textureIndex, sourceIndex, loader );\n\n\t}\n\n\tloadTextureImage( textureIndex, sourceIndex, loader ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\t\tconst sourceDef = json.images[ sourceIndex ];\n\n\t\tconst cacheKey = ( sourceDef.uri || sourceDef.bufferView ) + ':' + textureDef.sampler;\n\n\t\tif ( this.textureCache[ cacheKey ] ) {\n\n\t\t\t// See https://github.com/mrdoob/three.js/issues/21559.\n\t\t\treturn this.textureCache[ cacheKey ];\n\n\t\t}\n\n\t\tconst promise = this.loadImageSource( sourceIndex, loader ).then( function ( texture ) {\n\n\t\t\ttexture.flipY = false;\n\n\t\t\ttexture.name = textureDef.name || sourceDef.name || '';\n\n\t\t\tif ( texture.name === '' && typeof sourceDef.uri === 'string' && sourceDef.uri.startsWith( 'data:image/' ) === false ) {\n\n\t\t\t\ttexture.name = sourceDef.uri;\n\n\t\t\t}\n\n\t\t\tconst samplers = json.samplers || {};\n\t\t\tconst sampler = samplers[ textureDef.sampler ] || {};\n\n\t\t\ttexture.magFilter = WEBGL_FILTERS[ sampler.magFilter ] || LinearFilter;\n\t\t\ttexture.minFilter = WEBGL_FILTERS[ sampler.minFilter ] || LinearMipmapLinearFilter;\n\t\t\ttexture.wrapS = WEBGL_WRAPPINGS[ sampler.wrapS ] || RepeatWrapping;\n\t\t\ttexture.wrapT = WEBGL_WRAPPINGS[ sampler.wrapT ] || RepeatWrapping;\n\t\t\ttexture.generateMipmaps = ! texture.isCompressedTexture && texture.minFilter !== NearestFilter && texture.minFilter !== LinearFilter;\n\n\t\t\tparser.associations.set( texture, { textures: textureIndex } );\n\n\t\t\treturn texture;\n\n\t\t} ).catch( function () {\n\n\t\t\treturn null;\n\n\t\t} );\n\n\t\tthis.textureCache[ cacheKey ] = promise;\n\n\t\treturn promise;\n\n\t}\n\n\tloadImageSource( sourceIndex, loader ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst options = this.options;\n\n\t\tif ( this.sourceCache[ sourceIndex ] !== undefined ) {\n\n\t\t\treturn this.sourceCache[ sourceIndex ].then( ( texture ) => texture.clone() );\n\n\t\t}\n\n\t\tconst sourceDef = json.images[ sourceIndex ];\n\n\t\tconst URL = self.URL || self.webkitURL;\n\n\t\tlet sourceURI = sourceDef.uri || '';\n\t\tlet isObjectURL = false;\n\n\t\tif ( sourceDef.bufferView !== undefined ) {\n\n\t\t\t// Load binary image data from bufferView, if provided.\n\n\t\t\tsourceURI = parser.getDependency( 'bufferView', sourceDef.bufferView ).then( function ( bufferView ) {\n\n\t\t\t\tisObjectURL = true;\n\t\t\t\tconst blob = new Blob( [ bufferView ], { type: sourceDef.mimeType } );\n\t\t\t\tsourceURI = URL.createObjectURL( blob );\n\t\t\t\treturn sourceURI;\n\n\t\t\t} );\n\n\t\t} else if ( sourceDef.uri === undefined ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Image ' + sourceIndex + ' is missing URI and bufferView' );\n\n\t\t}\n\n\t\tconst promise = Promise.resolve( sourceURI ).then( function ( sourceURI ) {\n\n\t\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\t\tlet onLoad = resolve;\n\n\t\t\t\tif ( loader.isImageBitmapLoader === true ) {\n\n\t\t\t\t\tonLoad = function ( imageBitmap ) {\n\n\t\t\t\t\t\tconst texture = new Texture( imageBitmap );\n\t\t\t\t\t\ttexture.needsUpdate = true;\n\n\t\t\t\t\t\tresolve( texture );\n\n\t\t\t\t\t};\n\n\t\t\t\t}\n\n\t\t\t\tloader.load( LoaderUtils.resolveURL( sourceURI, options.path ), onLoad, undefined, reject );\n\n\t\t\t} );\n\n\t\t} ).then( function ( texture ) {\n\n\t\t\t// Clean up resources and configure Texture.\n\n\t\t\tif ( isObjectURL === true ) {\n\n\t\t\t\tURL.revokeObjectURL( sourceURI );\n\n\t\t\t}\n\n\t\t\tassignExtrasToUserData( texture, sourceDef );\n\n\t\t\ttexture.userData.mimeType = sourceDef.mimeType || getImageURIMimeType( sourceDef.uri );\n\n\t\t\treturn texture;\n\n\t\t} ).catch( function ( error ) {\n\n\t\t\tconsole.error( 'THREE.GLTFLoader: Couldn\\'t load texture', sourceURI );\n\t\t\tthrow error;\n\n\t\t} );\n\n\t\tthis.sourceCache[ sourceIndex ] = promise;\n\t\treturn promise;\n\n\t}\n\n\t/**\n\t * Asynchronously assigns a texture to the given material parameters.\n\t *\n\t * @param {Object} materialParams\n\t * @param {string} mapName\n\t * @param {Object} mapDef\n\t * @param {string} colorSpace\n\t * @return {Promise<Texture>}\n\t */\n\tassignTexture( materialParams, mapName, mapDef, colorSpace ) {\n\n\t\tconst parser = this;\n\n\t\treturn this.getDependency( 'texture', mapDef.index ).then( function ( texture ) {\n\n\t\t\tif ( ! texture ) return null;\n\n\t\t\tif ( mapDef.texCoord !== undefined && mapDef.texCoord > 0 ) {\n\n\t\t\t\ttexture = texture.clone();\n\t\t\t\ttexture.channel = mapDef.texCoord;\n\n\t\t\t}\n\n\t\t\tif ( parser.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ] ) {\n\n\t\t\t\tconst transform = mapDef.extensions !== undefined ? mapDef.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ] : undefined;\n\n\t\t\t\tif ( transform ) {\n\n\t\t\t\t\tconst gltfReference = parser.associations.get( texture );\n\t\t\t\t\ttexture = parser.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ].extendTexture( texture, transform );\n\t\t\t\t\tparser.associations.set( texture, gltfReference );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( colorSpace !== undefined ) {\n\n\t\t\t\ttexture.colorSpace = colorSpace;\n\n\t\t\t}\n\n\t\t\tmaterialParams[ mapName ] = texture;\n\n\t\t\treturn texture;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Assigns final material to a Mesh, Line, or Points instance. The instance\n\t * already has a material (generated from the glTF material options alone)\n\t * but reuse of the same glTF material may require multiple threejs materials\n\t * to accommodate different primitive types, defines, etc. New materials will\n\t * be created if necessary, and reused from a cache.\n\t * @param  {Object3D} mesh Mesh, Line, or Points instance.\n\t */\n\tassignFinalMaterial( mesh ) {\n\n\t\tconst geometry = mesh.geometry;\n\t\tlet material = mesh.material;\n\n\t\tconst useDerivativeTangents = geometry.attributes.tangent === undefined;\n\t\tconst useVertexColors = geometry.attributes.color !== undefined;\n\t\tconst useFlatShading = geometry.attributes.normal === undefined;\n\n\t\tif ( mesh.isPoints ) {\n\n\t\t\tconst cacheKey = 'PointsMaterial:' + material.uuid;\n\n\t\t\tlet pointsMaterial = this.cache.get( cacheKey );\n\n\t\t\tif ( ! pointsMaterial ) {\n\n\t\t\t\tpointsMaterial = new PointsMaterial();\n\t\t\t\tMaterial.prototype.copy.call( pointsMaterial, material );\n\t\t\t\tpointsMaterial.color.copy( material.color );\n\t\t\t\tpointsMaterial.map = material.map;\n\t\t\t\tpointsMaterial.sizeAttenuation = false; // glTF spec says points should be 1px\n\n\t\t\t\tthis.cache.add( cacheKey, pointsMaterial );\n\n\t\t\t}\n\n\t\t\tmaterial = pointsMaterial;\n\n\t\t} else if ( mesh.isLine ) {\n\n\t\t\tconst cacheKey = 'LineBasicMaterial:' + material.uuid;\n\n\t\t\tlet lineMaterial = this.cache.get( cacheKey );\n\n\t\t\tif ( ! lineMaterial ) {\n\n\t\t\t\tlineMaterial = new LineBasicMaterial();\n\t\t\t\tMaterial.prototype.copy.call( lineMaterial, material );\n\t\t\t\tlineMaterial.color.copy( material.color );\n\t\t\t\tlineMaterial.map = material.map;\n\n\t\t\t\tthis.cache.add( cacheKey, lineMaterial );\n\n\t\t\t}\n\n\t\t\tmaterial = lineMaterial;\n\n\t\t}\n\n\t\t// Clone the material if it will be modified\n\t\tif ( useDerivativeTangents || useVertexColors || useFlatShading ) {\n\n\t\t\tlet cacheKey = 'ClonedMaterial:' + material.uuid + ':';\n\n\t\t\tif ( useDerivativeTangents ) cacheKey += 'derivative-tangents:';\n\t\t\tif ( useVertexColors ) cacheKey += 'vertex-colors:';\n\t\t\tif ( useFlatShading ) cacheKey += 'flat-shading:';\n\n\t\t\tlet cachedMaterial = this.cache.get( cacheKey );\n\n\t\t\tif ( ! cachedMaterial ) {\n\n\t\t\t\tcachedMaterial = material.clone();\n\n\t\t\t\tif ( useVertexColors ) cachedMaterial.vertexColors = true;\n\t\t\t\tif ( useFlatShading ) cachedMaterial.flatShading = true;\n\n\t\t\t\tif ( useDerivativeTangents ) {\n\n\t\t\t\t\t// https://github.com/mrdoob/three.js/issues/11438#issuecomment-507003995\n\t\t\t\t\tif ( cachedMaterial.normalScale ) cachedMaterial.normalScale.y *= - 1;\n\t\t\t\t\tif ( cachedMaterial.clearcoatNormalScale ) cachedMaterial.clearcoatNormalScale.y *= - 1;\n\n\t\t\t\t}\n\n\t\t\t\tthis.cache.add( cacheKey, cachedMaterial );\n\n\t\t\t\tthis.associations.set( cachedMaterial, this.associations.get( material ) );\n\n\t\t\t}\n\n\t\t\tmaterial = cachedMaterial;\n\n\t\t}\n\n\t\tmesh.material = material;\n\n\t}\n\n\tgetMaterialType( /* materialIndex */ ) {\n\n\t\treturn MeshStandardMaterial;\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#materials\n\t * @param {number} materialIndex\n\t * @return {Promise<Material>}\n\t */\n\tloadMaterial( materialIndex ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\t\tconst materialDef = json.materials[ materialIndex ];\n\n\t\tlet materialType;\n\t\tconst materialParams = {};\n\t\tconst materialExtensions = materialDef.extensions || {};\n\n\t\tconst pending = [];\n\n\t\tif ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_UNLIT ] ) {\n\n\t\t\tconst kmuExtension = extensions[ EXTENSIONS.KHR_MATERIALS_UNLIT ];\n\t\t\tmaterialType = kmuExtension.getMaterialType();\n\t\t\tpending.push( kmuExtension.extendParams( materialParams, materialDef, parser ) );\n\n\t\t} else {\n\n\t\t\t// Specification:\n\t\t\t// https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#metallic-roughness-material\n\n\t\t\tconst metallicRoughness = materialDef.pbrMetallicRoughness || {};\n\n\t\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\n\t\t\tmaterialParams.opacity = 1.0;\n\n\t\t\tif ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\n\n\t\t\t\tconst array = metallicRoughness.baseColorFactor;\n\n\t\t\t\tmaterialParams.color.setRGB( array[ 0 ], array[ 1 ], array[ 2 ], LinearSRGBColorSpace );\n\t\t\t\tmaterialParams.opacity = array[ 3 ];\n\n\t\t\t}\n\n\t\t\tif ( metallicRoughness.baseColorTexture !== undefined ) {\n\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture, SRGBColorSpace ) );\n\n\t\t\t}\n\n\t\t\tmaterialParams.metalness = metallicRoughness.metallicFactor !== undefined ? metallicRoughness.metallicFactor : 1.0;\n\t\t\tmaterialParams.roughness = metallicRoughness.roughnessFactor !== undefined ? metallicRoughness.roughnessFactor : 1.0;\n\n\t\t\tif ( metallicRoughness.metallicRoughnessTexture !== undefined ) {\n\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'metalnessMap', metallicRoughness.metallicRoughnessTexture ) );\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'roughnessMap', metallicRoughness.metallicRoughnessTexture ) );\n\n\t\t\t}\n\n\t\t\tmaterialType = this._invokeOne( function ( ext ) {\n\n\t\t\t\treturn ext.getMaterialType && ext.getMaterialType( materialIndex );\n\n\t\t\t} );\n\n\t\t\tpending.push( Promise.all( this._invokeAll( function ( ext ) {\n\n\t\t\t\treturn ext.extendMaterialParams && ext.extendMaterialParams( materialIndex, materialParams );\n\n\t\t\t} ) ) );\n\n\t\t}\n\n\t\tif ( materialDef.doubleSided === true ) {\n\n\t\t\tmaterialParams.side = DoubleSide;\n\n\t\t}\n\n\t\tconst alphaMode = materialDef.alphaMode || ALPHA_MODES.OPAQUE;\n\n\t\tif ( alphaMode === ALPHA_MODES.BLEND ) {\n\n\t\t\tmaterialParams.transparent = true;\n\n\t\t\t// See: https://github.com/mrdoob/three.js/issues/17706\n\t\t\tmaterialParams.depthWrite = false;\n\n\t\t} else {\n\n\t\t\tmaterialParams.transparent = false;\n\n\t\t\tif ( alphaMode === ALPHA_MODES.MASK ) {\n\n\t\t\t\tmaterialParams.alphaTest = materialDef.alphaCutoff !== undefined ? materialDef.alphaCutoff : 0.5;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( materialDef.normalTexture !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'normalMap', materialDef.normalTexture ) );\n\n\t\t\tmaterialParams.normalScale = new Vector2( 1, 1 );\n\n\t\t\tif ( materialDef.normalTexture.scale !== undefined ) {\n\n\t\t\t\tconst scale = materialDef.normalTexture.scale;\n\n\t\t\t\tmaterialParams.normalScale.set( scale, scale );\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( materialDef.occlusionTexture !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'aoMap', materialDef.occlusionTexture ) );\n\n\t\t\tif ( materialDef.occlusionTexture.strength !== undefined ) {\n\n\t\t\t\tmaterialParams.aoMapIntensity = materialDef.occlusionTexture.strength;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( materialDef.emissiveFactor !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tconst emissiveFactor = materialDef.emissiveFactor;\n\t\t\tmaterialParams.emissive = new Color().setRGB( emissiveFactor[ 0 ], emissiveFactor[ 1 ], emissiveFactor[ 2 ], LinearSRGBColorSpace );\n\n\t\t}\n\n\t\tif ( materialDef.emissiveTexture !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'emissiveMap', materialDef.emissiveTexture, SRGBColorSpace ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending ).then( function () {\n\n\t\t\tconst material = new materialType( materialParams );\n\n\t\t\tif ( materialDef.name ) material.name = materialDef.name;\n\n\t\t\tassignExtrasToUserData( material, materialDef );\n\n\t\t\tparser.associations.set( material, { materials: materialIndex } );\n\n\t\t\tif ( materialDef.extensions ) addUnknownExtensionsToUserData( extensions, material, materialDef );\n\n\t\t\treturn material;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * When Object3D instances are targeted by animation, they need unique names.\n\t *\n\t * @param {String} originalName\n\t * @return {String}\n\t */\n\tcreateUniqueName( originalName ) {\n\n\t\tconst sanitizedName = PropertyBinding.sanitizeNodeName( originalName || '' );\n\n\t\tif ( sanitizedName in this.nodeNamesUsed ) {\n\n\t\t\treturn sanitizedName + '_' + ( ++ this.nodeNamesUsed[ sanitizedName ] );\n\n\t\t} else {\n\n\t\t\tthis.nodeNamesUsed[ sanitizedName ] = 0;\n\n\t\t\treturn sanitizedName;\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#geometry\n\t *\n\t * Creates BufferGeometries from primitives.\n\t *\n\t * @param {Array<GLTF.Primitive>} primitives\n\t * @return {Promise<Array<BufferGeometry>>}\n\t */\n\tloadGeometries( primitives ) {\n\n\t\tconst parser = this;\n\t\tconst extensions = this.extensions;\n\t\tconst cache = this.primitiveCache;\n\n\t\tfunction createDracoPrimitive( primitive ) {\n\n\t\t\treturn extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ]\n\t\t\t\t.decodePrimitive( primitive, parser )\n\t\t\t\t.then( function ( geometry ) {\n\n\t\t\t\t\treturn addPrimitiveAttributes( geometry, primitive, parser );\n\n\t\t\t\t} );\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = primitives.length; i < il; i ++ ) {\n\n\t\t\tconst primitive = primitives[ i ];\n\t\t\tconst cacheKey = createPrimitiveKey( primitive );\n\n\t\t\t// See if we've already created this geometry\n\t\t\tconst cached = cache[ cacheKey ];\n\n\t\t\tif ( cached ) {\n\n\t\t\t\t// Use the cached geometry if it exists\n\t\t\t\tpending.push( cached.promise );\n\n\t\t\t} else {\n\n\t\t\t\tlet geometryPromise;\n\n\t\t\t\tif ( primitive.extensions && primitive.extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ] ) {\n\n\t\t\t\t\t// Use DRACO geometry if available\n\t\t\t\t\tgeometryPromise = createDracoPrimitive( primitive );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// Otherwise create a new geometry\n\t\t\t\t\tgeometryPromise = addPrimitiveAttributes( new BufferGeometry(), primitive, parser );\n\n\t\t\t\t}\n\n\t\t\t\t// Cache this geometry\n\t\t\t\tcache[ cacheKey ] = { primitive: primitive, promise: geometryPromise };\n\n\t\t\t\tpending.push( geometryPromise );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#meshes\n\t * @param {number} meshIndex\n\t * @return {Promise<Group|Mesh|SkinnedMesh>}\n\t */\n\tloadMesh( meshIndex ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\n\t\tconst meshDef = json.meshes[ meshIndex ];\n\t\tconst primitives = meshDef.primitives;\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = primitives.length; i < il; i ++ ) {\n\n\t\t\tconst material = primitives[ i ].material === undefined\n\t\t\t\t? createDefaultMaterial( this.cache )\n\t\t\t\t: this.getDependency( 'material', primitives[ i ].material );\n\n\t\t\tpending.push( material );\n\n\t\t}\n\n\t\tpending.push( parser.loadGeometries( primitives ) );\n\n\t\treturn Promise.all( pending ).then( function ( results ) {\n\n\t\t\tconst materials = results.slice( 0, results.length - 1 );\n\t\t\tconst geometries = results[ results.length - 1 ];\n\n\t\t\tconst meshes = [];\n\n\t\t\tfor ( let i = 0, il = geometries.length; i < il; i ++ ) {\n\n\t\t\t\tconst geometry = geometries[ i ];\n\t\t\t\tconst primitive = primitives[ i ];\n\n\t\t\t\t// 1. create Mesh\n\n\t\t\t\tlet mesh;\n\n\t\t\t\tconst material = materials[ i ];\n\n\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLES ||\n\t\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ||\n\t\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ||\n\t\t\t\t\t\tprimitive.mode === undefined ) {\n\n\t\t\t\t\t// .isSkinnedMesh isn't in glTF spec. See ._markDefs()\n\t\t\t\t\tmesh = meshDef.isSkinnedMesh === true\n\t\t\t\t\t\t? new SkinnedMesh( geometry, material )\n\t\t\t\t\t\t: new Mesh( geometry, material );\n\n\t\t\t\t\tif ( mesh.isSkinnedMesh === true ) {\n\n\t\t\t\t\t\t// normalize skin weights to fix malformed assets (see #15319)\n\t\t\t\t\t\tmesh.normalizeSkinWeights();\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ) {\n\n\t\t\t\t\t\tmesh.geometry = toTrianglesDrawMode( mesh.geometry, TriangleStripDrawMode );\n\n\t\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ) {\n\n\t\t\t\t\t\tmesh.geometry = toTrianglesDrawMode( mesh.geometry, TriangleFanDrawMode );\n\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINES ) {\n\n\t\t\t\t\tmesh = new LineSegments( geometry, material );\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_STRIP ) {\n\n\t\t\t\t\tmesh = new Line( geometry, material );\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_LOOP ) {\n\n\t\t\t\t\tmesh = new LineLoop( geometry, material );\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.POINTS ) {\n\n\t\t\t\t\tmesh = new Points( geometry, material );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Primitive mode unsupported: ' + primitive.mode );\n\n\t\t\t\t}\n\n\t\t\t\tif ( Object.keys( mesh.geometry.morphAttributes ).length > 0 ) {\n\n\t\t\t\t\tupdateMorphTargets( mesh, meshDef );\n\n\t\t\t\t}\n\n\t\t\t\tmesh.name = parser.createUniqueName( meshDef.name || ( 'mesh_' + meshIndex ) );\n\n\t\t\t\tassignExtrasToUserData( mesh, meshDef );\n\n\t\t\t\tif ( primitive.extensions ) addUnknownExtensionsToUserData( extensions, mesh, primitive );\n\n\t\t\t\tparser.assignFinalMaterial( mesh );\n\n\t\t\t\tmeshes.push( mesh );\n\n\t\t\t}\n\n\t\t\tfor ( let i = 0, il = meshes.length; i < il; i ++ ) {\n\n\t\t\t\tparser.associations.set( meshes[ i ], {\n\t\t\t\t\tmeshes: meshIndex,\n\t\t\t\t\tprimitives: i\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\tif ( meshes.length === 1 ) {\n\n\t\t\t\tif ( meshDef.extensions ) addUnknownExtensionsToUserData( extensions, meshes[ 0 ], meshDef );\n\n\t\t\t\treturn meshes[ 0 ];\n\n\t\t\t}\n\n\t\t\tconst group = new Group();\n\n\t\t\tif ( meshDef.extensions ) addUnknownExtensionsToUserData( extensions, group, meshDef );\n\n\t\t\tparser.associations.set( group, { meshes: meshIndex } );\n\n\t\t\tfor ( let i = 0, il = meshes.length; i < il; i ++ ) {\n\n\t\t\t\tgroup.add( meshes[ i ] );\n\n\t\t\t}\n\n\t\t\treturn group;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#cameras\n\t * @param {number} cameraIndex\n\t * @return {Promise<THREE.Camera>}\n\t */\n\tloadCamera( cameraIndex ) {\n\n\t\tlet camera;\n\t\tconst cameraDef = this.json.cameras[ cameraIndex ];\n\t\tconst params = cameraDef[ cameraDef.type ];\n\n\t\tif ( ! params ) {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing camera parameters.' );\n\t\t\treturn;\n\n\t\t}\n\n\t\tif ( cameraDef.type === 'perspective' ) {\n\n\t\t\tcamera = new PerspectiveCamera( MathUtils.radToDeg( params.yfov ), params.aspectRatio || 1, params.znear || 1, params.zfar || 2e6 );\n\n\t\t} else if ( cameraDef.type === 'orthographic' ) {\n\n\t\t\tcamera = new OrthographicCamera( - params.xmag, params.xmag, params.ymag, - params.ymag, params.znear, params.zfar );\n\n\t\t}\n\n\t\tif ( cameraDef.name ) camera.name = this.createUniqueName( cameraDef.name );\n\n\t\tassignExtrasToUserData( camera, cameraDef );\n\n\t\treturn Promise.resolve( camera );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#skins\n\t * @param {number} skinIndex\n\t * @return {Promise<Skeleton>}\n\t */\n\tloadSkin( skinIndex ) {\n\n\t\tconst skinDef = this.json.skins[ skinIndex ];\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = skinDef.joints.length; i < il; i ++ ) {\n\n\t\t\tpending.push( this._loadNodeShallow( skinDef.joints[ i ] ) );\n\n\t\t}\n\n\t\tif ( skinDef.inverseBindMatrices !== undefined ) {\n\n\t\t\tpending.push( this.getDependency( 'accessor', skinDef.inverseBindMatrices ) );\n\n\t\t} else {\n\n\t\t\tpending.push( null );\n\n\t\t}\n\n\t\treturn Promise.all( pending ).then( function ( results ) {\n\n\t\t\tconst inverseBindMatrices = results.pop();\n\t\t\tconst jointNodes = results;\n\n\t\t\t// Note that bones (joint nodes) may or may not be in the\n\t\t\t// scene graph at this time.\n\n\t\t\tconst bones = [];\n\t\t\tconst boneInverses = [];\n\n\t\t\tfor ( let i = 0, il = jointNodes.length; i < il; i ++ ) {\n\n\t\t\t\tconst jointNode = jointNodes[ i ];\n\n\t\t\t\tif ( jointNode ) {\n\n\t\t\t\t\tbones.push( jointNode );\n\n\t\t\t\t\tconst mat = new Matrix4();\n\n\t\t\t\t\tif ( inverseBindMatrices !== null ) {\n\n\t\t\t\t\t\tmat.fromArray( inverseBindMatrices.array, i * 16 );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tboneInverses.push( mat );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Joint \"%s\" could not be found.', skinDef.joints[ i ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn new Skeleton( bones, boneInverses );\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#animations\n\t * @param {number} animationIndex\n\t * @return {Promise<AnimationClip>}\n\t */\n\tloadAnimation( animationIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst parser = this;\n\n\t\tconst animationDef = json.animations[ animationIndex ];\n\t\tconst animationName = animationDef.name ? animationDef.name : 'animation_' + animationIndex;\n\n\t\tconst pendingNodes = [];\n\t\tconst pendingInputAccessors = [];\n\t\tconst pendingOutputAccessors = [];\n\t\tconst pendingSamplers = [];\n\t\tconst pendingTargets = [];\n\n\t\tfor ( let i = 0, il = animationDef.channels.length; i < il; i ++ ) {\n\n\t\t\tconst channel = animationDef.channels[ i ];\n\t\t\tconst sampler = animationDef.samplers[ channel.sampler ];\n\t\t\tconst target = channel.target;\n\t\t\tconst name = target.node;\n\t\t\tconst input = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.input ] : sampler.input;\n\t\t\tconst output = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.output ] : sampler.output;\n\n\t\t\tif ( target.node === undefined ) continue;\n\n\t\t\tpendingNodes.push( this.getDependency( 'node', name ) );\n\t\t\tpendingInputAccessors.push( this.getDependency( 'accessor', input ) );\n\t\t\tpendingOutputAccessors.push( this.getDependency( 'accessor', output ) );\n\t\t\tpendingSamplers.push( sampler );\n\t\t\tpendingTargets.push( target );\n\n\t\t}\n\n\t\treturn Promise.all( [\n\n\t\t\tPromise.all( pendingNodes ),\n\t\t\tPromise.all( pendingInputAccessors ),\n\t\t\tPromise.all( pendingOutputAccessors ),\n\t\t\tPromise.all( pendingSamplers ),\n\t\t\tPromise.all( pendingTargets )\n\n\t\t] ).then( function ( dependencies ) {\n\n\t\t\tconst nodes = dependencies[ 0 ];\n\t\t\tconst inputAccessors = dependencies[ 1 ];\n\t\t\tconst outputAccessors = dependencies[ 2 ];\n\t\t\tconst samplers = dependencies[ 3 ];\n\t\t\tconst targets = dependencies[ 4 ];\n\n\t\t\tconst tracks = [];\n\n\t\t\tfor ( let i = 0, il = nodes.length; i < il; i ++ ) {\n\n\t\t\t\tconst node = nodes[ i ];\n\t\t\t\tconst inputAccessor = inputAccessors[ i ];\n\t\t\t\tconst outputAccessor = outputAccessors[ i ];\n\t\t\t\tconst sampler = samplers[ i ];\n\t\t\t\tconst target = targets[ i ];\n\n\t\t\t\tif ( node === undefined ) continue;\n\n\t\t\t\tif ( node.updateMatrix ) {\n\n\t\t\t\t\tnode.updateMatrix();\n\n\t\t\t\t}\n\n\t\t\t\tconst createdTracks = parser._createAnimationTracks( node, inputAccessor, outputAccessor, sampler, target );\n\n\t\t\t\tif ( createdTracks ) {\n\n\t\t\t\t\tfor ( let k = 0; k < createdTracks.length; k ++ ) {\n\n\t\t\t\t\t\ttracks.push( createdTracks[ k ] );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn new AnimationClip( animationName, undefined, tracks );\n\n\t\t} );\n\n\t}\n\n\tcreateNodeMesh( nodeIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst parser = this;\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\n\t\tif ( nodeDef.mesh === undefined ) return null;\n\n\t\treturn parser.getDependency( 'mesh', nodeDef.mesh ).then( function ( mesh ) {\n\n\t\t\tconst node = parser._getNodeRef( parser.meshCache, nodeDef.mesh, mesh );\n\n\t\t\t// if weights are provided on the node, override weights on the mesh.\n\t\t\tif ( nodeDef.weights !== undefined ) {\n\n\t\t\t\tnode.traverse( function ( o ) {\n\n\t\t\t\t\tif ( ! o.isMesh ) return;\n\n\t\t\t\t\tfor ( let i = 0, il = nodeDef.weights.length; i < il; i ++ ) {\n\n\t\t\t\t\t\to.morphTargetInfluences[ i ] = nodeDef.weights[ i ];\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\treturn node;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#nodes-and-hierarchy\n\t * @param {number} nodeIndex\n\t * @return {Promise<Object3D>}\n\t */\n\tloadNode( nodeIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst parser = this;\n\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\n\t\tconst nodePending = parser._loadNodeShallow( nodeIndex );\n\n\t\tconst childPending = [];\n\t\tconst childrenDef = nodeDef.children || [];\n\n\t\tfor ( let i = 0, il = childrenDef.length; i < il; i ++ ) {\n\n\t\t\tchildPending.push( parser.getDependency( 'node', childrenDef[ i ] ) );\n\n\t\t}\n\n\t\tconst skeletonPending = nodeDef.skin === undefined\n\t\t\t? Promise.resolve( null )\n\t\t\t: parser.getDependency( 'skin', nodeDef.skin );\n\n\t\treturn Promise.all( [\n\t\t\tnodePending,\n\t\t\tPromise.all( childPending ),\n\t\t\tskeletonPending\n\t\t] ).then( function ( results ) {\n\n\t\t\tconst node = results[ 0 ];\n\t\t\tconst children = results[ 1 ];\n\t\t\tconst skeleton = results[ 2 ];\n\n\t\t\tif ( skeleton !== null ) {\n\n\t\t\t\t// This full traverse should be fine because\n\t\t\t\t// child glTF nodes have not been added to this node yet.\n\t\t\t\tnode.traverse( function ( mesh ) {\n\n\t\t\t\t\tif ( ! mesh.isSkinnedMesh ) return;\n\n\t\t\t\t\tmesh.bind( skeleton, _identityMatrix );\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\tfor ( let i = 0, il = children.length; i < il; i ++ ) {\n\n\t\t\t\tnode.add( children[ i ] );\n\n\t\t\t}\n\n\t\t\treturn node;\n\n\t\t} );\n\n\t}\n\n\t// ._loadNodeShallow() parses a single node.\n\t// skin and child nodes are created and added in .loadNode() (no '_' prefix).\n\t_loadNodeShallow( nodeIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\t\tconst parser = this;\n\n\t\t// This method is called from .loadNode() and .loadSkin().\n\t\t// Cache a node to avoid duplication.\n\n\t\tif ( this.nodeCache[ nodeIndex ] !== undefined ) {\n\n\t\t\treturn this.nodeCache[ nodeIndex ];\n\n\t\t}\n\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\n\t\t// reserve node's name before its dependencies, so the root has the intended name.\n\t\tconst nodeName = nodeDef.name ? parser.createUniqueName( nodeDef.name ) : '';\n\n\t\tconst pending = [];\n\n\t\tconst meshPromise = parser._invokeOne( function ( ext ) {\n\n\t\t\treturn ext.createNodeMesh && ext.createNodeMesh( nodeIndex );\n\n\t\t} );\n\n\t\tif ( meshPromise ) {\n\n\t\t\tpending.push( meshPromise );\n\n\t\t}\n\n\t\tif ( nodeDef.camera !== undefined ) {\n\n\t\t\tpending.push( parser.getDependency( 'camera', nodeDef.camera ).then( function ( camera ) {\n\n\t\t\t\treturn parser._getNodeRef( parser.cameraCache, nodeDef.camera, camera );\n\n\t\t\t} ) );\n\n\t\t}\n\n\t\tparser._invokeAll( function ( ext ) {\n\n\t\t\treturn ext.createNodeAttachment && ext.createNodeAttachment( nodeIndex );\n\n\t\t} ).forEach( function ( promise ) {\n\n\t\t\tpending.push( promise );\n\n\t\t} );\n\n\t\tthis.nodeCache[ nodeIndex ] = Promise.all( pending ).then( function ( objects ) {\n\n\t\t\tlet node;\n\n\t\t\t// .isBone isn't in glTF spec. See ._markDefs\n\t\t\tif ( nodeDef.isBone === true ) {\n\n\t\t\t\tnode = new Bone();\n\n\t\t\t} else if ( objects.length > 1 ) {\n\n\t\t\t\tnode = new Group();\n\n\t\t\t} else if ( objects.length === 1 ) {\n\n\t\t\t\tnode = objects[ 0 ];\n\n\t\t\t} else {\n\n\t\t\t\tnode = new Object3D();\n\n\t\t\t}\n\n\t\t\tif ( node !== objects[ 0 ] ) {\n\n\t\t\t\tfor ( let i = 0, il = objects.length; i < il; i ++ ) {\n\n\t\t\t\t\tnode.add( objects[ i ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( nodeDef.name ) {\n\n\t\t\t\tnode.userData.name = nodeDef.name;\n\t\t\t\tnode.name = nodeName;\n\n\t\t\t}\n\n\t\t\tassignExtrasToUserData( node, nodeDef );\n\n\t\t\tif ( nodeDef.extensions ) addUnknownExtensionsToUserData( extensions, node, nodeDef );\n\n\t\t\tif ( nodeDef.matrix !== undefined ) {\n\n\t\t\t\tconst matrix = new Matrix4();\n\t\t\t\tmatrix.fromArray( nodeDef.matrix );\n\t\t\t\tnode.applyMatrix4( matrix );\n\n\t\t\t} else {\n\n\t\t\t\tif ( nodeDef.translation !== undefined ) {\n\n\t\t\t\t\tnode.position.fromArray( nodeDef.translation );\n\n\t\t\t\t}\n\n\t\t\t\tif ( nodeDef.rotation !== undefined ) {\n\n\t\t\t\t\tnode.quaternion.fromArray( nodeDef.rotation );\n\n\t\t\t\t}\n\n\t\t\t\tif ( nodeDef.scale !== undefined ) {\n\n\t\t\t\t\tnode.scale.fromArray( nodeDef.scale );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( ! parser.associations.has( node ) ) {\n\n\t\t\t\tparser.associations.set( node, {} );\n\n\t\t\t}\n\n\t\t\tparser.associations.get( node ).nodes = nodeIndex;\n\n\t\t\treturn node;\n\n\t\t} );\n\n\t\treturn this.nodeCache[ nodeIndex ];\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#scenes\n\t * @param {number} sceneIndex\n\t * @return {Promise<Group>}\n\t */\n\tloadScene( sceneIndex ) {\n\n\t\tconst extensions = this.extensions;\n\t\tconst sceneDef = this.json.scenes[ sceneIndex ];\n\t\tconst parser = this;\n\n\t\t// Loader returns Group, not Scene.\n\t\t// See: https://github.com/mrdoob/three.js/issues/18342#issuecomment-578981172\n\t\tconst scene = new Group();\n\t\tif ( sceneDef.name ) scene.name = parser.createUniqueName( sceneDef.name );\n\n\t\tassignExtrasToUserData( scene, sceneDef );\n\n\t\tif ( sceneDef.extensions ) addUnknownExtensionsToUserData( extensions, scene, sceneDef );\n\n\t\tconst nodeIds = sceneDef.nodes || [];\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = nodeIds.length; i < il; i ++ ) {\n\n\t\t\tpending.push( parser.getDependency( 'node', nodeIds[ i ] ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending ).then( function ( nodes ) {\n\n\t\t\tfor ( let i = 0, il = nodes.length; i < il; i ++ ) {\n\n\t\t\t\tscene.add( nodes[ i ] );\n\n\t\t\t}\n\n\t\t\t// Removes dangling associations, associations that reference a node that\n\t\t\t// didn't make it into the scene.\n\t\t\tconst reduceAssociations = ( node ) => {\n\n\t\t\t\tconst reducedAssociations = new Map();\n\n\t\t\t\tfor ( const [ key, value ] of parser.associations ) {\n\n\t\t\t\t\tif ( key instanceof Material || key instanceof Texture ) {\n\n\t\t\t\t\t\treducedAssociations.set( key, value );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tnode.traverse( ( node ) => {\n\n\t\t\t\t\tconst mappings = parser.associations.get( node );\n\n\t\t\t\t\tif ( mappings != null ) {\n\n\t\t\t\t\t\treducedAssociations.set( node, mappings );\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t\treturn reducedAssociations;\n\n\t\t\t};\n\n\t\t\tparser.associations = reduceAssociations( scene );\n\n\t\t\treturn scene;\n\n\t\t} );\n\n\t}\n\n\t_createAnimationTracks( node, inputAccessor, outputAccessor, sampler, target ) {\n\n\t\tconst tracks = [];\n\n\t\tconst targetName = node.name ? node.name : node.uuid;\n\t\tconst targetNames = [];\n\n\t\tif ( PATH_PROPERTIES[ target.path ] === PATH_PROPERTIES.weights ) {\n\n\t\t\tnode.traverse( function ( object ) {\n\n\t\t\t\tif ( object.morphTargetInfluences ) {\n\n\t\t\t\t\ttargetNames.push( object.name ? object.name : object.uuid );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t} else {\n\n\t\t\ttargetNames.push( targetName );\n\n\t\t}\n\n\t\tlet TypedKeyframeTrack;\n\n\t\tswitch ( PATH_PROPERTIES[ target.path ] ) {\n\n\t\t\tcase PATH_PROPERTIES.weights:\n\n\t\t\t\tTypedKeyframeTrack = NumberKeyframeTrack;\n\t\t\t\tbreak;\n\n\t\t\tcase PATH_PROPERTIES.rotation:\n\n\t\t\t\tTypedKeyframeTrack = QuaternionKeyframeTrack;\n\t\t\t\tbreak;\n\n\t\t\tcase PATH_PROPERTIES.position:\n\t\t\tcase PATH_PROPERTIES.scale:\n\n\t\t\t\tTypedKeyframeTrack = VectorKeyframeTrack;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tswitch ( outputAccessor.itemSize ) {\n\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\tTypedKeyframeTrack = NumberKeyframeTrack;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\tcase 3:\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tTypedKeyframeTrack = VectorKeyframeTrack;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tconst interpolation = sampler.interpolation !== undefined ? INTERPOLATION[ sampler.interpolation ] : InterpolateLinear;\n\n\n\t\tconst outputArray = this._getArrayFromAccessor( outputAccessor );\n\n\t\tfor ( let j = 0, jl = targetNames.length; j < jl; j ++ ) {\n\n\t\t\tconst track = new TypedKeyframeTrack(\n\t\t\t\ttargetNames[ j ] + '.' + PATH_PROPERTIES[ target.path ],\n\t\t\t\tinputAccessor.array,\n\t\t\t\toutputArray,\n\t\t\t\tinterpolation\n\t\t\t);\n\n\t\t\t// Override interpolation with custom factory method.\n\t\t\tif ( sampler.interpolation === 'CUBICSPLINE' ) {\n\n\t\t\t\tthis._createCubicSplineTrackInterpolant( track );\n\n\t\t\t}\n\n\t\t\ttracks.push( track );\n\n\t\t}\n\n\t\treturn tracks;\n\n\t}\n\n\t_getArrayFromAccessor( accessor ) {\n\n\t\tlet outputArray = accessor.array;\n\n\t\tif ( accessor.normalized ) {\n\n\t\t\tconst scale = getNormalizedComponentScale( outputArray.constructor );\n\t\t\tconst scaled = new Float32Array( outputArray.length );\n\n\t\t\tfor ( let j = 0, jl = outputArray.length; j < jl; j ++ ) {\n\n\t\t\t\tscaled[ j ] = outputArray[ j ] * scale;\n\n\t\t\t}\n\n\t\t\toutputArray = scaled;\n\n\t\t}\n\n\t\treturn outputArray;\n\n\t}\n\n\t_createCubicSplineTrackInterpolant( track ) {\n\n\t\ttrack.createInterpolant = function InterpolantFactoryMethodGLTFCubicSpline( result ) {\n\n\t\t\t// A CUBICSPLINE keyframe in glTF has three output values for each input value,\n\t\t\t// representing inTangent, splineVertex, and outTangent. As a result, track.getValueSize()\n\t\t\t// must be divided by three to get the interpolant's sampleSize argument.\n\n\t\t\tconst interpolantType = ( this instanceof QuaternionKeyframeTrack ) ? GLTFCubicSplineQuaternionInterpolant : GLTFCubicSplineInterpolant;\n\n\t\t\treturn new interpolantType( this.times, this.values, this.getValueSize() / 3, result );\n\n\t\t};\n\n\t\t// Mark as CUBICSPLINE. `track.getInterpolation()` doesn't support custom interpolants.\n\t\ttrack.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline = true;\n\n\t}\n\n}\n\n/**\n * @param {BufferGeometry} geometry\n * @param {GLTF.Primitive} primitiveDef\n * @param {GLTFParser} parser\n */\nfunction computeBounds( geometry, primitiveDef, parser ) {\n\n\tconst attributes = primitiveDef.attributes;\n\n\tconst box = new Box3();\n\n\tif ( attributes.POSITION !== undefined ) {\n\n\t\tconst accessor = parser.json.accessors[ attributes.POSITION ];\n\n\t\tconst min = accessor.min;\n\t\tconst max = accessor.max;\n\n\t\t// glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\n\n\t\tif ( min !== undefined && max !== undefined ) {\n\n\t\t\tbox.set(\n\t\t\t\tnew Vector3( min[ 0 ], min[ 1 ], min[ 2 ] ),\n\t\t\t\tnew Vector3( max[ 0 ], max[ 1 ], max[ 2 ] )\n\t\t\t);\n\n\t\t\tif ( accessor.normalized ) {\n\n\t\t\t\tconst boxScale = getNormalizedComponentScale( WEBGL_COMPONENT_TYPES[ accessor.componentType ] );\n\t\t\t\tbox.min.multiplyScalar( boxScale );\n\t\t\t\tbox.max.multiplyScalar( boxScale );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing min/max properties for accessor POSITION.' );\n\n\t\t\treturn;\n\n\t\t}\n\n\t} else {\n\n\t\treturn;\n\n\t}\n\n\tconst targets = primitiveDef.targets;\n\n\tif ( targets !== undefined ) {\n\n\t\tconst maxDisplacement = new Vector3();\n\t\tconst vector = new Vector3();\n\n\t\tfor ( let i = 0, il = targets.length; i < il; i ++ ) {\n\n\t\t\tconst target = targets[ i ];\n\n\t\t\tif ( target.POSITION !== undefined ) {\n\n\t\t\t\tconst accessor = parser.json.accessors[ target.POSITION ];\n\t\t\t\tconst min = accessor.min;\n\t\t\t\tconst max = accessor.max;\n\n\t\t\t\t// glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\n\n\t\t\t\tif ( min !== undefined && max !== undefined ) {\n\n\t\t\t\t\t// we need to get max of absolute components because target weight is [-1,1]\n\t\t\t\t\tvector.setX( Math.max( Math.abs( min[ 0 ] ), Math.abs( max[ 0 ] ) ) );\n\t\t\t\t\tvector.setY( Math.max( Math.abs( min[ 1 ] ), Math.abs( max[ 1 ] ) ) );\n\t\t\t\t\tvector.setZ( Math.max( Math.abs( min[ 2 ] ), Math.abs( max[ 2 ] ) ) );\n\n\n\t\t\t\t\tif ( accessor.normalized ) {\n\n\t\t\t\t\t\tconst boxScale = getNormalizedComponentScale( WEBGL_COMPONENT_TYPES[ accessor.componentType ] );\n\t\t\t\t\t\tvector.multiplyScalar( boxScale );\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// Note: this assumes that the sum of all weights is at most 1. This isn't quite correct - it's more conservative\n\t\t\t\t\t// to assume that each target can have a max weight of 1. However, for some use cases - notably, when morph targets\n\t\t\t\t\t// are used to implement key-frame animations and as such only two are active at a time - this results in very large\n\t\t\t\t\t// boxes. So for now we make a box that's sometimes a touch too small but is hopefully mostly of reasonable size.\n\t\t\t\t\tmaxDisplacement.max( vector );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing min/max properties for accessor POSITION.' );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\t// As per comment above this box isn't conservative, but has a reasonable size for a very large number of morph targets.\n\t\tbox.expandByVector( maxDisplacement );\n\n\t}\n\n\tgeometry.boundingBox = box;\n\n\tconst sphere = new Sphere();\n\n\tbox.getCenter( sphere.center );\n\tsphere.radius = box.min.distanceTo( box.max ) / 2;\n\n\tgeometry.boundingSphere = sphere;\n\n}\n\n/**\n * @param {BufferGeometry} geometry\n * @param {GLTF.Primitive} primitiveDef\n * @param {GLTFParser} parser\n * @return {Promise<BufferGeometry>}\n */\nfunction addPrimitiveAttributes( geometry, primitiveDef, parser ) {\n\n\tconst attributes = primitiveDef.attributes;\n\n\tconst pending = [];\n\n\tfunction assignAttributeAccessor( accessorIndex, attributeName ) {\n\n\t\treturn parser.getDependency( 'accessor', accessorIndex )\n\t\t\t.then( function ( accessor ) {\n\n\t\t\t\tgeometry.setAttribute( attributeName, accessor );\n\n\t\t\t} );\n\n\t}\n\n\tfor ( const gltfAttributeName in attributes ) {\n\n\t\tconst threeAttributeName = ATTRIBUTES[ gltfAttributeName ] || gltfAttributeName.toLowerCase();\n\n\t\t// Skip attributes already provided by e.g. Draco extension.\n\t\tif ( threeAttributeName in geometry.attributes ) continue;\n\n\t\tpending.push( assignAttributeAccessor( attributes[ gltfAttributeName ], threeAttributeName ) );\n\n\t}\n\n\tif ( primitiveDef.indices !== undefined && ! geometry.index ) {\n\n\t\tconst accessor = parser.getDependency( 'accessor', primitiveDef.indices ).then( function ( accessor ) {\n\n\t\t\tgeometry.setIndex( accessor );\n\n\t\t} );\n\n\t\tpending.push( accessor );\n\n\t}\n\n\tif ( ColorManagement.workingColorSpace !== LinearSRGBColorSpace && 'COLOR_0' in attributes ) {\n\n\t\tconsole.warn( `THREE.GLTFLoader: Converting vertex colors from \"srgb-linear\" to \"${ColorManagement.workingColorSpace}\" not supported.` );\n\n\t}\n\n\tassignExtrasToUserData( geometry, primitiveDef );\n\n\tcomputeBounds( geometry, primitiveDef, parser );\n\n\treturn Promise.all( pending ).then( function () {\n\n\t\treturn primitiveDef.targets !== undefined\n\t\t\t? addMorphTargets( geometry, primitiveDef.targets, parser )\n\t\t\t: geometry;\n\n\t} );\n\n}\n\nexport { GLTFLoader };\n","export const BLORKPACK_FLAGS = {\n\t// Functionality flags\n\tCOLLISION_VISUAL_DEBUG: false,\n\tSPOTLIGHT_VISUAL_DEBUG: false,\n\t// Log flags\n\tASSET_LOGS: false,\n\tACTIVATE_LOGS: false,\n\tPHYSICS_LOGS: false,\n\tMANIFEST_LOGS: false,\n\tANIMATION_LOGS: false,\n\tDEFAULT_CONFIG_LOGS: false,  // Log when default configurations are used instead of manifest values\n\tDEBUG_LOGS: false\n}; ","/**\n * Custom Type Manager - Loads custom asset types from JSON files\n */\n// Import flags - use proper ES module import\nimport { BLORKPACK_FLAGS } from './blorkpack_flags.js';\n// Default scale factor\nconst SCALE_FACTOR = 5;\n// No hardcoded custom types - everything comes from JSON\n/**\n *\n */\nclass CustomTypeManager {\n\tstatic instance = null;\n\t/**\n\t *\n\t */\n\tconstructor() {\n\t\tif (CustomTypeManager.instance) {\n\t\t\treturn CustomTypeManager.instance;\n\t\t}\n\t\t// Start with empty collections - all custom types will come from JSON\n\t\tthis.types = {};\n\t\tthis.configs = {};\n\t\t// Flag to track if custom types are loaded\n\t\tthis.customTypesLoaded = false;\n\t\tCustomTypeManager.instance = this;\n\t}\n\t/**\n     * Gets the singleton instance\n     */\n\tstatic getInstance() {\n\t\tif (!CustomTypeManager.instance) {\n\t\t\tCustomTypeManager.instance = new CustomTypeManager();\n\t\t}\n\t\treturn CustomTypeManager.instance;\n\t}\n\t/**\n     * Static method to load custom types from a JSON file\n     * @param {string} customTypesPath - Path to the custom types JSON file\n     */\n\tstatic async loadCustomTypes(customTypesPath) {\n\t\treturn CustomTypeManager.getInstance().loadCustomTypes(customTypesPath);\n\t}\n\t/**\n     * Loads custom types from a JSON file\n     * @param {string} customTypesPath - Path to the custom types JSON file\n     */\n\tasync loadCustomTypes(customTypesPath) {\n\t\t// Skip if already loaded\n\t\tif (this.customTypesLoaded) {\n\t\t\tif (BLORKPACK_FLAGS && BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\tconsole.log(\"Custom types already loaded, skipping\");\n\t\t\t}\n\t\t\treturn this;\n\t\t}\n\t\ttry {\n\t\t\tif (BLORKPACK_FLAGS && BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\tconsole.log(`Loading custom types from: ${customTypesPath}`);\n\t\t\t}\n\t\t\t// Fetch the custom types JSON\n\t\t\tconst response = await fetch(customTypesPath);\n\t\t\tif (!response.ok) {\n\t\t\t\tthrow new Error(`Failed to load custom types: ${response.status} ${response.statusText}`);\n\t\t\t}\n\t\t\tconst customTypesData = await response.json();\n\t\t\tif (!customTypesData || !customTypesData.custom_configs) {\n\t\t\t\tthrow new Error('Invalid custom types data: missing custom_configs');\n\t\t\t}\n\t\t\t// Add each custom type to the types object\n\t\t\tObject.keys(customTypesData.custom_configs).forEach(typeName => {\n\t\t\t\tconst config = customTypesData.custom_configs[typeName];\n\t\t\t\tif (!config.key) {\n\t\t\t\t\tif (BLORKPACK_FLAGS && BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\t\t\tconsole.warn(`Custom type ${typeName} missing key property, using typeName as key`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Add the type with its key value\n\t\t\t\t// For proper type checking, the key should match the typeName to avoid confusion\n\t\t\t\tconst typeKey = config.key || typeName;\n\t\t\t\tthis.types[typeName] = typeKey;\n\t\t\t\t// If the config has asset properties, add it to configs\n\t\t\t\tif (config.PATH) {\n\t\t\t\t\tthis.configs[typeKey] = {\n\t\t\t\t\t\tPATH: config.PATH,\n\t\t\t\t\t\tscale: config.scale || SCALE_FACTOR,\n\t\t\t\t\t\tmass: config.mass || 1,\n\t\t\t\t\t\trestitution: config.restitution || 1,\n\t\t\t\t\t\t...(config.ui_scale && { ui_scale: config.ui_scale }),\n\t\t\t\t\t\t...(config.display_layer && { display_layer: config.display_layer })\n\t\t\t\t\t};\n\t\t\t\t} else if (BLORKPACK_FLAGS && BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\t\tconsole.warn(`Custom type ${typeName} has no PATH property, configs may be incomplete`);\n\t\t\t\t}\n\t\t\t});\n\t\t\t// Clear logging with summary and details\n\t\t\tif (BLORKPACK_FLAGS && BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\tconsole.log(`Successfully loaded ${Object.keys(this.types).length} custom types from ${customTypesPath}:`);\n\t\t\t\tconsole.log(\"Mapped config keys:\", Object.keys(this.configs));\n\t\t\t}\n\t\t\t// Validate type mappings and configs\n\t\t\tlet mismatchCount = 0;\n\t\t\tif (BLORKPACK_FLAGS && BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\tObject.keys(this.types).forEach(typeName => {\n\t\t\t\t\tconst typeValue = this.types[typeName];\n\t\t\t\t\tif (typeName !== typeValue && !this.configs[typeValue]) {\n\t\t\t\t\t\tconsole.warn(`Type name '${typeName}' maps to '${typeValue}', but no config exists for '${typeValue}'`);\n\t\t\t\t\t\tmismatchCount++;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (mismatchCount > 0) {\n\t\t\t\t\tconsole.warn(`Found ${mismatchCount} type mapping mismatches. Running debugTypeMappings() for details.`);\n\t\t\t\t\tthis.debugTypeMappings();\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Mark as loaded\n\t\t\tthis.customTypesLoaded = true;\n\t\t\t// Make the types object immutable\n\t\t\tObject.freeze(this.types);\n\t\t\treturn this;\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error loading custom types:\", error);\n\t\t\treturn this;\n\t\t}\n\t}\n\t/**\n     * Gets all custom types\n     */\n\tgetTypes() {\n\t\treturn this.types;\n\t}\n\t/**\n     * Gets a specific custom type\n     */\n\tgetType(typeName) {\n\t\t// Check if this is a direct key in the types object\n\t\tif (typeName in this.types) {\n\t\t\treturn this.types[typeName];\n\t\t}\n\t\t// Check if this might be a value rather than a key\n\t\tconst typeValues = Object.values(this.types);\n\t\tif (typeValues.includes(typeName)) {\n\t\t\tif (BLORKPACK_FLAGS && BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\tconsole.warn(`Note: '${typeName}' is a type value, not a type name. Returning as-is.`);\n\t\t\t}\n\t\t\treturn typeName;\n\t\t}\n\t\t// Not found at all\n\t\tif (BLORKPACK_FLAGS && BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\tconsole.warn(`Type '${typeName}' not found in custom types.`);\n\t\t}\n\t\treturn typeName;\n\t}\n\t/**\n     * Gets all custom configurations\n     */\n\tgetConfigs() {\n\t\treturn this.configs;\n\t}\n\t/**\n     * Gets configuration for a specific custom type\n     */\n\tgetConfig(type) {\n\t\t// Try to get config directly\n\t\tif (this.configs[type]) {\n\t\t\treturn this.configs[type];\n\t\t}\n\t\t// If not found, check if this is a type name\n\t\tconst typeValue = this.getType(type);\n\t\tif (typeValue !== type && this.configs[typeValue]) {\n\t\t\tif (BLORKPACK_FLAGS && BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\tconsole.warn(`Note: Using config for '${typeValue}' instead of '${type}'`);\n\t\t\t}\n\t\t\treturn this.configs[typeValue];\n\t\t}\n\t\treturn null;\n\t}\n\t/**\n     * Checks if a particular custom type exists\n     */\n\thasType(typeName) {\n\t\t// First check if it's a direct key in the types object\n\t\tconst directCheck = typeName in this.types;\n\t\t// Also check if it's a value in the types object\n\t\tconst isTypeValue = Object.values(this.types).includes(typeName);\n\t\t// Return true if it's either a key or a value\n\t\treturn directCheck || isTypeValue;\n\t}\n\t/**\n     * Checks if custom types have been loaded\n     */\n\thasLoadedCustomTypes() {\n\t\tconst result = this.customTypesLoaded;\n\t\tif (!result && BLORKPACK_FLAGS && BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\tconsole.warn(\"Custom types have not been loaded yet. Call loadCustomTypes() first.\");\n\t\t\tconsole.warn(\"Current types:\", Object.keys(this.types).length);\n\t\t}\n\t\treturn result;\n\t}\n\t/**\n     * Debug method to print all type mappings and check for configuration discrepancies\n     */\n\tdebugTypeMappings() {\n\t\tif (!BLORKPACK_FLAGS || !BLORKPACK_FLAGS.ASSET_LOGS) return;\n\t\tconsole.log(\"=== Custom Type Manager Debug ===\");\n\t\tconsole.log(`Loaded ${Object.keys(this.types).length} types, ${Object.keys(this.configs).length} configs`);\n\t\tconsole.log(\"=== End Debug ===\");\n\t}\n\t/**\n     * Static method to debug type mappings\n     */\n\tstatic debugTypeMappings() {\n\t\treturn CustomTypeManager.getInstance().debugTypeMappings();\n\t}\n}\n// Create and export the singleton\nexport default CustomTypeManager.getInstance(); ","import { THREE } from \"./index.js\";\nimport { GLTFLoader } from \"three/examples/jsm/loaders/GLTFLoader\";\nimport CustomTypeManager from \"./custom_type_manager.js\";\nimport { BLORKPACK_FLAGS } from \"./blorkpack_flags.js\";\n/**\n * Class responsible for managing asset loading, storage, and caching.\n * Handles GLB models, materials, and maintains references to both static and dynamic objects.\n */\nexport class AssetStorage {\n\tstatic instance = null;\n\tstored_info = new Map();\n\tcached_models = new Map();\n\tloader;\n\t// Cache CustomTypeManager data\n\t#assetConfigs = null;\n\t/**\n\t *\n\t */\n\tconstructor() {\n\t\tif (AssetStorage.instance) {\n\t\t\treturn AssetStorage.instance;\n\t\t}\n\t\tthis.stored_info = new Map();\n\t\tthis.cached_models = new Map();\n\t\tthis.loader = new GLTFLoader();\n\t\t// Cache configuration data\n\t\tthis.#assetConfigs = CustomTypeManager.getConfigs();\n\t\tthis.loaded_assets = new Map();  // Stores the raw GLTF data\n\t\tthis.dynamic_bodies = new Map(); // Stores [mesh, physicsBody] pairs\n\t\tthis.static_meshes = new Map();  // Stores static meshes without physics\n\t\tthis.loading_promises = new Map();\n\t\tthis.material_cache = new Map(); // Initialize material cache\n\t\tthis.emission_states = new Map(); // Track emission states of objects\n\t\tthis.currently_activated_name = \"\";  // Track the currently activated object\n\t\tthis.instance_counter = 0;\n\t\tAssetStorage.instance = this;\n\t}\n\t/**\n     * Gets or creates the singleton instance of AssetStorage.\n     * @returns {AssetStorage} The singleton instance.\n     */\n\tstatic get_instance() {\n\t\tif (!AssetStorage.instance) {\n\t\t\tAssetStorage.instance = new AssetStorage();\n\t\t}\n\t\treturn AssetStorage.instance;\n\t}\n\t/**\n     * Loads an asset of the specified type asynchronously.\n     * @param {string} asset_type The type of asset to load.\n     * @returns {Promise<Object>} A promise that resolves with the loaded asset.\n     */\n\tasync load_asset_type(asset_type) {\n\t\tif (this.cached_models.has(asset_type)) {\n\t\t\treturn this.cached_models.get(asset_type);\n\t\t}\n\t\ttry {\n\t\t\t// Get asset configuration\n\t\t\tconst asset_config = this.#assetConfigs[asset_type];\n\t\t\tif (!asset_config) {\n\t\t\t\tconsole.error(`No configuration found for asset type: ${asset_type}`);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\t// Load the model\n\t\t\tconst gltf = await this.loader.loadAsync(asset_config.PATH);\n\t\t\tthis.cached_models.set(asset_type, gltf);\n\t\t\treturn gltf;\n\t\t} catch (error) {\n\t\t\tconsole.error(`Error loading asset type: ${asset_type}`, error);\n\t\t\treturn null;\n\t\t}\n\t}\n\t/**\n     * Adds an object to the storage system.\n     * @param {THREE.Object3D} incoming_mesh - The mesh to add\n     * @param {RAPIER.RigidBody} incoming_body - The physics body (optional)\n     * @returns {string} The instance ID of the added object\n     */\n\tadd_object(incoming_mesh, incoming_body) {\n\t\tconst instance_id = this.get_new_instance_id();\n\t\tif (incoming_body) {\n\t\t\t// Store as dynamic physics object\n\t\t\tthis.store_dynamic_body(instance_id, [incoming_mesh, incoming_body]);\n\t\t\t// Ensure the object has a userData reference to its physics body for easy access\n\t\t\tincoming_mesh.userData.physicsBody = incoming_body;\n\t\t\tincoming_mesh.userData.instanceId = instance_id;\n\t\t\t// Make sure the physics body position matches the mesh\n\t\t\tconst position = incoming_body.translation();\n\t\t\tincoming_mesh.position.set(position.x, position.y, position.z);\n\t\t\tconst rotation = incoming_body.rotation();\n\t\t\tincoming_mesh.quaternion.set(rotation.x, rotation.y, rotation.z, rotation.w);\n\t\t\tif (BLORKPACK_FLAGS.PHYSICS_LOGS) console.log(`Added dynamic body with ID: ${instance_id}`);\n\t\t} else {\n\t\t\t// Store as static mesh (no physics)\n\t\t\tthis.store_static_mesh(instance_id, incoming_mesh);\n\t\t\tincoming_mesh.userData.instanceId = instance_id;\n\t\t\tif (BLORKPACK_FLAGS.ASSET_LOGS) console.log(`Added static mesh with ID: ${instance_id}`);\n\t\t}\n\t\treturn instance_id;\n\t}\n\t/**\n     * Updates physics bodies and their corresponding meshes.\n     * Called every frame to synchronize visual representation with physics.\n     */\n\tupdate() {\n\t\t// Update physics for dynamic bodies\n\t\tthis.get_all_dynamic_bodies().forEach(([mesh, body]) => {\n\t\t\tif (body && mesh) {\n\t\t\t\t// Skip if the body is sleeping and hasn't moved\n\t\t\t\tif (body.isSleeping() && !body.isKinematic()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// Get the position and rotation from the physics body\n\t\t\t\tconst position = body.translation();\n\t\t\t\tmesh.position.set(position.x, position.y, position.z);\n\t\t\t\tconst rotation = body.rotation();\n\t\t\t\tmesh.quaternion.set(rotation.x, rotation.y, rotation.z, rotation.w);\n\t\t\t\t// Ensure the body is awake if it's being moved\n\t\t\t\tif (mesh.userData.isMoving && body.isSleeping()) {\n\t\t\t\t\tbody.wakeUp();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\t/**\n\t *\n\t */\n\tcleanup() {\n\t\t// Clean up dynamic bodies and meshes\n\t\tthis.get_all_dynamic_bodies().forEach(([mesh, body]) => {\n\t\t\tif (mesh) {\n\t\t\t\tif (mesh.parent) {\n\t\t\t\t\tmesh.parent.remove(mesh);\n\t\t\t\t}\n\t\t\t\tif (mesh.geometry) {\n\t\t\t\t\tmesh.geometry.dispose();\n\t\t\t\t}\n\t\t\t\tif (mesh.material) {\n\t\t\t\t\tif (Array.isArray(mesh.material)) {\n\t\t\t\t\t\tmesh.material.forEach(material => {\n\t\t\t\t\t\t\tif (material.map) material.map.dispose();\n\t\t\t\t\t\t\tmaterial.dispose();\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (mesh.material.map) mesh.material.map.dispose();\n\t\t\t\t\t\tmesh.material.dispose();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t// Clean up static meshes\n\t\tthis.get_all_static_meshes().forEach(mesh => {\n\t\t\tif (mesh) {\n\t\t\t\tif (mesh.parent) {\n\t\t\t\t\tmesh.parent.remove(mesh);\n\t\t\t\t}\n\t\t\t\tif (mesh.geometry) {\n\t\t\t\t\tmesh.geometry.dispose();\n\t\t\t\t}\n\t\t\t\tif (mesh.material) {\n\t\t\t\t\tif (Array.isArray(mesh.material)) {\n\t\t\t\t\t\tmesh.material.forEach(material => {\n\t\t\t\t\t\t\tif (material.map) material.map.dispose();\n\t\t\t\t\t\t\tmaterial.dispose();\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (mesh.material.map) mesh.material.map.dispose();\n\t\t\t\t\t\tmesh.material.dispose();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t// Clear maps\n\t\tthis.dynamic_bodies.clear();\n\t\tthis.static_meshes.clear();\n\t\tthis.emission_states.clear();\n\t\tthis.material_cache.clear();\n\t\t// Reset instance counter and currently activated\n\t\tthis.instance_counter = 0;\n\t\tthis.currently_activated_name = \"\";\n\t\tif (BLORKPACK_FLAGS.ASSET_LOGS) console.log(\"Asset storage cleaned up\");\n\t}\n\t/**\n\t *\n\t */\n\tget_new_instance_id() {\n\t\treturn `instance_${this.instance_counter++}`;\n\t}\n\t/**\n\t *\n\t */\n\tstore_loaded_asset(asset_type, gltf) {\n\t\tthis.loaded_assets.set(asset_type, gltf);\n\t}\n\t/**\n\t *\n\t */\n\tget_loaded_asset(asset_type) {\n\t\treturn this.loaded_assets.get(asset_type);\n\t}\n\t/**\n\t *\n\t */\n\thas_loaded_asset(asset_type) {\n\t\treturn this.loaded_assets.has(asset_type);\n\t}\n\t/**\n\t *\n\t */\n\tset_loading_promise(asset_type, promise) {\n\t\tthis.loading_promises.set(asset_type, promise);\n\t}\n\t/**\n\t *\n\t */\n\tget_loading_promise(asset_type) {\n\t\treturn this.loading_promises.get(asset_type);\n\t}\n\t/**\n\t *\n\t */\n\thas_loading_promise(asset_type) {\n\t\treturn this.loading_promises.has(asset_type);\n\t}\n\t/**\n\t *\n\t */\n\tdelete_loading_promise(asset_type) {\n\t\tthis.loading_promises.delete(asset_type);\n\t}\n\t/**\n\t *\n\t */\n\tstore_dynamic_body(instance_id, body_pair) {\n\t\tif (BLORKPACK_FLAGS.PHYSICS_LOGS) console.log(`Storing dynamic body: ${instance_id}`);\n\t\tthis.dynamic_bodies.set(instance_id, body_pair);\n\t}\n\t/**\n\t *\n\t */\n\tget_dynamic_body(instance_id) {\n\t\treturn this.dynamic_bodies.get(instance_id);\n\t}\n\t/**\n\t *\n\t */\n\tget_all_dynamic_bodies() {\n\t\treturn Array.from(this.dynamic_bodies.values());\n\t}\n\t/**\n\t *\n\t */\n\tget_body_pair_by_mesh(mesh) {\n\t\t// First try direct match\n\t\tfor (const [id, [object_mesh, body]] of this.dynamic_bodies.entries()) {\n\t\t\tif (object_mesh === mesh) {\n\t\t\t\t// Return array format for backwards compatibility with existing code\n\t\t\t\treturn [object_mesh, body];\n\t\t\t}\n\t\t\t// If the object is a child of a mesh in our storage\n\t\t\tif (object_mesh.children && object_mesh.children.includes(mesh)) {\n\t\t\t\treturn [object_mesh, body];\n\t\t\t}\n\t\t\t// Check if the mesh is a child somewhere in the hierarchy\n\t\t\tlet foundInHierarchy = false;\n\t\t\tobject_mesh.traverse((child) => {\n\t\t\t\tif (child === mesh) {\n\t\t\t\t\tfoundInHierarchy = true;\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (foundInHierarchy) {\n\t\t\t\treturn [object_mesh, body];\n\t\t\t}\n\t\t}\n\t\t// If direct match fails, try matching by name for legacy support\n\t\tconst meshName = mesh.name;\n\t\tfor (const [id, [object_mesh, body]] of this.dynamic_bodies.entries()) {\n\t\t\tif (object_mesh.name === meshName) {\n\t\t\t\treturn [object_mesh, body];\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\t/**\n\t *\n\t */\n\tstore_static_mesh(instance_id, mesh) {\n\t\tthis.static_meshes.set(instance_id, mesh);\n\t}\n\t/**\n\t *\n\t */\n\tget_static_mesh(instance_id) {\n\t\treturn this.static_meshes.get(instance_id);\n\t}\n\t/**\n\t *\n\t */\n\tget_all_static_meshes() {\n\t\treturn Array.from(this.static_meshes.values());\n\t}\n\t/**\n\t *\n\t */\n\tstore_material(key, material) {\n\t\tthis.material_cache.set(key, material);\n\t}\n\t/**\n\t *\n\t */\n\tget_material(key, originalMaterial) {\n\t\tif (this.has_material(key)) {\n\t\t\treturn this.material_cache.get(key);\n\t\t}\n\t\tif (originalMaterial) {\n\t\t\t// Clone the original material if provided\n\t\t\tconst material = originalMaterial.clone();\n\t\t\tthis.store_material(key, material);\n\t\t\treturn material;\n\t\t}\n\t\t// Create a basic material if nothing else is available\n\t\tconst material = new THREE.MeshStandardMaterial();\n\t\tthis.store_material(key, material);\n\t\treturn material;\n\t}\n\t/**\n\t *\n\t */\n\thas_material(key) {\n\t\treturn this.material_cache.has(key);\n\t}\n\t/**\n\t *\n\t */\n\tset_emission_state(object_name, state) {\n\t\tthis.emission_states.set(object_name, state);\n\t}\n\t/**\n\t *\n\t */\n\tget_emission_state(object_name) {\n\t\treturn this.emission_states.get(object_name);\n\t}\n\t/**\n\t *\n\t */\n\tdelete_emission_state(object_name) {\n\t\tthis.emission_states.delete(object_name);\n\t}\n\t/**\n\t *\n\t */\n\tset_currently_activated_name(name) {\n\t\tthis.currently_activated_name = name;\n\t}\n\t/**\n\t *\n\t */\n\tget_currently_activated_name() {\n\t\treturn this.currently_activated_name;\n\t}\n\t/**\n\t *\n\t */\n\tcontains_object(object_name) {\n\t\treturn this.emission_states.has(object_name);\n\t}\n\t/**\n     * Gets all assets (both dynamic bodies and static meshes).\n     * @returns {Array} Array of all assets.\n     */\n\tget_all_assets() {\n\t\t// Get dynamic bodies\n\t\tconst dynamic = this.get_all_dynamic_bodies().map(([mesh, body]) => {\n\t\t\treturn {\n\t\t\t\tmesh: mesh,\n\t\t\t\tbody: body,\n\t\t\t\ttype: mesh.userData?.type || 'unknown'\n\t\t\t};\n\t\t});\n\t\t// Get static meshes\n\t\tconst static_meshes = this.get_all_static_meshes().map(mesh => {\n\t\t\treturn {\n\t\t\t\tmesh: mesh,\n\t\t\t\tbody: null,\n\t\t\t\ttype: mesh.userData?.type || 'unknown'\n\t\t\t};\n\t\t});\n\t\t// Combine both arrays\n\t\treturn [...dynamic, ...static_meshes];\n\t}\n} ","import { THREE } from \"./index.js\";\nimport CustomTypeManager from \"./custom_type_manager.js\";\nimport { BLORKPACK_FLAGS } from \"./blorkpack_flags.js\";\nimport { AssetStorage } from \"./asset_storage.js\";\n/**\n * Class responsible for handling asset activation and interaction.\n */\nexport class AssetActivator {\n\tstatic instance = null;\n\tname = \"[AssetActivator]\";\n\tactivations = new Map();\n\t// Cache the CustomTypeManager types\n\t#assetTypes = null;\n\t/**\n\t *\n\t */\n\tconstructor(camera, renderer) {\n\t\tif (AssetActivator.instance) {\n\t\t\treturn AssetActivator.instance;\n\t\t}\n\t\tthis.camera = camera;\n\t\tthis.renderer = renderer;\n\t\tthis.storage = AssetStorage.get_instance();\n\t\tthis.raycaster = new THREE.Raycaster();\n\t\tthis.mouse = new THREE.Vector2();\n\t\tthis.active_objects = new Set();\n\t\t// Cache the asset types\n\t\tthis.#assetTypes = CustomTypeManager.getTypes();\n\t\tAssetActivator.instance = this;\n\t}\n\t/**\n     * Gets or creates the singleton instance of AssetActivator.\n     * @param {THREE.Camera} camera - The camera for raycasting.\n     * @param {THREE.WebGLRenderer} renderer - The renderer.\n     * @returns {AssetActivator} The singleton instance.\n     */\n\tstatic get_instance(camera, renderer) {\n\t\tif (!AssetActivator.instance) {\n\t\t\tAssetActivator.instance = new AssetActivator(camera, renderer);\n\t\t} else {\n\t\t\t// Update camera and renderer if provided\n\t\t\tif (camera) AssetActivator.instance.camera = camera;\n\t\t\tif (renderer) AssetActivator.instance.renderer = renderer;\n\t\t}\n\t\treturn AssetActivator.instance;\n\t}\n\t/**\n     * Checks if a mesh has active emission properties.\n     * @param {THREE.Mesh|THREE.Object3D} mesh - The mesh to check for emission.\n     * @returns {boolean} True if the mesh has active emission properties.\n     */\n\tis_mesh_emissive(mesh) {\n\t\tif (!mesh) return false;\n\t\tlet has_emissive = false;\n\t\tconst check_material = (material) => {\n\t\t\treturn material && \n                   material.emissive && \n                   material.emissiveIntensity > 0 &&\n                   material.emissiveIntensity === 9; // Our target intensity\n\t\t};\n\t\tif (mesh.isGroup || mesh.isObject3D) {\n\t\t\tmesh.traverse((child) => {\n\t\t\t\tif (child.isMesh && !child.name.startsWith('col_')) {\n\t\t\t\t\tif (check_material(child.material)) {\n\t\t\t\t\t\thas_emissive = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t} else if (mesh.isMesh) {\n\t\t\thas_emissive = check_material(mesh.material);\n\t\t}\n\t\treturn has_emissive;\n\t}\n\t/**\n     * Activates an object in the scene, applying emission effects.\n     * @param {string} object_name - The name of the object to activate.\n     * @returns {boolean} True if activation was successful.\n     */\n\tactivate_object(object_name) {\n\t\tif (BLORKPACK_FLAGS.ACTIVATE_LOGS) console.log(`${this.name} Activating: ${object_name}`);\n\t\t// Check if object exists\n\t\tif (!this.storage.contains_object(object_name)) {\n\t\t\tif (BLORKPACK_FLAGS.ACTIVATE_LOGS) console.log(`${this.name} Object not found: ${object_name}`);\n\t\t\treturn false;\n\t\t}\n\t\t// Check if already activated\n\t\tif (this.storage.get_currently_activated_name() === object_name) {\n\t\t\tif (BLORKPACK_FLAGS.ACTIVATE_LOGS) console.log(`${this.name} Object already activated: ${object_name}`);\n\t\t\treturn true;\n\t\t}\n\t\t// Get the mesh from storage\n\t\tconst mesh = this.storage.get_static_mesh(object_name);\n\t\tif (!mesh) {\n\t\t\tif (BLORKPACK_FLAGS.ACTIVATE_LOGS) console.log(`${this.name} Mesh not found for: ${object_name}`);\n\t\t\treturn false;\n\t\t}\n\t\t// Apply emission effect to the mesh\n\t\tmesh.traverse((child) => {\n\t\t\tif (child.isMesh && !child.name.startsWith('col_')) {\n\t\t\t\tif (child.material) {\n\t\t\t\t\tconst materials = Array.isArray(child.material) ? child.material : [child.material];\n\t\t\t\t\tmaterials.forEach((material) => {\n\t\t\t\t\t\tif (material.emissive) {\n\t\t\t\t\t\t\t// Store original emission color if not already stored\n\t\t\t\t\t\t\tif (!material._originalEmissive) {\n\t\t\t\t\t\t\t\tmaterial._originalEmissive = material.emissive.clone();\n\t\t\t\t\t\t\t\tmaterial._originalEmissiveIntensity = material.emissiveIntensity;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// Set emission properties\n\t\t\t\t\t\t\tmaterial.emissive.set(0xffffff);\n\t\t\t\t\t\t\tmaterial.emissiveIntensity = 9;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t// Store activation state\n\t\tthis.storage.set_emission_state(object_name, true);\n\t\tthis.storage.set_currently_activated_name(object_name);\n\t\tthis.active_objects.add(object_name);\n\t\treturn true;\n\t}\n\t/**\n     * Deactivates an object, removing emission effects.\n     * @param {string} object_name - The name of the object to deactivate.\n     * @returns {boolean} True if deactivation was successful.\n     */\n\tdeactivate_object(object_name) {\n\t\tif (BLORKPACK_FLAGS.ACTIVATE_LOGS) console.log(`${this.name} Deactivating: ${object_name}`);\n\t\tif (!this.storage.contains_object(object_name)) {\n\t\t\treturn false;\n\t\t}\n\t\t// Get the mesh from storage\n\t\tconst mesh = this.storage.get_static_mesh(object_name);\n\t\tif (!mesh) {\n\t\t\treturn false;\n\t\t}\n\t\t// Remove emission effect\n\t\tmesh.traverse((child) => {\n\t\t\tif (child.isMesh && !child.name.startsWith('col_')) {\n\t\t\t\tif (child.material) {\n\t\t\t\t\tconst materials = Array.isArray(child.material) ? child.material : [child.material];\n\t\t\t\t\tmaterials.forEach((material) => {\n\t\t\t\t\t\tif (material.emissive && material._originalEmissive) {\n\t\t\t\t\t\t\t// Restore original emission properties\n\t\t\t\t\t\t\tmaterial.emissive.copy(material._originalEmissive);\n\t\t\t\t\t\t\tmaterial.emissiveIntensity = material._originalEmissiveIntensity || 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t// Update state\n\t\tthis.storage.set_emission_state(object_name, false);\n\t\tif (this.storage.get_currently_activated_name() === object_name) {\n\t\t\tthis.storage.set_currently_activated_name(\"\");\n\t\t}\n\t\tthis.active_objects.delete(object_name);\n\t\treturn true;\n\t}\n\t/**\n     * Deactivates all currently active objects.\n     * @returns {void}\n     */\n\tdeactivate_all_objects() {\n\t\tif (BLORKPACK_FLAGS.ACTIVATE_LOGS) console.log(`${this.name} Deactivating all objects`);\n\t\t// Create a copy of the active objects set to avoid modification during iteration\n\t\tconst activeObjectsCopy = new Set(this.active_objects);\n\t\t// Deactivate each object\n\t\tactiveObjectsCopy.forEach(object_name => {\n\t\t\tthis.deactivate_object(object_name);\n\t\t});\n\t}\n\t/**\n     * Handles mouse movement for interaction.\n     * @param {MouseEvent} event - The mouse event.\n     */\n\tonMouseMove(event) {\n\t\t// Calculate normalized device coordinates from the event\n\t\tconst canvas = this.renderer.domElement;\n\t\tconst rect = canvas.getBoundingClientRect();\n\t\tthis.mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;\n\t\tthis.mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;\n\t}\n\t/**\n     * Performs a raycast to find intersected objects.\n     * @param {THREE.Scene} scene - The scene to raycast against.\n     * @returns {Array} Array of intersected objects.\n     */\n\traycast(scene) {\n\t\tthis.raycaster.setFromCamera(this.mouse, this.camera);\n\t\treturn this.raycaster.intersectObjects(scene.children, true);\n\t}\n\t/**\n     * Cleans up resources and resets state.\n     */\n\tcleanup() {\n\t\tthis.deactivate_all_objects();\n\t\tthis.active_objects.clear();\n\t\tAssetActivator.instance = null;\n\t}\n} ","/**\n * Enum representing the various system asset types that can be spawned.\n * Each type has a string value property that is used when passing the type as a parameter.\n */\nexport class SystemAssetType {\n\tstatic PRIMITIVE_BOX = { value: 'primitive_box' };\n\tstatic PRIMITIVE_SPHERE = { value: 'primitive_sphere' };\n\tstatic PRIMITIVE_CAPSULE = { value: 'primitive_capsule' };\n\tstatic PRIMITIVE_CYLINDER = { value: 'primitive_cylinder' };\n\tstatic SPOTLIGHT = { value: 'spotlight' };\n\t// TODO Create spawner for camera\n\tstatic CAMERA = { value: 'camera' };\n\t/**\n     * Checks if the provided asset type string matches a system asset type.\n     * @param {string} typeValue - The asset type string to check\n     * @returns {boolean} True if the type is a system asset type\n     */\n\tstatic isSystemAssetType(typeValue) {\n\t\treturn Object.values(this).some(type => type.value === typeValue);\n\t}\n\t/**\n     * Gets the system asset type enum object from a string value.\n     * @param {string} typeValue - The string value to convert to an enum\n     * @returns {Object|null} The enum object or null if not found\n     */\n\tstatic fromValue(typeValue) {\n\t\treturn Object.values(this).find(type => type.value === typeValue) || null;\n\t}\n}\n","/**\n * Utility class for generating unique IDs.\n * Implements singleton pattern for global access.\n */\nexport class IdGenerator {\n\tstatic instance = null;\n\t/**\n\t *\n\t */\n\tconstructor() {\n\t\tif (IdGenerator.instance) {\n\t\t\treturn IdGenerator.instance;\n\t\t}\n\t\t// Initialize counter for numeric IDs\n\t\tthis.counter = 0;\n\t\t// Store the instance\n\t\tIdGenerator.instance = this;\n\t}\n\t/**\n     * Gets or creates the singleton instance of IdGenerator.\n     * @returns {IdGenerator} The singleton instance.\n     */\n\tstatic get_instance() {\n\t\tif (!IdGenerator.instance) {\n\t\t\tIdGenerator.instance = new IdGenerator();\n\t\t}\n\t\treturn IdGenerator.instance;\n\t}\n\t/**\n     * Generates a unique asset ID using timestamp and random numbers.\n     * @returns {string} A unique ID string\n     */\n\tgenerate_asset_id() {\n\t\tconst timestamp = Date.now();\n\t\tconst random = Math.floor(Math.random() * 10000);\n\t\treturn `asset_${timestamp}_${random}`;\n\t}\n\t/**\n     * Generates a unique numeric ID.\n     * @returns {number} A unique numeric ID\n     */\n\tgenerate_numeric_id() {\n\t\treturn ++this.counter;\n\t}\n\t/**\n     * Generates a unique ID with a custom prefix.\n     * @param {string} prefix - The prefix to use for the ID\n     * @returns {string} A unique ID string with the specified prefix\n     */\n\tgenerate_prefixed_id(prefix) {\n\t\tconst timestamp = Date.now();\n\t\tconst random = Math.floor(Math.random() * 10000);\n\t\treturn `${prefix}_${timestamp}_${random}`;\n\t}\n} ","import { THREE, RAPIER } from \"../../../index.js\";\nimport { BLORKPACK_FLAGS } from \"../../../blorkpack_flags.js\";\nimport { SystemAssetType } from \"../../common/system_asset_types.js\";\nimport { IdGenerator } from \"../../common/id_generator.js\";\n/**\n * Creates a primitive box with the specified dimensions and properties.\n * This is used for simple assets that don't require a full 3D model.\n * \n * @param {THREE.Scene} scene - The Three.js scene to add objects to\n * @param {RAPIER.World} world - The Rapier physics world\n * @param {number} width - Width of the box\n * @param {number} height - Height of the box\n * @param {number} depth - Depth of the box\n * @param {THREE.Vector3} position - Position of the box\n * @param {THREE.Quaternion} rotation - Rotation of the box\n * @param {Object} options - Additional options for the box\n * @returns {Promise<Object>} The created box with mesh and body\n */\nexport async function create_primitive_box(scene, world, width, height, depth, position, rotation, options = {}) {\n\t// Make sure position and rotation are valid\n\tposition = position || new THREE.Vector3();\n\t// Handle different rotation types or create default\n\tlet quaternion;\n\tif (rotation instanceof THREE.Quaternion) {\n\t\tquaternion = rotation;\n\t} else if (rotation instanceof THREE.Euler) {\n\t\tquaternion = new THREE.Quaternion().setFromEuler(rotation);\n\t} else {\n\t\tquaternion = new THREE.Quaternion();\n\t}\n\t// Create geometry and material\n\tconst geometry = new THREE.BoxGeometry(width, height, depth);\n\t// Convert color from string to number if needed\n\tlet color_value = options.color || 0x808080;\n\tif (typeof color_value === 'string') {\n\t\tif (color_value.startsWith('0x')) {\n\t\t\tcolor_value = parseInt(color_value, 16);\n\t\t} else if (color_value.startsWith('#')) {\n\t\t\tcolor_value = parseInt(color_value.substring(1), 16);\n\t\t}\n\t}\n\tconst material = new THREE.MeshStandardMaterial({ \n\t\tcolor: color_value,\n\t\ttransparent: options.opacity < 1.0,\n\t\topacity: options.opacity || 1.0\n\t});\n\t// Create mesh\n\tconst mesh = new THREE.Mesh(geometry, material);\n\tmesh.position.copy(position);\n\tmesh.quaternion.copy(quaternion);\n\t// Set shadow properties\n\tmesh.castShadow = options.cast_shadow || false;\n\tmesh.receiveShadow = options.receive_shadow || false;\n\t// Add objects to scene in next frame to prevent stuttering\n\tawait new Promise(resolve => setTimeout(resolve, 0));\n\t// Add to scene\n\tscene.add(mesh);\n\t// Disable raycasting if specified\n\tif (options.raycast_disabled) {\n\t\tmesh.raycast = () => null;\n\t}\n\t// Create physics body if collidable\n\tlet body = null;\n\tif (options.collidable !== false) {\n\t\t// Determine body type based on mass and options\n\t\tlet body_desc;\n\t\tif (options.mass <= 0 || options.gravity === false) {\n\t\t\tbody_desc = RAPIER.RigidBodyDesc.fixed();\n\t\t} else {\n\t\t\tbody_desc = RAPIER.RigidBodyDesc.dynamic()\n\t\t\t\t.setMass(options.mass)\n\t\t\t\t.setCanSleep(options.sleeping !== false);\n\t\t}\n\t\t// Set position and rotation\n\t\tbody_desc.setTranslation(position.x, position.y, position.z);\n\t\tbody_desc.setRotation({\n\t\t\tx: quaternion.x,\n\t\t\ty: quaternion.y,\n\t\t\tz: quaternion.z,\n\t\t\tw: quaternion.w\n\t\t});\n\t\t// Create body\n\t\tbody = world.createRigidBody(body_desc);\n\t\t// Create collider\n\t\tlet collider_desc;\n\t\t// Use custom collider dimensions if specified, otherwise use mesh dimensions\n\t\tconst collider_width = (options.collider_dimensions?.width !== undefined) ? \n\t\t\toptions.collider_dimensions.width : width / 2;\n\t\tconst collider_height = (options.collider_dimensions?.height !== undefined) ? \n\t\t\toptions.collider_dimensions.height : height / 2;\n\t\tconst collider_depth = (options.collider_dimensions?.depth !== undefined) ? \n\t\t\toptions.collider_dimensions.depth : depth / 2;\n\t\t// Create cuboid collider\n\t\tcollider_desc = RAPIER.ColliderDesc.cuboid(collider_width, collider_height, collider_depth);\n\t\t// Set restitution and friction\n\t\tcollider_desc.setRestitution(options.restitution || 0.5);\n\t\tcollider_desc.setFriction(options.friction || 0.5);\n\t\t// Create collider and attach to body\n\t\tconst collider = world.createCollider(collider_desc, body);\n\t}\n\t// Generate a unique ID for this asset\n\tconst instance_id = IdGenerator.get_instance().generate_asset_id();\n\t// Return the result\n\treturn {\n\t\tmesh,\n\t\tbody,\n\t\tinstance_id,\n\t\ttype: SystemAssetType.PRIMITIVE_BOX.value,\n\t\toptions\n\t};\n} ","import { THREE, RAPIER } from \"../../../index.js\";\nimport { BLORKPACK_FLAGS } from \"../../../blorkpack_flags.js\";\nimport { SystemAssetType } from \"../../common/system_asset_types.js\";\nimport { IdGenerator } from \"../../common/id_generator.js\";\n/**\n * Creates a primitive sphere with the specified properties.\n * \n * @param {THREE.Scene} scene - The Three.js scene to add objects to\n * @param {RAPIER.World} world - The Rapier physics world\n * @param {string} id - The ID of the sphere\n * @param {number} radius - Radius of the sphere\n * @param {THREE.Vector3} position - Position of the sphere\n * @param {THREE.Quaternion} rotation - Rotation of the sphere\n * @param {Object} options - Additional options for the sphere\n * @returns {Promise<Object>} The created sphere with mesh and physics body\n */\nexport async function create_primitive_sphere(scene, world, id, radius, position, rotation, options = {}) {\n\t// Make sure position and rotation are valid\n\tposition = position || new THREE.Vector3();\n\trotation = rotation || new THREE.Quaternion();\n\tif (BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\tconsole.log(`Creating primitive sphere for ${id} with radius: ${radius}`);\n\t}\n\t// Create geometry and material\n\tconst geometry = new THREE.SphereGeometry(radius, 32, 24);\n\t// Convert color from string to number if needed\n\tlet color_value = options.color || 0x808080;\n\tif (typeof color_value === 'string') {\n\t\tif (color_value.startsWith('0x')) {\n\t\t\tcolor_value = parseInt(color_value, 16);\n\t\t} else if (color_value.startsWith('#')) {\n\t\t\tcolor_value = parseInt(color_value.substring(1), 16);\n\t\t}\n\t}\n\tconst material = new THREE.MeshStandardMaterial({ \n\t\tcolor: color_value,\n\t\ttransparent: options.opacity < 1.0,\n\t\topacity: options.opacity || 1.0\n\t});\n\t// Create mesh\n\tconst mesh = new THREE.Mesh(geometry, material);\n\tmesh.position.copy(position);\n\tmesh.quaternion.copy(rotation);\n\t// Set shadow properties\n\tmesh.castShadow = options.cast_shadow || false;\n\tmesh.receiveShadow = options.receive_shadow || false;\n\t// Add objects to scene in next frame to prevent stuttering\n\tawait new Promise(resolve => setTimeout(resolve, 0));\n\t// Add to scene\n\tscene.add(mesh);\n\t// Disable raycasting if specified\n\tif (options.raycast_disabled) {\n\t\tmesh.raycast = () => null;\n\t}\n\t// Create physics body if collidable\n\tlet body = null;\n\tif (options.collidable !== false && world) {\n\t\t// Determine body type based on mass and options\n\t\tlet body_desc;\n\t\tif (options.mass <= 0 || options.gravity === false) {\n\t\t\tbody_desc = RAPIER.RigidBodyDesc.fixed();\n\t\t} else {\n\t\t\tbody_desc = RAPIER.RigidBodyDesc.dynamic()\n\t\t\t\t.setMass(options.mass)\n\t\t\t\t.setCanSleep(options.sleeping !== false);\n\t\t}\n\t\t// Set position and rotation\n\t\tbody_desc.setTranslation(position.x, position.y, position.z);\n\t\tbody_desc.setRotation({\n\t\t\tx: rotation.x,\n\t\t\ty: rotation.y,\n\t\t\tz: rotation.z,\n\t\t\tw: rotation.w\n\t\t});\n\t\t// Create body\n\t\tbody = world.createRigidBody(body_desc);\n\t\t// Create sphere collider\n\t\tconst collider_desc = RAPIER.ColliderDesc.ball(radius);\n\t\t// Set restitution and friction\n\t\tcollider_desc.setRestitution(options.restitution || 0.5);\n\t\tcollider_desc.setFriction(options.friction || 0.5);\n\t\t// Create collider and attach to body\n\t\tconst collider = world.createCollider(collider_desc, body);\n\t}\n\t// Generate a unique ID for this asset\n\tconst instance_id = IdGenerator.get_instance().generate_asset_id();\n\t// Return the result\n\treturn {\n\t\tmesh,\n\t\tbody,\n\t\tinstance_id,\n\t\ttype: SystemAssetType.PRIMITIVE_SPHERE.value,\n\t\toptions\n\t};\n}\n\n/**\n * Generates a unique asset ID for spawned assets.\n * @returns {string} A unique ID string\n */\nfunction generate_asset_id() {\n\t// Simple implementation using timestamp and random numbers\n\tconst timestamp = Date.now();\n\tconst random = Math.floor(Math.random() * 10000);\n\treturn `asset_${timestamp}_${random}`;\n} ","import { THREE, RAPIER } from \"../../../index.js\";\nimport { BLORKPACK_FLAGS } from \"../../../blorkpack_flags.js\";\nimport { SystemAssetType } from \"../../common/system_asset_types.js\";\nimport { IdGenerator } from \"../../common/id_generator.js\";\n/**\n * Creates a primitive capsule with the specified properties.\n * \n * @param {THREE.Scene} scene - The Three.js scene to add objects to\n * @param {RAPIER.World} world - The Rapier physics world\n * @param {string} id - The ID of the capsule\n * @param {number} radius - Radius of the capsule\n * @param {number} height - Height of the capsule (not including the hemispherical caps)\n * @param {THREE.Vector3} position - Position of the capsule\n * @param {THREE.Quaternion} rotation - Rotation of the capsule\n * @param {Object} options - Additional options for the capsule\n * @returns {Promise<Object>} The created capsule with mesh and physics body\n */\nexport async function create_primitive_capsule(scene, world, id, radius, height, position, rotation, options = {}) {\n\t// Make sure position and rotation are valid\n\tposition = position || new THREE.Vector3();\n\trotation = rotation || new THREE.Quaternion();\n\tif (BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\tconsole.log(`Creating primitive capsule for ${id} with radius: ${radius}, height: ${height}`);\n\t}\n\t// Create geometry (use cylinder for now)\n\tconst geometry = new THREE.CapsuleGeometry(radius, height, 16, 32);\n\t// Convert color from string to number if needed\n\tlet color_value = options.color || 0x808080;\n\tif (typeof color_value === 'string') {\n\t\tif (color_value.startsWith('0x')) {\n\t\t\tcolor_value = parseInt(color_value, 16);\n\t\t} else if (color_value.startsWith('#')) {\n\t\t\tcolor_value = parseInt(color_value.substring(1), 16);\n\t\t}\n\t}\n\tconst material = new THREE.MeshStandardMaterial({ \n\t\tcolor: color_value,\n\t\ttransparent: options.opacity < 1.0,\n\t\topacity: options.opacity || 1.0\n\t});\n\t// Create mesh\n\tconst mesh = new THREE.Mesh(geometry, material);\n\tmesh.position.copy(position);\n\tmesh.quaternion.copy(rotation);\n\t// Set shadow properties\n\tmesh.castShadow = options.cast_shadow || false;\n\tmesh.receiveShadow = options.receive_shadow || false;\n\t// Add objects to scene in next frame to prevent stuttering\n\tawait new Promise(resolve => setTimeout(resolve, 0));\n\t// Add to scene\n\tscene.add(mesh);\n\t// Disable raycasting if specified\n\tif (options.raycast_disabled) {\n\t\tmesh.raycast = () => null;\n\t}\n\t// Create physics body if collidable\n\tlet body = null;\n\tif (options.collidable !== false && world) {\n\t\t// Determine body type based on mass and options\n\t\tlet body_desc;\n\t\tif (options.mass <= 0 || options.gravity === false) {\n\t\t\tbody_desc = RAPIER.RigidBodyDesc.fixed();\n\t\t} else {\n\t\t\tbody_desc = RAPIER.RigidBodyDesc.dynamic()\n\t\t\t\t.setMass(options.mass)\n\t\t\t\t.setCanSleep(options.sleeping !== false);\n\t\t}\n\t\t// Set position and rotation\n\t\tbody_desc.setTranslation(position.x, position.y, position.z);\n\t\tbody_desc.setRotation({\n\t\t\tx: rotation.x,\n\t\t\ty: rotation.y,\n\t\t\tz: rotation.z,\n\t\t\tw: rotation.w\n\t\t});\n\t\t// Create body\n\t\tbody = world.createRigidBody(body_desc);\n\t\t// Create capsule collider\n\t\tconst collider_desc = RAPIER.ColliderDesc.capsule(height / 2, radius);\n\t\t// Set restitution and friction\n\t\tcollider_desc.setRestitution(options.restitution || 0.5);\n\t\tcollider_desc.setFriction(options.friction || 0.5);\n\t\t// Create collider and attach to body\n\t\tconst collider = world.createCollider(collider_desc, body);\n\t}\n\t// Generate a unique ID for this asset\n\tconst instance_id = IdGenerator.get_instance().generate_asset_id();\n\t// Return the result\n\treturn {\n\t\tmesh,\n\t\tbody,\n\t\tinstance_id,\n\t\ttype: SystemAssetType.PRIMITIVE_CAPSULE.value,\n\t\toptions\n\t};\n} ","import { THREE, RAPIER } from \"../../../index.js\";\nimport { BLORKPACK_FLAGS } from \"../../../blorkpack_flags.js\";\nimport { SystemAssetType } from \"../../common/system_asset_types.js\";\nimport { IdGenerator } from \"../../common/id_generator.js\";\n/**\n * Creates a primitive cylinder with the specified properties.\n * \n * @param {THREE.Scene} scene - The Three.js scene to add objects to\n * @param {RAPIER.World} world - The Rapier physics world\n * @param {string} id - The ID of the cylinder\n * @param {number} radius - Radius of the cylinder\n * @param {number} height - Height of the cylinder\n * @param {THREE.Vector3} position - Position of the cylinder\n * @param {THREE.Quaternion} rotation - Rotation of the cylinder\n * @param {Object} options - Additional options for the cylinder\n * @returns {Promise<Object>} The created cylinder with mesh and physics body\n */\nexport async function create_primitive_cylinder(scene, world, id, radius, height, position, rotation, options = {}) {\n\t// Make sure position and rotation are valid\n\tposition = position || new THREE.Vector3();\n\trotation = rotation || new THREE.Quaternion();\n\tif (BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\tconsole.log(`Creating primitive cylinder for ${id} with radius: ${radius}, height: ${height}`);\n\t}\n\t// Create geometry\n\tconst geometry = new THREE.CylinderGeometry(radius, radius, height, 32);\n\t// Convert color from string to number if needed\n\tlet color_value = options.color || 0x808080;\n\tif (typeof color_value === 'string') {\n\t\tif (color_value.startsWith('0x')) {\n\t\t\tcolor_value = parseInt(color_value, 16);\n\t\t} else if (color_value.startsWith('#')) {\n\t\t\tcolor_value = parseInt(color_value.substring(1), 16);\n\t\t}\n\t}\n\tconst material = new THREE.MeshStandardMaterial({ \n\t\tcolor: color_value,\n\t\ttransparent: options.opacity < 1.0,\n\t\topacity: options.opacity || 1.0\n\t});\n\t// Create mesh\n\tconst mesh = new THREE.Mesh(geometry, material);\n\tmesh.position.copy(position);\n\tmesh.quaternion.copy(rotation);\n\t// Set shadow properties\n\tmesh.castShadow = options.cast_shadow || false;\n\tmesh.receiveShadow = options.receive_shadow || false;\n\t// Add objects to scene in next frame to prevent stuttering\n\tawait new Promise(resolve => setTimeout(resolve, 0));\n\t// Add to scene\n\tscene.add(mesh);\n\t// Disable raycasting if specified\n\tif (options.raycast_disabled) {\n\t\tmesh.raycast = () => null;\n\t}\n\t// Create physics body if collidable\n\tlet body = null;\n\tif (options.collidable !== false && world) {\n\t\t// Determine body type based on mass and options\n\t\tlet body_desc;\n\t\tif (options.mass <= 0 || options.gravity === false) {\n\t\t\tbody_desc = RAPIER.RigidBodyDesc.fixed();\n\t\t} else {\n\t\t\tbody_desc = RAPIER.RigidBodyDesc.dynamic()\n\t\t\t\t.setMass(options.mass)\n\t\t\t\t.setCanSleep(options.sleeping !== false);\n\t\t}\n\t\t// Set position and rotation\n\t\tbody_desc.setTranslation(position.x, position.y, position.z);\n\t\tbody_desc.setRotation({\n\t\t\tx: rotation.x,\n\t\t\ty: rotation.y,\n\t\t\tz: rotation.z,\n\t\t\tw: rotation.w\n\t\t});\n\t\t// Create body\n\t\tbody = world.createRigidBody(body_desc);\n\t\t// Create cylinder collider\n\t\tconst collider_desc = RAPIER.ColliderDesc.cylinder(height / 2, radius);\n\t\t// Set restitution and friction\n\t\tcollider_desc.setRestitution(options.restitution || 0.5);\n\t\tcollider_desc.setFriction(options.friction || 0.5);\n\t\t// Create collider and attach to body\n\t\tconst collider = world.createCollider(collider_desc, body);\n\t}\n\t// Generate a unique ID for this asset\n\tconst instance_id = IdGenerator.get_instance().generate_asset_id();\n\t// Return the result\n\treturn {\n\t\tmesh,\n\t\tbody,\n\t\tinstance_id,\n\t\ttype: SystemAssetType.PRIMITIVE_CYLINDER.value,\n\t\toptions\n\t};\n} ","import { THREE } from \"../../../index.js\";\nimport { BLORKPACK_FLAGS } from \"../../../blorkpack_flags.js\";\nimport { SystemAssetType } from \"../../common/system_asset_types.js\";\nimport { IdGenerator } from \"../../common/id_generator.js\";\nimport { AssetStorage } from \"../../../asset_storage.js\";\n// Configuration constant for unlimited spotlight debug visualization\nconst UNLIMITED_SPOTLIGHT_DEBUG_LENGTH = 400;\n/**\n * Creates a spotlight with the specified properties.\n * \n * @param {THREE.Scene} scene - The Three.js scene to add objects to\n * @param {string} id - The ID of the spotlight\n * @param {THREE.Vector3} position - Position of the spotlight\n * @param {THREE.Euler} rotation - Rotation of the spotlight\n * @param {Object} options - Additional options for the spotlight\n * @param {Object} asset_data - The complete asset data from the manifest\n * @returns {Promise<Object>} The created spotlight\n */\nexport async function create_spotlight(scene, id, position, rotation, options = {}, asset_data = {}) {\n\tif (BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\tconsole.log(`Creating spotlight for ${id}`);\n\t}\n\t// Get spotlight specific properties from additional_properties\n\tconst color = parseInt(options.color || \"0xffffff\", 16);\n\tconst intensity = asset_data?.additional_properties?.intensity || options.intensity || 0.3;\n\tconst max_distance = asset_data?.additional_properties?.max_distance || options.max_distance || 0;\n\tconst angle = asset_data?.additional_properties?.angle || options.angle || Math.PI / 8;\n\tconst penumbra = asset_data?.additional_properties?.penumbra || options.penumbra || 0.1;\n\tconst sharpness = asset_data?.additional_properties?.sharpness || options.sharpness || 0.5;\n\tif (BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\tconsole.log(`Spotlight properties: color=${color.toString(16)}, intensity=${intensity}, max_distance=${max_distance}, angle=${angle}, penumbra=${penumbra}, sharpness=${sharpness}`);\n\t}\n\ttry {\n\t\t// Create the spotlight\n\t\tconst spotlight = new THREE.SpotLight(\n\t\t\tcolor,\n\t\t\tintensity,\n\t\t\tmax_distance,\n\t\t\tangle,\n\t\t\tpenumbra,\n\t\t\tsharpness\n\t\t);\n\t\t// Set the spotlight's position\n\t\tspotlight.position.copy(position);\n\t\t// Set shadow properties if the spotlight should cast shadows\n\t\tif (options.cast_shadow) {\n\t\t\tspotlight.castShadow = true;\n\t\t\t// Set shadow quality settings if provided\n\t\t\tif (asset_data?.additional_properties?.shadow) {\n\t\t\t\tconst shadow_props = asset_data.additional_properties.shadow;\n\t\t\t\t// Shadow map size\n\t\t\t\tif (shadow_props.map_size) {\n\t\t\t\t\tspotlight.shadow.mapSize.width = shadow_props.map_size.width || 2048;\n\t\t\t\t\tspotlight.shadow.mapSize.height = shadow_props.map_size.height || 2048;\n\t\t\t\t}\n\t\t\t\t// Shadow blur\n\t\t\t\tif (shadow_props.blur_samples) {\n\t\t\t\t\tspotlight.shadow.blurSamples = shadow_props.blur_samples;\n\t\t\t\t}\n\t\t\t\tif (shadow_props.radius !== undefined) {\n\t\t\t\t\tspotlight.shadow.radius = shadow_props.radius;\n\t\t\t\t}\n\t\t\t\t// Camera settings\n\t\t\t\tif (shadow_props.camera) {\n\t\t\t\t\tspotlight.shadow.camera.near = shadow_props.camera.near || 10;\n\t\t\t\t\tspotlight.shadow.camera.far = shadow_props.camera.far || 100;\n\t\t\t\t\tspotlight.shadow.camera.fov = shadow_props.camera.fov || 30;\n\t\t\t\t}\n\t\t\t\t// Bias settings\n\t\t\t\tif (shadow_props.bias !== undefined) {\n\t\t\t\t\tspotlight.shadow.bias = shadow_props.bias;\n\t\t\t\t}\n\t\t\t\tif (shadow_props.normal_bias !== undefined) {\n\t\t\t\t\tspotlight.shadow.normalBias = shadow_props.normal_bias;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Default shadow settings\n\t\t\t\tspotlight.shadow.blurSamples = 32;\n\t\t\t\tspotlight.shadow.radius = 4;\n\t\t\t\tspotlight.shadow.mapSize.width = 2048;\n\t\t\t\tspotlight.shadow.mapSize.height = 2048;\n\t\t\t\tspotlight.shadow.camera.near = 10;\n\t\t\t\tspotlight.shadow.camera.far = 100;\n\t\t\t\tspotlight.shadow.camera.fov = 30;\n\t\t\t\tspotlight.shadow.bias = -0.002;\n\t\t\t\tspotlight.shadow.normalBias = 0.02;\n\t\t\t}\n\t\t}\n\t\t// Create and position target\n\t\tconst target = new THREE.Object3D();\n\t\tlet hasCustomTarget = false;\n\t\t// If target data is provided in the asset data, use that\n\t\tif (asset_data?.target && asset_data.target.position) {\n\t\t\ttarget.position.set(\n\t\t\t\tasset_data.target.position.x || 0, \n\t\t\t\tasset_data.target.position.y || 0, \n\t\t\t\tasset_data.target.position.z || 0\n\t\t\t);\n\t\t\thasCustomTarget = true;\n\t\t} else {\n\t\t\t// Otherwise calculate target position based on rotation\n\t\t\tconst targetDistance = 100; // Use a fixed distance for the target\n\t\t\tlet rotX, rotY;\n\t\t\tif (rotation instanceof THREE.Euler) {\n\t\t\t\trotX = rotation.x || 0;\n\t\t\t\trotY = rotation.y || 0;\n\t\t\t} else {\n\t\t\t\trotX = rotation.x || 0;\n\t\t\t\trotY = rotation.y || 0;\n\t\t\t}\n\t\t\t// Calculate target position based on spherical coordinates\n\t\t\tconst x = Math.sin(rotY) * Math.cos(rotX) * targetDistance;\n\t\t\tconst y = Math.sin(rotX) * targetDistance;\n\t\t\tconst z = Math.cos(rotY) * Math.cos(rotX) * targetDistance;\n\t\t\ttarget.position.set(\n\t\t\t\tposition.x + x,\n\t\t\t\tposition.y + y,\n\t\t\t\tposition.z + z\n\t\t\t);\n\t\t\thasCustomTarget = false;\n\t\t}\n\t\t// Set the target\n\t\tspotlight.target = target;\n\t\t// Add objects to scene in next frame to prevent stuttering\n\t\tawait new Promise(resolve => setTimeout(resolve, 0));\n\t\t// Add the spotlight and target to the scene\n\t\ttry {\n\t\t\tscene.add(spotlight);\n\t\t\tscene.add(target);\n\t\t} catch (sceneError) {\n\t\t\tconsole.error(`Error adding spotlight to scene:`, sceneError);\n\t\t}\n\t\t// Set type in userData for later identification\n\t\tspotlight.userData = { \n\t\t\t...spotlight.userData,\n\t\t\ttype: SystemAssetType.SPOTLIGHT.value,\n\t\t\thasCustomTarget: hasCustomTarget\n\t\t};\n\t\t// Create debug visualization\n\t\tif (BLORKPACK_FLAGS.SPOTLIGHT_VISUAL_DEBUG) {\n\t\t\tconst helpers = await create_spotlight_helper(scene, spotlight);\n\t\t\tspotlight.userData.debugHelpers = helpers;\n\t\t}\n\t\t// Store references for later cleanup\n\t\tconst asset_object = {\n\t\t\tmesh: spotlight,\n\t\t\tbody: null, // No physics for lights\n\t\t\tobjects: [spotlight, target],\n\t\t\ttype: SystemAssetType.SPOTLIGHT.value\n\t\t};\n\t\t// Store in asset storage\n\t\ttry {\n\t\t\tconst storage = AssetStorage.get_instance();\n\t\t\tconst spotlight_id = storage.get_new_instance_id();\n\t\t\tstorage.store_static_mesh(spotlight_id, spotlight);\n\t\t\t// Ensure the spotlight is properly marked with its type for future queries\n\t\t\tspotlight.userData.type = SystemAssetType.SPOTLIGHT.value;\n\t\t\tspotlight.userData.id = id;\n\t\t\tspotlight.userData.instanceId = spotlight_id;\n\t\t} catch (storageError) {\n\t\t\tconsole.error(`Error storing spotlight in asset storage:`, storageError);\n\t\t}\n\t\treturn asset_object;\n\t} catch (spotlightError) {\n\t\tconsole.error(`ERROR CREATING SPOTLIGHT: ${id}`, spotlightError);\n\t\treturn null;\n\t}\n}\n\n/**\n * Creates a spotlight helper to visualize the spotlight cone and direction.\n * Used for debugging purposes.\n * \n * @param {THREE.Scene} scene - The Three.js scene\n * @param {THREE.SpotLight} spotlight - The spotlight to create helpers for\n * @returns {Promise<Object>} The created helper objects\n */\nasync function create_spotlight_helper(scene, spotlight) {\n\tif (!spotlight) {\n\t\tconsole.error(`Cannot create helper: spotlight is null or undefined`);\n\t\treturn null;\n\t}\n\t// Create shared materials for debug visualization\n\tconst sharedDebugMaterials = {\n\t\thelper: new THREE.LineBasicMaterial({ color: 0x00FF00 }),\n\t\tcone: new THREE.MeshBasicMaterial({ \n\t\t\tcolor: 0x00FF00,\n\t\t\twireframe: true,\n\t\t\ttransparent: true,\n\t\t\topacity: 0.6\n\t\t})\n\t};\n\t// Create the standard helper\n\tconst helper = new THREE.SpotLightHelper(spotlight);\n\thelper.material = sharedDebugMaterials.helper;\n\thelper.visible = BLORKPACK_FLAGS.SPOTLIGHT_VISUAL_DEBUG;\n\t// Store original update method\n\tconst originalUpdate = helper.update;\n\thelper.update = () => {\n\t\toriginalUpdate.call(helper);\n\t\thelper.traverse(child => {\n\t\t\tif (child.material && child !== helper) {\n\t\t\t\tchild.material = sharedDebugMaterials.helper;\n\t\t\t}\n\t\t});\n\t};\n\t// Make helper and all its children non-interactive\n\thelper.raycast = () => null;\n\thelper.traverse(child => {\n\t\tchild.raycast = () => null;\n\t});\n\t// Add helper in next frame\n\tawait new Promise(resolve => setTimeout(resolve, 0));\n\tscene.add(helper);\n\t// Create the cone visualization\n\tconst spotlightToTarget = new THREE.Vector3().subVectors(\n\t\tspotlight.target.position,\n\t\tspotlight.position\n\t);\n\t// Calculate distance to target\n\tconst distanceToTarget = spotlightToTarget.length();\n\t// Set the height of the cone based on the spotlight's distance property\n\tlet height;\n\tif (spotlight.distance > 0) {\n\t\theight = spotlight.distance;\n\t} else {\n\t\theight = UNLIMITED_SPOTLIGHT_DEBUG_LENGTH;\n\t}\n\tconst radius = Math.tan(spotlight.angle) * height;\n\t// Create cone geometry\n\tconst geometry = new THREE.ConeGeometry(radius, height, 32, 32, true);\n\tgeometry.translate(0, -height/2, 0);\n\t// Create cone mesh\n\tconst cone = new THREE.Mesh(geometry, sharedDebugMaterials.cone);\n\tcone.visible = BLORKPACK_FLAGS.SPOTLIGHT_VISUAL_DEBUG;\n\tcone.raycast = () => null;\n\tcone.traverse(child => {\n\t\tchild.raycast = () => null;\n\t});\n\t// Set cone position and orientation\n\tcone.position.copy(spotlight.position);\n\tconst direction = spotlightToTarget.normalize();\n\tconst quaternion = new THREE.Quaternion();\n\tquaternion.setFromUnitVectors(new THREE.Vector3(0, -1, 0), direction);\n\tcone.quaternion.copy(quaternion);\n\t// Add cone in next frame\n\tawait new Promise(resolve => setTimeout(resolve, 0));\n\tscene.add(cone);\n\treturn {\n\t\thelper,\n\t\tcone\n\t};\n}\n\n/**\n * Generates a unique asset ID for spawned assets.\n * @returns {string} A unique ID string\n */\nfunction generate_asset_id() {\n\t// Simple implementation using timestamp and random numbers\n\tconst timestamp = Date.now();\n\tconst random = Math.floor(Math.random() * 10000);\n\treturn `asset_${timestamp}_${random}`;\n}\n\n/**\n * Updates all helper visualizations for spotlights.\n * Called from the main animation loop.\n * \n * @param {THREE.Scene} scene - The Three.js scene\n * @returns {Promise<void>}\n */\nexport async function update_helpers(scene) {\n\tif (!scene) return;\n\t// Find all spotlights in the scene\n\tconst spotlights = [];\n\tscene.traverse(obj => {\n\t\tif (obj.type === 'SpotLight') {\n\t\t\tspotlights.push(obj);\n\t\t}\n\t});\n\t// Update each spotlight's helpers\n\tspotlights.forEach(spotlight => {\n\t\tif (spotlight.userData.debugHelpers) {\n\t\t\tconst { helper, cone } = spotlight.userData.debugHelpers;\n\t\t\t// Update helper\n\t\t\tif (helper) {\n\t\t\t\thelper.update();\n\t\t\t\thelper.visible = BLORKPACK_FLAGS.SPOTLIGHT_VISUAL_DEBUG;\n\t\t\t}\n\t\t\t// Update cone\n\t\t\tif (cone) {\n\t\t\t\t// Update cone position and orientation\n\t\t\t\tcone.position.copy(spotlight.position);\n\t\t\t\t// Calculate direction to target\n\t\t\t\tconst spotlightToTarget = new THREE.Vector3().subVectors(\n\t\t\t\t\tspotlight.target.position,\n\t\t\t\t\tspotlight.position\n\t\t\t\t);\n\t\t\t\t// Update cone orientation\n\t\t\t\tconst direction = spotlightToTarget.normalize();\n\t\t\t\tconst quaternion = new THREE.Quaternion();\n\t\t\t\tquaternion.setFromUnitVectors(new THREE.Vector3(0, -1, 0), direction);\n\t\t\t\tcone.quaternion.copy(quaternion);\n\t\t\t\t// Update cone visibility\n\t\t\t\tcone.visible = BLORKPACK_FLAGS.SPOTLIGHT_VISUAL_DEBUG;\n\t\t\t}\n\t\t}\n\t});\n} ","import { THREE, RAPIER } from \"../../index.js\";\nimport { BLORKPACK_FLAGS } from \"../../blorkpack_flags.js\";\nimport {\n\tcreate_primitive_box,\n\tcreate_primitive_sphere,\n\tcreate_primitive_capsule,\n\tcreate_primitive_cylinder,\n\tcreate_spotlight\n} from './system_spawners/index.js';\nimport { SystemAssetType } from \"../common/system_asset_types.js\";\nimport { AssetSpawner } from \"../asset_spawner.js\";\nimport { IdGenerator } from \"../common/id_generator.js\";\n/**\n * Factory class responsible for creating and managing system-level assets.\n * Implements singleton pattern for global access.\n */\nexport class SystemFactory {\n\tstatic instance = null;\n\t/**\n\t *\n\t */\n\tconstructor(scene, world) {\n\t\tif (SystemFactory.instance) {\n\t\t\treturn SystemFactory.instance;\n\t\t}\n\t\tthis.scene = scene;\n\t\tthis.world = world;\n\t\tSystemFactory.instance = this;\n\t}\n\t/**\n     * Gets or creates the singleton instance of SystemFactory.\n     * @param {THREE.Scene} scene - The Three.js scene to add objects to.\n     * @param {RAPIER.World} world - The Rapier physics world.\n     * @returns {SystemFactory} The singleton instance.\n     */\n\tstatic get_instance(scene, world) {\n\t\tif (!SystemFactory.instance) {\n\t\t\tSystemFactory.instance = new SystemFactory(scene, world);\n\t\t} else {\n\t\t\t// Update scene and world if provided\n\t\t\tif (scene) SystemFactory.instance.scene = scene;\n\t\t\tif (world) SystemFactory.instance.world = world;\n\t\t}\n\t\treturn SystemFactory.instance;\n\t}\n\t/**\n     * Spawns assets from the manifest's system_assets array.\n     * This method handles system-level assets defined in the manifest.\n     * \n     * @param {Object} manifest_manager - Instance of ManifestManager\n     * @param {Function} progress_callback - Optional callback function for progress updates\n     * @returns {Promise<Array>} Array of spawned system assets\n     */\n\tasync spawn_system_assets(manifest_manager, progress_callback = null) {\n\t\tconst spawned_assets = [];\n\t\ttry {\n\t\t\t// Get all system assets from manifest\n\t\t\tconst system_assets = manifest_manager.get_system_assets();\n\t\t\tif (!system_assets || system_assets.length === 0) {\n\t\t\t\tif (BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\t\tconsole.log(\"No system assets found in manifest\");\n\t\t\t\t}\n\t\t\t\treturn spawned_assets;\n\t\t\t}\n\t\t\tif (BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\tconsole.log(`Found ${system_assets.length} system assets to spawn`);\n\t\t\t}\n\t\t\t// Process each system asset\n\t\t\tfor (const asset_data of system_assets) {\n\t\t\t\tif (progress_callback) {\n\t\t\t\t\tprogress_callback(`Loading system asset: ${asset_data.id}...`);\n\t\t\t\t}\n\t\t\t\t// Get asset type information\n\t\t\t\tconst asset_type_str = asset_data.asset_type;\n\t\t\t\t// Convert string type to enum if it's a system asset type\n\t\t\t\tlet asset_type = asset_type_str;\n\t\t\t\tif (SystemAssetType.isSystemAssetType(asset_type_str)) {\n\t\t\t\t\tasset_type = SystemAssetType.fromValue(asset_type_str);\n\t\t\t\t}\n\t\t\t\t// Extract position and rotation from asset data\n\t\t\t\tconst position = new THREE.Vector3(\n\t\t\t\t\tasset_data.position?.x || 0, \n\t\t\t\t\tasset_data.position?.y || 0, \n\t\t\t\t\tasset_data.position?.z || 0\n\t\t\t\t);\n\t\t\t\t// Create rotation from Euler angles\n\t\t\t\tconst rotation = new THREE.Euler(\n\t\t\t\t\tasset_data.rotation?.x || 0,\n\t\t\t\t\tasset_data.rotation?.y || 0,\n\t\t\t\t\tasset_data.rotation?.z || 0\n\t\t\t\t);\n\t\t\t\tconst quaternion = new THREE.Quaternion().setFromEuler(rotation);\n\t\t\t\t// Prepare options based on the asset's configuration\n\t\t\t\tconst options = {\n\t\t\t\t\t// Asset configuration\n\t\t\t\t\tcollidable: asset_data.config?.collidable !== undefined ? asset_data.config.collidable : true,\n\t\t\t\t\thidden: asset_data.config?.hidden !== undefined ? asset_data.config.hidden : false,\n\t\t\t\t\tdisabled: asset_data.config?.disabled !== undefined ? asset_data.config.disabled : false,\n\t\t\t\t\tsleeping: asset_data.config?.sleeping !== undefined ? asset_data.config.sleeping : true,\n\t\t\t\t\tgravity: asset_data.config?.gravity !== undefined ? asset_data.config.gravity : true,\n\t\t\t\t\tinteractable: asset_data.config?.interactable !== undefined ? asset_data.config.interactable : true,\n\t\t\t\t\tselectable: asset_data.config?.selectable !== undefined ? asset_data.config.selectable : true,\n\t\t\t\t\thighlightable: asset_data.config?.highlightable !== undefined ? asset_data.config.highlightable : true,\n\t\t\t\t\t// Properties from additional_properties\n\t\t\t\t\tcolor: asset_data.additional_properties?.color || \"0xffffff\",\n\t\t\t\t\tcast_shadow: asset_data.additional_properties?.cast_shadows !== undefined ? \n\t\t\t\t\t\tasset_data.additional_properties.cast_shadows : false,\n\t\t\t\t\treceive_shadow: asset_data.additional_properties?.receive_shadows !== undefined ? \n\t\t\t\t\t\tasset_data.additional_properties.receive_shadows : true,\n\t\t\t\t\t// Physics properties\n\t\t\t\t\tmass: asset_data.additional_properties?.mass !== undefined ? asset_data.additional_properties.mass : 1.0,\n\t\t\t\t\trestitution: asset_data.additional_properties?.restitution !== undefined ? \n\t\t\t\t\t\tasset_data.additional_properties.restitution : 0.5,\n\t\t\t\t\tfriction: asset_data.additional_properties?.friction !== undefined ? \n\t\t\t\t\t\tasset_data.additional_properties.friction : 0.5,\n\t\t\t\t\t// Size properties\n\t\t\t\t\tdimensions: asset_data.additional_properties?.physical_dimensions || {\n\t\t\t\t\t\twidth: 1.0,\n\t\t\t\t\t\theight: 1.0,\n\t\t\t\t\t\tdepth: 1.0\n\t\t\t\t\t},\n\t\t\t\t\t// Collider dimensions if specified\n\t\t\t\t\tcollider_dimensions: asset_data.additional_properties?.collider_dimensions,\n\t\t\t\t\t// Additional properties\n\t\t\t\t\tcustom_data: asset_data.additional_properties,\n\t\t\t\t\traycast_disabled: asset_data.additional_properties?.raycast_disabled\n\t\t\t\t};\n\t\t\t\t// Log the asset being created for debugging\n\t\t\t\tif (BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\t\tconsole.log(`Creating system asset: ${asset_data.id} (${asset_type_str})`, {\n\t\t\t\t\t\tposition,\n\t\t\t\t\t\tdimensions: options.dimensions,\n\t\t\t\t\t\tcolor: options.color\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t// Handle different system asset types\n\t\t\t\tlet result = null;\n\t\t\t\t// TODO This is wrong; If it got to this class in sp\n\t\t\t\t// Create an asset spawner instance\n\t\t\t\tconst assetSpawner = AssetSpawner.get_instance();\n\t\t\t\t// Use spawn_asset for all asset types\n\t\t\t\tresult = await assetSpawner.spawn_asset(\n\t\t\t\t\tasset_type,\n\t\t\t\t\tposition,\n\t\t\t\t\tquaternion, // For non-Euler rotation types\n\t\t\t\t\t{\n\t\t\t\t\t\t...options,\n\t\t\t\t\t\tid: asset_data.id,\n\t\t\t\t\t\tasset_data: asset_data,\n\t\t\t\t\t\trotation_euler: rotation // Store original Euler rotation if needed\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\t// If the result is null, fallback to legacy methods\n\t\t\t\tif (!result) {\n\t\t\t\t\tif (BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\t\t\tconsole.warn(`Fallback to legacy system spawners for: ${asset_data.id} (${asset_type_str})`);\n\t\t\t\t\t}\n\t\t\t\t\tif (asset_type_str === SystemAssetType.PRIMITIVE_BOX.value) {\n\t\t\t\t\t\t// Create a primitive box with the specified dimensions and properties\n\t\t\t\t\t\tresult = await create_primitive_box(\n\t\t\t\t\t\t\tthis.scene,\n\t\t\t\t\t\t\tthis.world,\n\t\t\t\t\t\t\toptions.dimensions.width, \n\t\t\t\t\t\t\toptions.dimensions.height, \n\t\t\t\t\t\t\toptions.dimensions.depth, \n\t\t\t\t\t\t\tposition, \n\t\t\t\t\t\t\tquaternion, \n\t\t\t\t\t\t\toptions\n\t\t\t\t\t\t);\n\t\t\t\t\t} \n\t\t\t\t\t// Handle spotlight asset type\n\t\t\t\t\telse if (asset_type_str === SystemAssetType.SPOTLIGHT.value) {\n\t\t\t\t\t\tresult = await create_spotlight(\n\t\t\t\t\t\t\tthis.scene,\n\t\t\t\t\t\t\tasset_data.id,\n\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\trotation,\n\t\t\t\t\t\t\toptions,\n\t\t\t\t\t\t\tasset_data\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\t// Handle primitive sphere asset type\n\t\t\t\t\telse if (asset_type_str === SystemAssetType.PRIMITIVE_SPHERE.value) {\n\t\t\t\t\t\tconst radius = options.dimensions?.radius || options.dimensions?.width / 2 || 0.5;\n\t\t\t\t\t\tresult = await create_primitive_sphere(\n\t\t\t\t\t\t\tthis.scene,\n\t\t\t\t\t\t\tthis.world,\n\t\t\t\t\t\t\tasset_data.id,\n\t\t\t\t\t\t\tradius,\n\t\t\t\t\t\t\tposition, \n\t\t\t\t\t\t\tquaternion,\n\t\t\t\t\t\t\toptions\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\t// Handle primitive capsule asset type\n\t\t\t\t\telse if (asset_type_str === SystemAssetType.PRIMITIVE_CAPSULE.value) {\n\t\t\t\t\t\tconst radius = options.dimensions?.radius || options.dimensions?.width / 2 || 0.5;\n\t\t\t\t\t\tconst height = options.dimensions?.height || 1.0;\n\t\t\t\t\t\tresult = await create_primitive_capsule(\n\t\t\t\t\t\t\tthis.scene,\n\t\t\t\t\t\t\tthis.world,\n\t\t\t\t\t\t\tasset_data.id,\n\t\t\t\t\t\t\tradius,\n\t\t\t\t\t\t\theight,\n\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\tquaternion,\n\t\t\t\t\t\t\toptions\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\t// Handle primitive cylinder asset type\n\t\t\t\t\telse if (asset_type_str === SystemAssetType.PRIMITIVE_CYLINDER.value) {\n\t\t\t\t\t\tconst radius = options.dimensions?.radius || options.dimensions?.width / 2 || 0.5;\n\t\t\t\t\t\tconst height = options.dimensions?.height || 1.0;\n\t\t\t\t\t\tresult = await create_primitive_cylinder(\n\t\t\t\t\t\t\tthis.scene,\n\t\t\t\t\t\t\tthis.world,\n\t\t\t\t\t\t\tasset_data.id,\n\t\t\t\t\t\t\tradius,\n\t\t\t\t\t\t\theight,\n\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\tquaternion,\n\t\t\t\t\t\t\toptions\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (result) {\n\t\t\t\t\t// Store the asset ID and type with the spawned asset data\n\t\t\t\t\tresult.id = asset_data.id;\n\t\t\t\t\tresult.asset_type = asset_type_str;\n\t\t\t\t\tspawned_assets.push(result);\n\t\t\t\t\tif (BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\t\t\tconsole.log(`Spawned system asset: ${asset_data.id} (${asset_type_str})`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\tconsole.log(`Spawned ${spawned_assets.length} system assets from manifest`);\n\t\t\t}\n\t\t\treturn spawned_assets;\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error spawning system assets:\", error);\n\t\t\treturn spawned_assets;\n\t\t}\n\t}\n\t/**\n     * Spawns a system asset of the specified type at the given position with the given rotation.\n     * @param {string|SystemAssetType} asset_type - The type of asset to spawn.\n     * @param {THREE.Vector3} position - The position to spawn the asset at.\n     * @param {THREE.Quaternion} rotation - The rotation of the asset.\n     * @param {Object} options - Additional options for spawning.\n     * @returns {Promise<Object>} A promise that resolves with the spawned asset details.\n     * @throws {Error} If the requested system type is not supported\n     */\n\tasync spawn_asset(asset_type, position = new THREE.Vector3(), rotation = new THREE.Quaternion(), options = {}) {\n\t\t// Handle SystemAssetType enum objects by extracting the value property\n\t\tlet type_value = typeof asset_type === 'object' && asset_type.value ? asset_type.value : asset_type;\n\t\t// Verify this is a system asset type\n\t\tif (!SystemAssetType.isSystemAssetType(type_value)) {\n\t\t\tthrow new Error(`Requested type \"${type_value}\" is not a supported system asset type`);\n\t\t}\n\t\t// Convert string type to enum if it's a system asset type\n\t\tconst asset_type_enum = SystemAssetType.fromValue(type_value);\n\t\t// Handle different system asset types\n\t\tswitch (asset_type_enum) {\n\t\tcase SystemAssetType.PRIMITIVE_BOX:\n\t\t\tconst { width = 1, height = 1, depth = 1 } = options.dimensions || {};\n\t\t\treturn create_primitive_box(\n\t\t\t\tthis.scene,\n\t\t\t\tthis.world,\n\t\t\t\twidth,\n\t\t\t\theight,\n\t\t\t\tdepth,\n\t\t\t\tposition,\n\t\t\t\trotation,\n\t\t\t\toptions\n\t\t\t);\n\t\tcase SystemAssetType.PRIMITIVE_SPHERE:\n\t\t\tconst radius = options.dimensions?.radius || options.dimensions?.width / 2 || 0.5;\n\t\t\treturn create_primitive_sphere(\n\t\t\t\tthis.scene,\n\t\t\t\tthis.world,\n\t\t\t\toptions.id || IdGenerator.get_instance().generate_asset_id(),\n\t\t\t\tradius,\n\t\t\t\tposition,\n\t\t\t\trotation,\n\t\t\t\toptions\n\t\t\t);\n\t\tcase SystemAssetType.PRIMITIVE_CAPSULE:\n\t\t\tconst capsuleRadius = options.dimensions?.radius || options.dimensions?.width / 2 || 0.5;\n\t\t\tconst capsuleHeight = options.dimensions?.height || 1.0;\n\t\t\treturn create_primitive_capsule(\n\t\t\t\tthis.scene,\n\t\t\t\tthis.world,\n\t\t\t\toptions.id || IdGenerator.get_instance().generate_asset_id(),\n\t\t\t\tcapsuleRadius,\n\t\t\t\tcapsuleHeight,\n\t\t\t\tposition,\n\t\t\t\trotation,\n\t\t\t\toptions\n\t\t\t);\n\t\tcase SystemAssetType.PRIMITIVE_CYLINDER:\n\t\t\tconst cylinderRadius = options.dimensions?.radius || options.dimensions?.width / 2 || 0.5;\n\t\t\tconst cylinderHeight = options.dimensions?.height || 1.0;\n\t\t\treturn create_primitive_cylinder(\n\t\t\t\tthis.scene,\n\t\t\t\tthis.world,\n\t\t\t\toptions.id || IdGenerator.get_instance().generate_asset_id(),\n\t\t\t\tcylinderRadius,\n\t\t\t\tcylinderHeight,\n\t\t\t\tposition,\n\t\t\t\trotation,\n\t\t\t\toptions\n\t\t\t);\n\t\tcase SystemAssetType.SPOTLIGHT:\n\t\t\treturn create_spotlight(\n\t\t\t\tthis.scene,\n\t\t\t\toptions.id || IdGenerator.get_instance().generate_asset_id(),\n\t\t\t\tposition,\n\t\t\t\trotation,\n\t\t\t\toptions,\n\t\t\t\toptions.asset_data || {}\n\t\t\t);\n\t\tdefault:\n\t\t\tthrow new Error(`System asset type \"${type_value}\" is not supported`);\n\t\t}\n\t}\n}\n","import { THREE, RAPIER } from \"../../index.js\";\nimport { AssetUtils } from \"../../index.js\";\nimport CustomTypeManager from \"../../custom_type_manager.js\";\nimport { AssetStorage } from \"../../asset_storage.js\";\nimport { BLORKPACK_FLAGS } from \"../../blorkpack_flags.js\";\nimport { IdGenerator } from \"../common/id_generator.js\";\n/**\n * Factory class responsible for spawning custom assets in the scene.\n * Handles loading and spawning of custom 3D models with physics.\n */\nexport class CustomFactory {\n\tstatic #instance = null;\n\tstatic #disposed = false;\n\tstorage;\n\tscene;\n\tworld;\n\t// Cache the types and configs from CustomTypeManager\n\t#assetTypes = null;\n\t#assetConfigs = null;\n\t/**\n     * Constructor\n     * @param {THREE.Scene} scene - The Three.js scene to add objects to\n     * @param {RAPIER.World} world - The physics world\n     */\n\tconstructor(scene = null, world = null) {\n\t\t// Singleton pattern - throw error if trying to create new instance\n\t\tif (CustomFactory.#instance) {\n\t\t\tthrow new Error('CustomFactory is a singleton. Use CustomFactory.get_instance() instead.');\n\t\t}\n\t\t// Initialize properties\n\t\tthis.storage = AssetStorage.get_instance();\n\t\tthis.scene = scene;\n\t\tthis.world = world;\n\t\t// Cache asset types and configs\n\t\tthis.#assetTypes = CustomTypeManager.getTypes();\n\t\tthis.#assetConfigs = CustomTypeManager.getConfigs();\n\t\t// Store the instance\n\t\tCustomFactory.#instance = this;\n\t\tCustomFactory.#disposed = false;\n\t}\n\t/**\n     * Gets or creates the singleton instance of CustomFactory\n     * @param {THREE.Scene} scene - The Three.js scene to add objects to\n     * @param {RAPIER.World} world - The physics world\n     * @returns {CustomFactory} The singleton instance\n     */\n\tstatic get_instance(scene, world) {\n\t\tif (CustomFactory.#disposed) {\n\t\t\tCustomFactory.#instance = null;\n\t\t\tCustomFactory.#disposed = false;\n\t\t}\n\t\tif (!CustomFactory.#instance) {\n\t\t\tCustomFactory.#instance = new CustomFactory(scene, world);\n\t\t} else if (scene || world) {\n\t\t\t// Update scene and world if provided\n\t\t\tif (scene) CustomFactory.#instance.scene = scene;\n\t\t\tif (world) CustomFactory.#instance.world = world;\n\t\t}\n\t\treturn CustomFactory.#instance;\n\t}\n\t/**\n     * Dispose of the factory instance and clean up resources\n     */\n\tdispose() {\n\t\tif (!CustomFactory.#instance) return;\n\t\t// Clear references\n\t\tthis.scene = null;\n\t\tthis.world = null;\n\t\tthis.storage = null;\n\t\tthis.#assetTypes = null;\n\t\tthis.#assetConfigs = null;\n\t\tCustomFactory.#disposed = true;\n\t\tCustomFactory.#instance = null;\n\t}\n\t/**\n\t *\n\t */\n\tstatic dispose_instance() {\n\t\tif (CustomFactory.#instance) {\n\t\t\tCustomFactory.#instance.dispose();\n\t\t}\n\t}\n\t/**\n     * Spawns a custom asset of the specified type at the given position with the given rotation\n     * @param {string} asset_type - The type of asset to spawn\n     * @param {THREE.Vector3} position - The position to spawn the asset at\n     * @param {THREE.Quaternion} rotation - The rotation of the asset\n     * @param {Object} options - Additional options for spawning\n     * @returns {Promise<Object>} A promise that resolves with the spawned asset details\n     */\n\tasync spawn_custom_asset(asset_type, position = new THREE.Vector3(), rotation = new THREE.Quaternion(), options = {}) {\n\t\ttry {\n\t\t\t// Check if custom types have been loaded\n\t\t\tif (!CustomTypeManager.hasLoadedCustomTypes()) {\n\t\t\t\tconsole.error(`Custom types not loaded yet. Please ensure CustomTypeManager.loadCustomTypes() is called before spawning assets.`);\n\t\t\t\tconsole.error(`Failed to spawn asset type: \"${asset_type}\"`);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\t// Check if the type exists\n\t\t\tif (!CustomTypeManager.hasType(asset_type)) {\n\t\t\t\tconsole.error(`Unsupported asset type: \"${asset_type}\". Cannot spawn asset.`);\n\t\t\t\tconsole.error(`Available types:`, Object.keys(CustomTypeManager.getTypes()));\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\t// Get the actual asset type key from the custom type manager\n\t\t\tconst customTypeKey = CustomTypeManager.getType(asset_type);\n\t\t\tif (BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\tconsole.log(`Spawning custom asset type: ${asset_type} (key: ${customTypeKey})`);\n\t\t\t}\n\t\t\t// Load the asset with the resolved custom type key\n\t\t\tconst gltfData = await this.storage.load_asset_type(customTypeKey);\n\t\t\tif (!gltfData) {\n\t\t\t\tconsole.error(`Failed to load custom asset type: ${customTypeKey}`);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\t// Get asset configuration from cache or CustomTypeManager\n\t\t\tlet asset_config = this.#assetConfigs[customTypeKey];\n\t\t\tif (!asset_config) {\n\t\t\t\t// Try to get it from CustomTypeManager\n\t\t\t\tasset_config = CustomTypeManager.getConfig(customTypeKey);\n\t\t\t\tif (asset_config) {\n\t\t\t\t\t// Cache it for future use\n\t\t\t\t\tthis.#assetConfigs[customTypeKey] = asset_config;\n\t\t\t\t} else {\n\t\t\t\t\tconsole.error(`No configuration found for custom asset type: ${customTypeKey}`);\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Clone the model and continue with regular asset loading flow\n\t\t\tconst originalModel = gltfData.scene;\n\t\t\tconst model = AssetUtils.cloneSkinnedMesh(originalModel);\n\t\t\t// Apply scaling based on asset_config\n\t\t\tconst scale = asset_config.scale || 1.0;\n\t\t\tmodel.scale.set(scale, scale, scale);\n\t\t\t// Apply position and rotation\n\t\t\tmodel.position.copy(position);\n\t\t\tmodel.quaternion.copy(rotation);\n\t\t\t// Add interactable_ prefix to the model name to make it grabbable\n\t\t\tconst uniqueId = Date.now().toString(36) + Math.random().toString(36).substr(2, 5);\n\t\t\tmodel.name = `interactable_${customTypeKey}_${uniqueId}`;\n\t\t\t// Hide collision meshes (objects with names starting with \"col_\")\n\t\t\t// And collect them for potential physics use\n\t\t\tconst collisionMeshes = [];\n\t\t\tconst displayMeshes = [];\n\t\t\tmodel.traverse((child) => {\n\t\t\t\tif (child.isMesh) {\n\t\t\t\t\tif (child.name.startsWith('col_')) {\n\t\t\t\t\t\t// This is a collision mesh - hide it and collect for physics\n\t\t\t\t\t\tchild.visible = false;\n\t\t\t\t\t\tcollisionMeshes.push(child);\n\t\t\t\t\t} else if (child.name.startsWith('display_')) {\n\t\t\t\t\t\t// This is a display mesh - make it visible but transparent by default\n\t\t\t\t\t\tchild.visible = true;\n\t\t\t\t\t\tif (BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\t\t\t\tconsole.log(`Setting display mesh ${child.name} to transparent by default`);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Create a transparent material as the default for display meshes\n\t\t\t\t\t\tconst displayMaterial = this.createDisplayMeshMaterial(0); // 0 = transparent\n\t\t\t\t\t\t// Apply the material to the display mesh\n\t\t\t\t\t\tchild.material = displayMaterial;\n\t\t\t\t\t\t// Explicitly set display state to transparent (0) in userData\n\t\t\t\t\t\t// This ensures the debug UI will recognize it as transparent\n\t\t\t\t\t\tif (model.userData) {\n\t\t\t\t\t\t\tmodel.userData.currentDisplayImage = 0;\n\t\t\t\t\t\t\tif (BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\t\t\t\t\tconsole.log(`Set userData.currentDisplayImage to 0 (transparent) for ${model.name}`);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\t\t\t\tconsole.log(`Applied transparent material to display mesh: ${child.name} in ${customTypeKey}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Keep track of display meshes\n\t\t\t\t\t\tdisplayMeshes.push(child);\n\t\t\t\t\t\tif (BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\t\t\t\tconsole.log(`Found display mesh: ${child.name} in ${customTypeKey}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Add interactable_ prefix to all visible meshes to make them grabbable\n\t\t\t\t\t\t// Use the same naming convention for child meshes\n\t\t\t\t\t\tconst childId = child.id || Math.floor(Math.random() * 10000);\n\t\t\t\t\t\tchild.name = `interactable_${customTypeKey}_${child.name || 'part'}_${childId}`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\t// Store reference to display meshes in model's userData if available\n\t\t\tif (displayMeshes.length > 0) {\n\t\t\t\tmodel.userData.displayMeshes = displayMeshes;\n\t\t\t\t// Add a helper function to switch between atlas images\n\t\t\t\tmodel.userData.switchDisplayImage = (imageIndex) => {\n\t\t\t\t\tif (imageIndex < 0 || imageIndex > 2) {\n\t\t\t\t\t\tconsole.error(`Invalid image index: ${imageIndex}. Must be between 0 and 2.`);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tdisplayMeshes.forEach(mesh => {\n\t\t\t\t\t\tif (mesh.material && mesh.material.map) {\n\t\t\t\t\t\t\tconst texture = mesh.material.map;\n\t\t\t\t\t\t\t// Set offset based on the selected image (0, 1, or 2)\n\t\t\t\t\t\t\ttexture.offset.x = imageIndex / 3;\n\t\t\t\t\t\t\t// Ensure the texture is updated\n\t\t\t\t\t\t\ttexture.needsUpdate = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t}\n\t\t\t// Add objects to scene in next frame to prevent stuttering\n\t\t\tawait new Promise(resolve => setTimeout(resolve, 0));\n\t\t\t// Add to scene\n\t\t\tthis.scene.add(model);\n\t\t\t// Make the model and all its children accessible for physics\n\t\t\tmodel.userData.assetType = customTypeKey;\n\t\t\tlet physicsBody = null;\n\t\t\t// Add physics if enabled\n\t\t\tif (options.enablePhysics !== false && this.world) {\n\t\t\t\t// Create a basic physics body\n\t\t\t\tconst rigidBodyDesc = RAPIER.RigidBodyDesc.dynamic()\n\t\t\t\t\t.setTranslation(position.x, position.y, position.z)\n\t\t\t\t\t.setLinearDamping(0.5)\n\t\t\t\t\t.setAngularDamping(0.6);\n\t\t\t\t// Explicitly set gravity scale to ensure gravity affects this object\n\t\t\t\trigidBodyDesc.setGravityScale(1.0);\n\t\t\t\t// Set initial rotation if provided\n\t\t\t\tif (rotation) {\n\t\t\t\t\trigidBodyDesc.setRotation(rotation);\n\t\t\t\t}\n\t\t\t\tphysicsBody = this.world.createRigidBody(rigidBodyDesc);\n\t\t\t\t// Check if we have collision meshes to use for more accurate colliders\n\t\t\t\tif (collisionMeshes.length > 0) {\n\t\t\t\t\t// Use the collision meshes for physics\n\t\t\t\t\tfor (const collisionMesh of collisionMeshes) {\n\t\t\t\t\t\tawait this.create_collider_from_mesh(collisionMesh, physicsBody, asset_config, options);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Fallback to simple cuboid collider\n\t\t\t\t\tconst halfScale = asset_config.scale / 2;\n\t\t\t\t\tlet collider_desc;\n\t\t\t\t\t// Use different collider shapes based on asset type or configuration\n\t\t\t\t\tif (options.colliderType === 'sphere') {\n\t\t\t\t\t\tcollider_desc = RAPIER.ColliderDesc.ball(halfScale);\n\t\t\t\t\t} else if (options.colliderType === 'capsule') {\n\t\t\t\t\t\tcollider_desc = RAPIER.ColliderDesc.capsule(halfScale, halfScale * 0.5);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Default to cuboid\n\t\t\t\t\t\tcollider_desc = RAPIER.ColliderDesc.cuboid(halfScale, halfScale, halfScale);\n\t\t\t\t\t}\n\t\t\t\t\t// Set physics materials\n\t\t\t\t\tcollider_desc.setRestitution(asset_config.restitution || 0.5);\n\t\t\t\t\tcollider_desc.setFriction(asset_config.friction || 0.5);\n\t\t\t\t\t// Create the collider and attach it to the rigid body\n\t\t\t\t\tthis.world.createCollider(collider_desc, physicsBody);\n\t\t\t\t\t// Create debug wireframe if debug is enabled\n\t\t\t\t\tif (BLORKPACK_FLAGS.COLLISION_VISUAL_DEBUG) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tawait this.create_debug_wireframe(\n\t\t\t\t\t\t\t\t'box',\n\t\t\t\t\t\t\t\t{ width: halfScale * 2, height: halfScale * 2, depth: halfScale * 2 },\n\t\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\t\trotation,\n\t\t\t\t\t\t\t\t{ color: 0x00ff00, opacity: 0.3, body: physicsBody }\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tconsole.warn('Failed to create debug wireframe:', error);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (BLORKPACK_FLAGS.PHYSICS_LOGS) {\n\t\t\t\t\tconsole.log(`Created physics body for ${customTypeKey} with mass: ${asset_config.mass || 1.0}, scale: ${scale}`);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Register with asset storage\n\t\t\tconst instance_id = this.storage.add_object(model, physicsBody);\n\t\t\treturn {\n\t\t\t\tmesh: model,\n\t\t\t\tbody: physicsBody,\n\t\t\t\tinstance_id\n\t\t\t};\n\t\t} catch (error) {\n\t\t\tconsole.error(`Error spawning custom asset ${asset_type}:`, error);\n\t\t\treturn null;\n\t\t}\n\t}\n\t/**\n     * Creates a collider from a mesh\n     * @param {THREE.Mesh} mesh - The mesh to create a collider from\n     * @param {RAPIER.RigidBody} body - The rigid body to attach the collider to\n     * @param {Object} asset_config - Asset configuration data\n     * @param {Object} [options={}] - Additional options for collider creation\n     * @returns {Promise<RAPIER.Collider>} The created collider\n     */\n\tasync create_collider_from_mesh(mesh, body, asset_config, options = {}) {\n\t\tif (!mesh || !body) return null;\n\t\tconst geometry = mesh.geometry;\n\t\tif (!geometry) return null;\n\t\t// Compute geometry bounds if needed\n\t\tif (!geometry.boundingBox) {\n\t\t\tgeometry.computeBoundingBox();\n\t\t}\n\t\t// Get mesh world position (relative to the model)\n\t\tconst position = new THREE.Vector3();\n\t\tconst quaternion = new THREE.Quaternion();\n\t\tconst meshScale = new THREE.Vector3();\n\t\t// Ensure matrix is updated to get accurate world position\n\t\tmesh.updateWorldMatrix(true, false);\n\t\tmesh.matrixWorld.decompose(position, quaternion, meshScale);\n\t\t// Adjust position for physics (since we're adding a collider to an existing body)\n\t\tconst bodyPos = body.translation();\n\t\tconst relativePos = {\n\t\t\tx: position.x - bodyPos.x,\n\t\t\ty: position.y - bodyPos.y,\n\t\t\tz: position.z - bodyPos.z\n\t\t};\n\t\t// Get the bounding box in local space\n\t\tconst box = geometry.boundingBox;\n\t\t// Calculate dimensions from the bounding box\n\t\tconst box_width = (box.max.x - box.min.x) * meshScale.x;\n\t\tconst box_height = (box.max.y - box.min.y) * meshScale.y;\n\t\tconst box_depth = (box.max.z - box.min.z) * meshScale.z;\n\t\t// Check the local center of the bounding box to adjust for offset meshes\n\t\tconst localCenter = new THREE.Vector3();\n\t\tbox.getCenter(localCenter);\n\t\t// If the local center is not at the origin, we need to account for that\n\t\tif (Math.abs(localCenter.x) > 0.001 || Math.abs(localCenter.y) > 0.001 || Math.abs(localCenter.z) > 0.001) {\n\t\t\t// Rotate the local center according to the mesh's world rotation\n\t\t\tconst rotatedCenter = localCenter.clone().applyQuaternion(quaternion);\n\t\t\t// Add this offset to the relative position\n\t\t\trelativePos.x += rotatedCenter.x * meshScale.x;\n\t\t\trelativePos.y += rotatedCenter.y * meshScale.y;\n\t\t\trelativePos.z += rotatedCenter.z * meshScale.z;\n\t\t\tif(BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\tconsole.log(`Adjusted position for ${mesh.name} due to non-centered geometry:`, {\n\t\t\t\t\tlocalCenter: `${localCenter.x.toFixed(2)}, ${localCenter.y.toFixed(2)}, ${localCenter.z.toFixed(2)}`,\n\t\t\t\t\trotatedCenter: `${rotatedCenter.x.toFixed(2)}, ${rotatedCenter.y.toFixed(2)}, ${rotatedCenter.z.toFixed(2)}`,\n\t\t\t\t\tnewRelativePos: `${relativePos.x.toFixed(2)}, ${relativePos.y.toFixed(2)}, ${relativePos.z.toFixed(2)}`\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tif(BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t// Log for debugging\n\t\t\tconsole.log(`Creating collider for ${mesh.name}:`, {\n\t\t\t\tworldPos: `${position.x.toFixed(2)}, ${position.y.toFixed(2)}, ${position.z.toFixed(2)}`,\n\t\t\t\tbodyPos: `${bodyPos.x.toFixed(2)}, ${bodyPos.y.toFixed(2)}, ${bodyPos.z.toFixed(2)}`,\n\t\t\t\trelativePos: `${relativePos.x.toFixed(2)}, ${relativePos.y.toFixed(2)}, ${relativePos.z.toFixed(2)}`,\n\t\t\t\tmeshScale: `${meshScale.x.toFixed(2)}, ${meshScale.y.toFixed(2)}, ${meshScale.z.toFixed(2)}`\n\t\t\t});\n\t\t}\n\t\tlet collider_desc;\n\t\t// Detect shape from name (often models use naming conventions)\n\t\tif (mesh.name.includes('sphere') || mesh.name.includes('ball')) {\n\t\t\t// Create a sphere collider\n\t\t\t// Estimate radius from geometry bounds\n\t\t\tgeometry.computeBoundingSphere();\n\t\t\tconst radius = geometry.boundingSphere.radius * meshScale.x;\n\t\t\tcollider_desc = RAPIER.ColliderDesc.ball(radius);\n\t\t} else if (mesh.name.includes('capsule')) {\n\t\t\t// Create a capsule collider\n\t\t\tconst height = (box.max.y - box.min.y) * meshScale.y;\n\t\t\tconst radius = Math.max(\n\t\t\t\t(box.max.x - box.min.x), \n\t\t\t\t(box.max.z - box.min.z)\n\t\t\t) * meshScale.x * 0.5;\n\t\t\tcollider_desc = RAPIER.ColliderDesc.capsule(height * 0.5, radius);\n\t\t} else {\n\t\t\t// Default to cuboid\n\t\t\t// Use exact dimensions from mesh's bounding box, scaled by the mesh's world scale\n\t\t\tconst collider_width = (options.collider_dimensions?.width !== undefined) ? \n\t\t\t\toptions.collider_dimensions.width : box_width / 2;\n\t\t\tconst collider_height = (options.collider_dimensions?.height !== undefined) ? \n\t\t\t\toptions.collider_dimensions.height : box_height / 2;\n\t\t\tconst collider_depth = (options.collider_dimensions?.depth !== undefined) ? \n\t\t\t\toptions.collider_dimensions.depth : box_depth / 2;\n\t\t\tcollider_desc = RAPIER.ColliderDesc.cuboid(collider_width, collider_height, collider_depth);\n\t\t}\n\t\t// Apply position offset (for standard colliders)\n\t\tcollider_desc.setTranslation(relativePos.x, relativePos.y, relativePos.z);\n\t\t// Apply rotation\n\t\tcollider_desc.setRotation(quaternion);\n\t\t// Set physical properties\n\t\tif (asset_config.mass) {\n\t\t\tcollider_desc.setMass(asset_config.mass);\n\t\t}\n\t\tif (asset_config.restitution) {\n\t\t\tcollider_desc.setRestitution(asset_config.restitution);\n\t\t}\n\t\tcollider_desc.setFriction(0.7);\n\t\t// Create the collider\n\t\tconst collider = this.world.createCollider(collider_desc, body);\n\t\t// Store reference to the collider on the mesh for debugging\n\t\tmesh.userData.physicsCollider = collider;\n\t\treturn collider;\n\t}\n\t/**\n     * Creates a material for display meshes based on the specified display mode\n     * @param {number} displayMode - 0: Transparent, 1: Black Screen, 2: White Screen\n     * @returns {THREE.Material} The created material\n     */\n\tcreateDisplayMeshMaterial(displayMode = 0) {\n\t\tlet material;\n\t\tswitch(displayMode) {\n\t\tcase 0: // Transparent\n\t\t\tmaterial = new THREE.MeshStandardMaterial({\n\t\t\t\tcolor: 0xffffff,            // White base color\n\t\t\t\ttransparent: true,           // Enable transparency\n\t\t\t\topacity: 0.0,                // Fully transparent\n\t\t\t\tside: THREE.DoubleSide\n\t\t\t});\n\t\t\tbreak;\n\t\tcase 1: // Black Screen\n\t\t\tmaterial = new THREE.MeshStandardMaterial({\n\t\t\t\tcolor: 0x000000,            // Black base color\n\t\t\t\temissive: 0x000000,         // No emission (black)\n\t\t\t\temissiveIntensity: 0,       // No emission intensity\n\t\t\t\tside: THREE.DoubleSide\n\t\t\t});\n\t\t\tbreak;\n\t\tcase 2: // White Screen\n\t\t\tmaterial = new THREE.MeshStandardMaterial({\n\t\t\t\tcolor: 0xffffff,            // White base color\n\t\t\t\temissive: 0xffffff,         // White emission\n\t\t\t\temissiveIntensity: 0.3,     // Moderate emission intensity to avoid too bright\n\t\t\t\tside: THREE.DoubleSide\n\t\t\t});\n\t\t\tbreak;\n\t\tdefault: // Default to transparent if invalid mode\n\t\t\tconsole.warn(`Invalid display mode: ${displayMode}, defaulting to transparent`);\n\t\t\tmaterial = new THREE.MeshStandardMaterial({\n\t\t\t\tcolor: 0xffffff,\n\t\t\t\ttransparent: true,\n\t\t\t\topacity: 0.0,\n\t\t\t\tside: THREE.DoubleSide\n\t\t\t});\n\t\t}\n\t\treturn material;\n\t}\n\t/**\n     * Creates a debug wireframe for visualizing physics shapes\n     * @param {string} type - The type of wireframe to create\n     * @param {Object} dimensions - The dimensions of the wireframe\n     * @param {THREE.Vector3} position - The position of the wireframe\n     * @param {THREE.Quaternion} rotation - The rotation of the wireframe\n     * @param {Object} options - Additional options for the wireframe\n     * @returns {Promise<THREE.Mesh>} The created wireframe mesh\n     */\n\tasync create_debug_wireframe(type, dimensions, position, rotation, options = {}) {\n\t\tlet geometry;\n\t\t// If we have a mesh geometry provided, use it directly for maximum accuracy\n\t\tif (type === 'mesh' && options.geometry) {\n\t\t\tgeometry = options.geometry;\n\t\t} else {\n\t\t\t// Otherwise create a primitive shape based on dimensions\n\t\t\tconst size = dimensions || { x: 1, y: 1, z: 1 };\n\t\t\tswitch (type) {\n\t\t\tcase 'cuboid':\n\t\t\t\tgeometry = new THREE.BoxGeometry(size.x * 2, size.y * 2, size.z * 2);\n\t\t\t\tbreak;\n\t\t\tcase 'sphere':\n\t\t\t\tgeometry = new THREE.SphereGeometry(size.radius || 1, 16, 16);\n\t\t\t\tbreak;\n\t\t\tcase 'capsule':\n\t\t\t\t// Approximate capsule with cylinder\n\t\t\t\tgeometry = new THREE.CylinderGeometry(size.radius, size.radius, size.height, 16);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tgeometry = new THREE.BoxGeometry(1, 1, 1);\n\t\t\t}\n\t\t}\n\t\t// Define the colors we'll use\n\t\tconst staticColor = 0x00FF00; // Green for static objects\n\t\t// Set of blue colors for dynamic objects\n\t\tconst blueColors = [\n\t\t\t0x0000FF, // Pure blue\n\t\t\t0x4444FF, // Light blue\n\t\t\t0x0088FF, // Sky blue\n\t\t\t0x00AAFF, // Azure\n\t\t\t0x00FFFF, // Cyan\n\t\t\t0x0066CC, // Medium blue\n\t\t\t0x0033AA, // Dark blue\n\t\t\t0x3366FF, // Royal blue\n\t\t\t0x6666FF, // Periwinkle\n\t\t\t0x0099CC  // Ocean blue\n\t\t];\n\t\t// Choose a color based on position hash to ensure consistent but varied colors\n\t\tlet color;\n\t\tif (options.isStatic === true) {\n\t\t\t// Static objects (like rooms) are green\n\t\t\tcolor = staticColor;\n\t\t} else {\n\t\t\t// Generate a simple hash based on the object's position\n\t\t\t// This ensures the same object gets the same color, but different objects get different colors\n\t\t\tlet hash = 0;\n\t\t\t// Use position for a simple hash\n\t\t\tconst posX = Math.round(position.x * 10);\n\t\t\tconst posY = Math.round(position.y * 10);\n\t\t\tconst posZ = Math.round(position.z * 10);\n\t\t\thash = Math.abs(posX + posY * 31 + posZ * 47) % blueColors.length;\n\t\t\t// Select a blue color using the hash\n\t\t\tcolor = blueColors[hash];\n\t\t}\n\t\tconst material = new THREE.MeshBasicMaterial({ \n\t\t\tcolor: color,\n\t\t\twireframe: true,\n\t\t\ttransparent: true,\n\t\t\topacity: 0.7\n\t\t});\n\t\tconst mesh = new THREE.Mesh(geometry, material);\n\t\tmesh.position.copy(position);\n\t\tmesh.quaternion.copy(rotation);\n\t\t// Apply scale for mesh-type wireframes\n\t\tif (options.scale && type === 'mesh') {\n\t\t\tmesh.scale.copy(options.scale);\n\t\t}\n\t\tmesh.renderOrder = 999; // Ensure wireframes render on top\n\t\t// Store any references needed to update this wireframe\n\t\tmesh.userData.physicsBodyId = options.bodyId;\n\t\tmesh.userData.debugType = type;\n\t\tmesh.userData.originalObject = options.originalObject;\n\t\tmesh.userData.isStatic = options.isStatic;\n\t\t// Add objects to scene in next frame to prevent stuttering\n\t\tawait new Promise(resolve => setTimeout(resolve, 0));\n\t\t// Only add to scene and store if debug is enabled\n\t\tif (BLORKPACK_FLAGS.COLLISION_VISUAL_DEBUG) {\n\t\t\tthis.scene.add(mesh);\n\t\t\tthis.debugMeshes.set(mesh.uuid, mesh);\n\t\t}\n\t\treturn mesh;\n\t}\n\t/**\n     * Spawns all custom assets from the manifest\n     * @param {Object} manifest_manager - Instance of ManifestManager\n     * @param {Function} progress_callback - Optional callback function for progress updates\n     * @returns {Promise<Array>} Array of spawned custom assets\n     */\n\tasync spawn_custom_assets(manifest_manager, progress_callback = null) {\n\t\tconst spawned_assets = [];\n\t\ttry {\n\t\t\t// Get all custom assets from manifest\n\t\t\tconst custom_assets = manifest_manager.get_custom_assets();\n\t\t\tif (!custom_assets || custom_assets.length === 0) {\n\t\t\t\tif (BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\t\tconsole.log(\"No custom assets found in manifest\");\n\t\t\t\t}\n\t\t\t\treturn spawned_assets;\n\t\t\t}\n\t\t\tif (BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\tconsole.log(`Found ${custom_assets.length} custom assets to spawn`);\n\t\t\t}\n\t\t\t// Process each custom asset\n\t\t\tfor (const asset_data of custom_assets) {\n\t\t\t\t// Extract position and rotation from asset data\n\t\t\t\tconst position = new THREE.Vector3(\n\t\t\t\t\tasset_data.position?.x || 0, \n\t\t\t\t\tasset_data.position?.y || 0, \n\t\t\t\t\tasset_data.position?.z || 0\n\t\t\t\t);\n\t\t\t\t// Create rotation from Euler angles\n\t\t\t\tconst rotation = new THREE.Euler(\n\t\t\t\t\tasset_data.rotation?.x || 0,\n\t\t\t\t\tasset_data.rotation?.y || 0,\n\t\t\t\t\tasset_data.rotation?.z || 0\n\t\t\t\t);\n\t\t\t\tconst quaternion = new THREE.Quaternion().setFromEuler(rotation);\n\t\t\t\t// Prepare options from asset data\n\t\t\t\tconst options = {\n\t\t\t\t\tscale: asset_data.scale,\n\t\t\t\t\tmaterial: asset_data.material,\n\t\t\t\t\tcollider: asset_data.collider,\n\t\t\t\t\tmass: asset_data.mass,\n\t\t\t\t\t...asset_data.options\n\t\t\t\t};\n\t\t\t\t// Spawn the custom asset\n\t\t\t\tconst result = await this.spawn_custom_asset(\n\t\t\t\t\tasset_data.asset_type,\n\t\t\t\t\tposition,\n\t\t\t\t\tquaternion,\n\t\t\t\t\toptions\n\t\t\t\t);\n\t\t\t\tif (result) {\n\t\t\t\t\t// Store the asset ID with the spawned asset data\n\t\t\t\t\tresult.id = asset_data.id;\n\t\t\t\t\tspawned_assets.push(result);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\tconsole.log(`Spawned ${spawned_assets.length} custom assets from manifest`);\n\t\t\t}\n\t\t\treturn spawned_assets;\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error spawning custom assets:\", error);\n\t\t\treturn spawned_assets;\n\t\t}\n\t}\n}\n","import { THREE, RAPIER } from \"../index.js\";\nimport CustomTypeManager from \"../custom_type_manager.js\";\nimport { AssetStorage } from \"../asset_storage.js\";\nimport { BLORKPACK_FLAGS } from \"../blorkpack_flags.js\";\nimport { SystemAssetType } from \"./common/system_asset_types.js\";\nimport { SystemFactory } from \"./asset_factories/system_factory.js\";\nimport { CustomFactory } from \"./asset_factories/custom_factory.js\";\nimport { IdGenerator } from \"./common/id_generator.js\";\n/**\n * Class responsible for spawning and managing 3D assets in the scene.\n * Handles both static and dynamic (physics-enabled) assets.\n */\nexport class AssetSpawner {\n\tstatic #instance = null;\n\tstatic #disposed = false;\n\tstorage;\n\tcontainer;\n\tworld;\n\tscene;\n\t// Cache the types and configs from CustomTypeManager\n\t#assetTypes = null;\n\t#assetConfigs = null;\n\t/**\n     * Constructor\n     * @param {Object} target_container - The container to spawn assets into\n     * @param {Object} target_world - The physics world\n     */\n\tconstructor(target_container = null, target_world = null) {\n\t\tif (AssetSpawner.#instance) {\n\t\t\tthrow new Error('AssetSpawner is a singleton. Use AssetSpawner.get_instance() instead.');\n\t\t}\n\t\tthis.storage = AssetStorage.get_instance();\n\t\tthis.container = target_container;\n\t\tthis.world = target_world;\n\t\t// Cache asset types and configs\n\t\tthis.#assetTypes = CustomTypeManager.getTypes();\n\t\tthis.#assetConfigs = CustomTypeManager.getConfigs();\n\t\tAssetSpawner.#instance = this;\n\t\tAssetSpawner.#disposed = false;\n\t}\n\t/**\n     * Gets or creates the singleton instance of AssetSpawner.\n     * @param {THREE.Scene} scene - The Three.js scene to add objects to.\n     * @param {RAPIER.World} world - The Rapier physics world.\n     * @returns {AssetSpawner} The singleton instance.\n     */\n\tstatic get_instance(scene, world) {\n\t\tif (AssetSpawner.#disposed) {\n\t\t\tAssetSpawner.#instance = null;\n\t\t\tAssetSpawner.#disposed = false;\n\t\t}\n\t\tif (!AssetSpawner.#instance) {\n\t\t\tAssetSpawner.#instance = new AssetSpawner(scene, world);\n\t\t} else if (scene || world) {\n\t\t\tif (scene) AssetSpawner.#instance.scene = scene;\n\t\t\tif (world) AssetSpawner.#instance.world = world;\n\t\t}\n\t\treturn AssetSpawner.#instance;\n\t}\n\t/**\n     * Spawns an asset of the specified type at the given position with the given rotation.\n     * @param {string} asset_type - The type of asset to spawn.\n     * @param {THREE.Vector3} position - The position to spawn the asset at.\n     * @param {THREE.Quaternion} rotation - The rotation of the asset.\n     * @param {Object} options - Additional options for spawning.\n     * @returns {Promise<Object>} A promise that resolves with the spawned asset details.\n     */\n\tasync spawn_asset(asset_type, position = new THREE.Vector3(), rotation = new THREE.Quaternion(), options = {}) {\n\t\t// Handle SystemAssetType enum objects by extracting the value property\n\t\tlet type_value = typeof asset_type === 'object' && asset_type.value ? asset_type.value : asset_type;\n\t\ttry {\n\t\t\t// Check if this is a system asset type\n\t\t\tif (SystemAssetType.isSystemAssetType(type_value)) {\n\t\t\t\t// Handle camera and spotlight in AssetSpawner for now\n\t\t\t\tif (type_value === SystemAssetType.CAMERA.value) {\n\t\t\t\t\treturn this.spawn_scene_camera(options);\n\t\t\t\t}\n\t\t\t\tif (type_value === SystemAssetType.SPOTLIGHT.value) {\n\t\t\t\t\t// Delegate spotlight creation to SystemFactory\n\t\t\t\t\tconst system_factory = SystemFactory.get_instance(this.scene, this.world);\n\t\t\t\t\treturn await system_factory.spawn_asset(asset_type, position, rotation, options);\n\t\t\t\t}\n\t\t\t\t// Delegate other system asset types to SystemFactory\n\t\t\t\tconst system_factory = SystemFactory.get_instance(this.scene, this.world);\n\t\t\t\treturn await system_factory.spawn_asset(asset_type, position, rotation, options);\n\t\t\t}\n\t\t\t// Check if the asset type exists in custom types\n\t\t\tif (CustomTypeManager.hasLoadedCustomTypes()) {\n\t\t\t\t// Check if the type exists directly\n\t\t\t\tif (CustomTypeManager.hasType(type_value)) {\n\t\t\t\t\t// Get CustomFactory instance\n\t\t\t\t\tconst custom_factory = CustomFactory.get_instance(this.scene, this.world);\n\t\t\t\t\t// Spawn the custom asset using CustomFactory\n\t\t\t\t\treturn await custom_factory.spawn_custom_asset(type_value, position, rotation, options);\n\t\t\t\t} else {\n\t\t\t\t\t// Not a system asset type or custom asset type - log error and return\n\t\t\t\t\t// Check if custom types have been loaded at all\n\t\t\t\t\tif (!CustomTypeManager.hasLoadedCustomTypes()) {\n\t\t\t\t\t\tconsole.error(`Custom types not loaded yet. Please ensure CustomTypeManager.loadCustomTypes() is called before spawning assets.`);\n\t\t\t\t\t\tconsole.error(`Failed to spawn asset type: \"${type_value}\"`);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.error(`Unsupported asset type: \"${type_value}\". Cannot spawn asset.`);\n\t\t\t\t\t\tconsole.error(`Available types:`, Object.keys(CustomTypeManager.getTypes()));\n\t\t\t\t\t}\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (error) {\n\t\t\t// Handle the case where type_value might not be defined yet\n\t\t\tif (typeof type_value !== 'undefined') {\n\t\t\t\tconsole.error(`Error spawning asset ${type_value}:`, error);\n\t\t\t} else {\n\t\t\t\tconsole.error(`Error spawning asset (type unknown):`, error);\n\t\t\t\tconsole.error(`Original asset_type:`, asset_type);\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t}\n\t/**\n     * @deprecated\n     * Creates a debug wireframe for visualizing physics shapes.\n     * @param {string} type - The type of wireframe to create.\n     * @param {Object} dimensions - The dimensions of the wireframe.\n     * @param {THREE.Vector3} position - The position of the wireframe.\n     * @param {THREE.Quaternion} rotation - The rotation of the wireframe.\n     * @param {Object} options - Additional options for the wireframe.\n     * @returns {Promise<THREE.Mesh>} The created wireframe mesh.\n     */\n\tasync create_debug_wireframe(type, dimensions, position, rotation, options = {}) {\n\t\tlet geometry;\n\t\t// If we have a mesh geometry provided, use it directly for maximum accuracy\n\t\tif (type === 'mesh' && options.geometry) {\n\t\t\tgeometry = options.geometry;\n\t\t} else {\n\t\t\t// Otherwise create a primitive shape based on dimensions\n\t\t\tconst size = dimensions || { x: 1, y: 1, z: 1 };\n\t\t\tswitch (type) {\n\t\t\tcase 'cuboid':\n\t\t\t\tgeometry = new THREE.BoxGeometry(size.x * 2, size.y * 2, size.z * 2);\n\t\t\t\tbreak;\n\t\t\tcase 'sphere':\n\t\t\t\tgeometry = new THREE.SphereGeometry(size.radius || 1, 16, 16);\n\t\t\t\tbreak;\n\t\t\tcase 'capsule':\n\t\t\t\t// Approximate capsule with cylinder\n\t\t\t\tgeometry = new THREE.CylinderGeometry(size.radius, size.radius, size.height, 16);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tgeometry = new THREE.BoxGeometry(1, 1, 1);\n\t\t\t}\n\t\t}\n\t\t// Define the colors we'll use\n\t\tconst staticColor = 0x00FF00; // Green for static objects\n\t\t// Set of blue colors for dynamic objects\n\t\tconst blueColors = [\n\t\t\t0x0000FF, // Pure blue\n\t\t\t0x4444FF, // Light blue\n\t\t\t0x0088FF, // Sky blue\n\t\t\t0x00AAFF, // Azure\n\t\t\t0x00FFFF, // Cyan\n\t\t\t0x0066CC, // Medium blue\n\t\t\t0x0033AA, // Dark blue\n\t\t\t0x3366FF, // Royal blue\n\t\t\t0x6666FF, // Periwinkle\n\t\t\t0x0099CC  // Ocean blue\n\t\t];\n\t\t// Choose a color based on position hash to ensure consistent but varied colors\n\t\tlet color;\n\t\tif (options.isStatic === true) {\n\t\t\t// Static objects (like rooms) are green\n\t\t\tcolor = staticColor;\n\t\t} else {\n\t\t\t// Generate a simple hash based on the object's position\n\t\t\t// This ensures the same object gets the same color, but different objects get different colors\n\t\t\tlet hash = 0;\n\t\t\t// Use position for a simple hash\n\t\t\tconst posX = Math.round(position.x * 10);\n\t\t\tconst posY = Math.round(position.y * 10);\n\t\t\tconst posZ = Math.round(position.z * 10);\n\t\t\thash = Math.abs(posX + posY * 31 + posZ * 47) % blueColors.length;\n\t\t\t// Select a blue color using the hash\n\t\t\tcolor = blueColors[hash];\n\t\t}\n\t\tconst material = new THREE.MeshBasicMaterial({ \n\t\t\tcolor: color,\n\t\t\twireframe: true,\n\t\t\ttransparent: true,\n\t\t\topacity: 0.7\n\t\t});\n\t\tconst mesh = new THREE.Mesh(geometry, material);\n\t\tmesh.position.copy(position);\n\t\tmesh.quaternion.copy(rotation);\n\t\t// Apply scale for mesh-type wireframes\n\t\tif (options.scale && type === 'mesh') {\n\t\t\tmesh.scale.copy(options.scale);\n\t\t}\n\t\tmesh.renderOrder = 999; // Ensure wireframes render on top\n\t\t// Store any references needed to update this wireframe\n\t\tmesh.userData.physicsBodyId = options.bodyId;\n\t\tmesh.userData.debugType = type;\n\t\tmesh.userData.originalObject = options.originalObject;\n\t\tmesh.userData.isStatic = options.isStatic;\n\t\t// Add objects to scene in next frame to prevent stuttering\n\t\tawait new Promise(resolve => setTimeout(resolve, 0));\n\t\t// Only add to scene and store if debug is enabled\n\t\tif (BLORKPACK_FLAGS.COLLISION_VISUAL_DEBUG) {\n\t\t\tthis.scene.add(mesh);\n\t\t\tthis.debugMeshes.set(mesh.uuid, mesh);\n\t\t}\n\t\treturn mesh;\n\t}\n\t/**\n     * @deprecated\n     * Updates the positions of debug wireframes based on physics bodies.\n     */\n\tupdate_debug_wireframes() {\n\t\tif (!BLORKPACK_FLAGS.COLLISION_VISUAL_DEBUG) return;\n\t\t// Get all dynamic bodies from storage\n\t\tconst dynamicBodies = this.storage.get_all_dynamic_bodies();\n\t\t// Update existing wireframes\n\t\tthis.debugMeshes.forEach((mesh) => {\n\t\t\t// Find the matching body for this wireframe\n\t\t\tlet foundBody = null;\n\t\t\t// Try to find by physicsBodyId if available\n\t\t\tif (mesh.userData.physicsBodyId) {\n\t\t\t\t// Find the body with this ID\n\t\t\t\tfor (const [bodyMesh, body] of dynamicBodies) {\n\t\t\t\t\tif (body.handle === mesh.userData.physicsBodyId) {\n\t\t\t\t\t\tfoundBody = body;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// If not found by ID, try to find by mesh\n\t\t\tif (!foundBody) {\n\t\t\t\tconst bodyPair = this.storage.get_body_pair_by_mesh(mesh);\n\t\t\t\tif (bodyPair) {\n\t\t\t\t\tfoundBody = bodyPair[1];\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Update position and rotation if body found\n\t\t\tif (foundBody) {\n\t\t\t\tconst position = foundBody.translation();\n\t\t\t\tmesh.position.set(position.x, position.y, position.z);\n\t\t\t\tconst rotation = foundBody.rotation();\n\t\t\t\tmesh.quaternion.set(rotation.x, rotation.y, rotation.z, rotation.w);\n\t\t\t}\n\t\t});\n\t}\n\t/**\n     * Core cleanup of essential resources.\n     */\n\tcleanup() {\n\t\t// Reset singleton instance\n\t\tAssetSpawner.#instance = null;\n\t\t// Clean up any core asset management resources\n\t\tif (this.storage) {\n\t\t\t// Clean up any remaining assets in storage\n\t\t\tconst allAssets = this.storage.get_all_assets();\n\t\t\tallAssets.forEach(asset => {\n\t\t\t\tif (asset && asset.mesh && asset.mesh.parent) {\n\t\t\t\t\tasset.mesh.parent.remove(asset.mesh);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t// Clean up any core physics resources\n\t\tif (this.world) {\n\t\t\t// Clean up any remaining physics bodies\n\t\t\tconst dynamicBodies = this.storage.get_all_dynamic_bodies();\n\t\t\tdynamicBodies.forEach(([mesh, body]) => {\n\t\t\t\tif (body) {\n\t\t\t\t\tthis.world.removeRigidBody(body);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t// Clear references\n\t\tthis.storage = null;\n\t\tthis.container = null;\n\t\tthis.world = null;\n\t\tthis.#assetTypes = null;\n\t\tthis.#assetConfigs = null;\n\t}\n\t/**\n     * @deprecated\n     * Cleanup of debug-specific resources.\n     * This will be removed in future refactoring.\n     */\n\tcleanup_debug() {\n\t\t// Remove debug wireframes\n\t\tif (this.debugMeshes) {\n\t\t\tthis.debugMeshes.forEach((mesh) => {\n\t\t\t\tif (mesh.parent) {\n\t\t\t\t\tmesh.parent.remove(mesh);\n\t\t\t\t}\n\t\t\t\tif (mesh.geometry) {\n\t\t\t\t\tmesh.geometry.dispose();\n\t\t\t\t}\n\t\t\t\tif (mesh.material) {\n\t\t\t\t\tmesh.material.dispose();\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.debugMeshes.clear();\n\t\t}\n\t\t// Clean up spotlight debug visualizations\n\t\tconst allAssets = this.storage.get_all_assets();\n\t\tallAssets.forEach(asset => {\n\t\t\tif (asset && asset.type === SystemAssetType.SPOTLIGHT.value) {\n\t\t\t\t// Remove spotlight and its target from the scene\n\t\t\t\tif (asset.objects) {\n\t\t\t\t\tasset.objects.forEach(obj => {\n\t\t\t\t\t\tif (obj && obj.parent) {\n\t\t\t\t\t\t\tobj.parent.remove(obj);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t// Remove the main spotlight mesh\n\t\t\t\tif (asset.mesh && asset.mesh.parent) {\n\t\t\t\t\tasset.mesh.parent.remove(asset.mesh);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\t/**\n     * Updates all visual elements including debug wireframes and spotlight helpers.\n     * This is the new method to use instead of the deprecated performCleanup().\n     */\n\tupdate_visualizations() {\n\t\t// Update debug wireframes if enabled\n\t\tif (BLORKPACK_FLAGS.COLLISION_VISUAL_DEBUG) {\n\t\t\tthis.update_debug_wireframes();\n\t\t}\n\t\t// Update spotlight helpers\n\t\tthis.update_helpers();\n\t}\n\t/**\n     * @deprecated\n     * Creates a material for display meshes based on the specified display mode\n     * @param {number} displayMode - 0: Transparent, 1: Black Screen, 2: White Screen\n     * @returns {THREE.Material} The created material\n     */\n\tstatic createDisplayMeshMaterial(displayMode = 0) {\n\t\tlet material;\n\t\tswitch(displayMode) {\n\t\tcase 0: // Transparent\n\t\t\tmaterial = new THREE.MeshStandardMaterial({\n\t\t\t\tcolor: 0xffffff,            // White base color\n\t\t\t\ttransparent: true,           // Enable transparency\n\t\t\t\topacity: 0.0,                // Fully transparent\n\t\t\t\tside: THREE.DoubleSide\n\t\t\t});\n\t\t\tbreak;\n\t\tcase 1: // Black Screen\n\t\t\tmaterial = new THREE.MeshStandardMaterial({\n\t\t\t\tcolor: 0x000000,            // Black base color\n\t\t\t\temissive: 0x000000,         // No emission (black)\n\t\t\t\temissiveIntensity: 0,       // No emission intensity\n\t\t\t\tside: THREE.DoubleSide\n\t\t\t});\n\t\t\tbreak;\n\t\tcase 2: // White Screen\n\t\t\tmaterial = new THREE.MeshStandardMaterial({\n\t\t\t\tcolor: 0xffffff,            // White base color\n\t\t\t\temissive: 0xffffff,         // White emission\n\t\t\t\temissiveIntensity: 0.3,     // Moderate emission intensity to avoid too bright\n\t\t\t\tside: THREE.DoubleSide\n\t\t\t});\n\t\t\tbreak;\n\t\tdefault: // Default to transparent if invalid mode\n\t\t\tconsole.warn(`Invalid display mode: ${displayMode}, defaulting to transparent`);\n\t\t\tmaterial = new THREE.MeshStandardMaterial({\n\t\t\t\tcolor: 0xffffff,\n\t\t\t\ttransparent: true,\n\t\t\t\topacity: 0.0,\n\t\t\t\tside: THREE.DoubleSide\n\t\t\t});\n\t\t}\n\t\treturn material;\n\t}\n\t/**\n     * @deprecated\n     * Creates a collider from a mesh\n     * @param {THREE.Mesh} mesh - The mesh to create a collider from\n     * @param {RAPIER.RigidBody} body - The rigid body to attach the collider to\n     * @param {Object} asset_config - Asset configuration data\n     * @param {Object} [options={}] - Additional options for collider creation\n     * @returns {Promise<RAPIER.Collider>} The created collider\n     */\n\tasync create_collider_from_mesh(mesh, body, asset_config, options = {}) {\n\t\tif (!mesh || !body) return null;\n\t\tconst geometry = mesh.geometry;\n\t\tif (!geometry) return null;\n\t\t// Compute geometry bounds if needed\n\t\tif (!geometry.boundingBox) {\n\t\t\tgeometry.computeBoundingBox();\n\t\t}\n\t\t// Get mesh world position (relative to the model)\n\t\tconst position = new THREE.Vector3();\n\t\tconst quaternion = new THREE.Quaternion();\n\t\tconst meshScale = new THREE.Vector3();\n\t\t// Ensure matrix is updated to get accurate world position\n\t\tmesh.updateWorldMatrix(true, false);\n\t\tmesh.matrixWorld.decompose(position, quaternion, meshScale);\n\t\t// Adjust position for physics (since we're adding a collider to an existing body)\n\t\tconst bodyPos = body.translation();\n\t\tconst relativePos = {\n\t\t\tx: position.x - bodyPos.x,\n\t\t\ty: position.y - bodyPos.y,\n\t\t\tz: position.z - bodyPos.z\n\t\t};\n\t\t// Get the bounding box in local space\n\t\tconst box = geometry.boundingBox;\n\t\t// Calculate dimensions from the bounding box\n\t\tconst box_width = (box.max.x - box.min.x) * meshScale.x;\n\t\tconst box_height = (box.max.y - box.min.y) * meshScale.y;\n\t\tconst box_depth = (box.max.z - box.min.z) * meshScale.z;\n\t\t// Check the local center of the bounding box to adjust for offset meshes\n\t\tconst localCenter = new THREE.Vector3();\n\t\tbox.getCenter(localCenter);\n\t\t// If the local center is not at the origin, we need to account for that\n\t\tif (Math.abs(localCenter.x) > 0.001 || Math.abs(localCenter.y) > 0.001 || Math.abs(localCenter.z) > 0.001) {\n\t\t\t// Rotate the local center according to the mesh's world rotation\n\t\t\tconst rotatedCenter = localCenter.clone().applyQuaternion(quaternion);\n\t\t\t// Add this offset to the relative position\n\t\t\trelativePos.x += rotatedCenter.x * meshScale.x;\n\t\t\trelativePos.y += rotatedCenter.y * meshScale.y;\n\t\t\trelativePos.z += rotatedCenter.z * meshScale.z;\n\t\t\tif(BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\tconsole.log(`Adjusted position for ${mesh.name} due to non-centered geometry:`, {\n\t\t\t\t\tlocalCenter: `${localCenter.x.toFixed(2)}, ${localCenter.y.toFixed(2)}, ${localCenter.z.toFixed(2)}`,\n\t\t\t\t\trotatedCenter: `${rotatedCenter.x.toFixed(2)}, ${rotatedCenter.y.toFixed(2)}, ${rotatedCenter.z.toFixed(2)}`,\n\t\t\t\t\tnewRelativePos: `${relativePos.x.toFixed(2)}, ${relativePos.y.toFixed(2)}, ${relativePos.z.toFixed(2)}`\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tif(BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t// Log for debugging\n\t\t\tconsole.log(`Creating collider for ${mesh.name}:`, {\n\t\t\t\tworldPos: `${position.x.toFixed(2)}, ${position.y.toFixed(2)}, ${position.z.toFixed(2)}`,\n\t\t\t\tbodyPos: `${bodyPos.x.toFixed(2)}, ${bodyPos.y.toFixed(2)}, ${bodyPos.z.toFixed(2)}`,\n\t\t\t\trelativePos: `${relativePos.x.toFixed(2)}, ${relativePos.y.toFixed(2)}, ${relativePos.z.toFixed(2)}`,\n\t\t\t\tmeshScale: `${meshScale.x.toFixed(2)}, ${meshScale.y.toFixed(2)}, ${meshScale.z.toFixed(2)}`\n\t\t\t});\n\t\t}\n\t\tlet collider_desc;\n\t\t// Detect shape from name (often models use naming conventions)\n\t\tif (mesh.name.includes('sphere') || mesh.name.includes('ball')) {\n\t\t\t// Create a sphere collider\n\t\t\t// Estimate radius from geometry bounds\n\t\t\tgeometry.computeBoundingSphere();\n\t\t\tconst radius = geometry.boundingSphere.radius * meshScale.x;\n\t\t\tcollider_desc = RAPIER.ColliderDesc.ball(radius);\n\t\t} else if (mesh.name.includes('capsule')) {\n\t\t\t// Create a capsule collider\n\t\t\tconst height = (box.max.y - box.min.y) * meshScale.y;\n\t\t\tconst radius = Math.max(\n\t\t\t\t(box.max.x - box.min.x), \n\t\t\t\t(box.max.z - box.min.z)\n\t\t\t) * meshScale.x * 0.5;\n\t\t\tcollider_desc = RAPIER.ColliderDesc.capsule(height * 0.5, radius);\n\t\t} else {\n\t\t\t// Default to cuboid\n\t\t\t// Use exact dimensions from mesh's bounding box, scaled by the mesh's world scale\n\t\t\tconst collider_width = (options.collider_dimensions?.width !== undefined) ? \n\t\t\t\toptions.collider_dimensions.width : box_width / 2;\n\t\t\tconst collider_height = (options.collider_dimensions?.height !== undefined) ? \n\t\t\t\toptions.collider_dimensions.height : box_height / 2;\n\t\t\tconst collider_depth = (options.collider_dimensions?.depth !== undefined) ? \n\t\t\t\toptions.collider_dimensions.depth : box_depth / 2;\n\t\t\tcollider_desc = RAPIER.ColliderDesc.cuboid(collider_width, collider_height, collider_depth);\n\t\t}\n\t\t// Apply position offset (for standard colliders)\n\t\tcollider_desc.setTranslation(relativePos.x, relativePos.y, relativePos.z);\n\t\t// Apply rotation\n\t\tcollider_desc.setRotation(quaternion);\n\t\t// Set physical properties\n\t\tif (asset_config.mass) {\n\t\t\tcollider_desc.setMass(asset_config.mass);\n\t\t}\n\t\tif (asset_config.restitution) {\n\t\t\tcollider_desc.setRestitution(asset_config.restitution);\n\t\t}\n\t\tcollider_desc.setFriction(0.7);\n\t\t// Create the collider\n\t\tconst collider = this.world.createCollider(collider_desc, body);\n\t\t// Store reference to the collider on the mesh for debugging\n\t\tmesh.userData.physicsCollider = collider;\n\t\treturn collider;\n\t}\n\t/**\n     * @deprecated\n     * Sets the collision debug state for this spawner.\n     * This allows the main application to control debug visualization.\n     * @param {boolean} enabled - Whether collision debug should be enabled\n     */\n\tasync set_collision_debug(enabled) {\n\t\t// Note: We're using the internal BLORKPACK_FLAGS but also accepting external control\n\t\tBLORKPACK_FLAGS.COLLISION_VISUAL_DEBUG = enabled;\n\t\t// Clear all existing wireframes if disabling\n\t\tif (!enabled) {\n\t\t\tthis.debugMeshes.forEach((mesh) => {\n\t\t\t\tif (mesh.parent) {\n\t\t\t\t\tmesh.parent.remove(mesh);\n\t\t\t\t}\n\t\t\t\tif (mesh.geometry) {\n\t\t\t\t\tmesh.geometry.dispose();\n\t\t\t\t}\n\t\t\t\tif (mesh.material) {\n\t\t\t\t\tmesh.material.dispose();\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.debugMeshes.clear();\n\t\t\treturn;\n\t\t}\n\t\t// If enabling, create wireframes for all bodies\n\t\tawait this.create_debug_wireframes_for_all_bodies();\n\t}\n\t/**\n     * @deprecated\n     * Creates debug wireframes for all physics bodies.\n     * This is used when enabling debug visualization after objects are already created.\n     */\n\tasync create_debug_wireframes_for_all_bodies() {\n\t\t// First clear any existing wireframes\n\t\tthis.debugMeshes.forEach((mesh) => {\n\t\t\tif (mesh.parent) {\n\t\t\t\tmesh.parent.remove(mesh);\n\t\t\t}\n\t\t\tif (mesh.geometry) {\n\t\t\t\tmesh.geometry.dispose();\n\t\t\t}\n\t\t\tif (mesh.material) {\n\t\t\t\tmesh.material.dispose();\n\t\t\t}\n\t\t});\n\t\tthis.debugMeshes.clear();\n\t\tif(BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\tconsole.log(\"Creating all debug wireframes\");\n\t\t}\n\t\t// Get all dynamic bodies from storage\n\t\tconst dynamicBodies = this.storage.get_all_dynamic_bodies();\n\t\t// Create a debug wireframe for each body\n\t\tfor (const [mesh, body] of dynamicBodies) {\n\t\t\tif (!body) continue;\n\t\t\t// Get the body position and rotation\n\t\t\tconst position = body.translation();\n\t\t\tconst rotation = body.rotation();\n\t\t\t// Try to find collision meshes in the object hierarchy\n\t\t\tconst collisionMeshes = [];\n\t\t\tmesh.traverse((child) => {\n\t\t\t\tif (child.isMesh && child.name.startsWith('col_')) {\n\t\t\t\t\tcollisionMeshes.push(child);\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (collisionMeshes.length > 0) {\n\t\t\t\t// Create wireframes for each collision mesh\n\t\t\t\tfor (const colMesh of collisionMeshes) {\n\t\t\t\t\t// Get the world transform of the collision mesh\n\t\t\t\t\tconst worldPosition = new THREE.Vector3();\n\t\t\t\t\tconst worldQuaternion = new THREE.Quaternion();\n\t\t\t\t\tconst worldScale = new THREE.Vector3();\n\t\t\t\t\tcolMesh.updateWorldMatrix(true, false);\n\t\t\t\t\tcolMesh.matrixWorld.decompose(worldPosition, worldQuaternion, worldScale);\n\t\t\t\t\t// Clone the geometry to create an exact wireframe representation\n\t\t\t\t\tconst clonedGeometry = colMesh.geometry.clone();\n\t\t\t\t\tif(BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\t\t\tconsole.log(`Creating dynamic wireframe for: ${colMesh.name}`);\n\t\t\t\t\t}\n\t\t\t\t\t// Create a wireframe using the actual collision mesh geometry\n\t\t\t\t\tawait this.create_debug_wireframe(\n\t\t\t\t\t\t'mesh',\n\t\t\t\t\t\tnull,  // Dimensions not needed when using actual geometry\n\t\t\t\t\t\tworldPosition,\n\t\t\t\t\t\tworldQuaternion,\n\t\t\t\t\t\t{ \n\t\t\t\t\t\t\tbodyId: body.handle,\n\t\t\t\t\t\t\tgeometry: clonedGeometry,\n\t\t\t\t\t\t\toriginalObject: colMesh,\n\t\t\t\t\t\t\tobjectId: colMesh.id,\n\t\t\t\t\t\t\tscale: worldScale,\n\t\t\t\t\t\t\tisStatic: false // Explicitly mark as NOT static\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// No collision meshes, create wireframe based on object bounds\n\t\t\t\tconst boundingBox = new THREE.Box3().setFromObject(mesh);\n\t\t\t\tconst size = boundingBox.getSize(new THREE.Vector3());\n\t\t\t\tconst center = boundingBox.getCenter(new THREE.Vector3());\n\t\t\t\tif(BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\t\tconsole.log(`Creating fallback dynamic wireframe for: ${mesh.name}`);\n\t\t\t\t}\n\t\t\t\t// Create the debug wireframe\n\t\t\t\tawait this.create_debug_wireframe(\n\t\t\t\t\t'cuboid', \n\t\t\t\t\t{ \n\t\t\t\t\t\tx: size.x * 0.5, \n\t\t\t\t\t\ty: size.y * 0.5, \n\t\t\t\t\t\tz: size.z * 0.5 \n\t\t\t\t\t}, \n\t\t\t\t\tcenter, \n\t\t\t\t\tmesh.quaternion,\n\t\t\t\t\t{ \n\t\t\t\t\t\tbodyId: body.handle,\n\t\t\t\t\t\toriginalObject: mesh,\n\t\t\t\t\t\tobjectId: mesh.id,\n\t\t\t\t\t\tisStatic: false // Explicitly mark as NOT static\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\t// Also check for static bodies that might have physics\n\t\tconst staticMeshes = this.storage.get_all_static_meshes();\n\t\tfor (const mesh of staticMeshes) {\n\t\t\tif (!mesh) continue;\n\t\t\t// Only process static meshes that might have collision (like rooms)\n\t\t\tif (mesh.name.includes('ROOM') || mesh.name.includes('FLOOR')) {\n\t\t\t\tif(BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\t\tconsole.log(`Processing static mesh: ${mesh.name}`);\n\t\t\t\t}\n\t\t\t\t// Create a simple green wireframe for the static mesh\n\t\t\t\tconst boundingBox = new THREE.Box3().setFromObject(mesh);\n\t\t\t\tconst size = boundingBox.getSize(new THREE.Vector3());\n\t\t\t\tconst center = boundingBox.getCenter(new THREE.Vector3());\n\t\t\t\tif(BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\t\tconsole.log(`Creating static wireframe for room: ${mesh.name}`);\n\t\t\t\t}\n\t\t\t\tawait this.create_debug_wireframe(\n\t\t\t\t\t'cuboid', \n\t\t\t\t\t{ \n\t\t\t\t\t\tx: size.x * 0.5, \n\t\t\t\t\t\ty: size.y * 0.5, \n\t\t\t\t\t\tz: size.z * 0.5 \n\t\t\t\t\t}, \n\t\t\t\t\tcenter, \n\t\t\t\t\tmesh.quaternion,\n\t\t\t\t\t{ \n\t\t\t\t\t\toriginalObject: mesh,\n\t\t\t\t\t\tobjectId: mesh.id,\n\t\t\t\t\t\tisStatic: true  // Explicitly mark as static\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\t/**\n     * Spawns assets from asset groups defined in the manifest\n     * @param {Object} manifest_manager - Instance of ManifestManager\n     * @param {Function} progress_callback - Optional callback function for progress updates\n     * @returns {Promise<Array>} Array of spawned assets\n     */\n\tasync spawn_asset_groups(manifest_manager, progress_callback = null) {\n\t\tconst spawned_assets = [];\n\t\ttry {\n\t\t\t// Get all asset groups from manifest\n\t\t\tconst asset_groups = manifest_manager.get_all_asset_groups();\n\t\t\tif (!asset_groups || asset_groups.length === 0) {\n\t\t\t\tif (BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\t\tconsole.log(\"No asset groups found in manifest\");\n\t\t\t\t}\n\t\t\t\treturn spawned_assets;\n\t\t\t}\n\t\t\t// Find active asset groups\n\t\t\tconst active_groups = asset_groups.filter(group => group.active);\n\t\t\t// Process each active group\n\t\t\tfor (const group of active_groups) {\n\t\t\t\tif (progress_callback) {\n\t\t\t\t\tprogress_callback(`Loading asset group: ${group.name}...`);\n\t\t\t\t}\n\t\t\t\t// Process each asset in the group\n\t\t\t\tfor (const asset_id of group.assets) {\n\t\t\t\t\tconst asset_data = manifest_manager.get_asset(asset_id);\n\t\t\t\t\tif (asset_data) {\n\t\t\t\t\t\t// Get asset type information\n\t\t\t\t\t\tconst asset_type = asset_data.asset_type;\n\t\t\t\t\t\tconst custom_type = manifest_manager.get_custom_type(asset_type);\n\t\t\t\t\t\tif (custom_type) {\n\t\t\t\t\t\t\t// Extract position and rotation from asset data\n\t\t\t\t\t\t\tconst position = new THREE.Vector3(\n\t\t\t\t\t\t\t\tasset_data.position?.x || 0, \n\t\t\t\t\t\t\t\tasset_data.position?.y || 0, \n\t\t\t\t\t\t\t\tasset_data.position?.z || 0\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t// Create rotation from Euler angles\n\t\t\t\t\t\t\tconst rotation = new THREE.Euler(\n\t\t\t\t\t\t\t\tasset_data.rotation?.x || 0,\n\t\t\t\t\t\t\t\tasset_data.rotation?.y || 0,\n\t\t\t\t\t\t\t\tasset_data.rotation?.z || 0\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tconst quaternion = new THREE.Quaternion().setFromEuler(rotation);\n\t\t\t\t\t\t\t// Prepare options from asset data\n\t\t\t\t\t\t\tconst options = {\n\t\t\t\t\t\t\t\tscale: asset_data.scale,\n\t\t\t\t\t\t\t\tmaterial: asset_data.material,\n\t\t\t\t\t\t\t\tcollider: asset_data.collider,\n\t\t\t\t\t\t\t\tmass: asset_data.mass,\n\t\t\t\t\t\t\t\t...asset_data.options\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t// Spawn the asset using the existing spawn_asset method\n\t\t\t\t\t\t\tconst result = await this.spawn_asset(\n\t\t\t\t\t\t\t\tasset_type,\n\t\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\t\tquaternion,\n\t\t\t\t\t\t\t\toptions\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (result) {\n\t\t\t\t\t\t\t\t// Store the asset ID with the spawned asset data\n\t\t\t\t\t\t\t\tresult.id = asset_id;\n\t\t\t\t\t\t\t\tspawned_assets.push(result);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\t\t\t\tconsole.warn(`Custom type \"${asset_type}\" not found for asset ${asset_id}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\t\t\tconsole.warn(`Asset with ID \"${asset_id}\" not found in manifest`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\tconsole.log(`Spawned ${spawned_assets.length} assets from manifest`);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error('Error spawning asset groups:', error);\n\t\t}\n\t\treturn spawned_assets;\n\t}\n\t/**\n     * Spawns all assets from the manifest, routing system assets to SystemFactory\n     * and handling custom assets directly.\n     * \n     * @param {Object} manifest_manager - Instance of ManifestManager\n     * @param {Function} progress_callback - Optional callback function for progress updates\n     * @returns {Promise<Array>} Array of all spawned assets\n     */\n\tasync spawn_manifest_assets(manifest_manager, progress_callback = null) {\n\t\tconst spawned_assets = [];\n\t\ttry {\n\t\t\t// Get all assets from manifest\n\t\t\tconst system_assets = manifest_manager.get_system_assets();\n\t\t\tconst custom_assets = manifest_manager.get_custom_assets();\n\t\t\tif (BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\tconsole.log(`Found ${system_assets.length} system assets and ${custom_assets.length} custom assets to spawn`);\n\t\t\t}\n\t\t\t// Initialize SystemFactory if we have system assets\n\t\t\tif (system_assets && system_assets.length > 0) {\n\t\t\t\tif (progress_callback) {\n\t\t\t\t\tprogress_callback('Loading system assets...');\n\t\t\t\t}\n\t\t\t\t// Get SystemFactory instance\n\t\t\t\tconst system_factory = SystemFactory.get_instance(this.scene, this.world);\n\t\t\t\t// Spawn system assets\n\t\t\t\tconst system_results = await system_factory.spawn_system_assets(manifest_manager, progress_callback);\n\t\t\t\tspawned_assets.push(...system_results);\n\t\t\t}\n\t\t\t// Spawn custom assets\n\t\t\tif (custom_assets && custom_assets.length > 0) {\n\t\t\t\tif (progress_callback) {\n\t\t\t\t\tprogress_callback('Loading custom assets...');\n\t\t\t\t}\n\t\t\t\t// Get CustomFactory instance and spawn custom assets\n\t\t\t\tconst custom_factory = CustomFactory.get_instance(this.scene, this.world);\n\t\t\t\tconst custom_results = await custom_factory.spawn_custom_assets(manifest_manager, progress_callback);\n\t\t\t\tspawned_assets.push(...custom_results);\n\t\t\t}\n\t\t\tif (BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\t\tconsole.log(`Spawned ${spawned_assets.length} total assets from manifest`);\n\t\t\t}\n\t\t\treturn spawned_assets;\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error spawning manifest assets:\", error);\n\t\t\treturn spawned_assets;\n\t\t}\n\t}\n\t/**\n     * @deprecated\n     * Spawns a scene camera based on the camera configuration from the manifest.\n     * This method creates a simple camera without any additional functionality.\n     * \n     * @param {Object} camera_config - The camera configuration object from manifest\n     * @returns {THREE.PerspectiveCamera} The created camera\n     */\n\tspawn_scene_camera(camera_config) {\n\t\tif (!camera_config) {\n\t\t\tconsole.error(\"No camera configuration provided to spawn_scene_camera\");\n\t\t\treturn null;\n\t\t}\n\t\t// Create the camera using the configuration\n\t\tconst camera = new THREE.PerspectiveCamera(\n\t\t\t// Field of view\n\t\t\tcamera_config.fov || 75,\n\t\t\t// Default aspect ratio (will be updated when added to scene)\n\t\t\twindow.innerWidth / window.innerHeight,\n\t\t\t// Near and far clipping planes\n\t\t\tcamera_config.near || 0.1,\n\t\t\tcamera_config.far || 1000\n\t\t);\n\t\t// Set camera position from config\n\t\tcamera.position.set(\n\t\t\tcamera_config.position?.x || 0,\n\t\t\tcamera_config.position?.y || 5,\n\t\t\tcamera_config.position?.z || 10\n\t\t);\n\t\t// Store camera reference in asset storage\n\t\tconst camera_id = IdGenerator.get_instance().generate_asset_id();\n\t\tthis.storage.store_static_mesh(camera_id, camera);\n\t\treturn camera;\n\t}\n\t/**\n     * Creates a helper visualization for the specified asset type.\n     * Used for debugging purposes.\n     * \n     * @param {string} asset_type - The type of asset to create a helper for\n     * @param {THREE.Object3D} asset - The asset to create helpers for\n     * @returns {Promise<Object>} The created helper objects\n     */\n\tasync create_helper(asset_type, asset) {\n\t\tif (!asset) return null;\n\t\tswitch (asset_type) {\n\t\tcase SystemAssetType.SPOTLIGHT.value:\n\t\t\tconst { create_spotlight_helper } = await import('./asset_factories/system_spawners/spotlight_spawner.js');\n\t\t\treturn create_spotlight_helper(this.scene, asset);\n\t\t\t// Add other asset type cases here as needed\n\t\tdefault:\n\t\t\tconsole.warn(`No helper visualization available for asset type: ${asset_type}`);\n\t\t\treturn null;\n\t\t}\n\t}\n\t/**\n     * Removes helper visualizations for the specified asset.\n     * \n     * @param {THREE.Object3D} asset - The asset whose helpers should be removed\n     * @returns {Promise<void>}\n     */\n\tasync despawn_helpers(asset) {\n\t\tif (!asset || !asset.userData.debugHelpers) return;\n\t\tconst { helper, cone } = asset.userData.debugHelpers;\n\t\tif (helper && helper.parent) helper.parent.remove(helper);\n\t\tif (cone && cone.parent) cone.parent.remove(cone);\n\t\t// Clear the debug helpers reference\n\t\tasset.userData.debugHelpers = null;\n\t}\n\t/**\n     * Updates all helper visualizations to match their associated assets.\n     * Called from the main animation loop.\n     */\n\tasync update_helpers() {\n\t\tconst { update_helpers } = await import('./asset_factories/system_spawners/spotlight_spawner.js');\n\t\treturn update_helpers(this.scene);\n\t}\n\t/**\n     * Forces a full update of all helper visualizations on next call.\n     * Call this when you know assets have been added or removed.\n     */\n\tasync forceHelperUpdate() {\n\t\tconst { forceSpotlightDebugUpdate } = await import('./asset_factories/system_spawners/spotlight_spawner.js');\n\t\treturn forceSpotlightDebugUpdate(this.scene);\n\t}\n\t/**\n     * Dispose of the spawner instance and clean up resources\n     */\n\tdispose() {\n\t\tif (!AssetSpawner.#instance) return;\n\t\t// Dispose of factories\n\t\tCustomFactory.dispose_instance();\n\t\t// Clear references\n\t\tthis.scene = null;\n\t\tthis.world = null;\n\t\tthis.storage = null;\n\t\tthis.container = null;\n\t\tAssetSpawner.#disposed = true;\n\t\tAssetSpawner.#instance = null;\n\t}\n\t/**\n\t *\n\t */\n\tstatic dispose_instance() {\n\t\tif (AssetSpawner.#instance) {\n\t\t\tAssetSpawner.#instance.dispose();\n\t\t}\n\t}\n} ","/**\n * Default configuration values for blorkpack\n * \n * This file contains the default values for various configurations\n * that will be used when the manifest doesn't specify them.\n */\n/**\n * Default environment settings\n */\nexport const DEFAULT_ENVIRONMENT = {\n\t/**\n     * Default gravity configuration\n     * Standard Earth gravity is (0, -9.8, 0), but we default to zero gravity\n     * to avoid unexpected behavior in scenes\n     */\n\tgravity: {\n\t\tx: 0.0,\n\t\ty: 0.0,\n\t\tz: 0.0\n\t},\n\t/**\n     * Default ambient light settings\n     */\n\tambient_light: {\n\t\tcolor: \"0xffffff\",\n\t\tintensity: 0.5\n\t},\n\t/**\n     * Default fog settings\n     */\n\tfog: {\n\t\tenabled: false,\n\t\tcolor: \"0xaaaaaa\",\n\t\tnear: 10,\n\t\tfar: 100\n\t},\n\t/**\n     * Default background settings\n     */\n\tbackground: {\n\t\ttype: 'COLOR',\n\t\tcolor_value: '0x000000'\n\t},\n\t/**\n     * Default greeting data settings\n     */\n\tgreeting_data: {\n\t\tdisplay: false,\n\t\tmodal_path: ''\n\t}\n};\n/**\n * Default physics settings\n */\nexport const DEFAULT_PHYSICS = {\n\tenabled: true,\n\tupdate_rate: 60,\n\tsubsteps: 1,\n\tdebug_draw: false,\n\tallow_sleep: true,\n\tlinear_sleep_threshold: 0.2,\n\tangular_sleep_threshold: 0.1,\n\tsleep_threshold: 0.1,\n\tmax_velocity_iterations: 2,\n\tmax_velocity_friction: 4,\n\tintegration_parameters: {\n\t\tdt: 1/60,\n\t\terp: 0.8,\n\t\twarmstart_coeff: 0.8,\n\t\tallowed_linear_error: 0.001\n\t}\n};\n/**\n * Default rendering settings\n */\nexport const DEFAULT_RENDERING = {\n\tshadows: true,\n\tantialiasing: true,\n\ttone_mapping_exposure: 1.0,\n\toutput_encoding: \"sRGB\"\n}; ","import { DEFAULT_ENVIRONMENT, DEFAULT_PHYSICS, DEFAULT_RENDERING } from '../resources/default_configs.js';\nimport { BLORKPACK_FLAGS } from './blorkpack_flags.js';\n/**\n * Singleton class for managing manifest.json data\n */\nexport class ManifestManager {\n\t/**\n     * IMPORTANT: Always use the getter methods to access manifest data instead of direct access.\n     * The getter methods handle null checks and provide default values when properties are missing.\n     * This prevents having to do redundant null checks throughout the codebase.\n     * \n     * Example:\n     * - GOOD: manifest_manager.get_greeting_data().display\n     * - BAD:  manifest_manager.get_scene_data()?.greeting_data?.display\n     */\n\tstatic instance = null;\n\t/**\n\t *\n\t */\n\tconstructor() {\n\t\tif (ManifestManager.instance) {\n\t\t\treturn ManifestManager.instance;\n\t\t}\n\t\t/** @type {Manifest|null} */\n\t\tthis.manifest_data = null;\n\t\tthis.load_promise = null;\n\t\tthis.is_loaded = false;\n\t\t/** @type {string|null} The path that successfully loaded the manifest */\n\t\tthis.successful_manifest_path = null;\n\t\tManifestManager.instance = this;\n\t}\n\t/**\n     * Gets or creates the singleton instance of ManifestManager.\n     * @returns {ManifestManager} The singleton instance.\n     */\n\tstatic get_instance() {\n\t\tif (!ManifestManager.instance) {\n\t\t\tManifestManager.instance = new ManifestManager();\n\t\t}\n\t\treturn ManifestManager.instance;\n\t}\n\t/**\n     * Gets the path that successfully loaded the manifest\n     * @returns {string|null} The successful path or null if manifest hasn't been loaded\n     */\n\tget_successful_manifest_path() {\n\t\treturn this.successful_manifest_path;\n\t}\n\t/**\n     * Loads the manifest file from specified path.\n     * @param {string} [relativePath='resources/manifest.json'] - Path to the manifest file\n     * @returns {Promise<Object>} Promise resolving to the manifest data\n     */\n\tasync load_manifest(relativePath = 'resources/manifest.json') {\n\t\tif (this.is_loaded) {\n\t\t\treturn this.manifest_data;\n\t\t}\n\t\tif (this.load_promise) {\n\t\t\treturn this.load_promise;\n\t\t}\n\t\t// Get the base path from the current URL\n\t\tconst basePath = window.location.pathname.includes('/threejs_site/') ? '/threejs_site' : '';\n\t\tconst fullPath = `${basePath}/${relativePath}`.replace(/\\/+/g, '/');\n\t\tconsole.log(`Loading manifest from: ${fullPath}`);\n\t\ttry {\n\t\t\tconst response = await fetch(fullPath);\n\t\t\tif (!response.ok) {\n\t\t\t\tthrow new Error(`Failed to load manifest: ${response.status}`);\n\t\t\t}\n\t\t\tconst data = await response.json();\n\t\t\tthis.manifest_data = data;\n\t\t\tthis.is_loaded = true;\n\t\t\tthis.successful_manifest_path = fullPath;\n\t\t\t// Log success with clear formatting\n\t\t\tconsole.log(`\n%cManifest Successfully Loaded\n%cPath: ${fullPath}\n%cThis is the path that worked - you can remove other manifest copies\n`, \n\t\t\t'color: green; font-weight: bold; font-size: 1.1em;',\n\t\t\t'color: blue; font-weight: bold;',\n\t\t\t'color: gray; font-style: italic;'\n\t\t\t);\n\t\t\treturn data;\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Failed to load manifest:\", error);\n\t\t\tthrow error;\n\t\t}\n\t}\n\t/**\n     * Saves the manifest data to a JSON file (for the application creating manifests).\n     * @param {string} [path='resources/manifest.json'] - Path where to save the manifest\n     * @param {Object} [data=null] - Data to save, or use the current manifest_data if null\n     * @returns {Promise<boolean>} Promise resolving to true if save was successful\n     */\n\tasync save_manifest(path = 'resources/manifest.json', data = null) {\n\t\tconst data_to_save = data || this.manifest_data;\n\t\tif (!data_to_save) {\n\t\t\tthrow new Error('No manifest data to save');\n\t\t}\n\t\tconst serialized_data = JSON.stringify(data_to_save, null, 2);\n\t\ttry {\n\t\t\t// Browser environment\n\t\t\tif (typeof window !== 'undefined' && typeof document !== 'undefined') {\n\t\t\t\tconst blob = new Blob([serialized_data], { type: 'application/json' });\n\t\t\t\tconst url = URL.createObjectURL(blob);\n\t\t\t\tconst a = document.createElement('a');\n\t\t\t\ta.href = url;\n\t\t\t\ta.download = path.split('/').pop();\n\t\t\t\tdocument.body.appendChild(a);\n\t\t\t\ta.click();\n\t\t\t\tdocument.body.removeChild(a);\n\t\t\t\tURL.revokeObjectURL(url);\n\t\t\t\treturn true;\n\t\t\t} \n\t\t\t// Node.js environment\n\t\t\tif (typeof process !== 'undefined' && process.versions && process.versions.node) {\n\t\t\t\t// Since dynamic imports don't work well with our bundling, we'll check if fs is available\n\t\t\t\t// through the global require function first\n\t\t\t\tif (typeof require === 'function') {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst fs = require('fs');\n\t\t\t\t\t\tfs.writeFileSync(path, serialized_data);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t} catch (require_error) {\n\t\t\t\t\t\tconsole.warn('Could not require fs module:', require_error.message);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Otherwise we'll use a more creative approach - write to the console and\n\t\t\t\t// suggest how to save the file\n\t\t\t\tconsole.warn('Cannot directly save files in this Node.js environment.');\n\t\t\t\tconsole.warn('To save the manifest, write the following data to a file:');\n\t\t\t\tconsole.warn(`Path: ${path}`);\n\t\t\t\tconsole.warn('Data:', serialized_data);\n\t\t\t\t// For testing purposes, we'll create a temporary _save_data field\n\t\t\t\t// that can be checked by tests\n\t\t\t\tthis._save_data = {\n\t\t\t\t\tpath,\n\t\t\t\t\tdata: data_to_save\n\t\t\t\t};\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t// Fallback for unknown environments\n\t\t\tconsole.warn('Unable to save manifest: Unknown environment');\n\t\t\tconsole.warn('Manifest data:', serialized_data);\n\t\t\treturn false;\n\t\t} catch (error) {\n\t\t\tconsole.error('Error in save_manifest:', error);\n\t\t\tthrow error;\n\t\t}\n\t}\n\t/**\n     * Validates the manifest data against expected schema.\n     * @param {Object} [data=null] - Data to validate, or use the current manifest_data if null\n     * @returns {Object} Validation result with is_valid flag and any errors\n     */\n\tvalidate_manifest(data = null) {\n\t\tconst data_to_validate = data || this.manifest_data;\n\t\tif (!data_to_validate) {\n\t\t\treturn { is_valid: false, errors: ['No manifest data to validate'] };\n\t\t}\n\t\tconst errors = [];\n\t\t// Basic validation checks\n\t\tif (!data_to_validate.manifest_version) {\n\t\t\terrors.push('Missing manifest_version');\n\t\t}\n\t\tif (!data_to_validate.name) {\n\t\t\terrors.push('Missing name');\n\t\t}\n\t\t// Custom types validation\n\t\tif (data_to_validate.custom_types && Array.isArray(data_to_validate.custom_types)) {\n\t\t\tdata_to_validate.custom_types.forEach((type, index) => {\n\t\t\t\tif (!type.name) {\n\t\t\t\t\terrors.push(`custom_types[${index}]: Missing name`);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t// Scene data validation\n\t\tif (!data_to_validate.scene_data) {\n\t\t\terrors.push('Missing scene_data');\n\t\t}\n\t\t// Add more validation as needed...\n\t\treturn {\n\t\t\tis_valid: errors.length === 0,\n\t\t\terrors\n\t\t};\n\t}\n\t/**\n     * Creates a new empty manifest with default values.\n     * @param {string} name - Name of the new manifest\n     * @param {string} description - Description of the manifest\n     * @returns {Object} The newly created manifest data\n     */\n\tcreate_new_manifest(name, description) {\n\t\tconst timestamp = new Date().toLocaleDateString();\n\t\t/** @type {Manifest} */\n\t\tconst new_manifest = {\n\t\t\tmanifest_version: \"1.0\",\n\t\t\tname: name || \"New Manifest\",\n\t\t\tdescription: description || \"Created with ManifestManager\",\n\t\t\tauthor: \"\",\n\t\t\tcreated_date: timestamp,\n\t\t\tupdated_date: timestamp,\n\t\t\tcustom_types: [],\n\t\t\tjoint_data: {},\n\t\t\tasset_groups: [],\n\t\t\tasset_data: {},\n\t\t\tcustom_assets: [],\n\t\t\tsystem_assets: [],\n\t\t\tscene_data: {\n\t\t\t\tversion: \"1.0\",\n\t\t\t\tname: \"Main Scene\",\n\t\t\t\tdescription: \"Default scene\",\n\t\t\t\tenvironment: {\n\t\t\t\t\tgravity: {\n\t\t\t\t\t\tx: 0.0,\n\t\t\t\t\t\ty: 9.8,\n\t\t\t\t\t\tz: 0.0\n\t\t\t\t\t},\n\t\t\t\t\tambient_light: {\n\t\t\t\t\t\tcolor: \"0xffffff\",\n\t\t\t\t\t\tintensity: 0.5\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tphysics: {\n\t\t\t\t\tenabled: true,\n\t\t\t\t\tupdate_rate: 60\n\t\t\t\t},\n\t\t\t\trendering: {\n\t\t\t\t\tshadows: true,\n\t\t\t\t\tantialiasing: true\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tthis.manifest_data = new_manifest;\n\t\tthis.is_loaded = true;\n\t\treturn new_manifest;\n\t}\n\t/**\n     * Gets the entire manifest data.\n     * @returns {Object|null} The manifest data or null if not loaded.\n     */\n\tget_manifest() {\n\t\treturn this.manifest_data;\n\t}\n\t/**\n     * Updates the entire manifest data.\n     * @param {Object} data - The new manifest data\n     */\n\tset_manifest(data) {\n\t\tthis.manifest_data = data;\n\t\tthis.is_loaded = true;\n\t}\n\t/**\n     * Checks if the manifest is loaded.\n     * @returns {boolean} True if the manifest is loaded.\n     */\n\tis_manifest_loaded() {\n\t\treturn this.is_loaded;\n\t}\n\t/**\n     * Gets a custom type definition by name.\n     * @param {string} type_name - The name of the custom type.\n     * @returns {CustomType|null} The custom type definition or null if not found.\n     */\n\tget_custom_type(type_name) {\n\t\tif (!this.is_loaded || !this.manifest_data?.custom_types) {\n\t\t\treturn null;\n\t\t}\n\t\treturn this.manifest_data.custom_types.find(type => type.name === type_name) || null;\n\t}\n\t/**\n     * Gets all custom types.\n     * @returns {Array<CustomType>|null} Array of custom types or null if manifest not loaded.\n     */\n\tget_all_custom_types() {\n\t\treturn this.is_loaded ? this.manifest_data?.custom_types || [] : null;\n\t}\n\t/**\n     * Adds or updates a custom type.\n     * @param {CustomType} type_data - The custom type data\n     * @returns {boolean} True if successful\n     */\n\tset_custom_type(type_data) {\n\t\tif (!this.is_loaded || !type_data.name) {\n\t\t\treturn false;\n\t\t}\n\t\tif (!this.manifest_data.custom_types) {\n\t\t\tthis.manifest_data.custom_types = [];\n\t\t}\n\t\tconst existing_index = this.manifest_data.custom_types.findIndex(t => t.name === type_data.name);\n\t\tif (existing_index >= 0) {\n\t\t\tthis.manifest_data.custom_types[existing_index] = type_data;\n\t\t} else {\n\t\t\tthis.manifest_data.custom_types.push(type_data);\n\t\t}\n\t\treturn true;\n\t}\n\t/**\n     * Gets an asset group by ID.\n     * @param {string} group_id - The ID of the asset group.\n     * @returns {AssetGroup|null} The asset group or null if not found.\n     */\n\tget_asset_group(group_id) {\n\t\tif (!this.is_loaded || !this.manifest_data?.asset_groups) {\n\t\t\treturn null;\n\t\t}\n\t\treturn this.manifest_data.asset_groups.find(group => group.id === group_id) || null;\n\t}\n\t/**\n     * Gets all asset groups.\n     * @returns {Array<AssetGroup>|null} Array of asset groups or null if manifest not loaded.\n     */\n\tget_all_asset_groups() {\n\t\treturn this.is_loaded ? this.manifest_data?.asset_groups || [] : null;\n\t}\n\t/**\n     * Adds or updates an asset group.\n     * @param {AssetGroup} group_data - The asset group data\n     * @returns {boolean} True if successful\n     */\n\tset_asset_group(group_data) {\n\t\tif (!this.is_loaded || !group_data.id) {\n\t\t\treturn false;\n\t\t}\n\t\tif (!this.manifest_data.asset_groups) {\n\t\t\tthis.manifest_data.asset_groups = [];\n\t\t}\n\t\tconst existing_index = this.manifest_data.asset_groups.findIndex(g => g.id === group_data.id);\n\t\tif (existing_index >= 0) {\n\t\t\tthis.manifest_data.asset_groups[existing_index] = group_data;\n\t\t} else {\n\t\t\tthis.manifest_data.asset_groups.push(group_data);\n\t\t}\n\t\treturn true;\n\t}\n\t/**\n     * Gets an asset by ID.\n     * @param {string} asset_id - The ID of the asset.\n     * @returns {AssetData|null} The asset data or null if not found.\n     */\n\tget_asset(asset_id) {\n\t\tif (!this.is_loaded || !this.manifest_data?.asset_data) {\n\t\t\treturn null;\n\t\t}\n\t\t// If asset_data is an object with keys\n\t\tif (typeof this.manifest_data.asset_data === 'object' && !Array.isArray(this.manifest_data.asset_data)) {\n\t\t\treturn this.manifest_data.asset_data[asset_id] || null;\n\t\t}\n\t\t// If asset_data is an array\n\t\tif (Array.isArray(this.manifest_data.asset_data)) {\n\t\t\treturn this.manifest_data.asset_data.find(asset => asset.id === asset_id) || null;\n\t\t}\n\t\treturn null;\n\t}\n\t/**\n     * Gets all assets.\n     * @returns {Object<string,AssetData>|Array<AssetData>|null} Assets or null if manifest not loaded.\n     */\n\tget_all_assets() {\n\t\treturn this.is_loaded ? this.manifest_data?.asset_data || null : null;\n\t}\n\t/**\n     * Adds or updates an asset.\n     * @param {string} asset_id - The ID of the asset\n     * @param {AssetData} asset_data - The asset data\n     * @returns {boolean} True if successful\n     */\n\tset_asset(asset_id, asset_data) {\n\t\tif (!this.is_loaded || !asset_id) {\n\t\t\treturn false;\n\t\t}\n\t\t// Initialize asset_data if it doesn't exist\n\t\tif (!this.manifest_data.asset_data) {\n\t\t\t// Default to object notation\n\t\t\tthis.manifest_data.asset_data = {};\n\t\t}\n\t\t// If asset_data is an object with keys\n\t\tif (typeof this.manifest_data.asset_data === 'object' && !Array.isArray(this.manifest_data.asset_data)) {\n\t\t\tthis.manifest_data.asset_data[asset_id] = asset_data;\n\t\t\treturn true;\n\t\t}\n\t\t// If asset_data is an array\n\t\tif (Array.isArray(this.manifest_data.asset_data)) {\n\t\t\tconst existing_index = this.manifest_data.asset_data.findIndex(asset => asset.id === asset_id);\n\t\t\tif (existing_index >= 0) {\n\t\t\t\tthis.manifest_data.asset_data[existing_index] = asset_data;\n\t\t\t} else {\n\t\t\t\tthis.manifest_data.asset_data.push(asset_data);\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\t/**\n     * Gets the scene data.\n     * @returns {SceneData|null} The scene data or null if not loaded.\n     */\n\tget_scene_data() {\n\t\treturn this.is_loaded ? this.manifest_data?.scene_data || null : null;\n\t}\n\t/**\n     * Sets the scene data.\n     * @param {SceneData} scene_data - The scene data to set\n     * @returns {boolean} True if successful\n     */\n\tset_scene_data(scene_data) {\n\t\tif (!this.is_loaded) {\n\t\t\treturn false;\n\t\t}\n\t\tthis.manifest_data.scene_data = scene_data;\n\t\treturn true;\n\t}\n\t/**\n     * Gets the greeting data configuration from the manifest.\n     * If not defined in the manifest, returns a default with display set to false.\n     * @returns {Object} The greeting data configuration\n     */\n\tget_greeting_data() {\n\t\tconst scene_data = this.get_scene_data();\n\t\tif (scene_data?.greeting_data) {\n\t\t\treturn {\n\t\t\t\tdisplay: scene_data.greeting_data.display === true,\n\t\t\t\tmodal_path: scene_data.greeting_data.modal_path || ''\n\t\t\t};\n\t\t}\n\t\t// Log that we're using the default value\n\t\tif (typeof BLORKPACK_FLAGS !== 'undefined' && BLORKPACK_FLAGS.DEFAULT_CONFIG_LOGS) {\n\t\t\tconsole.debug(\"No greeting data found in manifest, using default (display: false)\");\n\t\t}\n\t\treturn DEFAULT_ENVIRONMENT.greeting_data;\n\t}\n\t/**\n     * Gets the auto_throttle setting from the manifest.\n     * If not defined in the manifest, returns the default (true).\n     * @returns {boolean} Whether automatic resolution throttling is enabled\n     */\n\tget_auto_throttle() {\n\t\tconst scene_data = this.get_scene_data();\n\t\tif (scene_data && 'auto_throttle' in scene_data) {\n\t\t\treturn scene_data.auto_throttle === true;\n\t\t}\n\t\t// Log that we're using the default value\n\t\tif (typeof BLORKPACK_FLAGS !== 'undefined' && BLORKPACK_FLAGS.DEFAULT_CONFIG_LOGS) {\n\t\t\tconsole.debug(\"No auto_throttle setting found in manifest, using default (true)\");\n\t\t}\n\t\treturn true; // Default to true for backward compatibility\n\t}\n\t/**\n     * Gets the gravity configuration from the manifest.\n     * If not defined in the manifest, returns the default.\n     * @returns {Object} The gravity configuration with x, y, z properties\n     */\n\tget_gravity() {\n\t\tconst scene_data = this.get_scene_data();\n\t\tif (scene_data?.environment?.gravity) {\n\t\t\treturn scene_data.environment.gravity;\n\t\t}\n\t\t// Log that we're using the default value\n\t\tif (typeof BLORKPACK_FLAGS !== 'undefined' && BLORKPACK_FLAGS.DEFAULT_CONFIG_LOGS) {\n\t\t\tconsole.debug(\"Using default gravity configuration from blorkpack defaults\");\n\t\t}\n\t\treturn DEFAULT_ENVIRONMENT.gravity;\n\t}\n\t/**\n     * Gets the physics optimization settings from the manifest.\n     * If not defined in the manifest, returns the default.\n     * @returns {Object} The physics optimization settings\n     */\n\tget_physics_optimization_settings() {\n\t\tconst scene_data = this.get_scene_data();\n\t\tif (scene_data?.physics?.optimization) {\n\t\t\treturn scene_data.physics.optimization;\n\t\t}\n\t\t// Log that we're using the default value\n\t\tif (typeof BLORKPACK_FLAGS !== 'undefined' && BLORKPACK_FLAGS.DEFAULT_CONFIG_LOGS) {\n\t\t\tconsole.debug(\"Using default physics optimization settings from blorkpack defaults\");\n\t\t}\n\t\treturn DEFAULT_PHYSICS;\n\t}\n\t/**\n     * Gets the ambient light configuration from the manifest.\n     * If not defined in the manifest, returns the default.\n     * @returns {Object} The ambient light configuration\n     */\n\tget_ambient_light() {\n\t\tconst scene_data = this.get_scene_data();\n\t\tif (scene_data?.environment?.ambient_light) {\n\t\t\treturn scene_data.environment.ambient_light;\n\t\t}\n\t\t// Log that we're using the default value\n\t\tif (typeof BLORKPACK_FLAGS !== 'undefined' && BLORKPACK_FLAGS.DEFAULT_CONFIG_LOGS) {\n\t\t\tconsole.debug(\"Using default ambient light configuration from blorkpack defaults\");\n\t\t}\n\t\treturn DEFAULT_ENVIRONMENT.ambient_light;\n\t}\n\t/**\n     * Gets the fog configuration from the manifest.\n     * If not defined in the manifest, returns the default.\n     * @returns {Object} The fog configuration\n     */\n\tget_fog() {\n\t\tconst scene_data = this.get_scene_data();\n\t\tif (scene_data?.environment?.fog) {\n\t\t\treturn scene_data.environment.fog;\n\t\t}\n\t\t// Log that we're using the default value\n\t\tif (typeof BLORKPACK_FLAGS !== 'undefined' && BLORKPACK_FLAGS.DEFAULT_CONFIG_LOGS) {\n\t\t\tconsole.debug(\"Using default fog configuration from blorkpack defaults\");\n\t\t}\n\t\treturn DEFAULT_ENVIRONMENT.fog;\n\t}\n\t/**\n     * Gets the physics configuration from the manifest.\n     * If not defined in the manifest, returns the default.\n     * @returns {Object} The physics configuration\n     */\n\tget_physics_config() {\n\t\tconst scene_data = this.get_scene_data();\n\t\tif (scene_data?.physics) {\n\t\t\treturn scene_data.physics;\n\t\t}\n\t\t// Log that we're using the default value\n\t\tif (typeof BLORKPACK_FLAGS !== 'undefined' && BLORKPACK_FLAGS.DEFAULT_CONFIG_LOGS) {\n\t\t\tconsole.debug(\"Using default physics configuration from blorkpack defaults\");\n\t\t}\n\t\treturn DEFAULT_PHYSICS;\n\t}\n\t/**\n     * Gets the rendering configuration from the manifest.\n     * If not defined in the manifest, returns the default.\n     * @returns {Object} The rendering configuration\n     */\n\tget_rendering_config() {\n\t\tconst scene_data = this.get_scene_data();\n\t\tif (scene_data?.rendering) {\n\t\t\treturn scene_data.rendering;\n\t\t}\n\t\t// Log that we're using the default value\n\t\tif (typeof BLORKPACK_FLAGS !== 'undefined' && BLORKPACK_FLAGS.DEFAULT_CONFIG_LOGS) {\n\t\t\tconsole.debug(\"Using default rendering configuration from blorkpack defaults\");\n\t\t}\n\t\treturn DEFAULT_RENDERING;\n\t}\n\t/**\n     * Gets the background configuration from the manifest.\n     * If not defined in the manifest, returns the default.\n     * Validates all fields to ensure they have appropriate values.\n     * @returns {Object} The background configuration\n     */\n\tget_background_config() {\n\t\tconst scene_data = this.get_scene_data();\n\t\tlet background = DEFAULT_ENVIRONMENT.background;\n\t\tif (scene_data?.background) {\n\t\t\tbackground = scene_data.background;\n\t\t\t// Ensure type is valid\n\t\t\tif (!['COLOR', 'IMAGE', 'SKYBOX'].includes(background.type)) {\n\t\t\t\tif (typeof BLORKPACK_FLAGS !== 'undefined' && BLORKPACK_FLAGS.DEFAULT_CONFIG_LOGS) {\n\t\t\t\t\tconsole.debug(`Invalid background type \"${background.type}\", using default type \"${DEFAULT_ENVIRONMENT.background.type}\"`);\n\t\t\t\t}\n\t\t\t\tbackground.type = DEFAULT_ENVIRONMENT.background.type;\n\t\t\t}\n\t\t\t// Ensure color_value is present for COLOR type\n\t\t\tif (background.type === 'COLOR' && !background.color_value) {\n\t\t\t\tif (typeof BLORKPACK_FLAGS !== 'undefined' && BLORKPACK_FLAGS.DEFAULT_CONFIG_LOGS) {\n\t\t\t\t\tconsole.debug(`Background type is COLOR but color_value is missing, using default value \"${DEFAULT_ENVIRONMENT.background.color_value}\"`);\n\t\t\t\t}\n\t\t\t\tbackground.color_value = DEFAULT_ENVIRONMENT.background.color_value;\n\t\t\t}\n\t\t\t// Ensure image_path is present for IMAGE type\n\t\t\tif (background.type === 'IMAGE' && !background.image_path) {\n\t\t\t\tif (typeof BLORKPACK_FLAGS !== 'undefined' && BLORKPACK_FLAGS.DEFAULT_CONFIG_LOGS) {\n\t\t\t\t\tconsole.debug(`Background type is IMAGE but image_path is missing, caller will use fallback image`);\n\t\t\t\t}\n\t\t\t\t// We'll let the caller handle the fallback with BACKGROUND_IMAGE\n\t\t\t}\n\t\t\t// Ensure skybox properties are valid for SKYBOX type\n\t\t\tif (background.type === 'SKYBOX') {\n\t\t\t\tif (!background.skybox) {\n\t\t\t\t\tif (typeof BLORKPACK_FLAGS !== 'undefined' && BLORKPACK_FLAGS.DEFAULT_CONFIG_LOGS) {\n\t\t\t\t\t\tconsole.debug(`Background type is SKYBOX but skybox object is missing, using default values enabled: false, skybox_path: \"\"`);\n\t\t\t\t\t}\n\t\t\t\t\tbackground.skybox = { enabled: false, skybox_path: '' };\n\t\t\t\t} else {\n\t\t\t\t\tif (!background.skybox.enabled) {\n\t\t\t\t\t\tif (typeof BLORKPACK_FLAGS !== 'undefined' && BLORKPACK_FLAGS.DEFAULT_CONFIG_LOGS) {\n\t\t\t\t\t\t\tconsole.debug(`Background type is SKYBOX but skybox.enabled is false, skybox will not be used`);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (!background.skybox.skybox_path) {\n\t\t\t\t\t\tif (typeof BLORKPACK_FLAGS !== 'undefined' && BLORKPACK_FLAGS.DEFAULT_CONFIG_LOGS) {\n\t\t\t\t\t\t\tconsole.debug(`Background type is SKYBOX but skybox_path is missing, using default value \"\"`);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbackground.skybox.skybox_path = '';\n\t\t\t\t\t\tbackground.skybox.enabled = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// Log that we're using the default value\n\t\t\tif (typeof BLORKPACK_FLAGS !== 'undefined' && BLORKPACK_FLAGS.DEFAULT_CONFIG_LOGS) {\n\t\t\t\tconsole.debug(`Using default background configuration: type \"${DEFAULT_ENVIRONMENT.background.type}\", color_value \"${DEFAULT_ENVIRONMENT.background.color_value}\"`);\n\t\t\t}\n\t\t}\n\t\treturn background;\n\t}\n\t/**\n     * Gets the joint data from the manifest.\n     * @returns {Object} The joint data or an empty object if not defined\n     */\n\tget_joint_data() {\n\t\treturn this.manifest_data?.joint_data || {};\n\t}\n\t/**\n     * Sets the joint data in the manifest.\n     * @param {Object} joint_data - The joint data to set\n     */\n\tset_joint_data(joint_data) {\n\t\tif (!this.manifest_data) {\n\t\t\tthis.manifest_data = this.create_new_manifest();\n\t\t}\n\t\tthis.manifest_data.joint_data = joint_data;\n\t}\n\t/**\n     * Gets the custom_assets array from the manifest.\n     * @returns {Array} Array of custom assets or an empty array if not defined\n     */\n\tget_custom_assets() {\n\t\tif (BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\tconsole.log('Getting custom assets from manifest...');\n\t\t}\n\t\treturn this.manifest_data?.custom_assets || [];\n\t}\n\t/**\n     * Sets the custom_assets array in the manifest.\n     * @param {Array} custom_assets - The custom assets array to set\n     */\n\tset_custom_assets(custom_assets) {\n\t\tif (!this.manifest_data) {\n\t\t\tthis.manifest_data = this.create_new_manifest();\n\t\t}\n\t\tthis.manifest_data.custom_assets = custom_assets;\n\t}\n\t/**\n     * Gets the system_assets array from the manifest.\n     * @returns {Array} The system assets array (empty array if not found)\n     */\n\tget_system_assets() {\n\t\tif (BLORKPACK_FLAGS.ASSET_LOGS) {\n\t\t\tconsole.log('Getting system assets from manifest...');\n\t\t}\n\t\treturn this.manifest_data?.system_assets || [];\n\t}\n\t/**\n     * Sets the system_assets array in the manifest.\n     * @param {Array} system_assets - The system assets array to set\n     */\n\tset_system_assets(system_assets) {\n\t\tif (!this.manifest_data) {\n\t\t\tthis.manifest_data = this.create_new_manifest();\n\t\t}\n\t\tthis.manifest_data.system_assets = system_assets;\n\t}\n\t/**\n     * Gets the camera configuration from the scene_data.\n     * @returns {Object} The camera configuration with defaults applied\n     */\n\tget_camera_config() {\n\t\tconst scene_data = this.get_scene_data();\n\t\tconst default_camera = {\n\t\t\tposition: { x: 0, y: 5, z: 10 },\n\t\t\ttarget: { x: 0, y: 0, z: 0 },\n\t\t\tfov: 75,\n\t\t\tnear: 0.1,\n\t\t\tfar: 1000,\n\t\t\tui_distance: 25,\n\t\t\tcontrols: {\n\t\t\t\ttype: \"ORBIT\",\n\t\t\t\tenable_damping: true,\n\t\t\t\tdamping_factor: 0.05,\n\t\t\t\tmin_distance: 5,\n\t\t\t\tmax_distance: 30,\n\t\t\t\tmin_polar_angle: -60,\n\t\t\t\tmax_polar_angle: 60,\n\t\t\t\tenable_zoom: true,\n\t\t\t\tenable_rotate: true,\n\t\t\t\tenable_pan: true\n\t\t\t},\n\t\t\tshoulder_lights: {\n\t\t\t\tenabled: true,\n\t\t\t\tleft: {\n\t\t\t\t\tposition: { x: -3, y: 2.5, z: 40 },\n\t\t\t\t\trotation: { pitch: 190, yaw: 0 },\n\t\t\t\t\tangle: 80,\n\t\t\t\t\tmax_distance: 0,\n\t\t\t\t\tintensity: 2\n\t\t\t\t},\n\t\t\t\tright: {\n\t\t\t\t\tposition: { x: 3, y: 2.5, z: 40 },\n\t\t\t\t\trotation: { pitch: 190, yaw: 0 },\n\t\t\t\t\tangle: 80,\n\t\t\t\t\tmax_distance: 0,\n\t\t\t\t\tintensity: 2\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tif (!scene_data || !scene_data.default_camera) {\n\t\t\tif (BLORKPACK_FLAGS.MANIFEST_LOGS) {\n\t\t\t\tconsole.warn('No camera configuration found in scene_data, using defaults');\n\t\t\t}\n\t\t\treturn default_camera;\n\t\t}\n\t\t// Deep merge the provided camera config with defaults\n\t\tconst camera_config = { ...default_camera };\n\t\t// Merge position and target\n\t\tif (scene_data.default_camera.position) {\n\t\t\tcamera_config.position = {\n\t\t\t\tx: scene_data.default_camera.position.x ?? default_camera.position.x,\n\t\t\t\ty: scene_data.default_camera.position.y ?? default_camera.position.y,\n\t\t\t\tz: scene_data.default_camera.position.z ?? default_camera.position.z\n\t\t\t};\n\t\t}\n\t\tif (scene_data.default_camera.target) {\n\t\t\tcamera_config.target = {\n\t\t\t\tx: scene_data.default_camera.target.x ?? default_camera.target.x,\n\t\t\t\ty: scene_data.default_camera.target.y ?? default_camera.target.y,\n\t\t\t\tz: scene_data.default_camera.target.z ?? default_camera.target.z\n\t\t\t};\n\t\t}\n\t\t// Merge simple properties\n\t\tcamera_config.fov = scene_data.default_camera.fov ?? default_camera.fov;\n\t\tcamera_config.near = scene_data.default_camera.near ?? default_camera.near;\n\t\tcamera_config.far = scene_data.default_camera.far ?? default_camera.far;\n\t\tcamera_config.ui_distance = scene_data.default_camera.ui_distance ?? default_camera.ui_distance;\n\t\t// Merge controls\n\t\tif (scene_data.default_camera.controls) {\n\t\t\tcamera_config.controls = {\n\t\t\t\ttype: scene_data.default_camera.controls.type ?? default_camera.controls.type,\n\t\t\t\tenable_damping: scene_data.default_camera.controls.enable_damping ?? default_camera.controls.enable_damping,\n\t\t\t\tdamping_factor: scene_data.default_camera.controls.damping_factor ?? default_camera.controls.damping_factor,\n\t\t\t\tmin_distance: scene_data.default_camera.controls.min_distance ?? default_camera.controls.min_distance,\n\t\t\t\tmax_distance: scene_data.default_camera.controls.max_distance ?? default_camera.controls.max_distance,\n\t\t\t\tmin_polar_angle: scene_data.default_camera.controls.min_polar_angle ?? default_camera.controls.min_polar_angle,\n\t\t\t\tmax_polar_angle: scene_data.default_camera.controls.max_polar_angle ?? default_camera.controls.max_polar_angle,\n\t\t\t\tenable_zoom: scene_data.default_camera.controls.enable_zoom ?? default_camera.controls.enable_zoom,\n\t\t\t\tenable_rotate: scene_data.default_camera.controls.enable_rotate ?? default_camera.controls.enable_rotate,\n\t\t\t\tenable_pan: scene_data.default_camera.controls.enable_pan ?? default_camera.controls.enable_pan\n\t\t\t};\n\t\t}\n\t\t// Merge shoulder lights\n\t\tif (scene_data.default_camera.shoulder_lights) {\n\t\t\tcamera_config.shoulder_lights = {\n\t\t\t\tenabled: scene_data.default_camera.shoulder_lights.enabled ?? default_camera.shoulder_lights.enabled\n\t\t\t};\n\t\t\t// Merge left light\n\t\t\tif (scene_data.default_camera.shoulder_lights.left) {\n\t\t\t\tcamera_config.shoulder_lights.left = { ...default_camera.shoulder_lights.left };\n\t\t\t\tif (scene_data.default_camera.shoulder_lights.left.position) {\n\t\t\t\t\tcamera_config.shoulder_lights.left.position = {\n\t\t\t\t\t\tx: scene_data.default_camera.shoulder_lights.left.position.x ?? default_camera.shoulder_lights.left.position.x,\n\t\t\t\t\t\ty: scene_data.default_camera.shoulder_lights.left.position.y ?? default_camera.shoulder_lights.left.position.y,\n\t\t\t\t\t\tz: scene_data.default_camera.shoulder_lights.left.position.z ?? default_camera.shoulder_lights.left.position.z\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tif (scene_data.default_camera.shoulder_lights.left.rotation) {\n\t\t\t\t\tcamera_config.shoulder_lights.left.rotation = {\n\t\t\t\t\t\tpitch: scene_data.default_camera.shoulder_lights.left.rotation.pitch ?? default_camera.shoulder_lights.left.rotation.pitch,\n\t\t\t\t\t\tyaw: scene_data.default_camera.shoulder_lights.left.rotation.yaw ?? default_camera.shoulder_lights.left.rotation.yaw\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tcamera_config.shoulder_lights.left.angle = scene_data.default_camera.shoulder_lights.left.angle ?? default_camera.shoulder_lights.left.angle;\n\t\t\t\tcamera_config.shoulder_lights.left.max_distance = scene_data.default_camera.shoulder_lights.left.max_distance ?? default_camera.shoulder_lights.left.max_distance;\n\t\t\t\tcamera_config.shoulder_lights.left.intensity = scene_data.default_camera.shoulder_lights.left.intensity ?? default_camera.shoulder_lights.left.intensity;\n\t\t\t}\n\t\t\t// Merge right light\n\t\t\tif (scene_data.default_camera.shoulder_lights.right) {\n\t\t\t\tcamera_config.shoulder_lights.right = { ...default_camera.shoulder_lights.right };\n\t\t\t\tif (scene_data.default_camera.shoulder_lights.right.position) {\n\t\t\t\t\tcamera_config.shoulder_lights.right.position = {\n\t\t\t\t\t\tx: scene_data.default_camera.shoulder_lights.right.position.x ?? default_camera.shoulder_lights.right.position.x,\n\t\t\t\t\t\ty: scene_data.default_camera.shoulder_lights.right.position.y ?? default_camera.shoulder_lights.right.position.y,\n\t\t\t\t\t\tz: scene_data.default_camera.shoulder_lights.right.position.z ?? default_camera.shoulder_lights.right.position.z\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tif (scene_data.default_camera.shoulder_lights.right.rotation) {\n\t\t\t\t\tcamera_config.shoulder_lights.right.rotation = {\n\t\t\t\t\t\tpitch: scene_data.default_camera.shoulder_lights.right.rotation.pitch ?? default_camera.shoulder_lights.right.rotation.pitch,\n\t\t\t\t\t\tyaw: scene_data.default_camera.shoulder_lights.right.rotation.yaw ?? default_camera.shoulder_lights.right.rotation.yaw\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tcamera_config.shoulder_lights.right.angle = scene_data.default_camera.shoulder_lights.right.angle ?? default_camera.shoulder_lights.right.angle;\n\t\t\t\tcamera_config.shoulder_lights.right.max_distance = scene_data.default_camera.shoulder_lights.right.max_distance ?? default_camera.shoulder_lights.right.max_distance;\n\t\t\t\tcamera_config.shoulder_lights.right.intensity = scene_data.default_camera.shoulder_lights.right.intensity ?? default_camera.shoulder_lights.right.intensity;\n\t\t\t}\n\t\t}\n\t\treturn camera_config;\n\t}\n} ","import {\n\tBufferGeometry,\n\tFloat32BufferAttribute,\n\tOrthographicCamera,\n\tMesh\n} from 'three';\n\nclass Pass {\n\n\tconstructor() {\n\n\t\tthis.isPass = true;\n\n\t\t// if set to true, the pass is processed by the composer\n\t\tthis.enabled = true;\n\n\t\t// if set to true, the pass indicates to swap read and write buffer after rendering\n\t\tthis.needsSwap = true;\n\n\t\t// if set to true, the pass clears its buffer before rendering\n\t\tthis.clear = false;\n\n\t\t// if set to true, the result of the pass is rendered to screen. This is set automatically by EffectComposer.\n\t\tthis.renderToScreen = false;\n\n\t}\n\n\tsetSize( /* width, height */ ) {}\n\n\trender( /* renderer, writeBuffer, readBuffer, deltaTime, maskActive */ ) {\n\n\t\tconsole.error( 'THREE.Pass: .render() must be implemented in derived pass.' );\n\n\t}\n\n\tdispose() {}\n\n}\n\n// Helper for passes that need to fill the viewport with a single quad.\n\nconst _camera = new OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );\n\n// https://github.com/mrdoob/three.js/pull/21358\n\nclass FullscreenTriangleGeometry extends BufferGeometry {\n\n\tconstructor() {\n\n\t\tsuper();\n\n\t\tthis.setAttribute( 'position', new Float32BufferAttribute( [ - 1, 3, 0, - 1, - 1, 0, 3, - 1, 0 ], 3 ) );\n\t\tthis.setAttribute( 'uv', new Float32BufferAttribute( [ 0, 2, 0, 0, 2, 0 ], 2 ) );\n\n\t}\n\n}\n\nconst _geometry = new FullscreenTriangleGeometry();\n\nclass FullScreenQuad {\n\n\tconstructor( material ) {\n\n\t\tthis._mesh = new Mesh( _geometry, material );\n\n\t}\n\n\tdispose() {\n\n\t\tthis._mesh.geometry.dispose();\n\n\t}\n\n\trender( renderer ) {\n\n\t\trenderer.render( this._mesh, _camera );\n\n\t}\n\n\tget material() {\n\n\t\treturn this._mesh.material;\n\n\t}\n\n\tset material( value ) {\n\n\t\tthis._mesh.material = value;\n\n\t}\n\n}\n\nexport { Pass, FullScreenQuad };\n","/**\n * Full-screen textured quad shader\n */\n\nconst CopyShader = {\n\n\tname: 'CopyShader',\n\n\tuniforms: {\n\n\t\t'tDiffuse': { value: null },\n\t\t'opacity': { value: 1.0 }\n\n\t},\n\n\tvertexShader: /* glsl */`\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}`,\n\n\tfragmentShader: /* glsl */`\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\n\t\t}`\n\n};\n\nexport { CopyShader };\n","import {\n\tShaderMaterial,\n\tUniformsUtils\n} from 'three';\nimport { Pass, FullScreenQuad } from './Pass.js';\n\nclass ShaderPass extends Pass {\n\n\tconstructor( shader, textureID ) {\n\n\t\tsuper();\n\n\t\tthis.textureID = ( textureID !== undefined ) ? textureID : 'tDiffuse';\n\n\t\tif ( shader instanceof ShaderMaterial ) {\n\n\t\t\tthis.uniforms = shader.uniforms;\n\n\t\t\tthis.material = shader;\n\n\t\t} else if ( shader ) {\n\n\t\t\tthis.uniforms = UniformsUtils.clone( shader.uniforms );\n\n\t\t\tthis.material = new ShaderMaterial( {\n\n\t\t\t\tname: ( shader.name !== undefined ) ? shader.name : 'unspecified',\n\t\t\t\tdefines: Object.assign( {}, shader.defines ),\n\t\t\t\tuniforms: this.uniforms,\n\t\t\t\tvertexShader: shader.vertexShader,\n\t\t\t\tfragmentShader: shader.fragmentShader\n\n\t\t\t} );\n\n\t\t}\n\n\t\tthis.fsQuad = new FullScreenQuad( this.material );\n\n\t}\n\n\trender( renderer, writeBuffer, readBuffer /*, deltaTime, maskActive */ ) {\n\n\t\tif ( this.uniforms[ this.textureID ] ) {\n\n\t\t\tthis.uniforms[ this.textureID ].value = readBuffer.texture;\n\n\t\t}\n\n\t\tthis.fsQuad.material = this.material;\n\n\t\tif ( this.renderToScreen ) {\n\n\t\t\trenderer.setRenderTarget( null );\n\t\t\tthis.fsQuad.render( renderer );\n\n\t\t} else {\n\n\t\t\trenderer.setRenderTarget( writeBuffer );\n\t\t\t// TODO: Avoid using autoClear properties, see https://github.com/mrdoob/three.js/pull/15571#issuecomment-465669600\n\t\t\tif ( this.clear ) renderer.clear( renderer.autoClearColor, renderer.autoClearDepth, renderer.autoClearStencil );\n\t\t\tthis.fsQuad.render( renderer );\n\n\t\t}\n\n\t}\n\n\tdispose() {\n\n\t\tthis.material.dispose();\n\n\t\tthis.fsQuad.dispose();\n\n\t}\n\n}\n\nexport { ShaderPass };\n","import { Pass } from './Pass.js';\n\nclass MaskPass extends Pass {\n\n\tconstructor( scene, camera ) {\n\n\t\tsuper();\n\n\t\tthis.scene = scene;\n\t\tthis.camera = camera;\n\n\t\tthis.clear = true;\n\t\tthis.needsSwap = false;\n\n\t\tthis.inverse = false;\n\n\t}\n\n\trender( renderer, writeBuffer, readBuffer /*, deltaTime, maskActive */ ) {\n\n\t\tconst context = renderer.getContext();\n\t\tconst state = renderer.state;\n\n\t\t// don't update color or depth\n\n\t\tstate.buffers.color.setMask( false );\n\t\tstate.buffers.depth.setMask( false );\n\n\t\t// lock buffers\n\n\t\tstate.buffers.color.setLocked( true );\n\t\tstate.buffers.depth.setLocked( true );\n\n\t\t// set up stencil\n\n\t\tlet writeValue, clearValue;\n\n\t\tif ( this.inverse ) {\n\n\t\t\twriteValue = 0;\n\t\t\tclearValue = 1;\n\n\t\t} else {\n\n\t\t\twriteValue = 1;\n\t\t\tclearValue = 0;\n\n\t\t}\n\n\t\tstate.buffers.stencil.setTest( true );\n\t\tstate.buffers.stencil.setOp( context.REPLACE, context.REPLACE, context.REPLACE );\n\t\tstate.buffers.stencil.setFunc( context.ALWAYS, writeValue, 0xffffffff );\n\t\tstate.buffers.stencil.setClear( clearValue );\n\t\tstate.buffers.stencil.setLocked( true );\n\n\t\t// draw into the stencil buffer\n\n\t\trenderer.setRenderTarget( readBuffer );\n\t\tif ( this.clear ) renderer.clear();\n\t\trenderer.render( this.scene, this.camera );\n\n\t\trenderer.setRenderTarget( writeBuffer );\n\t\tif ( this.clear ) renderer.clear();\n\t\trenderer.render( this.scene, this.camera );\n\n\t\t// unlock color and depth buffer and make them writable for subsequent rendering/clearing\n\n\t\tstate.buffers.color.setLocked( false );\n\t\tstate.buffers.depth.setLocked( false );\n\n\t\tstate.buffers.color.setMask( true );\n\t\tstate.buffers.depth.setMask( true );\n\n\t\t// only render where stencil is set to 1\n\n\t\tstate.buffers.stencil.setLocked( false );\n\t\tstate.buffers.stencil.setFunc( context.EQUAL, 1, 0xffffffff ); // draw if == 1\n\t\tstate.buffers.stencil.setOp( context.KEEP, context.KEEP, context.KEEP );\n\t\tstate.buffers.stencil.setLocked( true );\n\n\t}\n\n}\n\nclass ClearMaskPass extends Pass {\n\n\tconstructor() {\n\n\t\tsuper();\n\n\t\tthis.needsSwap = false;\n\n\t}\n\n\trender( renderer /*, writeBuffer, readBuffer, deltaTime, maskActive */ ) {\n\n\t\trenderer.state.buffers.stencil.setLocked( false );\n\t\trenderer.state.buffers.stencil.setTest( false );\n\n\t}\n\n}\n\nexport { MaskPass, ClearMaskPass };\n","import {\n\tClock,\n\tHalfFloatType,\n\tNoBlending,\n\tVector2,\n\tWebGLRenderTarget\n} from 'three';\nimport { CopyShader } from '../shaders/CopyShader.js';\nimport { ShaderPass } from './ShaderPass.js';\nimport { ClearMaskPass, MaskPass } from './MaskPass.js';\n\nclass EffectComposer {\n\n\tconstructor( renderer, renderTarget ) {\n\n\t\tthis.renderer = renderer;\n\n\t\tthis._pixelRatio = renderer.getPixelRatio();\n\n\t\tif ( renderTarget === undefined ) {\n\n\t\t\tconst size = renderer.getSize( new Vector2() );\n\t\t\tthis._width = size.width;\n\t\t\tthis._height = size.height;\n\n\t\t\trenderTarget = new WebGLRenderTarget( this._width * this._pixelRatio, this._height * this._pixelRatio, { type: HalfFloatType } );\n\t\t\trenderTarget.texture.name = 'EffectComposer.rt1';\n\n\t\t} else {\n\n\t\t\tthis._width = renderTarget.width;\n\t\t\tthis._height = renderTarget.height;\n\n\t\t}\n\n\t\tthis.renderTarget1 = renderTarget;\n\t\tthis.renderTarget2 = renderTarget.clone();\n\t\tthis.renderTarget2.texture.name = 'EffectComposer.rt2';\n\n\t\tthis.writeBuffer = this.renderTarget1;\n\t\tthis.readBuffer = this.renderTarget2;\n\n\t\tthis.renderToScreen = true;\n\n\t\tthis.passes = [];\n\n\t\tthis.copyPass = new ShaderPass( CopyShader );\n\t\tthis.copyPass.material.blending = NoBlending;\n\n\t\tthis.clock = new Clock();\n\n\t}\n\n\tswapBuffers() {\n\n\t\tconst tmp = this.readBuffer;\n\t\tthis.readBuffer = this.writeBuffer;\n\t\tthis.writeBuffer = tmp;\n\n\t}\n\n\taddPass( pass ) {\n\n\t\tthis.passes.push( pass );\n\t\tpass.setSize( this._width * this._pixelRatio, this._height * this._pixelRatio );\n\n\t}\n\n\tinsertPass( pass, index ) {\n\n\t\tthis.passes.splice( index, 0, pass );\n\t\tpass.setSize( this._width * this._pixelRatio, this._height * this._pixelRatio );\n\n\t}\n\n\tremovePass( pass ) {\n\n\t\tconst index = this.passes.indexOf( pass );\n\n\t\tif ( index !== - 1 ) {\n\n\t\t\tthis.passes.splice( index, 1 );\n\n\t\t}\n\n\t}\n\n\tisLastEnabledPass( passIndex ) {\n\n\t\tfor ( let i = passIndex + 1; i < this.passes.length; i ++ ) {\n\n\t\t\tif ( this.passes[ i ].enabled ) {\n\n\t\t\t\treturn false;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn true;\n\n\t}\n\n\trender( deltaTime ) {\n\n\t\t// deltaTime value is in seconds\n\n\t\tif ( deltaTime === undefined ) {\n\n\t\t\tdeltaTime = this.clock.getDelta();\n\n\t\t}\n\n\t\tconst currentRenderTarget = this.renderer.getRenderTarget();\n\n\t\tlet maskActive = false;\n\n\t\tfor ( let i = 0, il = this.passes.length; i < il; i ++ ) {\n\n\t\t\tconst pass = this.passes[ i ];\n\n\t\t\tif ( pass.enabled === false ) continue;\n\n\t\t\tpass.renderToScreen = ( this.renderToScreen && this.isLastEnabledPass( i ) );\n\t\t\tpass.render( this.renderer, this.writeBuffer, this.readBuffer, deltaTime, maskActive );\n\n\t\t\tif ( pass.needsSwap ) {\n\n\t\t\t\tif ( maskActive ) {\n\n\t\t\t\t\tconst context = this.renderer.getContext();\n\t\t\t\t\tconst stencil = this.renderer.state.buffers.stencil;\n\n\t\t\t\t\t//context.stencilFunc( context.NOTEQUAL, 1, 0xffffffff );\n\t\t\t\t\tstencil.setFunc( context.NOTEQUAL, 1, 0xffffffff );\n\n\t\t\t\t\tthis.copyPass.render( this.renderer, this.writeBuffer, this.readBuffer, deltaTime );\n\n\t\t\t\t\t//context.stencilFunc( context.EQUAL, 1, 0xffffffff );\n\t\t\t\t\tstencil.setFunc( context.EQUAL, 1, 0xffffffff );\n\n\t\t\t\t}\n\n\t\t\t\tthis.swapBuffers();\n\n\t\t\t}\n\n\t\t\tif ( MaskPass !== undefined ) {\n\n\t\t\t\tif ( pass instanceof MaskPass ) {\n\n\t\t\t\t\tmaskActive = true;\n\n\t\t\t\t} else if ( pass instanceof ClearMaskPass ) {\n\n\t\t\t\t\tmaskActive = false;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.renderer.setRenderTarget( currentRenderTarget );\n\n\t}\n\n\treset( renderTarget ) {\n\n\t\tif ( renderTarget === undefined ) {\n\n\t\t\tconst size = this.renderer.getSize( new Vector2() );\n\t\t\tthis._pixelRatio = this.renderer.getPixelRatio();\n\t\t\tthis._width = size.width;\n\t\t\tthis._height = size.height;\n\n\t\t\trenderTarget = this.renderTarget1.clone();\n\t\t\trenderTarget.setSize( this._width * this._pixelRatio, this._height * this._pixelRatio );\n\n\t\t}\n\n\t\tthis.renderTarget1.dispose();\n\t\tthis.renderTarget2.dispose();\n\t\tthis.renderTarget1 = renderTarget;\n\t\tthis.renderTarget2 = renderTarget.clone();\n\n\t\tthis.writeBuffer = this.renderTarget1;\n\t\tthis.readBuffer = this.renderTarget2;\n\n\t}\n\n\tsetSize( width, height ) {\n\n\t\tthis._width = width;\n\t\tthis._height = height;\n\n\t\tconst effectiveWidth = this._width * this._pixelRatio;\n\t\tconst effectiveHeight = this._height * this._pixelRatio;\n\n\t\tthis.renderTarget1.setSize( effectiveWidth, effectiveHeight );\n\t\tthis.renderTarget2.setSize( effectiveWidth, effectiveHeight );\n\n\t\tfor ( let i = 0; i < this.passes.length; i ++ ) {\n\n\t\t\tthis.passes[ i ].setSize( effectiveWidth, effectiveHeight );\n\n\t\t}\n\n\t}\n\n\tsetPixelRatio( pixelRatio ) {\n\n\t\tthis._pixelRatio = pixelRatio;\n\n\t\tthis.setSize( this._width, this._height );\n\n\t}\n\n\tdispose() {\n\n\t\tthis.renderTarget1.dispose();\n\t\tthis.renderTarget2.dispose();\n\n\t\tthis.copyPass.dispose();\n\n\t}\n\n}\n\nexport { EffectComposer };\n","const OutputShader = {\n\n\tname: 'OutputShader',\n\n\tuniforms: {\n\n\t\t'tDiffuse': { value: null },\n\t\t'toneMappingExposure': { value: 1 }\n\n\t},\n\n\tvertexShader: /* glsl */`\n\t\tprecision highp float;\n\n\t\tuniform mat4 modelViewMatrix;\n\t\tuniform mat4 projectionMatrix;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}`,\n\n\tfragmentShader: /* glsl */`\n\t\n\t\tprecision highp float;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\t#include <tonemapping_pars_fragment>\n\t\t#include <colorspace_pars_fragment>\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\n\t\t\t// tone mapping\n\n\t\t\t#ifdef LINEAR_TONE_MAPPING\n\n\t\t\t\tgl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );\n\n\t\t\t#elif defined( REINHARD_TONE_MAPPING )\n\n\t\t\t\tgl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );\n\n\t\t\t#elif defined( CINEON_TONE_MAPPING )\n\n\t\t\t\tgl_FragColor.rgb = CineonToneMapping( gl_FragColor.rgb );\n\n\t\t\t#elif defined( ACES_FILMIC_TONE_MAPPING )\n\n\t\t\t\tgl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );\n\n\t\t\t#elif defined( AGX_TONE_MAPPING )\n\n\t\t\t\tgl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );\n\n\t\t\t#elif defined( NEUTRAL_TONE_MAPPING )\n\n\t\t\t\tgl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );\n\n\t\t\t#endif\n\n\t\t\t// color space\n\n\t\t\t#ifdef SRGB_TRANSFER\n\n\t\t\t\tgl_FragColor = sRGBTransferOETF( gl_FragColor );\n\n\t\t\t#endif\n\n\t\t}`\n\n};\n\nexport { OutputShader };\n","import {\n\tColorManagement,\n\tRawShaderMaterial,\n\tUniformsUtils,\n\tLinearToneMapping,\n\tReinhardToneMapping,\n\tCineonToneMapping,\n\tAgXToneMapping,\n\tACESFilmicToneMapping,\n\tNeutralToneMapping,\n\tSRGBTransfer\n} from 'three';\nimport { Pass, FullScreenQuad } from './Pass.js';\nimport { OutputShader } from '../shaders/OutputShader.js';\n\nclass OutputPass extends Pass {\n\n\tconstructor() {\n\n\t\tsuper();\n\n\t\t//\n\n\t\tconst shader = OutputShader;\n\n\t\tthis.uniforms = UniformsUtils.clone( shader.uniforms );\n\n\t\tthis.material = new RawShaderMaterial( {\n\t\t\tname: shader.name,\n\t\t\tuniforms: this.uniforms,\n\t\t\tvertexShader: shader.vertexShader,\n\t\t\tfragmentShader: shader.fragmentShader\n\t\t} );\n\n\t\tthis.fsQuad = new FullScreenQuad( this.material );\n\n\t\t// internal cache\n\n\t\tthis._outputColorSpace = null;\n\t\tthis._toneMapping = null;\n\n\t}\n\n\trender( renderer, writeBuffer, readBuffer/*, deltaTime, maskActive */ ) {\n\n\t\tthis.uniforms[ 'tDiffuse' ].value = readBuffer.texture;\n\t\tthis.uniforms[ 'toneMappingExposure' ].value = renderer.toneMappingExposure;\n\n\t\t// rebuild defines if required\n\n\t\tif ( this._outputColorSpace !== renderer.outputColorSpace || this._toneMapping !== renderer.toneMapping ) {\n\n\t\t\tthis._outputColorSpace = renderer.outputColorSpace;\n\t\t\tthis._toneMapping = renderer.toneMapping;\n\n\t\t\tthis.material.defines = {};\n\n\t\t\tif ( ColorManagement.getTransfer( this._outputColorSpace ) === SRGBTransfer ) this.material.defines.SRGB_TRANSFER = '';\n\n\t\t\tif ( this._toneMapping === LinearToneMapping ) this.material.defines.LINEAR_TONE_MAPPING = '';\n\t\t\telse if ( this._toneMapping === ReinhardToneMapping ) this.material.defines.REINHARD_TONE_MAPPING = '';\n\t\t\telse if ( this._toneMapping === CineonToneMapping ) this.material.defines.CINEON_TONE_MAPPING = '';\n\t\t\telse if ( this._toneMapping === ACESFilmicToneMapping ) this.material.defines.ACES_FILMIC_TONE_MAPPING = '';\n\t\t\telse if ( this._toneMapping === AgXToneMapping ) this.material.defines.AGX_TONE_MAPPING = '';\n\t\t\telse if ( this._toneMapping === NeutralToneMapping ) this.material.defines.NEUTRAL_TONE_MAPPING = '';\n\n\t\t\tthis.material.needsUpdate = true;\n\n\t\t}\n\n\t\t//\n\n\t\tif ( this.renderToScreen === true ) {\n\n\t\t\trenderer.setRenderTarget( null );\n\t\t\tthis.fsQuad.render( renderer );\n\n\t\t} else {\n\n\t\t\trenderer.setRenderTarget( writeBuffer );\n\t\t\tif ( this.clear ) renderer.clear( renderer.autoClearColor, renderer.autoClearDepth, renderer.autoClearStencil );\n\t\t\tthis.fsQuad.render( renderer );\n\n\t\t}\n\n\t}\n\n\tdispose() {\n\n\t\tthis.material.dispose();\n\t\tthis.fsQuad.dispose();\n\n\t}\n\n}\n\nexport { OutputPass };\n","import {\n\tColor\n} from 'three';\nimport { Pass } from './Pass.js';\n\nclass RenderPass extends Pass {\n\n\tconstructor( scene, camera, overrideMaterial = null, clearColor = null, clearAlpha = null ) {\n\n\t\tsuper();\n\n\t\tthis.scene = scene;\n\t\tthis.camera = camera;\n\n\t\tthis.overrideMaterial = overrideMaterial;\n\n\t\tthis.clearColor = clearColor;\n\t\tthis.clearAlpha = clearAlpha;\n\n\t\tthis.clear = true;\n\t\tthis.clearDepth = false;\n\t\tthis.needsSwap = false;\n\t\tthis._oldClearColor = new Color();\n\n\t}\n\n\trender( renderer, writeBuffer, readBuffer /*, deltaTime, maskActive */ ) {\n\n\t\tconst oldAutoClear = renderer.autoClear;\n\t\trenderer.autoClear = false;\n\n\t\tlet oldClearAlpha, oldOverrideMaterial;\n\n\t\tif ( this.overrideMaterial !== null ) {\n\n\t\t\toldOverrideMaterial = this.scene.overrideMaterial;\n\n\t\t\tthis.scene.overrideMaterial = this.overrideMaterial;\n\n\t\t}\n\n\t\tif ( this.clearColor !== null ) {\n\n\t\t\trenderer.getClearColor( this._oldClearColor );\n\t\t\trenderer.setClearColor( this.clearColor, renderer.getClearAlpha() );\n\n\t\t}\n\n\t\tif ( this.clearAlpha !== null ) {\n\n\t\t\toldClearAlpha = renderer.getClearAlpha();\n\t\t\trenderer.setClearAlpha( this.clearAlpha );\n\n\t\t}\n\n\t\tif ( this.clearDepth == true ) {\n\n\t\t\trenderer.clearDepth();\n\n\t\t}\n\n\t\trenderer.setRenderTarget( this.renderToScreen ? null : readBuffer );\n\n\t\tif ( this.clear === true ) {\n\n\t\t\t// TODO: Avoid using autoClear properties, see https://github.com/mrdoob/three.js/pull/15571#issuecomment-465669600\n\t\t\trenderer.clear( renderer.autoClearColor, renderer.autoClearDepth, renderer.autoClearStencil );\n\n\t\t}\n\n\t\trenderer.render( this.scene, this.camera );\n\n\t\t// restore\n\n\t\tif ( this.clearColor !== null ) {\n\n\t\t\trenderer.setClearColor( this._oldClearColor );\n\n\t\t}\n\n\t\tif ( this.clearAlpha !== null ) {\n\n\t\t\trenderer.setClearAlpha( oldClearAlpha );\n\n\t\t}\n\n\t\tif ( this.overrideMaterial !== null ) {\n\n\t\t\tthis.scene.overrideMaterial = oldOverrideMaterial;\n\n\t\t}\n\n\t\trenderer.autoClear = oldAutoClear;\n\n\t}\n\n}\n\nexport { RenderPass };\n","import {\n\tColor\n} from 'three';\n\n/**\n * Luminosity\n * http://en.wikipedia.org/wiki/Luminosity\n */\n\nconst LuminosityHighPassShader = {\n\n\tname: 'LuminosityHighPassShader',\n\n\tshaderID: 'luminosityHighPass',\n\n\tuniforms: {\n\n\t\t'tDiffuse': { value: null },\n\t\t'luminosityThreshold': { value: 1.0 },\n\t\t'smoothWidth': { value: 1.0 },\n\t\t'defaultColor': { value: new Color( 0x000000 ) },\n\t\t'defaultOpacity': { value: 0.0 }\n\n\t},\n\n\tvertexShader: /* glsl */`\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}`,\n\n\tfragmentShader: /* glsl */`\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec3 defaultColor;\n\t\tuniform float defaultOpacity;\n\t\tuniform float luminosityThreshold;\n\t\tuniform float smoothWidth;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\n\t\t\tfloat v = luminance( texel.xyz );\n\n\t\t\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n\n\t\t\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n\n\t\t\tgl_FragColor = mix( outputColor, texel, alpha );\n\n\t\t}`\n\n};\n\nexport { LuminosityHighPassShader };\n","import {\n\tAdditiveBlending,\n\tColor,\n\tHalfFloatType,\n\tMeshBasicMaterial,\n\tShaderMaterial,\n\tUniformsUtils,\n\tVector2,\n\tVector3,\n\tWebGLRenderTarget\n} from 'three';\nimport { Pass, FullScreenQuad } from './Pass.js';\nimport { CopyShader } from '../shaders/CopyShader.js';\nimport { LuminosityHighPassShader } from '../shaders/LuminosityHighPassShader.js';\n\n/**\n * UnrealBloomPass is inspired by the bloom pass of Unreal Engine. It creates a\n * mip map chain of bloom textures and blurs them with different radii. Because\n * of the weighted combination of mips, and because larger blurs are done on\n * higher mips, this effect provides good quality and performance.\n *\n * Reference:\n * - https://docs.unrealengine.com/latest/INT/Engine/Rendering/PostProcessEffects/Bloom/\n */\nclass UnrealBloomPass extends Pass {\n\n\tconstructor( resolution, strength, radius, threshold ) {\n\n\t\tsuper();\n\n\t\tthis.strength = ( strength !== undefined ) ? strength : 1;\n\t\tthis.radius = radius;\n\t\tthis.threshold = threshold;\n\t\tthis.resolution = ( resolution !== undefined ) ? new Vector2( resolution.x, resolution.y ) : new Vector2( 256, 256 );\n\n\t\t// create color only once here, reuse it later inside the render function\n\t\tthis.clearColor = new Color( 0, 0, 0 );\n\n\t\t// render targets\n\t\tthis.renderTargetsHorizontal = [];\n\t\tthis.renderTargetsVertical = [];\n\t\tthis.nMips = 5;\n\t\tlet resx = Math.round( this.resolution.x / 2 );\n\t\tlet resy = Math.round( this.resolution.y / 2 );\n\n\t\tthis.renderTargetBright = new WebGLRenderTarget( resx, resy, { type: HalfFloatType } );\n\t\tthis.renderTargetBright.texture.name = 'UnrealBloomPass.bright';\n\t\tthis.renderTargetBright.texture.generateMipmaps = false;\n\n\t\tfor ( let i = 0; i < this.nMips; i ++ ) {\n\n\t\t\tconst renderTargetHorizontal = new WebGLRenderTarget( resx, resy, { type: HalfFloatType } );\n\n\t\t\trenderTargetHorizontal.texture.name = 'UnrealBloomPass.h' + i;\n\t\t\trenderTargetHorizontal.texture.generateMipmaps = false;\n\n\t\t\tthis.renderTargetsHorizontal.push( renderTargetHorizontal );\n\n\t\t\tconst renderTargetVertical = new WebGLRenderTarget( resx, resy, { type: HalfFloatType } );\n\n\t\t\trenderTargetVertical.texture.name = 'UnrealBloomPass.v' + i;\n\t\t\trenderTargetVertical.texture.generateMipmaps = false;\n\n\t\t\tthis.renderTargetsVertical.push( renderTargetVertical );\n\n\t\t\tresx = Math.round( resx / 2 );\n\n\t\t\tresy = Math.round( resy / 2 );\n\n\t\t}\n\n\t\t// luminosity high pass material\n\n\t\tconst highPassShader = LuminosityHighPassShader;\n\t\tthis.highPassUniforms = UniformsUtils.clone( highPassShader.uniforms );\n\n\t\tthis.highPassUniforms[ 'luminosityThreshold' ].value = threshold;\n\t\tthis.highPassUniforms[ 'smoothWidth' ].value = 0.01;\n\n\t\tthis.materialHighPassFilter = new ShaderMaterial( {\n\t\t\tuniforms: this.highPassUniforms,\n\t\t\tvertexShader: highPassShader.vertexShader,\n\t\t\tfragmentShader: highPassShader.fragmentShader\n\t\t} );\n\n\t\t// gaussian blur materials\n\n\t\tthis.separableBlurMaterials = [];\n\t\tconst kernelSizeArray = [ 3, 5, 7, 9, 11 ];\n\t\tresx = Math.round( this.resolution.x / 2 );\n\t\tresy = Math.round( this.resolution.y / 2 );\n\n\t\tfor ( let i = 0; i < this.nMips; i ++ ) {\n\n\t\t\tthis.separableBlurMaterials.push( this.getSeparableBlurMaterial( kernelSizeArray[ i ] ) );\n\n\t\t\tthis.separableBlurMaterials[ i ].uniforms[ 'invSize' ].value = new Vector2( 1 / resx, 1 / resy );\n\n\t\t\tresx = Math.round( resx / 2 );\n\n\t\t\tresy = Math.round( resy / 2 );\n\n\t\t}\n\n\t\t// composite material\n\n\t\tthis.compositeMaterial = this.getCompositeMaterial( this.nMips );\n\t\tthis.compositeMaterial.uniforms[ 'blurTexture1' ].value = this.renderTargetsVertical[ 0 ].texture;\n\t\tthis.compositeMaterial.uniforms[ 'blurTexture2' ].value = this.renderTargetsVertical[ 1 ].texture;\n\t\tthis.compositeMaterial.uniforms[ 'blurTexture3' ].value = this.renderTargetsVertical[ 2 ].texture;\n\t\tthis.compositeMaterial.uniforms[ 'blurTexture4' ].value = this.renderTargetsVertical[ 3 ].texture;\n\t\tthis.compositeMaterial.uniforms[ 'blurTexture5' ].value = this.renderTargetsVertical[ 4 ].texture;\n\t\tthis.compositeMaterial.uniforms[ 'bloomStrength' ].value = strength;\n\t\tthis.compositeMaterial.uniforms[ 'bloomRadius' ].value = 0.1;\n\n\t\tconst bloomFactors = [ 1.0, 0.8, 0.6, 0.4, 0.2 ];\n\t\tthis.compositeMaterial.uniforms[ 'bloomFactors' ].value = bloomFactors;\n\t\tthis.bloomTintColors = [ new Vector3( 1, 1, 1 ), new Vector3( 1, 1, 1 ), new Vector3( 1, 1, 1 ), new Vector3( 1, 1, 1 ), new Vector3( 1, 1, 1 ) ];\n\t\tthis.compositeMaterial.uniforms[ 'bloomTintColors' ].value = this.bloomTintColors;\n\n\t\t// blend material\n\n\t\tconst copyShader = CopyShader;\n\n\t\tthis.copyUniforms = UniformsUtils.clone( copyShader.uniforms );\n\n\t\tthis.blendMaterial = new ShaderMaterial( {\n\t\t\tuniforms: this.copyUniforms,\n\t\t\tvertexShader: copyShader.vertexShader,\n\t\t\tfragmentShader: copyShader.fragmentShader,\n\t\t\tblending: AdditiveBlending,\n\t\t\tdepthTest: false,\n\t\t\tdepthWrite: false,\n\t\t\ttransparent: true\n\t\t} );\n\n\t\tthis.enabled = true;\n\t\tthis.needsSwap = false;\n\n\t\tthis._oldClearColor = new Color();\n\t\tthis.oldClearAlpha = 1;\n\n\t\tthis.basic = new MeshBasicMaterial();\n\n\t\tthis.fsQuad = new FullScreenQuad( null );\n\n\t}\n\n\tdispose() {\n\n\t\tfor ( let i = 0; i < this.renderTargetsHorizontal.length; i ++ ) {\n\n\t\t\tthis.renderTargetsHorizontal[ i ].dispose();\n\n\t\t}\n\n\t\tfor ( let i = 0; i < this.renderTargetsVertical.length; i ++ ) {\n\n\t\t\tthis.renderTargetsVertical[ i ].dispose();\n\n\t\t}\n\n\t\tthis.renderTargetBright.dispose();\n\n\t\t//\n\n\t\tfor ( let i = 0; i < this.separableBlurMaterials.length; i ++ ) {\n\n\t\t\tthis.separableBlurMaterials[ i ].dispose();\n\n\t\t}\n\n\t\tthis.compositeMaterial.dispose();\n\t\tthis.blendMaterial.dispose();\n\t\tthis.basic.dispose();\n\n\t\t//\n\n\t\tthis.fsQuad.dispose();\n\n\t}\n\n\tsetSize( width, height ) {\n\n\t\tlet resx = Math.round( width / 2 );\n\t\tlet resy = Math.round( height / 2 );\n\n\t\tthis.renderTargetBright.setSize( resx, resy );\n\n\t\tfor ( let i = 0; i < this.nMips; i ++ ) {\n\n\t\t\tthis.renderTargetsHorizontal[ i ].setSize( resx, resy );\n\t\t\tthis.renderTargetsVertical[ i ].setSize( resx, resy );\n\n\t\t\tthis.separableBlurMaterials[ i ].uniforms[ 'invSize' ].value = new Vector2( 1 / resx, 1 / resy );\n\n\t\t\tresx = Math.round( resx / 2 );\n\t\t\tresy = Math.round( resy / 2 );\n\n\t\t}\n\n\t}\n\n\trender( renderer, writeBuffer, readBuffer, deltaTime, maskActive ) {\n\n\t\trenderer.getClearColor( this._oldClearColor );\n\t\tthis.oldClearAlpha = renderer.getClearAlpha();\n\t\tconst oldAutoClear = renderer.autoClear;\n\t\trenderer.autoClear = false;\n\n\t\trenderer.setClearColor( this.clearColor, 0 );\n\n\t\tif ( maskActive ) renderer.state.buffers.stencil.setTest( false );\n\n\t\t// Render input to screen\n\n\t\tif ( this.renderToScreen ) {\n\n\t\t\tthis.fsQuad.material = this.basic;\n\t\t\tthis.basic.map = readBuffer.texture;\n\n\t\t\trenderer.setRenderTarget( null );\n\t\t\trenderer.clear();\n\t\t\tthis.fsQuad.render( renderer );\n\n\t\t}\n\n\t\t// 1. Extract Bright Areas\n\n\t\tthis.highPassUniforms[ 'tDiffuse' ].value = readBuffer.texture;\n\t\tthis.highPassUniforms[ 'luminosityThreshold' ].value = this.threshold;\n\t\tthis.fsQuad.material = this.materialHighPassFilter;\n\n\t\trenderer.setRenderTarget( this.renderTargetBright );\n\t\trenderer.clear();\n\t\tthis.fsQuad.render( renderer );\n\n\t\t// 2. Blur All the mips progressively\n\n\t\tlet inputRenderTarget = this.renderTargetBright;\n\n\t\tfor ( let i = 0; i < this.nMips; i ++ ) {\n\n\t\t\tthis.fsQuad.material = this.separableBlurMaterials[ i ];\n\n\t\t\tthis.separableBlurMaterials[ i ].uniforms[ 'colorTexture' ].value = inputRenderTarget.texture;\n\t\t\tthis.separableBlurMaterials[ i ].uniforms[ 'direction' ].value = UnrealBloomPass.BlurDirectionX;\n\t\t\trenderer.setRenderTarget( this.renderTargetsHorizontal[ i ] );\n\t\t\trenderer.clear();\n\t\t\tthis.fsQuad.render( renderer );\n\n\t\t\tthis.separableBlurMaterials[ i ].uniforms[ 'colorTexture' ].value = this.renderTargetsHorizontal[ i ].texture;\n\t\t\tthis.separableBlurMaterials[ i ].uniforms[ 'direction' ].value = UnrealBloomPass.BlurDirectionY;\n\t\t\trenderer.setRenderTarget( this.renderTargetsVertical[ i ] );\n\t\t\trenderer.clear();\n\t\t\tthis.fsQuad.render( renderer );\n\n\t\t\tinputRenderTarget = this.renderTargetsVertical[ i ];\n\n\t\t}\n\n\t\t// Composite All the mips\n\n\t\tthis.fsQuad.material = this.compositeMaterial;\n\t\tthis.compositeMaterial.uniforms[ 'bloomStrength' ].value = this.strength;\n\t\tthis.compositeMaterial.uniforms[ 'bloomRadius' ].value = this.radius;\n\t\tthis.compositeMaterial.uniforms[ 'bloomTintColors' ].value = this.bloomTintColors;\n\n\t\trenderer.setRenderTarget( this.renderTargetsHorizontal[ 0 ] );\n\t\trenderer.clear();\n\t\tthis.fsQuad.render( renderer );\n\n\t\t// Blend it additively over the input texture\n\n\t\tthis.fsQuad.material = this.blendMaterial;\n\t\tthis.copyUniforms[ 'tDiffuse' ].value = this.renderTargetsHorizontal[ 0 ].texture;\n\n\t\tif ( maskActive ) renderer.state.buffers.stencil.setTest( true );\n\n\t\tif ( this.renderToScreen ) {\n\n\t\t\trenderer.setRenderTarget( null );\n\t\t\tthis.fsQuad.render( renderer );\n\n\t\t} else {\n\n\t\t\trenderer.setRenderTarget( readBuffer );\n\t\t\tthis.fsQuad.render( renderer );\n\n\t\t}\n\n\t\t// Restore renderer settings\n\n\t\trenderer.setClearColor( this._oldClearColor, this.oldClearAlpha );\n\t\trenderer.autoClear = oldAutoClear;\n\n\t}\n\n\tgetSeparableBlurMaterial( kernelRadius ) {\n\n\t\tconst coefficients = [];\n\n\t\tfor ( let i = 0; i < kernelRadius; i ++ ) {\n\n\t\t\tcoefficients.push( 0.39894 * Math.exp( - 0.5 * i * i / ( kernelRadius * kernelRadius ) ) / kernelRadius );\n\n\t\t}\n\n\t\treturn new ShaderMaterial( {\n\n\t\t\tdefines: {\n\t\t\t\t'KERNEL_RADIUS': kernelRadius\n\t\t\t},\n\n\t\t\tuniforms: {\n\t\t\t\t'colorTexture': { value: null },\n\t\t\t\t'invSize': { value: new Vector2( 0.5, 0.5 ) }, // inverse texture size\n\t\t\t\t'direction': { value: new Vector2( 0.5, 0.5 ) },\n\t\t\t\t'gaussianCoefficients': { value: coefficients } // precomputed Gaussian coefficients\n\t\t\t},\n\n\t\t\tvertexShader:\n\t\t\t\t`varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}`,\n\n\t\t\tfragmentShader:\n\t\t\t\t`#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 invSize;\n\t\t\t\tuniform vec2 direction;\n\t\t\t\tuniform float gaussianCoefficients[KERNEL_RADIUS];\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tfloat weightSum = gaussianCoefficients[0];\n\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv ).rgb * weightSum;\n\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat x = float(i);\n\t\t\t\t\t\tfloat w = gaussianCoefficients[i];\n\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\n\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset ).rgb;\n\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset ).rgb;\n\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\n\t\t\t\t\t\tweightSum += 2.0 * w;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}`\n\t\t} );\n\n\t}\n\n\tgetCompositeMaterial( nMips ) {\n\n\t\treturn new ShaderMaterial( {\n\n\t\t\tdefines: {\n\t\t\t\t'NUM_MIPS': nMips\n\t\t\t},\n\n\t\t\tuniforms: {\n\t\t\t\t'blurTexture1': { value: null },\n\t\t\t\t'blurTexture2': { value: null },\n\t\t\t\t'blurTexture3': { value: null },\n\t\t\t\t'blurTexture4': { value: null },\n\t\t\t\t'blurTexture5': { value: null },\n\t\t\t\t'bloomStrength': { value: 1.0 },\n\t\t\t\t'bloomFactors': { value: null },\n\t\t\t\t'bloomTintColors': { value: null },\n\t\t\t\t'bloomRadius': { value: 0.0 }\n\t\t\t},\n\n\t\t\tvertexShader:\n\t\t\t\t`varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}`,\n\n\t\t\tfragmentShader:\n\t\t\t\t`varying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform float bloomStrength;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\n\t\t\t\tfloat lerpBloomFactor(const in float factor) {\n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n\t\t\t\t}`\n\t\t} );\n\n\t}\n\n}\n\nUnrealBloomPass.BlurDirectionX = new Vector2( 1.0, 0.0 );\nUnrealBloomPass.BlurDirectionY = new Vector2( 0.0, 1.0 );\n\nexport { UnrealBloomPass };\n","import {\n\tMatrix4,\n\tObject3D,\n\tVector2,\n\tVector3\n} from 'three';\n\nclass CSS2DObject extends Object3D {\n\n\tconstructor( element = document.createElement( 'div' ) ) {\n\n\t\tsuper();\n\n\t\tthis.isCSS2DObject = true;\n\n\t\tthis.element = element;\n\n\t\tthis.element.style.position = 'absolute';\n\t\tthis.element.style.userSelect = 'none';\n\n\t\tthis.element.setAttribute( 'draggable', false );\n\n\t\tthis.center = new Vector2( 0.5, 0.5 ); // ( 0, 0 ) is the lower left; ( 1, 1 ) is the top right\n\n\t\tthis.addEventListener( 'removed', function () {\n\n\t\t\tthis.traverse( function ( object ) {\n\n\t\t\t\tif (\n\t\t\t\t\tobject.element instanceof object.element.ownerDocument.defaultView.Element &&\n\t\t\t\t\tobject.element.parentNode !== null\n\t\t\t\t) {\n\n\t\t\t\t\tobject.element.remove();\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t} );\n\n\t}\n\n\tcopy( source, recursive ) {\n\n\t\tsuper.copy( source, recursive );\n\n\t\tthis.element = source.element.cloneNode( true );\n\n\t\tthis.center = source.center;\n\n\t\treturn this;\n\n\t}\n\n}\n\n//\n\nconst _vector = new Vector3();\nconst _viewMatrix = new Matrix4();\nconst _viewProjectionMatrix = new Matrix4();\nconst _a = new Vector3();\nconst _b = new Vector3();\n\nclass CSS2DRenderer {\n\n\tconstructor( parameters = {} ) {\n\n\t\tconst _this = this;\n\n\t\tlet _width, _height;\n\t\tlet _widthHalf, _heightHalf;\n\n\t\tconst cache = {\n\t\t\tobjects: new WeakMap()\n\t\t};\n\n\t\tconst domElement = parameters.element !== undefined ? parameters.element : document.createElement( 'div' );\n\n\t\tdomElement.style.overflow = 'hidden';\n\n\t\tthis.domElement = domElement;\n\n\t\tthis.getSize = function () {\n\n\t\t\treturn {\n\t\t\t\twidth: _width,\n\t\t\t\theight: _height\n\t\t\t};\n\n\t\t};\n\n\t\tthis.render = function ( scene, camera ) {\n\n\t\t\tif ( scene.matrixWorldAutoUpdate === true ) scene.updateMatrixWorld();\n\t\t\tif ( camera.parent === null && camera.matrixWorldAutoUpdate === true ) camera.updateMatrixWorld();\n\n\t\t\t_viewMatrix.copy( camera.matrixWorldInverse );\n\t\t\t_viewProjectionMatrix.multiplyMatrices( camera.projectionMatrix, _viewMatrix );\n\n\t\t\trenderObject( scene, scene, camera );\n\t\t\tzOrder( scene );\n\n\t\t};\n\n\t\tthis.setSize = function ( width, height ) {\n\n\t\t\t_width = width;\n\t\t\t_height = height;\n\n\t\t\t_widthHalf = _width / 2;\n\t\t\t_heightHalf = _height / 2;\n\n\t\t\tdomElement.style.width = width + 'px';\n\t\t\tdomElement.style.height = height + 'px';\n\n\t\t};\n\n\t\tfunction hideObject( object ) {\n\n\t\t\tif ( object.isCSS2DObject ) object.element.style.display = 'none';\n\n\t\t\tfor ( let i = 0, l = object.children.length; i < l; i ++ ) {\n\n\t\t\t\thideObject( object.children[ i ] );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction renderObject( object, scene, camera ) {\n\n\t\t\tif ( object.visible === false ) {\n\n\t\t\t\thideObject( object );\n\n\t\t\t\treturn;\n\n\t\t\t}\n\n\t\t\tif ( object.isCSS2DObject ) {\n\n\t\t\t\t_vector.setFromMatrixPosition( object.matrixWorld );\n\t\t\t\t_vector.applyMatrix4( _viewProjectionMatrix );\n\n\t\t\t\tconst visible = ( _vector.z >= - 1 && _vector.z <= 1 ) && ( object.layers.test( camera.layers ) === true );\n\n\t\t\t\tconst element = object.element;\n\t\t\t\telement.style.display = visible === true ? '' : 'none';\n\n\t\t\t\tif ( visible === true ) {\n\n\t\t\t\t\tobject.onBeforeRender( _this, scene, camera );\n\n\t\t\t\t\telement.style.transform = 'translate(' + ( - 100 * object.center.x ) + '%,' + ( - 100 * object.center.y ) + '%)' + 'translate(' + ( _vector.x * _widthHalf + _widthHalf ) + 'px,' + ( - _vector.y * _heightHalf + _heightHalf ) + 'px)';\n\n\t\t\t\t\tif ( element.parentNode !== domElement ) {\n\n\t\t\t\t\t\tdomElement.appendChild( element );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tobject.onAfterRender( _this, scene, camera );\n\n\t\t\t\t}\n\n\t\t\t\tconst objectData = {\n\t\t\t\t\tdistanceToCameraSquared: getDistanceToSquared( camera, object )\n\t\t\t\t};\n\n\t\t\t\tcache.objects.set( object, objectData );\n\n\t\t\t}\n\n\t\t\tfor ( let i = 0, l = object.children.length; i < l; i ++ ) {\n\n\t\t\t\trenderObject( object.children[ i ], scene, camera );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction getDistanceToSquared( object1, object2 ) {\n\n\t\t\t_a.setFromMatrixPosition( object1.matrixWorld );\n\t\t\t_b.setFromMatrixPosition( object2.matrixWorld );\n\n\t\t\treturn _a.distanceToSquared( _b );\n\n\t\t}\n\n\t\tfunction filterAndFlatten( scene ) {\n\n\t\t\tconst result = [];\n\n\t\t\tscene.traverseVisible( function ( object ) {\n\n\t\t\t\tif ( object.isCSS2DObject ) result.push( object );\n\n\t\t\t} );\n\n\t\t\treturn result;\n\n\t\t}\n\n\t\tfunction zOrder( scene ) {\n\n\t\t\tconst sorted = filterAndFlatten( scene ).sort( function ( a, b ) {\n\n\t\t\t\tif ( a.renderOrder !== b.renderOrder ) {\n\n\t\t\t\t\treturn b.renderOrder - a.renderOrder;\n\n\t\t\t\t}\n\n\t\t\t\tconst distanceA = cache.objects.get( a ).distanceToCameraSquared;\n\t\t\t\tconst distanceB = cache.objects.get( b ).distanceToCameraSquared;\n\n\t\t\t\treturn distanceA - distanceB;\n\n\t\t\t} );\n\n\t\t\tconst zMax = sorted.length;\n\n\t\t\tfor ( let i = 0, l = sorted.length; i < l; i ++ ) {\n\n\t\t\t\tsorted[ i ].element.style.zIndex = zMax - i;\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n}\n\nexport { CSS2DObject, CSS2DRenderer };\n","import { CSS2DRenderer, UnrealBloomPass } from 'three/examples/jsm/Addons.js';\nimport { EffectComposer } from 'three/examples/jsm/Addons.js';\nimport { RenderPass } from 'three/examples/jsm/Addons.js';\nimport { OutputPass } from 'three/examples/jsm/Addons.js';\nimport { THREE } from './index.js';\n/**\n *\n */\nexport class AppRenderer {\n\twebgl_renderer;\n\tcss_renderer;\n\tcomposer;\n\t/**\n\t *\n\t */\n\tconstructor(incoming_parent, incoming_camera) {\n\t\tthis.parent = incoming_parent;\n\t\tthis.camera = incoming_camera;\n\t\t// Html rendering\n\t\tthis.css_renderer = new CSS2DRenderer();\n\t\tthis.css_renderer.setSize(window.innerWidth, window.innerHeight);\n\t\tthis.css_renderer.domElement.style.position = 'absolute';\n\t\tthis.css_renderer.domElement.style.top = '0';\n\t\tthis.css_renderer.domElement.style.zIndex = '1'; // On top of WebGL canvas\n\t\tdocument.body.appendChild(this.css_renderer.domElement);\n\t\t// 3D rendering\n\t\tthis.webgl_renderer = new THREE.WebGLRenderer({ antialias: true });\n\t\tthis.webgl_renderer.setSize(window.innerWidth, window.innerHeight);\n\t\tthis.webgl_renderer.shadowMap.enabled = true;\n\t\tthis.webgl_renderer.shadowMap.type = THREE.VSMShadowMap;\n\t\tthis. webgl_renderer.domElement.style.position = 'absolute';\n\t\tthis. webgl_renderer.domElement.style.top = '0';\n\t\tthis.webgl_renderer.domElement.style.zIndex = '0';\n\t\tdocument.body.appendChild(this.webgl_renderer.domElement);\n\t\t// After effects\n\t\tthis.composer = new EffectComposer(this.webgl_renderer);\n\t\tconst output_pass = new OutputPass();\n\t\tconst render_scene = new RenderPass(this.parent, this.camera);\n\t\tconst bloom_pass = new UnrealBloomPass( \n\t\t\tnew THREE.Vector2(window.innerWidth, window.innerHeight), // Resolution\n\t\t\t1.5, // Strength\n\t\t\t0.4, // Radius\n\t\t\t1 // Threshold\n\t\t);\n\t\tthis.composer.addPass(render_scene);\n\t\tthis.composer.addPass(bloom_pass);\n\t\tthis.composer.addPass(output_pass);\n\t}\n\t// ----- Functions\n\t/**\n\t *\n\t */\n\tadd_event_listener(incoming_event_name, handler_method) {\n\t\tthis.webgl_renderer.domElement.addEventListener(incoming_event_name, handler_method);\n\t\tthis.css_renderer.domElement.addEventListener(incoming_event_name, handler_method);\n\t}\n\t/**\n\t *\n\t */\n\tremove_event_listener(incoming_event_name, handler_method) {\n\t\tthis.webgl_renderer.domElement.removeEventListener(incoming_event_name, handler_method);\n\t\tthis.css_renderer.domElement.removeEventListener(incoming_event_name, handler_method);\n\t}\n\t/**\n     * Properly disposes of all renderer resources to prevent memory leaks\n     */\n\tdispose() {\n\t\t// Stop animation loop\n\t\tthis.webgl_renderer.setAnimationLoop(null);\n\t\t// Dispose of composer passes\n\t\tif (this.composer) {\n\t\t\tthis.composer.passes.forEach(pass => {\n\t\t\t\tif (pass.dispose) {\n\t\t\t\t\tpass.dispose();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t// Dispose of renderers\n\t\tif (this.webgl_renderer) {\n\t\t\tthis.webgl_renderer.dispose();\n\t\t\tif (document.body.contains(this.webgl_renderer.domElement)) {\n\t\t\t\tdocument.body.removeChild(this.webgl_renderer.domElement);\n\t\t\t}\n\t\t}\n\t\tif (this.css_renderer && document.body.contains(this.css_renderer.domElement)) {\n\t\t\tdocument.body.removeChild(this.css_renderer.domElement);\n\t\t}\n\t\t// Clear references\n\t\tthis.composer = null;\n\t\tthis.webgl_renderer = null;\n\t\tthis.css_renderer = null;\n\t}\n\t/**\n\t *\n\t */\n\trender() {\n\t\tthis.composer.render();\n\t\tthis.css_renderer.render(this.parent, this.camera);\n\t}\n\t/**\n     * Force a render. Used by the debug UI for smooth resolution changes.\n     */\n\tforceRender() {\n\t\tthis.render();\n\t}\n\t/**\n\t *\n\t */\n\tresize() {\n\t\tthis.webgl_renderer.setSize(window.innerWidth, window.innerHeight);\n\t\tthis.css_renderer.setSize(window.innerWidth, window.innerHeight);\n\t\t// Update bloom pass resolution\n\t\tconst bloomPass = this.composer.passes.find(pass => pass instanceof UnrealBloomPass);\n\t\tif (bloomPass) {\n\t\t\tbloomPass.resolution.set(window.innerWidth, window.innerHeight);\n\t\t}\n\t}\n\t/**\n     * Sets the pixel ratio with proper handling of the post-processing pipeline\n     * @param {number} ratio - The new pixel ratio\n     */\n\tsetPixelRatio(ratio) {\n\t\t// Create overlay for smooth transition\n\t\tconst overlay = document.createElement('div');\n\t\toverlay.style.position = 'fixed';\n\t\toverlay.style.top = '0';\n\t\toverlay.style.left = '0';\n\t\toverlay.style.width = '100%';\n\t\toverlay.style.height = '100%';\n\t\toverlay.style.backgroundColor = 'black';\n\t\toverlay.style.opacity = '0';\n\t\toverlay.style.transition = 'opacity 0.2s ease-in-out';\n\t\toverlay.style.zIndex = '9999'; // Very high z-index to be above everything\n\t\toverlay.style.pointerEvents = 'none'; // Don't block interactions\n\t\tdocument.body.appendChild(overlay);\n\t\t// Store current canvas to properly match the background color\n\t\tconst currentBgColor = window.getComputedStyle(document.body).backgroundColor || 'black';\n\t\toverlay.style.backgroundColor = currentBgColor;\n\t\t// Apply fade-in\n\t\t// Force a reflow to ensure transition works\n\t\toverlay.offsetHeight;\n\t\t// Fade to higher opacity to ensure complete masking\n\t\toverlay.style.opacity = '0.3'; \n\t\t// After fade-in completes, update renderer\n\t\tsetTimeout(() => {\n\t\t\t// Update renderer\n\t\t\tthis.webgl_renderer.setPixelRatio(ratio);\n\t\t\t// Update composer\n\t\t\tthis.composer.setPixelRatio(ratio);\n\t\t\t// Force a render to apply changes - do this twice to ensure all buffers are updated\n\t\t\tthis.render();\n\t\t\t// Wait a bit for the render to complete before starting fade-out\n\t\t\tsetTimeout(() => {\n\t\t\t\t// Double-check with a second render\n\t\t\t\tthis.render();\n\t\t\t\t// Now start fade-out\n\t\t\t\toverlay.style.opacity = '0';\n\t\t\t\t// Clean up after transition\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tif (document.body.contains(overlay)) {\n\t\t\t\t\t\tdocument.body.removeChild(overlay);\n\t\t\t\t\t}\n\t\t\t\t\t// Final render after cleanup\n\t\t\t\t\tthis.render();\n\t\t\t\t}, 250); // Longer cleanup time\n\t\t\t}, 50); // Short delay between renderer update and fade-out\n\t\t}, 200); // Longer delay to ensure fade-in is complete\n\t}\n\t// ----- Setters\n\t/**\n\t *\n\t */\n\tset_animation_loop(incoming_function) {\n\t\tthis.webgl_renderer.setAnimationLoop(incoming_function);\n\t}\n\t// ----- Getters\n\t/**\n     * Returns the WebGL renderer instance\n     * @returns {THREE.WebGLRenderer} The WebGL renderer\n     */\n\tget_renderer() {\n\t\treturn this.webgl_renderer;\n\t}\n} ","import { RAPIER, THREE, initThree } from '../index.js';\nimport { AssetStorage } from '../asset_storage.js';\nimport { BLORKPACK_FLAGS } from '../blorkpack_flags.js';\nconst THROW_MULTIPLIER = 0.1; // Adjust this to control throw strength\nconst SHOVE_FORCE = 4; // Adjust this value to control the force of the shove\nconst ZOOM_AMOUNT = 2;  // Amount to move per scroll event\n// Module state (will be initialized in init())\nlet current_mouse_pos;\nlet initial_grab_distance = 15; // Store initial distance when grabbed\nlet last_position;\nlet current_velocity;\nlet last_time = 0;\nlet isInitialized = false;\n/**\n * Initialize the physics utility module\n * @returns {Promise<void>}\n */\nexport async function initPhysicsUtil() {\n\tif (isInitialized) return;\n\t// Initialize Three.js\n\tawait initThree();\n\t// Now we can safely use THREE classes\n\tcurrent_mouse_pos = new THREE.Vector2();\n\tlast_position = new THREE.Vector3();\n\tcurrent_velocity = new THREE.Vector3();\n\tisInitialized = true;\n}\n\n/**\n * Helper function to find a physics body for an object\n * @param {Object} object - The object to find a physics body for\n * @returns {Object|null} - The physics body or null if not found\n */\nfunction findPhysicsBody(object) {\n\tif (!object) return null;\n\t// 1. Direct property\n\tif (object.physicsBody) return object.physicsBody;\n\t// 2. Check userData\n\tif (object.userData?.physicsBody) return object.userData.physicsBody;\n\t// 3. Check root model\n\tif (object.userData?.rootModel) {\n\t\tconst rootModel = object.userData.rootModel;\n\t\tif (rootModel.physicsBody) return rootModel.physicsBody;\n\t\tif (rootModel.userData?.physicsBody) return rootModel.userData.physicsBody;\n\t}\n\t// 4. Check asset storage\n\tconst bodyPair = AssetStorage.get_instance().get_body_pair_by_mesh(object);\n\tif (bodyPair) return bodyPair[1]; // Extract the body from [mesh, body]\n\t// 5. Traverse up the object hierarchy\n\tlet current = object;\n\tlet depth = 0;\n\tconst MAX_DEPTH = 10;\n\twhile (current && depth < MAX_DEPTH) {\n\t\tif (current.physicsBody) return current.physicsBody;\n\t\tif (current.userData?.physicsBody) return current.userData.physicsBody;\n\t\tif (current.parent) {\n\t\t\tcurrent = current.parent;\n\t\t\tdepth++;\n\t\t} else {\n\t\t\tbreak;\n\t\t}\n\t}\n\t// Not found\n\treturn null;\n}\n\n/**\n * Apply a shove force to an object\n * @param {Object} incoming_object - The object to shove\n * @param {Object} incoming_source - The camera or other source of the shove direction\n */\nexport function shove_object(incoming_object, incoming_source) {\n\tif (!isInitialized) {\n\t\tconsole.warn(\"Physics utils not initialized. Call initPhysicsUtil() first.\");\n\t\treturn;\n\t}\n\tconst body = findPhysicsBody(incoming_object);\n\tif (!body) return;\n\t// Calculate direction from camera to interactable\n\tconst camera_position = new THREE.Vector3();\n\tincoming_source.getWorldPosition(camera_position);\n\tconst interactable_position = new THREE.Vector3();\n\tincoming_object.getWorldPosition(interactable_position);\n\tconst direction = new THREE.Vector3()\n\t\t.subVectors(interactable_position, camera_position)\n\t\t.normalize();\n\t// Apply the impulse force in the calculated direction\n\tbody.applyImpulse(\n\t\t{ x: direction.x * SHOVE_FORCE, y: direction.y * SHOVE_FORCE, z: direction.z * SHOVE_FORCE },\n\t\ttrue\n\t);\n}\n/**\n * Update mouse position for physics interactions\n * @param {MouseEvent} e - The mouse event\n */\nexport function update_mouse_position(e) {\n\tif (!isInitialized) return;\n\tcurrent_mouse_pos.x = (e.clientX / window.innerWidth) * 2 - 1;\n\tcurrent_mouse_pos.y = -(e.clientY / window.innerHeight) * 2 + 1;\n}\n/**\n * Translate (move) an object to follow the mouse position\n * @param {Object} incoming_object - The object to translate\n * @param {THREE.Camera} incoming_camera - The camera to use for raycasting\n */\nexport function translate_object(incoming_object, incoming_camera) {\n\tif (!isInitialized || !incoming_object) return;\n\tconst physicsBody = findPhysicsBody(incoming_object);\n\tif (!physicsBody) {\n\t\tconsole.warn(`No physics body found for translating: ${incoming_object.name}`);\n\t\treturn;\n\t}\n\t// Get ray from camera through mouse point\n\tconst ray_start = new THREE.Vector3();\n\tconst ray_end = new THREE.Vector3();\n\tconst ray_dir = new THREE.Vector3();\n\tray_start.setFromMatrixPosition(incoming_camera.matrixWorld);\n\tray_end.set(current_mouse_pos.x, current_mouse_pos.y, 1).unproject(incoming_camera);\n\tray_dir.subVectors(ray_end, ray_start).normalize();\n\t// Calculate the target position at the desired distance along the ray\n\tconst target_pos = new THREE.Vector3();\n\ttarget_pos.copy(ray_start).addScaledVector(ray_dir, initial_grab_distance);\n\t// Update physics body position\n\tphysicsBody.setTranslation(\n\t\t{ \n\t\t\tx: target_pos.x, \n\t\t\ty: target_pos.y, \n\t\t\tz: target_pos.z \n\t\t}, \n\t\ttrue\n\t);\n\t// Store current position for velocity calculation on release\n\tconst current_time = performance.now();\n\t// Only update last position if enough time has passed to avoid jitter\n\tif (current_time - last_time > 16) {  // Roughly 60fps\n\t\tconst current_pos = physicsBody.translation();\n\t\tlast_position.set(current_pos.x, current_pos.y, current_pos.z);\n\t\tlast_time = current_time;\n\t}\n}\n/**\n * Zoom in (move object closer)\n */\nexport function zoom_object_in() {\n\tinitial_grab_distance += ZOOM_AMOUNT;\n}\n/**\n * Zoom out (move object farther)\n */\nexport function zoom_object_out() {\n\tinitial_grab_distance -= ZOOM_AMOUNT;\n}\n/**\n * Grab an object to start moving it\n * @param {Object} incoming_object - The object to grab\n * @param {THREE.Camera} incoming_camera - The camera to use for positioning\n */\nexport function grab_object(incoming_object, incoming_camera) {\n\tif (!isInitialized || !incoming_object) return;\n\tif (BLORKPACK_FLAGS.ACTIVATE_LOGS) console.log(`Grabbing ${incoming_object.name}`);\n\tconst physicsBody = findPhysicsBody(incoming_object);\n\tif (!physicsBody) {\n\t\tconsole.warn(`No physics body found for ${incoming_object.name}`, incoming_object);\n\t\tif (BLORKPACK_FLAGS.ACTIVATE_LOGS) {\n\t\t\tconsole.log(\"Object properties:\", Object.keys(incoming_object));\n\t\t\tconsole.log(\"Object userData:\", incoming_object.userData);\n\t\t}\n\t\treturn;\n\t}\n\tif (BLORKPACK_FLAGS.ACTIVATE_LOGS) {\n\t\tconsole.log(`Successfully found physics body for ${incoming_object.name}`, physicsBody);\n\t}\n\t// Store initial distance from camera when grabbed\n\tconst camera_pos = new THREE.Vector3();\n\tincoming_camera.getWorldPosition(camera_pos);\n\tconst object_pos = new THREE.Vector3();\n\tobject_pos.copy(physicsBody.translation());\n\tinitial_grab_distance = camera_pos.distanceTo(object_pos);\n\t// Reset velocity tracking\n\tlast_position.copy(object_pos);\n\tlast_time = performance.now();\n\t// Change to kinematic while grabbed to prevent forces from acting on it\n\tphysicsBody.setBodyType(RAPIER.RigidBodyType.KinematicPositionBased);\n\t// Mark object as being moved\n\tincoming_object.userData.isMoving = true;\n\t// Make sure the body is awake\n\tphysicsBody.wakeUp();\n}\n/**\n * Release a grabbed object\n * @param {Object} incoming_object - The object to release\n */\nexport function release_object(incoming_object) {\n\tif (!isInitialized || !incoming_object) return;\n\tconst physicsBody = findPhysicsBody(incoming_object);\n\tif (!physicsBody) {\n\t\tconsole.warn(`No physics body found for release: ${incoming_object.name}`);\n\t\treturn;\n\t}\n\tif (BLORKPACK_FLAGS.ACTIVATE_LOGS) {\n\t\tconsole.log(`Successfully releasing physics body for ${incoming_object.name}`);\n\t}\n\t// Change back to dynamic body\n\tphysicsBody.setBodyType(RAPIER.RigidBodyType.Dynamic);\n\t// Calculate impulse based on recent movement\n\tconst current_time = performance.now();\n\tconst time_diff = (current_time - last_time) / 1000; // Convert to seconds\n\tif (time_diff > 0) {\n\t\tconst current_pos = physicsBody.translation();\n\t\tconst vel = new THREE.Vector3(\n\t\t\t(current_pos.x - last_position.x) / time_diff,\n\t\t\t(current_pos.y - last_position.y) / time_diff,\n\t\t\t(current_pos.z - last_position.z) / time_diff\n\t\t);\n\t\t// Apply calculated impulse\n\t\tphysicsBody.applyImpulse({ \n\t\t\tx: vel.x * THROW_MULTIPLIER, \n\t\t\ty: vel.y * THROW_MULTIPLIER, \n\t\t\tz: vel.z * THROW_MULTIPLIER \n\t\t}, true);\n\t}\n\t// Make sure gravity is properly applied\n\tphysicsBody.setGravityScale(1.0);\n\t// Mark object as no longer moving\n\tincoming_object.userData.isMoving = false;\n} ","/**\n * @fileoverview Type definitions for manifest.json structure\n * This file provides JSDoc type definitions for the manifest structure,\n * which can be used for documentation, reference, and type checking.\n */\n/**\n * @typedef {Object} CustomType\n * @property {string} name - Unique name identifier for this custom type\n * @property {string} version - Version of the custom type\n * @property {Object} load_layers - Which layers to load for this asset type\n * @property {boolean} load_layers.viewable - Whether to load the viewable layer\n * @property {boolean} load_layers.collision - Whether to load the collision layer  \n * @property {boolean} load_layers.display - Whether to load the display layer\n * @property {Object} paths - Paths to associated resources\n * @property {string} paths.asset - Path to the 3D model file\n * @property {string} [paths.script] - Optional path to associated script\n * @property {Object} size - Physical size properties\n * @property {number} size.radius - Radius if applicable\n * @property {number} size.width - Width dimension\n * @property {number} size.height - Height dimension\n * @property {number} size.depth - Depth dimension\n * @property {Object} scale - Scaling factors for rendering\n * @property {number} scale.x - X-axis scale\n * @property {number} scale.y - Y-axis scale\n * @property {number} scale.z - Z-axis scale\n * @property {Object} [scale.ui] - UI-specific scaling\n * @property {number} scale.ui.x - UI X-axis scale\n * @property {number} scale.ui.y - UI Y-axis scale\n * @property {number} scale.ui.z - UI Z-axis scale\n * @property {Object} physics - Physics properties\n * @property {number} physics.restitution - Bounciness factor\n * @property {number} physics.sleep_timer - Time until object goes to sleep\n * @property {number} physics.mass - Object mass\n * @property {number} physics.gravity_scale - How much gravity affects this object\n * @property {number} physics.friction - Surface friction\n * @property {Array<string>} physics.collision_groups - Groups this object belongs to\n * @property {Array<string>} physics.collision_mask - Groups this object collides with\n * @property {Object} visual - Visual properties\n * @property {boolean} visual.emitting - Whether object emits light\n * @property {string} visual.emission_color - Hex color code for emission\n * @property {number} visual.emission_intensity - Intensity of emission\n * @property {number} visual.opacity - Object opacity\n * @property {boolean} visual.cast_shadow - Whether object casts shadows\n * @property {boolean} visual.receive_shadow - Whether object receives shadows\n * @property {Object} visual.debug - Debug visualization properties\n * @property {boolean} visual.debug.enabled - Whether debug visualization is enabled\n * @property {number} visual.debug.opacity - Debug visualization opacity\n * @property {string} visual.debug.color - Hex color code for debug visualization\n */\n/**\n * @typedef {Object} JointData\n * @property {string} type - Joint type (FIXED, REVOLUTE, etc.)\n * @property {Vector3} position - Joint position\n * @property {Vector3} rotation - Joint rotation\n * @property {string} target_id - ID of target object\n * @property {Object} limits - Joint constraints\n * @property {Object} limits.angular - Angular limits\n * @property {Object} limits.angular.x - X-axis angular limits\n * @property {number} limits.angular.x.min - Minimum X-axis angle\n * @property {number} limits.angular.x.max - Maximum X-axis angle\n * @property {Object} limits.angular.y - Y-axis angular limits\n * @property {number} limits.angular.y.min - Minimum Y-axis angle\n * @property {number} limits.angular.y.max - Maximum Y-axis angle\n * @property {Object} limits.angular.z - Z-axis angular limits\n * @property {number} limits.angular.z.min - Minimum Z-axis angle\n * @property {number} limits.angular.z.max - Maximum Z-axis angle\n * @property {Object} limits.linear - Linear limits\n * @property {Object} limits.linear.x - X-axis linear limits\n * @property {number} limits.linear.x.min - Minimum X-axis position\n * @property {number} limits.linear.x.max - Maximum X-axis position\n * @property {Object} limits.linear.y - Y-axis linear limits\n * @property {number} limits.linear.y.min - Minimum Y-axis position\n * @property {number} limits.linear.y.max - Maximum Y-axis position\n * @property {Object} limits.linear.z - Z-axis linear limits\n * @property {number} limits.linear.z.min - Minimum Z-axis position\n * @property {number} limits.linear.z.max - Maximum Z-axis position\n * @property {Object} parameters - Additional joint parameters\n * @property {number} parameters.stiffness - Joint stiffness\n * @property {number} parameters.damping - Joint damping\n */\n/**\n * @typedef {Object} AssetGroup\n * @property {string} id - Unique identifier for the group\n * @property {string} name - Display name\n * @property {string} description - Description of the group\n * @property {Array<string>} tags - Tags for filtering/categorization\n * @property {Array<string>} assets - IDs of assets in this group\n * @property {boolean} active - Whether the group is active\n * @property {string} toggle_behavior - Behavior when toggling (ALL, ONE_AT_A_TIME, etc.)\n */\n/**\n * @typedef {Object} Vector3\n * @property {number} x - X coordinate\n * @property {number} y - Y coordinate\n * @property {number} z - Z coordinate\n */\n/**\n * @typedef {Object} AssetConfig\n * @property {boolean} collidable - Whether the asset can collide\n * @property {boolean} hidden - Whether the asset is hidden\n * @property {boolean} disabled - Whether the asset is disabled\n * @property {boolean} sleeping - Whether the asset starts in sleep state\n * @property {boolean} gravity - Whether the asset is affected by gravity\n * @property {boolean} interactable - Whether the asset can be interacted with\n * @property {boolean} selectable - Whether the asset can be selected\n * @property {boolean} highlightable - Whether the asset can be highlighted\n */\n/**\n * @typedef {Object} AssetData\n * @property {string} id - Unique identifier\n * @property {string} type - Asset type (CUSTOM, PRIMITIVE, etc.)\n * @property {string} asset_type - Reference to custom type if type is CUSTOM\n * @property {string} version - Asset version\n * @property {AssetConfig} config - Asset configuration\n * @property {Array<string>} tags - Tags for filtering/categorization\n * @property {string} group_id - ID of the group this asset belongs to\n * @property {Array<JointData>} joints - Joint data for connected assets\n * @property {Object} parent - Parent asset reference\n * @property {Array<Object>} children - Child assets\n * @property {Vector3} position - Position in 3D space\n * @property {Vector3} rotation - Rotation in 3D space\n * @property {Object} target - Target information\n * @property {string} target.id - ID of target asset\n * @property {Vector3} target.position - Position of target\n * @property {Object} additional_properties - Extra properties specific to asset type\n * @property {string} [additional_properties.color] - Color in hex format\n * @property {number} [additional_properties.intensity] - Light intensity\n * @property {number} [additional_properties.max_distance] - Maximum distance (0 = unlimited)\n * @property {number} [additional_properties.angle] - Spotlight cone angle\n * @property {number} [additional_properties.penumbra] - Spotlight edge softness\n * @property {number} [additional_properties.sharpness] - Spotlight sharpness\n * @property {boolean} [additional_properties.cast_shadows] - Whether it casts shadows\n * @property {boolean} [additional_properties.receive_shadows] - Whether it receives shadows\n * @property {Object} [additional_properties.shadow] - Shadow configuration\n * @property {number} [additional_properties.shadow.blur_samples] - Number of blur samples\n * @property {number} [additional_properties.shadow.radius] - Blur radius\n * @property {Object} [additional_properties.shadow.map_size] - Shadow map dimensions\n * @property {number} [additional_properties.shadow.map_size.width] - Shadow map width\n * @property {number} [additional_properties.shadow.map_size.height] - Shadow map height\n * @property {Object} [additional_properties.shadow.camera] - Shadow camera settings\n * @property {number} [additional_properties.shadow.camera.near] - Shadow camera near plane\n * @property {number} [additional_properties.shadow.camera.far] - Shadow camera far plane\n * @property {number} [additional_properties.shadow.camera.fov] - Shadow camera field of view\n * @property {number} [additional_properties.shadow.bias] - Shadow bias\n * @property {number} [additional_properties.shadow.normal_bias] - Shadow normal bias\n * @property {number} [additional_properties.fov] - Field of view for cameras\n * @property {number} [additional_properties.near] - Near clipping plane\n * @property {number} [additional_properties.far] - Far clipping plane\n * @property {number} [additional_properties.aspect_ratio] - Camera aspect ratio\n * @property {number} [additional_properties.near_clipping] - Near clipping distance\n * @property {number} [additional_properties.far_clipping] - Far clipping distance\n * @property {Object} [additional_properties.physical_dimensions] - Physical dimensions\n * @property {number} [additional_properties.physical_dimensions.width] - Width\n * @property {number} [additional_properties.physical_dimensions.height] - Height\n * @property {number} [additional_properties.physical_dimensions.depth] - Depth\n * @property {Object} [additional_properties.collider_dimensions] - Collider dimensions\n * @property {number} [additional_properties.collider_dimensions.width] - Collider width\n * @property {number} [additional_properties.collider_dimensions.height] - Collider height\n * @property {number} [additional_properties.collider_dimensions.depth] - Collider depth\n * @property {number} [additional_properties.restitution] - Bounciness factor\n * @property {number} [additional_properties.mass] - Physics mass\n * @property {number} [additional_properties.friction] - Surface friction\n * @property {boolean} [additional_properties.raycast_disabled] - Whether raycast is disabled\n * @property {Array} [additional_properties.animations] - Animation configurations\n */\n/**\n * @typedef {Object} SceneData\n * @property {string} version - Scene data version\n * @property {string} name - Scene name\n * @property {string} description - Scene description\n * @property {string} base_url - Base URL for assets\n * @property {Object} greeting_data - Configuration for greeting message display\n * @property {boolean} greeting_data.display - Whether to show a greeting message\n * @property {string} greeting_data.modal_path - Path to the modal HTML file to display (required if display is true)\n * @property {Object} background - Background settings\n * @property {string} background.type - Type of background (IMAGE, COLOR, or SKYBOX)\n * @property {string} background.image_path - Path to background image (only include when type is IMAGE)\n * @property {string} background.color_value - Background color hex (only include when type is COLOR)\n * @property {Object} background.skybox - Skybox settings (only include when type is SKYBOX)\n * @property {boolean} background.skybox.enabled - Whether skybox is enabled\n * @property {string} background.skybox.skybox_path - Path to skybox\n * @property {Object} environment - Environment settings\n * @property {Vector3} environment.gravity - Gravity vector\n * @property {Object} environment.ambient_light - Ambient light settings\n * @property {string} environment.ambient_light.color - Light color hex\n * @property {number} environment.ambient_light.intensity - Light intensity\n * @property {Object} environment.fog - Fog settings\n * @property {boolean} environment.fog.enabled - Whether fog is enabled\n * @property {string} environment.fog.color - Fog color hex\n * @property {number} environment.fog.near - Near fog distance\n * @property {number} environment.fog.far - Far fog distance\n * @property {Object} physics - Physics settings\n * @property {boolean} physics.enabled - Whether physics is enabled\n * @property {number} physics.update_rate - Physics update rate\n * @property {number} physics.substeps - Physics substeps\n * @property {boolean} physics.debug_draw - Whether to draw debug visualization\n * @property {boolean} physics.allow_sleep - Whether to allow objects to sleep when inactive\n * @property {number} physics.linear_sleep_threshold - Threshold for linear velocity sleep determination\n * @property {number} physics.angular_sleep_threshold - Threshold for angular velocity sleep determination\n * @property {number} physics.sleep_threshold - General sleep threshold\n * @property {number} physics.max_velocity_iterations - Maximum velocity solver iterations\n * @property {number} physics.max_velocity_friction - Maximum velocity iterations for friction\n * @property {Object} physics.integration_parameters - Physics integration parameters\n * @property {number} physics.integration_parameters.dt - Fixed timestep delta time\n * @property {number} physics.integration_parameters.erp - Error reduction parameter\n * @property {number} physics.integration_parameters.warmstart_coeff - Coefficient for warm starting\n * @property {number} physics.integration_parameters.allowed_linear_error - Allowed linear error tolerance\n * @property {Object} rendering - Rendering settings\n * @property {boolean} rendering.shadows - Whether to enable shadows\n * @property {boolean} rendering.antialiasing - Whether to enable antialiasing\n * @property {number} rendering.tone_mapping_exposure - Tone mapping exposure\n * @property {string} rendering.output_encoding - Output encoding\n * @property {Object} post_processing - Post-processing settings\n * @property {boolean} post_processing.enabled - Whether post-processing is enabled\n * @property {Object} post_processing.bloom - Bloom effect settings\n * @property {boolean} post_processing.bloom.enabled - Whether bloom is enabled\n * @property {number} post_processing.bloom.strength - Bloom strength\n * @property {number} post_processing.bloom.threshold - Bloom threshold\n * @property {number} post_processing.bloom.radius - Bloom radius\n * @property {Object} post_processing.ssao - SSAO effect settings\n * @property {boolean} post_processing.ssao.enabled - Whether SSAO is enabled\n * @property {number} post_processing.ssao.radius - SSAO radius\n * @property {number} post_processing.ssao.intensity - SSAO intensity\n * @property {boolean} post_processing.ssao.blur - Whether to blur SSAO\n * @property {Object} default_camera - Default camera settings\n * @property {Vector3} default_camera.position - Camera position\n * @property {Vector3} default_camera.target - Camera target\n * @property {number} default_camera.fov - Field of view\n * @property {number} default_camera.near - Near clipping plane\n * @property {number} default_camera.far - Far clipping plane\n * @property {number} default_camera.ui_distance - Distance for UI placement in front of camera\n * @property {Object} default_camera.controls - Camera controls\n * @property {string} default_camera.controls.type - Control type (ORBIT, FLY, etc.)\n * @property {boolean} default_camera.controls.enable_damping - Whether to enable damping\n * @property {number} default_camera.controls.damping_factor - Damping factor\n * @property {number} default_camera.controls.min_distance - Minimum distance\n * @property {number} default_camera.controls.max_distance - Maximum distance\n * @property {number} default_camera.controls.min_polar_angle - Minimum polar angle\n * @property {number} default_camera.controls.max_polar_angle - Maximum polar angle\n * @property {boolean} default_camera.controls.enable_zoom - Whether to enable zoom\n * @property {boolean} default_camera.controls.enable_rotate - Whether to enable rotation\n * @property {boolean} default_camera.controls.enable_pan - Whether to enable panning\n * @property {Object} default_camera.shoulder_lights - Shoulder light settings\n * @property {boolean} default_camera.shoulder_lights.enabled - Whether shoulder lights are enabled\n * @property {Object} default_camera.shoulder_lights.left - Left shoulder light settings\n * @property {Object} default_camera.shoulder_lights.left.position - Position of left shoulder light\n * @property {number} default_camera.shoulder_lights.left.position.x - X position\n * @property {number} default_camera.shoulder_lights.left.position.y - Y position\n * @property {number} default_camera.shoulder_lights.left.position.z - Z position\n * @property {Object} default_camera.shoulder_lights.left.rotation - Rotation of left shoulder light\n * @property {number} default_camera.shoulder_lights.left.rotation.pitch - Pitch rotation \n * @property {number} default_camera.shoulder_lights.left.rotation.yaw - Yaw rotation\n * @property {number} default_camera.shoulder_lights.left.angle - Angle of left spotlight cone\n * @property {number} default_camera.shoulder_lights.left.max_distance - Maximum distance (0 = unlimited)\n * @property {number} default_camera.shoulder_lights.left.intensity - Light intensity\n * @property {Object} default_camera.shoulder_lights.right - Right shoulder light settings\n * @property {Object} default_camera.shoulder_lights.right.position - Position of right shoulder light\n * @property {number} default_camera.shoulder_lights.right.position.x - X position\n * @property {number} default_camera.shoulder_lights.right.position.y - Y position\n * @property {number} default_camera.shoulder_lights.right.position.z - Z position\n * @property {Object} default_camera.shoulder_lights.right.rotation - Rotation of right shoulder light\n * @property {number} default_camera.shoulder_lights.right.rotation.pitch - Pitch rotation\n * @property {number} default_camera.shoulder_lights.right.rotation.yaw - Yaw rotation\n * @property {number} default_camera.shoulder_lights.right.angle - Angle of right spotlight cone\n * @property {number} default_camera.shoulder_lights.right.max_distance - Maximum distance (0 = unlimited)\n * @property {number} default_camera.shoulder_lights.right.intensity - Light intensity\n */\n/**\n * @typedef {Object} Manifest\n * @property {string} manifest_version - Version of the manifest format\n * @property {string} name - Manifest name\n * @property {string} description - Manifest description\n * @property {string} author - Author of the manifest\n * @property {string} created_date - Creation date\n * @property {string} updated_date - Last update date\n * @property {Array<CustomType>} custom_types - Custom type definitions\n * @property {JointData} joint_data - Joint data for connecting assets\n * @property {Array<AssetGroup>} asset_groups - Asset groups\n * @property {Object<string, AssetData>} asset_data - Asset data indexed by ID\n * @property {Array<Object>} application_assets - Application-specific assets\n * @property {Array<Object>} system_assets - System assets\n * @property {SceneData} scene_data - Scene configuration\n */\n// Export the type definitions\nexport const MANIFEST_TYPES = {\n\t// This empty object helps with imports\n};\n// Export symbols for documentation purposes\nexport const typeDefs = {\n\tManifest: '/** @type {Manifest} */',\n\tCustomType: '/** @type {CustomType} */',\n\tJointData: '/** @type {JointData} */',\n\tAssetGroup: '/** @type {AssetGroup} */',\n\tAssetData: '/** @type {AssetData} */',\n\tSceneData: '/** @type {SceneData} */'\n}; ","// Export dependencies for external use\nimport { clone as cloneSkinnedMesh } from 'three/examples/jsm/utils/SkeletonUtils.js';\nimport { Easing, Tween } from 'three/examples/jsm/libs/tween.module.js';\nimport { createRapierProxy } from './rapier_proxy.js';\nimport { createThreeProxy } from './three_proxy.js';\n// Create the proxies that will lazy-load modules when init() is called\nexport const RAPIER = createRapierProxy();\nexport const THREE = createThreeProxy();\n// Create utilities that we will export\nexport const AssetUtils = {\n\tcloneSkinnedMesh\n};\n/**\n * Initialize Rapier physics engine. Must be called before using RAPIER.\n * @returns {Promise<void>}\n */\nexport async function initRapier() {\n\treturn RAPIER.init();\n}\n/**\n * Initialize Three.js. Must be called before using THREE.\n * @returns {Promise<void>}\n */\nexport async function initThree() {\n\treturn THREE.init();\n}\nexport { Easing, Tween };\n// Re-export asset management components\nexport * from './asset_storage.js';\nexport * from './asset_activator.js';\nexport * from './asset_spawner/asset_spawner.js';\nexport * from './manifest_manager.js';\nexport * from './loaders.js';\nexport * from './app_renderer.js';\nexport * from './physics/index.js'; // Export physics utilities\nimport { AssetStorage } from './asset_storage.js';\nimport { AssetSpawner } from './asset_spawner/asset_spawner.js';\nimport { AssetActivator } from './asset_activator.js';\nimport { ManifestManager } from './manifest_manager.js';\nimport { AppRenderer } from './app_renderer.js';\nimport CustomTypeManager from './custom_type_manager.js';\nimport { BLORKPACK_FLAGS } from './blorkpack_flags.js';\nimport { MANIFEST_TYPES } from './manifest_types.js';\nimport { initPhysicsUtil } from './physics/physics_util.js';\nimport { SystemAssetType } from './asset_spawner/common/system_asset_types.js';\n// Export the components\nexport {\n\tManifestManager,\n\tMANIFEST_TYPES,\n\tAssetSpawner,\n\tAssetStorage,\n\tAssetActivator,\n\tAppRenderer,\n\tCustomTypeManager,\n\tBLORKPACK_FLAGS,\n\tinitPhysicsUtil,\n\tSystemAssetType\n}; "],"names":["clone","Group","Sequence","Tween","_a","threeModule","RAPIER","isInitialized","initPromise","self","res","URL","sourceURI","node","accessor","CustomTypeManager","material","_b","_q","_assetTypes","_assetConfigs","_instance","_disposed","system_factory","create_spotlight_helper","update_helpers","cloneSkinnedMesh"],"mappings":"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","x_google_ignoreList":[0,1,5,6,23,24,25,26,27,28,29,30,31,32,33]}